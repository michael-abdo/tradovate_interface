// ==UserScript==
// @name         Auto Order (Modular)
// @namespace    http://tampermonkey.net/
// @version      6.0
// @description  Thin wrapper that loads the modular Tradovate automation driver and UI panel.
// @author       You
// @match        https://trader.tradovate.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tradovate.com
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    const driverSource = "var TradovateAutoDriverBundle=(()=>{var j=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var me=Object.prototype.hasOwnProperty;var be=(L,k)=>{for(var M in k)j(L,M,{get:k[M],enumerable:!0})},fe=(L,k,M,F)=>{if(k&&typeof k==\"object\"||typeof k==\"function\")for(let A of ye(k))!me.call(L,A)&&A!==M&&j(L,A,{get:()=>k[A],enumerable:!(F=ge(k,A))||F.enumerable});return L};var xe=L=>fe(j({},\"__esModule\",{value:!0}),L);var Se={};be(Se,{createAutoDriver:()=>ke,default:()=>ve});(function(){\"use strict\";console.log(\"Auto Order script initialized\");var L=!1;function k(t){return console.log(`Delaying for ${t}ms`),new Promise(n=>setTimeout(n,t))}function M(){console.log(\"Creating UI\");let t=localStorage.getItem(\"bracketTrade_tp\")||\"120\",n=localStorage.getItem(\"bracketTrade_sl\")||\"40\",l=localStorage.getItem(\"bracketTrade_qty\")||\"9\",i=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",y=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\";console.log(`Stored values: TP=${t}, SL=${n}, Qty=${l}, Tick=${i}, Symbol=${y}`);let a=document.createElement(\"div\");a.id=\"bracket-trade-box\",Object.assign(a.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"});let m=0,f=0;m&&f?(a.style.left=m,a.style.top=f):(a.style.top=\"20px\",a.style.right=\"20px\"),a.innerHTML=`\n    <!-- Header with Symbol -->\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n        <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n        <input type=\"text\" id=\"symbolInput\" value=\"${y}\"\n            style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n            placeholder=\"Symbol\" />\n    </div>\n\n    <!-- Hidden Tick Size Input -->\n    <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n        <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n        <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${i}\"\n            style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n    </div>\n\n    <!-- Main Controls -->\n    <div id=\"mainControls\">\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"tpInput\" value=\"${t}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Ticks\" />\n                <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"slInput\" value=\"${n}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Ticks\" />\n                <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n            <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n            <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                <input type=\"number\" id=\"qtyInput\" value=\"${l}\" min=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n            </div>\n            <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n        </div>\n        <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n            <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n            <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n        </div>\n\n        <!-- NEW: Breakeven button above Reverse -->\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n        </div>\n\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n        </div>\n    </div>`,document.body.appendChild(a),console.log(\"UI container added to DOM\");let o=document.createElement(\"div\");o.id=\"bracket-trade-tray\",Object.assign(o.style,{position:\"fixed\",top:a.style.top||\"20px\",left:\"0px\",background:\"#24262b\",border:\"1px solid #444\",padding:\"10px\",borderRadius:\"8px\",boxShadow:\"0 2px 10px rgba(0,0,0,0.4)\",color:\"#fff\",width:\"140px\",zIndex:\"99999\",display:\"none\"}),o.innerHTML=`\n      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\n        <div style=\"font-weight:600;\">Price Tray</div>\n        <button id=\"trayCloseBtn\" title=\"Hide\"\n          style=\"background:#333;border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;\">\\xD7</button>\n      </div>\n      <div style=\"display:flex;flex-direction:column;gap:6px\">\n        <button id=\"tray-btn-high\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">High</button>\n        <button id=\"tray-btn-low\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Low</button>\n        <button id=\"tray-btn-open\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Open</button>\n        <button id=\"tray-btn-close\" style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Close</button>\n        <button id=\"tray-btn-mid\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Middle</button>\n      </div>\n    `,document.body.appendChild(o);let s=document.createElement(\"button\");s.id=\"trayToggle\",s.textContent=\"\\u25C2 O/L/H/C/M\",Object.assign(s.style,{position:\"absolute\",right:\"-92px\",top:\"0\",height:\"32px\",background:\"#30343b\",color:\"#fff\",border:\"1px solid #444\",borderRadius:\"0 8px 8px 0\",padding:\"4px 8px\",cursor:\"pointer\"}),a.appendChild(s);function g(){let e=a.getBoundingClientRect();o.style.top=`${e.top}px`,o.style.left=`${e.right+8}px`}g(),window.addEventListener(\"resize\",g),s.addEventListener(\"click\",()=>{g(),o.style.display=o.style.display===\"none\"?\"block\":\"none\"}),o.querySelector(\"#trayCloseBtn\")?.addEventListener(\"click\",()=>{o.style.display=\"none\"});let r=null;function v(){let e=(document.getElementById(\"tickInput\")?.value||\"\").toString(),d=e.indexOf(\".\");return d===-1?0:e.length-d-1}setInterval(()=>{try{if(typeof A==\"function\"){if(r=A(),r){let e={open:[\"tray-btn-open\",\"Open\"],low:[\"tray-btn-low\",\"Low\"],high:[\"tray-btn-high\",\"High\"],close:[\"tray-btn-close\",\"Close\"]};for(let[c,[u,b]]of Object.entries(e)){let w=document.getElementById(u);if(!w)continue;let $=r[c];w.title=$!=null?`${b}: ${$}`:`${b}: \\u2014`}let d=document.getElementById(\"tray-btn-mid\");if(d){let c=r.open,u=r.close;if(typeof c==\"number\"&&typeof u==\"number\"){let b=v(),w=((c+u)/2).toFixed(b);d.title=`Mid (O+C)/2: ${w}`}else d.title=\"Mid (O+C)/2: \\u2014\"}}g()}}catch(e){console.warn(\"extractTradovateDataBox polling error:\",e)}},500);function x(e){let d=document.getElementById(\"entryPriceInput\");if(!d||e==null)return;Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(d,e),[\"input\",\"change\",\"blur\"].forEach(u=>d.dispatchEvent(new Event(u,{bubbles:!0})))}function p(e){if(!r||r[e]==null){console.warn(`No ${e} available from databox`);return}x(r[e])}function S(){if(!r||typeof r.open!=\"number\"||typeof r.close!=\"number\"){console.warn(\"Mid price unavailable (need open & close)\");return}let e=v(),d=((r.high+r.low)/2).toFixed(e);x(d)}document.getElementById(\"tray-btn-open\")?.addEventListener(\"click\",()=>p(\"open\")),document.getElementById(\"tray-btn-low\")?.addEventListener(\"click\",()=>p(\"low\")),document.getElementById(\"tray-btn-high\")?.addEventListener(\"click\",()=>p(\"high\")),document.getElementById(\"tray-btn-close\")?.addEventListener(\"click\",()=>p(\"close\")),document.getElementById(\"tray-btn-mid\")?.addEventListener(\"click\",S),console.log(\"Setting up UI event handlers\");let I=document.getElementById(\"slInput\"),h=document.getElementById(\"tpInput\"),T=document.getElementById(\"qtyInput\");document.getElementById(\"slInput\").addEventListener(\"input\",()=>{console.log(`SL input changed to: ${I.value}`);let e=parseFloat(I.value);isNaN(e)||(h.value=e*3,console.log(`Calculated TP: ${h.value} (SL \\xD7 3)`)),localStorage.setItem(\"bracketTrade_sl\",I.value),localStorage.setItem(\"bracketTrade_tp\",h.value)}),h.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${h.value}`),localStorage.setItem(\"bracketTrade_tp\",h.value)}),document.getElementById(\"qtyInput\").addEventListener(\"input\",e=>{console.log(`Quantity input changed to: ${e.target.value}`),localStorage.setItem(\"bracketTrade_qty\",e.target.value)}),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let e=document.getElementById(\"symbolInput\").value||\"NQ\",d=N(e);console.log(`Calling clickExitForSymbol for: ${d} with Exit at Mkt & Cxl option`),F(d,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",d)}catch(e){console.error(\"Close All operation failed:\",e);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(d){console.error(\"Fallback close method also failed:\",d)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let e=document.getElementById(\"symbolInput\").value||\"NQ\",d=N(e);console.log(`Calling clickExitForSymbol for: ${d} with Cancel All option`),F(d,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",d)}catch(e){console.error(\"Cancel All operation failed:\",e)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let e=document.getElementById(\"symbolInput\").value||\"NQ\",d=N(e);console.log(`Calling clickExitForSymbol for: ${d} with Reverse & Cxl option`),F(d,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",d)}catch(e){console.error(\"Reverse Position operation failed:\",e)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",async()=>{console.log(\"Breakeven button clicked\");try{let e=document.getElementById(\"symbolInput\").value||\"NQ\",d=N(e);console.log(`Breakeven for symbol: ${d}`);let c=C=>(C||\"\").replace(/\\s+/g,\" \").trim().toUpperCase(),u=[...document.querySelectorAll(\".contract-symbol span\")].find(C=>{let O=c(C.textContent),pe=c(d);return O===pe||O.startsWith(c(e))});if(!u)return console.error(\"Breakeven: contract header not found\");let w=[...(u.closest(\".gm-scroll-view\")||u.closest(\".header\")||document).querySelectorAll(\".info-column\")].find(C=>/position/i.test(C.querySelector(\"small\")?.textContent||\"\"));if(!w){console.error(\"Breakeven: Position column not found\");return}let $=w.querySelector(\".number\"),q=$?.querySelector(\"span\"),X=($?.textContent||\"\").trim().match(/@([\\d.,]+)/);if(!X){console.error(\"Breakeven: could not parse entry price from Position\");return}let G=parseFloat(X[1].replace(/,/g,\"\")),Q=1;if(q){let C=parseFloat(q.textContent.replace(/[^\\d.-]/g,\"\"));!isNaN(C)&&C!==0&&(Q=Math.abs(C))}let U=\"LONG\",Z=q?.classList||$?.classList||{contains:()=>!1};Z.contains(\"text-danger\")&&(U=\"SHORT\"),Z.contains(\"text-success\")&&(U=\"LONG\");let W=U===\"LONG\"?\"Sell\":\"Buy\";console.log(`Breakeven detected: side=${U}, qty=${Q}, entry=${G}. Placing ${W} LIMIT at entry.`);let H=document.getElementById(\"tpCheckbox\"),Y=document.getElementById(\"slCheckbox\"),se=H.checked,de=Y.checked;H.checked=!1,Y.checked=!1;let ue=(()=>{let O=(parseFloat(document.getElementById(\"tickInput\").value)||.25).toString();return O.includes(\".\")?O.length-O.indexOf(\".\")-1:0})();document.getElementById(\"entryPriceInput\").value=G.toFixed(ue),document.getElementById(\"qtyInput\").value=Q.toString(),[\"input\",\"change\",\"blur\"].forEach(C=>{document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(C,{bubbles:!0})),document.getElementById(\"qtyInput\").dispatchEvent(new Event(C,{bubbles:!0}))}),await R(e,Q,W,null,null,parseFloat(document.getElementById(\"tickInput\").value)||.25),H.checked=se,Y.checked=de,document.getElementById(\"entryPriceInput\").value=\"\",[\"input\",\"change\",\"blur\"].forEach(C=>document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(C,{bubbles:!0})))}catch(e){console.error(\"Breakeven action failed:\",e)}}),console.log(\"Setting up persistent settings\"),document.getElementById(\"symbolInput\").value=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\",document.getElementById(\"symbolInput\").addEventListener(\"input\",e=>{console.log(`Symbol input changed to: ${e.target.value}`),localStorage.setItem(\"bracketTrade_symbol\",e.target.value)}),document.getElementById(\"symbolInput\").addEventListener(\"change\",e=>{let d=e.target.value,c=N(d);console.log(`Symbol changed to: ${d}, normalized: ${c}`);let u=d.replace(/[A-Z]\\d+$/,\"\"),b=V[u];if(b){console.log(`Found default values for ${u}: SL=${b.defaultSL}, TP=${b.defaultTP}`);let w=document.getElementById(\"slInput\"),$=document.getElementById(\"tpInput\"),q=document.getElementById(\"tickInput\");w.value=b.defaultSL,$.value=b.defaultTP,typeof b.tickSize==\"number\"&&(q.value=b.tickSize,localStorage.setItem(\"bracketTrade_tick\",b.tickSize),console.log(`Updated tick size to ${b.tickSize} for ${u}`)),localStorage.setItem(\"bracketTrade_sl\",b.defaultSL),localStorage.setItem(\"bracketTrade_tp\",b.defaultTP),console.log(`Updated SL/TP to default values for ${u}: SL=${w.value}, TP=${$.value}`)}J(\".search-box--input\",c)}),document.getElementById(\"tickInput\").value=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",document.getElementById(\"tickInput\").addEventListener(\"input\",e=>{console.log(`Tick size input changed to: ${e.target.value}`),localStorage.setItem(\"bracketTrade_tick\",e.target.value)}),console.log(\"Setting up drag functionality\");let E=!1,B,P;a.addEventListener(\"mousedown\",e=>{console.log(\"Container mousedown event detected\"),E=!0,B=e.clientX-a.getBoundingClientRect().left,P=e.clientY-a.getBoundingClientRect().top,console.log(`Drag started at offset X:${B}, Y:${P}`),a.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",e=>{if(E){let d=`${e.clientX-B}px`,c=`${e.clientY-P}px`;e.clientX%20===0&&console.log(`Dragging panel to X:${d}, Y:${c}`),a.style.left=d,a.style.top=c,a.style.right=\"unset\",g()}}),document.addEventListener(\"mouseup\",()=>{E&&(console.log(`Container drop position: Left:${a.style.left}, Top:${a.style.top}`),localStorage.setItem(\"bracketTradeBoxLeft\",a.style.left),localStorage.setItem(\"bracketTradeBoxTop\",a.style.top)),E=!1,a.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let e=document.getElementById(\"symbolInput\").value||\"NQ\",d=+T.value,c=+h.value,u=+I.value,b=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${e}, Qty=${d}, TP=${c}, SL=${u}, TickSize=${b}`),R(e,d,\"Buy\",c,u,b).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let e=document.getElementById(\"symbolInput\").value||\"NQ\",d=+T.value,c=+h.value,u=+I.value,b=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${e}, Qty=${d}, TP=${c}, SL=${u}, TickSize=${b}`),R(e,d,\"Sell\",c,u,b).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}async function F(t,n=\"cancel-option-Exit-at-Mkt-Cxl\"){let l={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},i={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},y=c=>(c||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),a=c=>new Promise(u=>setTimeout(u,c));async function m(c,{timeout:u=1200,interval:b=50}={}){let w=performance.now();for(;performance.now()-w<u;){let $=c();if($)return $;await a(b)}return null}let f=n.toLowerCase(),o=l[f]||n,s=i[o]||null,g=y(t),r=/^[A-Z]{1,3}$/.test(g),v=[...document.querySelectorAll(\".header .contract-symbol span\")].find(c=>{let u=y(c.textContent);return u===g||r&&u.startsWith(g)});if(!v)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let p=v.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),S=p?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),I=p?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!p||!S||!I)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(s?s.test(y(S.textContent)):!1)return S.click(),!0;I.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let T=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(c=>c.offsetParent!==null||/display\\s*:\\s*block/i.test(c.getAttribute(\"style\")||\"\")||!!c.closest(\".open\")),E=await m(T,{timeout:900,interval:40});if(!E||!E.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let B=I.getBoundingClientRect();E.sort((c,u)=>{let b=c.getBoundingClientRect(),w=u.getBoundingClientRect(),$=Math.hypot(b.left-B.left,b.top-B.bottom),q=Math.hypot(w.left-B.left,w.top-B.bottom);return $-q});let P=E[0],e=document.getElementById(o);if(!e&&s){for(let c of E)if(e=[...c.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(u=>s.test(y(u.textContent))),e){P=c;break}}if(!e)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let d=e.tagName?e.matches(\"a,button\")?e:e.querySelector(\"a,button\")||e:e;return[\"mousedown\",\"mouseup\",\"click\"].forEach(c=>d.dispatchEvent(new MouseEvent(c,{bubbles:!0}))),I.click(),await a(120),E=T(),e=document.getElementById(o)||(s?E?.flatMap(c=>[...c.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(c=>s.test(y(c.textContent))):null),e?([\"mousedown\",\"mouseup\",\"click\"].forEach(c=>(e.querySelector(\"a,button\")||e).dispatchEvent(new MouseEvent(c,{bubbles:!0}))),await a(80),S.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function A(t=document){let n=[...t.querySelectorAll(\".databox.react-draggable.react-resizable\")].find(m=>m.offsetParent!==null);if(!n)return null;let y={timestamp:((m,f=n)=>{let o=f.querySelector(m);return o?o.textContent.trim():null})(\".header .title\")||null};return n.querySelectorAll(\".gm-scroll-view .entries li\").forEach(m=>{let f=m.querySelector(\".label\"),o=m.querySelector(\".desc\");if(!f||!o)return;let s=f.cloneNode(!0);s.querySelectorAll(\"span\").forEach(S=>S.remove());let g=(s.textContent||\"\").trim().toLowerCase().replace(/[^a-z0-9]/g,\"\"),r=(o.textContent||\"\").trim(),x={open:\"open\",high:\"high\",low:\"low\",close:\"close\",volume:\"volume\",atr:\"atr\",vwap:\"vwap\",upperband1:\"upperBand1\",lowerband1:\"lowerBand1\",upperband2:\"upperBand2\",lowerband2:\"lowerBand2\"}[g]||g,p=r.replace(/,/g,\"\");x===\"volume\"?p=Number.parseInt(p,10):p=Number.parseFloat(p),y[x]=Number.isNaN(p)?r:p}),y}document.querySelectorAll(\"#bracket-trade-box, #bracket-trade-tray\").forEach(t=>t.remove()),M(),console.log(\"UI creation complete\");async function J(t,n){console.log(`updateSymbol called with selector: \"${t}\", value: \"${n}\"`);let l=document.querySelectorAll(t);console.log(`Found ${l.length} matching inputs`);let i=l[1]||l[0];if(!i){console.error(\"No matching input elements found!\");return}console.log(\"Selected input:\",i);let y=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,a=m=>i.dispatchEvent(new KeyboardEvent(m,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),y.call(i,\"\"),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await k(400),console.log(`Setting input value to: \"${n}\"`),y.call(i,n),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await k(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(a),i.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function Ie(t){let n=\"input.form-control\";for(let l=0;l<20;l++){let i=document.querySelector(n);if(i&&i.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,t),[\"input\",\"change\",\"blur\"].forEach(a=>i.dispatchEvent(new Event(a,{bubbles:!0}))),await k(300);return}await k(100)}console.error(\"Price input not found\")}function N(t){console.log(`normalizeSymbol called with: \"${t}\"`);let n=/^[A-Z]{1,3}$/.test(t);console.log(`Is root symbol: ${n}`);let l=n?te(t):t.toUpperCase();return console.log(`Normalized symbol: \"${l}\"`),l}async function ee(t){console.log(\"Creating bracket orders with data:\",t);let n=document.getElementById(\"tpCheckbox\").checked,l=document.getElementById(\"slCheckbox\").checked;console.log(`TP enabled: ${n}, SL enabled: ${l}`);async function i(o,s){let g=[...document.querySelectorAll(\".trading-ticket\")].find(p=>p.offsetParent);if(!g)return console.error(\"No visible trading ticket\");let r;for(let p=0;p<25&&(r=[...g.querySelectorAll(o)].find(S=>S.offsetParent&&!S.disabled),!r);p++)await k(100);if(!r)return console.error(`No live input for ${o}`);let v=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,x=r.closest(\".select-input.combobox\");x&&!r.value&&(x.querySelector(\".btn\")?.click(),await k(150),x.querySelector(\".dropdown-menu li\")?.click(),await k(150));for(let p=0;p<3&&(r.focus(),v.call(r,s),r.dispatchEvent(new Event(\"input\",{bubbles:!0})),r.dispatchEvent(new Event(\"change\",{bubbles:!0})),r.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),r.blur(),await k(250),`${r.value}`.trim()!==`${s}`);p++);}async function y(){if(console.log(\"Setting common order fields\"),t.action){console.log(`Setting action to: ${t.action}`);let o=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${o.length} action labels`),o.forEach(s=>{s.textContent.trim()===t.action&&(console.log(`Clicking ${t.action} label`),s.click())})}t.qty&&(console.log(`Setting quantity to: ${t.qty}`),await i(\".select-input.combobox input\",t.qty))}function a(o=document){let s=o.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(s,g=>{let r=g.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),v=r[0]?.textContent.trim()||\"\",x=r[1]?.textContent.trim()||\"\",p=r[2]?.textContent.trim()||\"\",S=r[3]?.textContent.trim()||\"\",I=null,h=p.match(/@([\\d.]+)/);return h&&(I=Number(h[1])),{timestamp:v,id:x,event:p,comment:S,fillPrice:I}})}function m(o=\"up\"){let s=document.querySelector(\".numeric-input-value-controls\");if(!s)return;s.querySelector(o===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function f(o,s){await y(),document.querySelector(\".group.order-type .select-input div[tabindex]\")?.click(),[...document.querySelectorAll(\"ul.dropdown-menu li\")].find(r=>r.textContent.trim()===o)?.click(),s&&await i(\".numeric-input.feedback-wrapper input\",s),m(),document.querySelector(\".btn-group .btn-primary\")?.click(),await k(200),console.log(a()),document.querySelector(\".icon.icon-back\")?.click(),await k(200)}return console.log(`Submitting initial ${t.orderType||\"MARKET\"} order`),await f(t.orderType||\"MARKET\",t.entryPrice),t.action===\"Buy\"?(console.log(\"Flipping action to Sell for TP/SL orders\"),t.action=\"Sell\",n&&(console.log(`Creating take profit order at ${t.takeProfit}`),await f(\"LIMIT\",t.takeProfit)),l&&(console.log(`Creating stop loss order at ${t.stopLoss}`),await f(\"STOP\",t.stopLoss))):(console.log(\"Flipping action to Buy for TP/SL orders\"),t.action=\"Buy\",n&&(console.log(`Creating take profit order at ${t.takeProfit}`),await f(\"LIMIT\",t.takeProfit)),l&&(console.log(`Creating stop loss order at ${t.stopLoss}`),await f(\"STOP\",t.stopLoss))),console.log(\"Bracket order creation complete\"),Promise.resolve()}function Ee(t=document){let n=t.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(n,l=>{let i=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),y=i[0]?.textContent.trim()||\"\",a=i[1]?.textContent.trim()||\"\",m=i[2]?.textContent.trim()||\"\",f=i[3]?.textContent.trim()||\"\",o=null,s=m.match(/@([\\d.]+)/);return s&&(o=Number(s[1])),{timestamp:y,id:a,event:m,comment:f,fillPrice:o}})}let V={MNQ:{tickSize:.25,tickValue:.5,defaultSL:40,defaultTP:100,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:40,defaultTP:100,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function R(t,n=1,l=\"Buy\",i=null,y=null,a=.25){console.log(`autoTrade called with: symbol=${t}, qty=${n}, action=${l}, TP=${i}, SL=${y}, tickSize=${a}`);let m=document.getElementById(\"symbolInput\").value||\"NQ\";console.log(`Using symbol: ${m}`);let f=m.replace(/[A-Z]\\d+$/,\"\");console.log(`Root symbol: ${f}`);let o=V[f];f!==R.lastRootSymbol&&(document.getElementById(\"tickInput\").value=o?.tickSize??\"\"),R.lastRootSymbol=f;let s=o&&typeof o.tickSize==\"number\"?o.tickSize:parseFloat(document.getElementById(\"tickInput\").value)||a;tickInput.value=s,localStorage.setItem(\"bracketTrade_tick\",s);let g=y||o?.defaultSL||parseInt(document.getElementById(\"slInput\").value)||40,r=i||o?.defaultTP||parseInt(document.getElementById(\"tpInput\").value)||100,v=o?.tickSize?\"dictionary\":document.getElementById(\"tickInput\").value?\"input field\":\"default parameter\";console.log(`Using tick size ${s} (from ${v})`),console.log(`Using SL: ${g} ticks, TP: ${r} ticks`),console.log(`Getting market data for ${m}`);let x=oe(m);if(!x){console.error(`No market data for ${m}`);return}console.log(\"Market data:\",x);let p=document.getElementById(\"entryPriceInput\"),S=p&&p.value?parseFloat(p.value):null,I=parseFloat(l===\"Buy\"?x.offerPrice:x.bidPrice);console.log(`Market price: ${I} (${l===\"Buy\"?\"offer\":\"bid\"} price)`);let h=\"MARKET\",T=I;S!==null?(console.log(`Custom entry price provided: ${S}`),T=S,l===\"Buy\"?h=S<I?\"LIMIT\":\"STOP\":h=S>I?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${h}`)):console.log(`No custom entry price provided, using market order at ${I}`);let E=o?.precision??2;console.log(`Using price precision: ${E} decimal places`);let B=document.getElementById(\"slPriceInput\"),P=document.getElementById(\"tpPriceInput\"),e=B&&B.value?parseFloat(B.value):null,d=P&&P.value?parseFloat(P.value):null,c;e!==null?(c=e.toFixed(E),console.log(`Using hardcoded SL price: ${c}`)):(c=(l===\"Buy\"?T-g*s:T+g*s).toFixed(E),console.log(`Calculated SL price: ${c} (${l===\"Buy\"?\"entry - \":\"entry + \"}${g} ticks)`));let u;d!==null?(u=d.toFixed(E),console.log(`Using hardcoded TP price: ${u}`)):(u=(l===\"Buy\"?T+r*s:T-r*s).toFixed(E),console.log(`Calculated TP price: ${u} (${l===\"Buy\"?\"entry + \":\"entry - \"}${r} ticks)`));let b={symbol:x.symbol,action:l,qty:n.toString(),takeProfit:u,stopLoss:c,orderType:h,entryPrice:h!==\"MARKET\"?T.toFixed(E):null};return console.log(\"Trade data prepared:\",b),console.log(\"Submitting bracket orders\"),ee(b).finally(()=>{let w=V[f],$=document.getElementById(\"slInput\"),q=document.getElementById(\"tpInput\")})}function te(t){console.log(`getFrontQuarter called for root: \"${t}\"`);let{letter:n,yearDigit:l}=K();console.log(`Got quarterly code: letter=${n}, yearDigit=${l}`);let i=`${t.toUpperCase()}${n}${l}`;return console.log(`Returning front quarter symbol: \"${i}\"`),i}function oe(t){console.log(`getMarketData called for: \"${t}\"`);let n=/^[A-Z]{1,3}$/.test(t)?N(t):t.toUpperCase(),l=ne(n);if(!l)return console.log(`Cannot Find ${t}`),null;let i=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),y=i[4]?.textContent.trim(),a=i[5]?.textContent.trim();return{symbol:n,bidPrice:y,offerPrice:a}}function ne(t){let n=/^[A-Z]{1,3}$/.test((t||\"\").trim()),l=n?null:m(t),i=n?m(t):null,y=document.querySelectorAll(\".quoteboard.module.data-table, .data-table, .quoteboard\"),a=y.length?y:[document];for(let f of a){let o=f.querySelectorAll(\".public_fixedDataTable_bodyRow\");for(let s of o){if(s.offsetParent===null)continue;let g=s.querySelector(\".public_fixedDataTableCell_cellContent\");if(!g)continue;let r=m(g.textContent);if(l&&r===l||i&&r.startsWith(i))return s}}return console.error(`findQuoteRow: row for \"${t}\" not found (visible area).`),null;function m(f){return String(f||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase()}}let le=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function he(t=new Date){console.log(`getMonthlyCode called with date: ${t.toISOString()}`);let n=le[t.getUTCMonth()],l=t.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${n}, yearDigit=${l}`),{letter:n,yearDigit:l}}function _(t=new Date){console.log(`getNQFrontMonth called with date: ${t.toISOString()}`);let n=[3,6,9,12],l=[\"H\",\"M\",\"U\",\"Z\"],i=t.getFullYear(),y=t.getMonth()+1,a=t.getDate();console.log(`Current date: ${i}-${y}-${a}`);for(let o=0;o<n.length;o++){let s=n[o],g=z(i,s),r=new Date(g);if(r.setDate(g.getDate()-4),console.log(`Checking ${l[o]} contract: expiry=${g.toISOString()}, roll=${r.toISOString()}`),t<r){let v=`NQ${l[o]}${String(i).slice(-2)}`;return console.log(`Current front month: ${v} (before roll date)`),{symbol:v,letter:l[o],yearDigit:String(i).slice(-2),expiry:g,rollDate:r,isRollPeriod:!1}}else if(t<g){let v=(o+1)%4,x=v>o?i:i+1,p=`NQ${l[v]}${String(x).slice(-2)}`;return console.log(`Front month during roll period: ${p}`),{symbol:p,letter:l[v],yearDigit:String(x).slice(-2),expiry:z(x,n[v]),rollDate:r,isRollPeriod:!0}}}let m=i+1,f=`NQ${l[0]}${String(m).slice(-2)}`;return console.log(`Moving to next year: ${f}`),{symbol:f,letter:l[0],yearDigit:String(m).slice(-2),expiry:z(m,n[0]),rollDate:null,isRollPeriod:!1}}function z(t,n){let i=(5-new Date(t,n-1,1).getDay()+7)%7,y=new Date(t,n-1,1+i),a=new Date(y);return a.setDate(y.getDate()+14),a}function K(t=new Date){console.log(`getQuarterlyCode called (legacy) with date: ${t.toISOString()}`);let n=_(t);return console.log(`Legacy getQuarterlyCode returning: letter=${n.letter}, yearDigit=${n.yearDigit}`),{letter:n.letter,yearDigit:String(n.yearDigit).slice(-1)}}console.log(\"Calculating current NQ front month using CME rules...\");let D=_();console.log(`Current NQ front month: ${D.symbol}`),console.log(`Expiry date: ${D.expiry.toISOString()}`),console.log(`Roll date: ${D.rollDate?D.rollDate.toISOString():\"N/A\"}`),console.log(`Is in roll period: ${D.isRollPeriod}`);let{letter:re,yearDigit:ce}=K(),ie=`NQ${re}${ce}`;console.log(`Legacy front-quarter symbol: ${ie}`),window.getNQFrontMonth=_,window.getThirdFriday=z;let ae={init:()=>{console.log(\"[TradoAuto] legacy driver init\")},autoTrade:R,clickExitForSymbol:F,moveStopLossToBreakeven,createUI:M,getNQFrontMonth:_,getThirdFriday:z};window.TradoAuto=ae})();function ke(){return typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto}var ve=typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto;return xe(Se);})();\n//# sourceMappingURL=tradovate_auto_driver.js.map\n";
    const panelSource = "var TradovateUIPanelBundle=(()=>{var ie=Object.defineProperty;var ke=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Se=Object.prototype.hasOwnProperty;var Ee=(h,k)=>{for(var S in k)ie(h,S,{get:k[S],enumerable:!0})},he=(h,k,S,z)=>{if(k&&typeof k==\"object\"||typeof k==\"function\")for(let L of Ie(k))!Se.call(h,L)&&L!==S&&ie(h,L,{get:()=>k[L],enumerable:!(z=ke(k,L))||z.enumerable});return h};var $e=h=>he(ie({},\"__esModule\",{value:!0}),h);var Be={};Ee(Be,{createUIPanel:()=>me,default:()=>we});(function(){\"use strict\";console.log(\"Auto Order script initialized\");var h=!1;function k(e){return console.log(`Delaying for ${e}ms`),new Promise(o=>setTimeout(o,e))}function S(){console.log(\"Creating UI\");let e=localStorage.getItem(\"bracketTrade_tp\")||\"120\",o=localStorage.getItem(\"bracketTrade_sl\")||\"40\",l=localStorage.getItem(\"bracketTrade_qty\")||\"9\",i=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",b=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\";console.log(`Stored values: TP=${e}, SL=${o}, Qty=${l}, Tick=${i}, Symbol=${b}`);let a=document.createElement(\"div\");a.id=\"bracket-trade-box\",Object.assign(a.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"});let f=0,v=0;f&&v?(a.style.left=f,a.style.top=v):(a.style.top=\"20px\",a.style.right=\"20px\"),a.innerHTML=`\n    <!-- Header with Symbol -->\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n        <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n        <input type=\"text\" id=\"symbolInput\" value=\"${b}\"\n            style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n            placeholder=\"Symbol\" />\n    </div>\n\n    <!-- Hidden Tick Size Input -->\n    <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n        <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n        <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${i}\"\n            style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n    </div>\n\n    <!-- Main Controls -->\n    <div id=\"mainControls\">\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"tpInput\" value=\"${e}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Ticks\" />\n                <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"slInput\" value=\"${o}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Ticks\" />\n                <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n            <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n            <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                <input type=\"number\" id=\"qtyInput\" value=\"${l}\" min=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n            </div>\n            <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n        </div>\n        <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n            <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n            <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n        </div>\n\n        <!-- NEW: Breakeven button above Reverse -->\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n        </div>\n\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n        </div>\n    </div>`,document.body.appendChild(a),console.log(\"UI container added to DOM\");let n=document.createElement(\"div\");n.id=\"bracket-trade-tray\",Object.assign(n.style,{position:\"fixed\",top:a.style.top||\"20px\",left:\"0px\",background:\"#24262b\",border:\"1px solid #444\",padding:\"10px\",borderRadius:\"8px\",boxShadow:\"0 2px 10px rgba(0,0,0,0.4)\",color:\"#fff\",width:\"140px\",zIndex:\"99999\",display:\"none\"}),n.innerHTML=`\n      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\n        <div style=\"font-weight:600;\">Price Tray</div>\n        <button id=\"trayCloseBtn\" title=\"Hide\"\n          style=\"background:#333;border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;\">\\xD7</button>\n      </div>\n      <div style=\"display:flex;flex-direction:column;gap:6px\">\n        <button id=\"tray-btn-high\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">High</button>\n        <button id=\"tray-btn-low\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Low</button>\n        <button id=\"tray-btn-open\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Open</button>\n        <button id=\"tray-btn-close\" style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Close</button>\n        <button id=\"tray-btn-mid\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Middle</button>\n      </div>\n    `,document.body.appendChild(n);let s=document.createElement(\"button\");s.id=\"trayToggle\",s.textContent=\"\\u25C2 O/L/H/C/M\",Object.assign(s.style,{position:\"absolute\",right:\"-92px\",top:\"0\",height:\"32px\",background:\"#30343b\",color:\"#fff\",border:\"1px solid #444\",borderRadius:\"0 8px 8px 0\",padding:\"4px 8px\",cursor:\"pointer\"}),a.appendChild(s);function m(){let t=a.getBoundingClientRect();n.style.top=`${t.top}px`,n.style.left=`${t.right+8}px`}m(),window.addEventListener(\"resize\",m),s.addEventListener(\"click\",()=>{m(),n.style.display=n.style.display===\"none\"?\"block\":\"none\"}),n.querySelector(\"#trayCloseBtn\")?.addEventListener(\"click\",()=>{n.style.display=\"none\"});let r=null;function B(){let t=(document.getElementById(\"tickInput\")?.value||\"\").toString(),d=t.indexOf(\".\");return d===-1?0:t.length-d-1}setInterval(()=>{try{if(typeof L==\"function\"){if(r=L(),r){let t={open:[\"tray-btn-open\",\"Open\"],low:[\"tray-btn-low\",\"Low\"],high:[\"tray-btn-high\",\"High\"],close:[\"tray-btn-close\",\"Close\"]};for(let[c,[p,x]]of Object.entries(t)){let N=document.getElementById(p);if(!N)continue;let R=r[c];N.title=R!=null?`${x}: ${R}`:`${x}: \\u2014`}let d=document.getElementById(\"tray-btn-mid\");if(d){let c=r.open,p=r.close;if(typeof c==\"number\"&&typeof p==\"number\"){let x=B(),N=((c+p)/2).toFixed(x);d.title=`Mid (O+C)/2: ${N}`}else d.title=\"Mid (O+C)/2: \\u2014\"}}m()}}catch(t){console.warn(\"extractTradovateDataBox polling error:\",t)}},500);function $(t){let d=document.getElementById(\"entryPriceInput\");if(!d||t==null)return;Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(d,t),[\"input\",\"change\",\"blur\"].forEach(p=>d.dispatchEvent(new Event(p,{bubbles:!0})))}function y(t){if(!r||r[t]==null){console.warn(`No ${t} available from databox`);return}$(r[t])}function C(){if(!r||typeof r.open!=\"number\"||typeof r.close!=\"number\"){console.warn(\"Mid price unavailable (need open & close)\");return}let t=B(),d=((r.high+r.low)/2).toFixed(t);$(d)}document.getElementById(\"tray-btn-open\")?.addEventListener(\"click\",()=>y(\"open\")),document.getElementById(\"tray-btn-low\")?.addEventListener(\"click\",()=>y(\"low\")),document.getElementById(\"tray-btn-high\")?.addEventListener(\"click\",()=>y(\"high\")),document.getElementById(\"tray-btn-close\")?.addEventListener(\"click\",()=>y(\"close\")),document.getElementById(\"tray-btn-mid\")?.addEventListener(\"click\",C),console.log(\"Setting up UI event handlers\");let T=document.getElementById(\"slInput\"),A=document.getElementById(\"tpInput\"),U=document.getElementById(\"qtyInput\");document.getElementById(\"slInput\").addEventListener(\"input\",()=>{console.log(`SL input changed to: ${T.value}`);let t=parseFloat(T.value);isNaN(t)||(A.value=t*3,console.log(`Calculated TP: ${A.value} (SL \\xD7 3)`)),localStorage.setItem(\"bracketTrade_sl\",T.value),localStorage.setItem(\"bracketTrade_tp\",A.value)}),A.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${A.value}`),localStorage.setItem(\"bracketTrade_tp\",A.value)}),document.getElementById(\"qtyInput\").addEventListener(\"input\",t=>{console.log(`Quantity input changed to: ${t.target.value}`),localStorage.setItem(\"bracketTrade_qty\",t.target.value)}),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let t=document.getElementById(\"symbolInput\").value||\"NQ\",d=q(t);console.log(`Calling clickExitForSymbol for: ${d} with Exit at Mkt & Cxl option`),z(d,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",d)}catch(t){console.error(\"Close All operation failed:\",t);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(d){console.error(\"Fallback close method also failed:\",d)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let t=document.getElementById(\"symbolInput\").value||\"NQ\",d=q(t);console.log(`Calling clickExitForSymbol for: ${d} with Cancel All option`),z(d,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",d)}catch(t){console.error(\"Cancel All operation failed:\",t)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let t=document.getElementById(\"symbolInput\").value||\"NQ\",d=q(t);console.log(`Calling clickExitForSymbol for: ${d} with Reverse & Cxl option`),z(d,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",d)}catch(t){console.error(\"Reverse Position operation failed:\",t)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",async()=>{console.log(\"Breakeven button clicked\");try{let t=document.getElementById(\"symbolInput\").value||\"NQ\",d=q(t);console.log(`Breakeven for symbol: ${d}`);let c=D=>(D||\"\").replace(/\\s+/g,\" \").trim().toUpperCase(),p=[...document.querySelectorAll(\".contract-symbol span\")].find(D=>{let J=c(D.textContent),ve=c(d);return J===ve||J.startsWith(c(t))});if(!p)return console.error(\"Breakeven: contract header not found\");let N=[...(p.closest(\".gm-scroll-view\")||p.closest(\".header\")||document).querySelectorAll(\".info-column\")].find(D=>/position/i.test(D.querySelector(\"small\")?.textContent||\"\"));if(!N){console.error(\"Breakeven: Position column not found\");return}let R=N.querySelector(\".number\"),Z=R?.querySelector(\"span\"),de=(R?.textContent||\"\").trim().match(/@([\\d.,]+)/);if(!de){console.error(\"Breakeven: could not parse entry price from Position\");return}let ue=parseFloat(de[1].replace(/,/g,\"\")),ne=1;if(Z){let D=parseFloat(Z.textContent.replace(/[^\\d.-]/g,\"\"));!isNaN(D)&&D!==0&&(ne=Math.abs(D))}let le=\"LONG\",pe=Z?.classList||R?.classList||{contains:()=>!1};pe.contains(\"text-danger\")&&(le=\"SHORT\"),pe.contains(\"text-success\")&&(le=\"LONG\");let ge=le===\"LONG\"?\"Sell\":\"Buy\";console.log(`Breakeven detected: side=${le}, qty=${ne}, entry=${ue}. Placing ${ge} LIMIT at entry.`);let re=document.getElementById(\"tpCheckbox\"),ce=document.getElementById(\"slCheckbox\"),be=re.checked,fe=ce.checked;re.checked=!1,ce.checked=!1;let xe=(()=>{let J=(parseFloat(document.getElementById(\"tickInput\").value)||.25).toString();return J.includes(\".\")?J.length-J.indexOf(\".\")-1:0})();document.getElementById(\"entryPriceInput\").value=ue.toFixed(xe),document.getElementById(\"qtyInput\").value=ne.toString(),[\"input\",\"change\",\"blur\"].forEach(D=>{document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(D,{bubbles:!0})),document.getElementById(\"qtyInput\").dispatchEvent(new Event(D,{bubbles:!0}))}),await M(t,ne,ge,null,null,parseFloat(document.getElementById(\"tickInput\").value)||.25),re.checked=be,ce.checked=fe,document.getElementById(\"entryPriceInput\").value=\"\",[\"input\",\"change\",\"blur\"].forEach(D=>document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(D,{bubbles:!0})))}catch(t){console.error(\"Breakeven action failed:\",t)}}),console.log(\"Setting up persistent settings\"),document.getElementById(\"symbolInput\").value=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\",document.getElementById(\"symbolInput\").addEventListener(\"input\",t=>{console.log(`Symbol input changed to: ${t.target.value}`),localStorage.setItem(\"bracketTrade_symbol\",t.target.value)}),document.getElementById(\"symbolInput\").addEventListener(\"change\",t=>{let d=t.target.value,c=q(d);console.log(`Symbol changed to: ${d}, normalized: ${c}`);let p=d.replace(/[A-Z]\\d+$/,\"\"),x=F[p];if(x){console.log(`Found default values for ${p}: SL=${x.defaultSL}, TP=${x.defaultTP}`);let N=document.getElementById(\"slInput\"),R=document.getElementById(\"tpInput\"),Z=document.getElementById(\"tickInput\");N.value=x.defaultSL,R.value=x.defaultTP,typeof x.tickSize==\"number\"&&(Z.value=x.tickSize,localStorage.setItem(\"bracketTrade_tick\",x.tickSize),console.log(`Updated tick size to ${x.tickSize} for ${p}`)),localStorage.setItem(\"bracketTrade_sl\",x.defaultSL),localStorage.setItem(\"bracketTrade_tp\",x.defaultTP),console.log(`Updated SL/TP to default values for ${p}: SL=${N.value}, TP=${R.value}`)}Q(\".search-box--input\",c)}),document.getElementById(\"tickInput\").value=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",document.getElementById(\"tickInput\").addEventListener(\"input\",t=>{console.log(`Tick size input changed to: ${t.target.value}`),localStorage.setItem(\"bracketTrade_tick\",t.target.value)}),console.log(\"Setting up drag functionality\");let P=!1,_,Y;a.addEventListener(\"mousedown\",t=>{console.log(\"Container mousedown event detected\"),P=!0,_=t.clientX-a.getBoundingClientRect().left,Y=t.clientY-a.getBoundingClientRect().top,console.log(`Drag started at offset X:${_}, Y:${Y}`),a.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",t=>{if(P){let d=`${t.clientX-_}px`,c=`${t.clientY-Y}px`;t.clientX%20===0&&console.log(`Dragging panel to X:${d}, Y:${c}`),a.style.left=d,a.style.top=c,a.style.right=\"unset\",m()}}),document.addEventListener(\"mouseup\",()=>{P&&(console.log(`Container drop position: Left:${a.style.left}, Top:${a.style.top}`),localStorage.setItem(\"bracketTradeBoxLeft\",a.style.left),localStorage.setItem(\"bracketTradeBoxTop\",a.style.top)),P=!1,a.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let t=document.getElementById(\"symbolInput\").value||\"NQ\",d=+U.value,c=+A.value,p=+T.value,x=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${t}, Qty=${d}, TP=${c}, SL=${p}, TickSize=${x}`),M(t,d,\"Buy\",c,p,x).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let t=document.getElementById(\"symbolInput\").value||\"NQ\",d=+U.value,c=+A.value,p=+T.value,x=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${t}, Qty=${d}, TP=${c}, SL=${p}, TickSize=${x}`),M(t,d,\"Sell\",c,p,x).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}async function z(e,o=\"cancel-option-Exit-at-Mkt-Cxl\"){let l={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},i={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},b=c=>(c||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),a=c=>new Promise(p=>setTimeout(p,c));async function f(c,{timeout:p=1200,interval:x=50}={}){let N=performance.now();for(;performance.now()-N<p;){let R=c();if(R)return R;await a(x)}return null}let v=o.toLowerCase(),n=l[v]||o,s=i[n]||null,m=b(e),r=/^[A-Z]{1,3}$/.test(m),B=[...document.querySelectorAll(\".header .contract-symbol span\")].find(c=>{let p=b(c.textContent);return p===m||r&&p.startsWith(m)});if(!B)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let y=B.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),C=y?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),T=y?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!y||!C||!T)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(s?s.test(b(C.textContent)):!1)return C.click(),!0;T.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let U=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(c=>c.offsetParent!==null||/display\\s*:\\s*block/i.test(c.getAttribute(\"style\")||\"\")||!!c.closest(\".open\")),P=await f(U,{timeout:900,interval:40});if(!P||!P.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let _=T.getBoundingClientRect();P.sort((c,p)=>{let x=c.getBoundingClientRect(),N=p.getBoundingClientRect(),R=Math.hypot(x.left-_.left,x.top-_.bottom),Z=Math.hypot(N.left-_.left,N.top-_.bottom);return R-Z});let Y=P[0],t=document.getElementById(n);if(!t&&s){for(let c of P)if(t=[...c.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(p=>s.test(b(p.textContent))),t){Y=c;break}}if(!t)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let d=t.tagName?t.matches(\"a,button\")?t:t.querySelector(\"a,button\")||t:t;return[\"mousedown\",\"mouseup\",\"click\"].forEach(c=>d.dispatchEvent(new MouseEvent(c,{bubbles:!0}))),T.click(),await a(120),P=U(),t=document.getElementById(n)||(s?P?.flatMap(c=>[...c.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(c=>s.test(b(c.textContent))):null),t?([\"mousedown\",\"mouseup\",\"click\"].forEach(c=>(t.querySelector(\"a,button\")||t).dispatchEvent(new MouseEvent(c,{bubbles:!0}))),await a(80),C.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function L(e=document){let o=[...e.querySelectorAll(\".databox.react-draggable.react-resizable\")].find(f=>f.offsetParent!==null);if(!o)return null;let b={timestamp:((f,v=o)=>{let n=v.querySelector(f);return n?n.textContent.trim():null})(\".header .title\")||null};return o.querySelectorAll(\".gm-scroll-view .entries li\").forEach(f=>{let v=f.querySelector(\".label\"),n=f.querySelector(\".desc\");if(!v||!n)return;let s=v.cloneNode(!0);s.querySelectorAll(\"span\").forEach(C=>C.remove());let m=(s.textContent||\"\").trim().toLowerCase().replace(/[^a-z0-9]/g,\"\"),r=(n.textContent||\"\").trim(),$={open:\"open\",high:\"high\",low:\"low\",close:\"close\",volume:\"volume\",atr:\"atr\",vwap:\"vwap\",upperband1:\"upperBand1\",lowerband1:\"lowerBand1\",upperband2:\"upperBand2\",lowerband2:\"lowerBand2\"}[m]||m,y=r.replace(/,/g,\"\");$===\"volume\"?y=Number.parseInt(y,10):y=Number.parseFloat(y),b[$]=Number.isNaN(y)?r:y}),b}document.querySelectorAll(\"#bracket-trade-box, #bracket-trade-tray\").forEach(e=>e.remove()),S(),console.log(\"UI creation complete\");async function Q(e,o){console.log(`updateSymbol called with selector: \"${e}\", value: \"${o}\"`);let l=document.querySelectorAll(e);console.log(`Found ${l.length} matching inputs`);let i=l[1]||l[0];if(!i){console.error(\"No matching input elements found!\");return}console.log(\"Selected input:\",i);let b=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,a=f=>i.dispatchEvent(new KeyboardEvent(f,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),b.call(i,\"\"),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await k(400),console.log(`Setting input value to: \"${o}\"`),b.call(i,o),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await k(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(a),i.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function ee(e){let o=\"input.form-control\";for(let l=0;l<20;l++){let i=document.querySelector(o);if(i&&i.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,e),[\"input\",\"change\",\"blur\"].forEach(a=>i.dispatchEvent(new Event(a,{bubbles:!0}))),await k(300);return}await k(100)}console.error(\"Price input not found\")}function q(e){console.log(`normalizeSymbol called with: \"${e}\"`);let o=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${o}`);let l=o?I(e):e.toUpperCase();return console.log(`Normalized symbol: \"${l}\"`),l}async function G(e){console.log(\"Creating bracket orders with data:\",e);let o=document.getElementById(\"tpCheckbox\").checked,l=document.getElementById(\"slCheckbox\").checked;console.log(`TP enabled: ${o}, SL enabled: ${l}`);async function i(n,s){let m=[...document.querySelectorAll(\".trading-ticket\")].find(y=>y.offsetParent);if(!m)return console.error(\"No visible trading ticket\");let r;for(let y=0;y<25&&(r=[...m.querySelectorAll(n)].find(C=>C.offsetParent&&!C.disabled),!r);y++)await k(100);if(!r)return console.error(`No live input for ${n}`);let B=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,$=r.closest(\".select-input.combobox\");__UI_PANEL_BUNDLE__&!r.value&&($.querySelector(\".btn\")?.click(),await k(150),$.querySelector(\".dropdown-menu li\")?.click(),await k(150));for(let y=0;y<3&&(r.focus(),B.call(r,s),r.dispatchEvent(new Event(\"input\",{bubbles:!0})),r.dispatchEvent(new Event(\"change\",{bubbles:!0})),r.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),r.blur(),await k(250),`${r.value}`.trim()!==`${s}`);y++);}async function b(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let n=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${n.length} action labels`),n.forEach(s=>{s.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),s.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await i(\".select-input.combobox input\",e.qty))}function a(n=document){let s=n.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(s,m=>{let r=m.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),B=r[0]?.textContent.trim()||\"\",$=r[1]?.textContent.trim()||\"\",y=r[2]?.textContent.trim()||\"\",C=r[3]?.textContent.trim()||\"\",T=null,A=y.match(/@([\\d.]+)/);return A&&(T=Number(A[1])),{timestamp:B,id:$,event:y,comment:C,fillPrice:T}})}function f(n=\"up\"){let s=document.querySelector(\".numeric-input-value-controls\");if(!s)return;s.querySelector(n===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function v(n,s){await b(),document.querySelector(\".group.order-type .select-input div[tabindex]\")?.click(),[...document.querySelectorAll(\"ul.dropdown-menu li\")].find(r=>r.textContent.trim()===n)?.click(),s&&await i(\".numeric-input.feedback-wrapper input\",s),f(),document.querySelector(\".btn-group .btn-primary\")?.click(),await k(200),console.log(a()),document.querySelector(\".icon.icon-back\")?.click(),await k(200)}return console.log(`Submitting initial ${e.orderType||\"MARKET\"} order`),await v(e.orderType||\"MARKET\",e.entryPrice),e.action===\"Buy\"?(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",o&&(console.log(`Creating take profit order at ${e.takeProfit}`),await v(\"LIMIT\",e.takeProfit)),l&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await v(\"STOP\",e.stopLoss))):(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",o&&(console.log(`Creating take profit order at ${e.takeProfit}`),await v(\"LIMIT\",e.takeProfit)),l&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await v(\"STOP\",e.stopLoss))),console.log(\"Bracket order creation complete\"),Promise.resolve()}function W(e=document){let o=e.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(o,l=>{let i=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),b=i[0]?.textContent.trim()||\"\",a=i[1]?.textContent.trim()||\"\",f=i[2]?.textContent.trim()||\"\",v=i[3]?.textContent.trim()||\"\",n=null,s=f.match(/@([\\d.]+)/);return s&&(n=Number(s[1])),{timestamp:b,id:a,event:f,comment:v,fillPrice:n}})}let F={MNQ:{tickSize:.25,tickValue:.5,defaultSL:40,defaultTP:100,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:40,defaultTP:100,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function M(e,o=1,l=\"Buy\",i=null,b=null,a=.25){console.log(`autoTrade called with: symbol=${e}, qty=${o}, action=${l}, TP=${i}, SL=${b}, tickSize=${a}`);let f=document.getElementById(\"symbolInput\").value||\"NQ\";console.log(`Using symbol: ${f}`);let v=f.replace(/[A-Z]\\d+$/,\"\");console.log(`Root symbol: ${v}`);let n=F[v];v!==M.lastRootSymbol&&(document.getElementById(\"tickInput\").value=n?.tickSize??\"\"),M.lastRootSymbol=v;let s=n&&typeof n.tickSize==\"number\"?n.tickSize:parseFloat(document.getElementById(\"tickInput\").value)||a;tickInput.value=s,localStorage.setItem(\"bracketTrade_tick\",s);let m=b||n?.defaultSL||parseInt(document.getElementById(\"slInput\").value)||40,r=i||n?.defaultTP||parseInt(document.getElementById(\"tpInput\").value)||100,B=n?.tickSize?\"dictionary\":document.getElementById(\"tickInput\").value?\"input field\":\"default parameter\";console.log(`Using tick size ${s} (from ${B})`),console.log(`Using SL: ${m} ticks, TP: ${r} ticks`),console.log(`Getting market data for ${f}`);let $=te(f);if(!$){console.error(`No market data for ${f}`);return}console.log(\"Market data:\",$);let y=document.getElementById(\"entryPriceInput\"),C=y&&y.value?parseFloat(y.value):null,T=parseFloat(l===\"Buy\"?$.offerPrice:$.bidPrice);console.log(`Market price: ${T} (${l===\"Buy\"?\"offer\":\"bid\"} price)`);let A=\"MARKET\",U=T;C!==null?(console.log(`Custom entry price provided: ${C}`),U=C,l===\"Buy\"?A=C<T?\"LIMIT\":\"STOP\":A=C>T?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${A}`)):console.log(`No custom entry price provided, using market order at ${T}`);let P=n?.precision??2;console.log(`Using price precision: ${P} decimal places`);let _=document.getElementById(\"slPriceInput\"),Y=document.getElementById(\"tpPriceInput\"),t=_&&_.value?parseFloat(_.value):null,d=Y&&Y.value?parseFloat(Y.value):null,c;t!==null?(c=t.toFixed(P),console.log(`Using hardcoded SL price: ${c}`)):(c=(l===\"Buy\"?U-m*s:U+m*s).toFixed(P),console.log(`Calculated SL price: ${c} (${l===\"Buy\"?\"entry - \":\"entry + \"}${m} ticks)`));let p;d!==null?(p=d.toFixed(P),console.log(`Using hardcoded TP price: ${p}`)):(p=(l===\"Buy\"?U+r*s:U-r*s).toFixed(P),console.log(`Calculated TP price: ${p} (${l===\"Buy\"?\"entry + \":\"entry - \"}${r} ticks)`));let x={symbol:$.symbol,action:l,qty:o.toString(),takeProfit:p,stopLoss:c,orderType:A,entryPrice:A!==\"MARKET\"?U.toFixed(P):null};return console.log(\"Trade data prepared:\",x),console.log(\"Submitting bracket orders\"),G(x).finally(()=>{let N=F[v],R=document.getElementById(\"slInput\"),Z=document.getElementById(\"tpInput\")})}function I(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:o,yearDigit:l}=E();console.log(`Got quarterly code: letter=${o}, yearDigit=${l}`);let i=`${e.toUpperCase()}${o}${l}`;return console.log(`Returning front quarter symbol: \"${i}\"`),i}function te(e){console.log(`getMarketData called for: \"${e}\"`);let o=/^[A-Z]{1,3}$/.test(e)?q(e):e.toUpperCase(),l=H(o);if(!l)return console.log(`Cannot Find ${e}`),null;let i=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),b=i[4]?.textContent.trim(),a=i[5]?.textContent.trim();return{symbol:o,bidPrice:b,offerPrice:a}}function H(e){let o=/^[A-Z]{1,3}$/.test((e||\"\").trim()),l=o?null:f(e),i=o?f(e):null,b=document.querySelectorAll(\".quoteboard.module.data-table, .data-table, .quoteboard\"),a=b.length?b:[document];for(let v of a){let n=v.querySelectorAll(\".public_fixedDataTable_bodyRow\");for(let s of n){if(s.offsetParent===null)continue;let m=s.querySelector(\".public_fixedDataTableCell_cellContent\");if(!m)continue;let r=f(m.textContent);if(l&&r===l||i&&r.startsWith(i))return s}}return console.error(`findQuoteRow: row for \"${e}\" not found (visible area).`),null;function f(v){return String(v||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase()}}let V=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function oe(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let o=V[e.getUTCMonth()],l=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${o}, yearDigit=${l}`),{letter:o,yearDigit:l}}function j(e=new Date){console.log(`getNQFrontMonth called with date: ${e.toISOString()}`);let o=[3,6,9,12],l=[\"H\",\"M\",\"U\",\"Z\"],i=e.getFullYear(),b=e.getMonth()+1,a=e.getDate();console.log(`Current date: ${i}-${b}-${a}`);for(let n=0;n<o.length;n++){let s=o[n],m=X(i,s),r=new Date(m);if(r.setDate(m.getDate()-4),console.log(`Checking ${l[n]} contract: expiry=${m.toISOString()}, roll=${r.toISOString()}`),e<r){let B=`NQ${l[n]}${String(i).slice(-2)}`;return console.log(`Current front month: ${B} (before roll date)`),{symbol:B,letter:l[n],yearDigit:String(i).slice(-2),expiry:m,rollDate:r,isRollPeriod:!1}}else if(e<m){let B=(n+1)%4,$=B>n?i:i+1,y=`NQ${l[B]}${String($).slice(-2)}`;return console.log(`Front month during roll period: ${y}`),{symbol:y,letter:l[B],yearDigit:String($).slice(-2),expiry:X($,o[B]),rollDate:r,isRollPeriod:!0}}}let f=i+1,v=`NQ${l[0]}${String(f).slice(-2)}`;return console.log(`Moving to next year: ${v}`),{symbol:v,letter:l[0],yearDigit:String(f).slice(-2),expiry:X(f,o[0]),rollDate:null,isRollPeriod:!1}}function X(e,o){let i=(5-new Date(e,o-1,1).getDay()+7)%7,b=new Date(e,o-1,1+i),a=new Date(b);return a.setDate(b.getDate()+14),a}function E(e=new Date){console.log(`getQuarterlyCode called (legacy) with date: ${e.toISOString()}`);let o=j(e);return console.log(`Legacy getQuarterlyCode returning: letter=${o.letter}, yearDigit=${o.yearDigit}`),{letter:o.letter,yearDigit:String(o.yearDigit).slice(-1)}}console.log(\"Calculating current NQ front month using CME rules...\");let w=j();console.log(`Current NQ front month: ${w.symbol}`),console.log(`Expiry date: ${w.expiry.toISOString()}`),console.log(`Roll date: ${w.rollDate?w.rollDate.toISOString():\"N/A\"}`),console.log(`Is in roll period: ${w.isRollPeriod}`);let{letter:K,yearDigit:g}=E(),u=`NQ${K}${g}`;console.log(`Legacy front-quarter symbol: ${u}`),window.getNQFrontMonth=j,window.getThirdFriday=X;let O={init:()=>{console.log(\"[TradoAuto] legacy driver init\")},autoTrade:M,clickExitForSymbol:z,moveStopLossToBreakeven,createUI:S,getNQFrontMonth:j,getThirdFriday:X};window.TradoAuto=O})();var ae=typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto;function ye(h,{visible:k=!1}={}){if(console.log(`Creating UI (visible=${k})`),!h)return console.warn(\"[TradoUIPanel] renderPanel called without driver instance\"),null;let S=h.state,z=h.futuresTickData,L=h.normalizeSymbol,Q=\"NQ\",ee=Q.replace(/[A-Z]\\d+$/,\"\"),q=z[ee]||z.NQ;S.symbol=Q,S.tp=q.defaultTP,S.sl=q.defaultSL,S.tickSize=q.tickSize;let G=q.defaultTP.toString(),W=q.defaultSL.toString(),F=\"10\",M=q.tickSize.toString();console.log(`Using defaults: TP=${G}, SL=${W}, Qty=${F}, Tick=${M}, Symbol=${Q}`),console.log(`Symbol data for ${ee}: defaultTP=${q.defaultTP}, defaultSL=${q.defaultSL}`);let I=document.createElement(\"div\");I.id=k?\"bracket-trade-box\":\"invisible-trade-inputs\",k?(Object.assign(I.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"}),I.style.top=\"20px\",I.style.right=\"20px\"):Object.assign(I.style,{position:\"fixed\",top:\"-9999px\",left:\"-9999px\",visibility:\"hidden\",opacity:\"0\",pointerEvents:\"none\"}),k?I.innerHTML=`\n        <!-- Header with Symbol -->\n        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n            <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n            <input type=\"text\" id=\"symbolInput\" value=\"${Q}\"\n                style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                placeholder=\"Symbol\" />\n        </div>\n        \n        <!-- Hidden Tick Size Input -->\n        <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n            <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n            <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${M}\"\n                style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n        </div>\n\n        <!-- Main Controls -->\n        <div id=\"mainControls\">\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"tpInput\" value=\"${G}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Ticks\" />\n                    <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n                <input type=\"checkbox\" id=\"slCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"slInput\" value=\"${W}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"SL Ticks\" />\n                    <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                        placeholder=\"SL Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n                <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n                <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                    <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"0.01\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                    <input type=\"number\" id=\"qtyInput\" value=\"${F}\" min=\"1\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                </div>\n                <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n                <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n                <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n            </div>\n            <!-- NEW: Breakeven button above Reverse -->\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n            </div>\n        </div>`:I.innerHTML=`\n            <input type=\"text\" id=\"symbolInput\" value=\"${Q}\" />\n            <input type=\"number\" id=\"tickInput\" value=\"${M}\" />\n            <input type=\"number\" id=\"tpInput\" value=\"${G}\" />\n            <input type=\"number\" id=\"slInput\" value=\"${W}\" />\n            <input type=\"number\" id=\"qtyInput\" value=\"${F}\" />\n            <input type=\"number\" id=\"entryPriceInput\" />\n            <input type=\"number\" id=\"tpPriceInput\" />\n            <input type=\"number\" id=\"slPriceInput\" />\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n        `;let te=k?\"bracket-trade-box\":\"invisible-trade-inputs\";if(document.getElementById(te))return console.log(`${te} already exists, skipping creation`),document.getElementById(te);document.body.appendChild(I),console.log(\"UI container added to DOM\"),console.log(\"Setting up universal event handlers\");let H=document.getElementById(\"slInput\"),V=document.getElementById(\"tpInput\"),oe=document.getElementById(\"qtyInput\");H&&H.addEventListener(\"input\",()=>{console.log(`SL input changed to: ${H.value}`);let E=parseFloat(H.value);isNaN(E)||(S.sl=E,V&&(V.value=Math.round(E*3.5)),S.tp=Math.round(E*3.5),console.log(`Calculated TP: ${S.tp} (SL \\xD7 3.5)`))}),V&&V.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${V.value}`);let E=parseFloat(V.value);isNaN(E)||(S.tp=E)}),oe&&oe.addEventListener(\"input\",E=>{console.log(`Quantity input changed to: ${E.target.value}`);let w=parseInt(E.target.value);!isNaN(w)&&w>0&&(S.qty=w)});let j=document.getElementById(\"symbolInput\");j&&(j.addEventListener(\"input\",E=>{console.log(`Symbol input changed to: ${E.target.value}`),S.symbol=E.target.value}),j.addEventListener(\"change\",E=>{let w=E.target.value,K=L(w);console.log(`Symbol changed to: ${w}, normalized: ${K}`);let g=w.replace(/[A-Z]\\d+$/,\"\"),u=z[g];if(u){console.log(`Found default values for ${g}: SL=${u.defaultSL}, TP=${u.defaultTP}`);let O=document.getElementById(\"slInput\"),e=document.getElementById(\"tpInput\"),o=document.getElementById(\"tickInput\");O.value=u.defaultSL,e.value=u.defaultTP,S.sl=u.defaultSL,S.tp=u.defaultTP,typeof u.tickSize==\"number\"&&(o.value=u.tickSize,S.tickSize=u.tickSize,console.log(`Updated tick size to ${u.tickSize} for ${g}`)),console.log(`\\u2705 Updated SL/TP to default values for ${g}: SL=${O.value}, TP=${e.value}`)}h.updateSymbol(\".trading-ticket .search-box--input\",K)}));let X=document.getElementById(\"tickInput\");if(X&&X.addEventListener(\"input\",E=>{console.log(`Tick size input changed to: ${E.target.value}`);let w=parseFloat(E.target.value);!isNaN(w)&&w>0&&(S.tickSize=w)}),k){console.log(\"Setting up UI event handlers\"),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let g=document.getElementById(\"symbolInput\").value||\"NQ\",u=L(g);console.log(`Calling clickExitForSymbol for: ${u} with Exit at Mkt & Cxl option`),h.clickExitForSymbol(u,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",u)}catch(g){console.error(\"Close All operation failed:\",g);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(u){console.error(\"Fallback close method also failed:\",u)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let g=document.getElementById(\"symbolInput\").value||\"NQ\",u=L(g);console.log(`Calling clickExitForSymbol for: ${u} with Cancel All option`),h.clickExitForSymbol(u,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",u)}catch(g){console.error(\"Cancel All operation failed:\",g)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let g=document.getElementById(\"symbolInput\").value||\"NQ\",u=L(g);console.log(`Calling clickExitForSymbol for: ${u} with Reverse & Cxl option`),h.clickExitForSymbol(u,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",u)}catch(g){console.error(\"Reverse Position operation failed:\",g)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",()=>{console.log(\"Breakeven button clicked\");try{let g=document.getElementById(\"symbolInput\").value||\"NQ\",u=L(g);console.log(`Processing breakeven for symbol: ${u}`),h.moveStopLossToBreakeven(u),console.log(\"Breakeven action triggered for symbol:\",u)}catch(g){console.error(\"Breakeven operation failed:\",g)}}),console.log(\"Setting up default values\"),document.getElementById(\"symbolInput\").value=\"NQ\",document.getElementById(\"tickInput\").value=S.tickSize,console.log(\"Setting up drag functionality\");let E=!1,w,K;I.addEventListener(\"mousedown\",g=>{console.log(\"Container mousedown event detected\"),E=!0,w=g.clientX-I.getBoundingClientRect().left,K=g.clientY-I.getBoundingClientRect().top,console.log(`Drag started at offset X:${w}, Y:${K}`),I.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",g=>{if(E){let u=`${g.clientX-w}px`,O=`${g.clientY-K}px`;g.clientX%20===0&&console.log(`Dragging panel to X:${u}, Y:${O}`),I.style.left=u,I.style.top=O,I.style.right=\"unset\"}}),document.addEventListener(\"mouseup\",()=>{E&&console.log(`Container drop position: Left:${I.style.left}, Top:${I.style.top}`),E=!1,I.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let g=document.getElementById(\"symbolInput\").value||\"NQ\",u=+oe.value,O=+V.value,e=+H.value,o=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${g}, Qty=${u}, TP=${O}, SL=${e}, TickSize=${o}`),h.autoTrade(g,u,\"Buy\",O,e,o).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let g=document.getElementById(\"symbolInput\").value||\"NQ\",u=+oe.value,O=+V.value,e=+H.value,o=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${g}, Qty=${u}, TP=${O}, SL=${e}, TickSize=${o}`),h.autoTrade(g,u,\"Sell\",O,e,o).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}return console.log(\"State management: Using in-memory state only, no persistence\"),I}function me({driverInstance:h=ae}={},k={}){let S=!1,z=!1,L=null;function Q(F={}){let{visible:M=!0}={...k,...F},I=ye(h,{visible:M});return I&&(S=!0,z=M,L=I),I}function ee(){return Q({visible:!1})}function q(){return Q({visible:!0})}function G(){let F=!1,M=document.getElementById(\"bracket-trade-box\"),I=document.getElementById(\"invisible-trade-inputs\");return M&&(M.remove(),F=!0),I&&(I.remove(),F=!0),F&&(S=!1,z=!1,L=null),F}function W(){return{mounted:S,visible:z,hasPanel:!!document.getElementById(\"bracket-trade-box\"),hasInvisiblePanel:!!document.getElementById(\"invisible-trade-inputs\"),lastContainer:L}}return{mount:Q,createUI:Q,createInvisibleUI:ee,show:q,hide:G,getStatus:W,render:F=>ye(h,F)}}var se=me();ae.registerUIPanel(se);typeof window<\"u\"&&(window.TradoUIPanel=se);var we=se;return $e(Be);})();\n//# sourceMappingURL=tradovate_ui_panel.js.map\n";

    function inject(code, id) {
        if (!code) {
            console.warn(`[AutoOrder] No code supplied for ${id}, skipping injection.`);
            return;
        }

        const scriptId = `trado-${id}`;
        if (document.getElementById(scriptId)) {
            console.debug(`[AutoOrder] Script ${scriptId} already present, skipping duplicate injection.`);
            return;
        }

        const script = document.createElement('script');
        script.id = scriptId;
        script.type = 'text/javascript';
        script.textContent = code;
        document.head.appendChild(script);
        console.debug(`[AutoOrder] Injected ${id} bundle.`);
    }

    function waitForGlobal(name, timeout = 8000) {
        return new Promise((resolve, reject) => {
            const start = Date.now();
            (function check() {
                if (window[name]) {
                    resolve(window[name]);
                    return;
                }
                if (Date.now() - start > timeout) {
                    reject(new Error(`${name} not available within ${timeout}ms`));
                    return;
                }
                requestAnimationFrame(check);
            })();
        });
    }

    inject(driverSource, 'auto-driver');
    inject(panelSource, 'ui-panel');

    Promise.all([
        waitForGlobal('TradoAuto'),
        waitForGlobal('TradoUIPanel')
    ]).then(([autoDriver, uiPanel]) => {
        try {
            autoDriver.init?.({ source: 'tampermonkey' });
        } catch (err) {
            console.error('[AutoOrder] Failed to init driver', err);
        }

        try {
            uiPanel.mount?.({ visible: true });
        } catch (err) {
            console.error('[AutoOrder] Failed to mount UI panel', err);
        }

        console.info('[AutoOrder] Driver and panel ready.');
    }).catch(err => {
        console.error('[AutoOrder] Initialization failed', err);
    });
})();
