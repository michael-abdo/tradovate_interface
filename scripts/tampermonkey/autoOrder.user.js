// ==UserScript==
// @name         Auto Order (Modular)
// @namespace    http://tampermonkey.net/
// @version      6.0
// @description  Thin wrapper that loads the modular Tradovate automation driver and UI panel.
// @author       You
// @match        https://trader.tradovate.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tradovate.com
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    const driverSource = "\"use strict\";var TradovateAutoDriverBundle=(()=>{var q=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var oe=Object.prototype.hasOwnProperty;var ne=(t,i)=>{for(var r in i)q(t,r,{get:i[r],enumerable:!0})},le=(t,i,r,l)=>{if(i&&typeof i==\"object\"||typeof i==\"function\")for(let p of te(i))!oe.call(t,p)&&p!==r&&q(t,p,{get:()=>i[p],enumerable:!(l=ee(i,p))||l.enumerable});return t};var re=t=>le(q({},\"__esModule\",{value:!0}),t);var Ee={};ne(Ee,{createAutoDriver:()=>W,createInvisibleUI:()=>J,default:()=>Te,initDriver:()=>_,registerUIPanel:()=>Q});console.log(\"Auto Order script initialized - AUTOMATIC HOT RELOAD SUCCESS!\");function L(t){return console.log(`Delaying for ${t}ms`),new Promise(i=>setTimeout(i,t))}var v={symbol:\"NQ\",tickSize:.25,tp:null,sl:null,qty:10,entryPrice:null,tpPrice:null,slPrice:null,tpEnabled:!0,slEnabled:!0};async function ie(t,i=\"cancel-option-Exit-at-Mkt-Cxl\"){let r={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},l={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},p=k=>(k||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),u=k=>new Promise(w=>setTimeout(w,k));async function T(k,{timeout:w=1200,interval:e=50}={}){let d=performance.now();for(;performance.now()-d<w;){let I=k();if(I)return I;await u(e)}return null}let y=i.toLowerCase(),s=r[y]||i,f=l[s]||null,a=p(t),c=/^[A-Z]{1,3}$/.test(a),n=[...document.querySelectorAll(\".header .contract-symbol span\")].find(k=>{let w=p(k.textContent);if(w===a)return!0;if(c&&w.startsWith(a)){let e=w.substring(a.length);return/^[FGHJKMNQUVXZ]\\d+$/.test(e)}return!1});if(!n)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let $=n.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),b=$?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),S=$?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!$||!b||!S)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(f?f.test(p(b.textContent)):!1)return b.click(),!0;S.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let C=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(k=>k.offsetParent!==null||/display\\s*:\\s*block/i.test(k.getAttribute(\"style\")||\"\")||!!k.closest(\".open\")),R=await T(C,{timeout:900,interval:40});if(!R||!R.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let P=S.getBoundingClientRect();R.sort((k,w)=>{let e=k.getBoundingClientRect(),d=w.getBoundingClientRect(),I=Math.hypot(e.left-P.left,e.top-P.bottom),h=Math.hypot(d.left-P.left,d.top-P.bottom);return I-h});let A=R[0],m=document.getElementById(s);if(!m&&f){for(let k of R)if(m=[...k.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(w=>f.test(p(w.textContent))),m){A=k;break}}if(!m)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let o=m.tagName?m.matches(\"a,button\")?m:m.querySelector(\"a,button\")||m:m;return[\"mousedown\",\"mouseup\",\"click\"].forEach(k=>o.dispatchEvent(new MouseEvent(k,{bubbles:!0}))),S.click(),await u(120),R=C(),m=document.getElementById(s)||(f?R?.flatMap(k=>[...k.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(k=>f.test(p(k.textContent))):null),m?([\"mousedown\",\"mouseup\",\"click\"].forEach(k=>(m.querySelector(\"a,button\")||m).dispatchEvent(new MouseEvent(k,{bubbles:!0}))),await u(80),b.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function ce(t){console.log(`moveStopLossToBreakeven called for symbol: ${t}`);let i=V(t);if(!i){console.log(`No open position found for ${t}`);return}console.log(`Found position for ${t}:`,i);let r=i.entryPrice,l=i.quantity>0,p=t.replace(/[A-Z]\\d+$/,\"\"),u=N[p],y=(u?.tickSize||.25)*2,s=l?(r+y).toFixed(u?.precision||2):(r-y).toFixed(u?.precision||2);console.log(`Calculated breakeven price: ${s} (entry: ${r}, isLong: ${l}, buffer: ${y})`);let f=document.querySelectorAll(\".module.module-dom\"),a=0;for(let c of f){let n=c.querySelector(\".contract-symbol span\"),g=n?n.textContent.trim().toUpperCase():\"\",$=t.toUpperCase(),b=/^[A-Z]{1,3}$/.test($);if(g===$||b&&g.startsWith($)&&/^[FGHJKMNQUVXZ]\\d+$/.test(g.substring($.length))){let S=c.querySelector(\".order-type\");if(S&&S.textContent.includes(\"STOP\")){console.log(`Found stop order for ${t}, updating to breakeven`);let E=c.querySelector('input[type=\"number\"], .numeric-input input');E?(console.log(`Updating stop price from ${E.value} to ${s}`),E.focus(),E.value=s,E.dispatchEvent(new Event(\"input\",{bubbles:!0})),E.dispatchEvent(new Event(\"change\",{bubbles:!0})),E.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),a++,console.log(`Stop order ${a} updated to breakeven`)):console.log(\"Price input not found for stop order\")}}}a>0?console.log(`\\u2705 Successfully moved ${a} stop order(s) to breakeven for ${t}`):console.log(`\\u26A0\\uFE0F No stop orders found to update for ${t}`)}function V(t){console.log(`getCurrentPosition called for symbol: ${t}`);let i=document.querySelectorAll(\".module.module-dom\");for(let l of i){let p=l.querySelector(\".contract-symbol span\"),u=p?p.textContent.trim().toUpperCase():\"\",T=t.toUpperCase(),y=/^[A-Z]{1,3}$/.test(T);if(u===T||y&&u.startsWith(T)&&/^[FGHJKMNQUVXZ]\\d+$/.test(u.substring(T.length))){let s=l.querySelector(\".position-quantity, .quantity\"),f=l.querySelector(\".avg-price, .entry-price, .price\");if(s&&f){let a=parseFloat(s.textContent.replace(/[^\\d.-]/g,\"\")),c=parseFloat(f.textContent.replace(/[^\\d.-]/g,\"\"));if(!isNaN(a)&&!isNaN(c)&&a!==0)return console.log(`Found position: qty=${a}, entry=${c}`),{quantity:a,entryPrice:c}}}}let r=document.querySelectorAll(\".portfolio-row, .position-row\");for(let l of r){let p=l.querySelector(\".symbol, .contract-symbol\"),u=p?p.textContent.trim().toUpperCase():\"\",T=t.toUpperCase(),y=/^[A-Z]{1,3}$/.test(T);if(u===T||y&&u.startsWith(T)&&/^[FGHJKMNQUVXZ]\\d+$/.test(u.substring(T.length))){let s=l.querySelectorAll(\"td, .cell\");for(let f=0;f<s.length;f++){let a=s[f].textContent.trim(),c=parseFloat(a.replace(/[^\\d.-]/g,\"\"));if(!isNaN(c)&&c!==0)for(let n=f+1;n<Math.min(f+4,s.length);n++){let g=s[n].textContent.trim(),$=parseFloat(g.replace(/[^\\d.-]/g,\"\"));if(!isNaN($)&&$>0)return console.log(`Found position from portfolio: qty=${c}, entry=${$}`),{quantity:c,entryPrice:$}}}}}return console.log(`No position data found for ${t}`),null}async function se(t,i){console.log(`updateSymbol called with selector: \"${t}\", value: \"${i}\"`);let r=document.querySelectorAll(t);if(console.log(`Found ${r.length} matching inputs with selector: ${t}`),r.length===0){let T=['.trading-ticket input[type=\"text\"]',\".order-entry .search-box--input\",\".order-ticket .search-box--input\",\".search-box--input\"];for(let y of T)if(r=document.querySelectorAll(y),r.length>0){console.log(`Using fallback selector: ${y}, found ${r.length} inputs`);break}}let l=r[0]||r[1];if(!l){console.error(\"No matching input elements found with any selector!\"),console.error(\"Tried selectors:\",t,\"and fallbacks\");return}console.log(\"Selected input:\",l),console.log(\"Input location:\",{inTradingTicket:!!l.closest(\".trading-ticket\"),inMarketAnalyzer:!!l.closest(\".market-analyzer, .market-watchlist\"),parentClasses:l.parentElement?.className,placeholder:l.placeholder});let p=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,u=T=>l.dispatchEvent(new KeyboardEvent(T,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),p.call(l,\"\"),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await L(400),console.log(`Setting input value to: \"${i}\"`),p.call(l,i),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await L(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(u),l.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function ae(t){let i=\"input.form-control\";for(let r=0;r<20;r++){let l=document.querySelector(i);if(l&&l.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(l,t),[\"input\",\"change\",\"blur\"].forEach(u=>l.dispatchEvent(new Event(u,{bubbles:!0}))),await L(300);return}await L(100)}console.error(\"Price input not found\")}function ue(t){console.log(`normalizeSymbol called with: \"${t}\"`);let i=/^[A-Z]{1,3}$/.test(t);console.log(`Is root symbol: ${i}`);let r=i?z(t):t.toUpperCase();return console.log(`Normalized symbol: \"${r}\"`),r}async function H(t){console.log(\"Creating bracket orders with data:\",t);let i=document.getElementById(\"tpCheckbox\"),r=document.getElementById(\"slCheckbox\");i&&typeof t.enableTP==\"boolean\"&&(i.checked=t.enableTP),r&&typeof t.enableSL==\"boolean\"&&(r.checked=t.enableSL);let l=typeof t.enableTP==\"boolean\"?t.enableTP:i?i.checked:!0,p=typeof t.enableSL==\"boolean\"?t.enableSL:r?r.checked:!0;console.log(`TP enabled: ${l}, SL enabled: ${p}`);async function u(n,g){let $=[...document.querySelectorAll(\".trading-ticket\")].find(C=>C.offsetParent);if(!$)return console.error(\"No visible trading ticket\");let b;for(let C=0;C<25&&(b=[...$.querySelectorAll(n)].find(R=>R.offsetParent&&!R.disabled),!b);C++)await L(100);if(!b)return console.error(`No live input for ${n}`);let S=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,E=b.closest(\".select-input.combobox\");E&&!b.value&&(E.querySelector(\".btn\")?.click(),await L(150),E.querySelector(\".dropdown-menu li\")?.click(),await L(150));for(let C=0;C<3&&(b.focus(),S.call(b,g),b.dispatchEvent(new Event(\"input\",{bubbles:!0})),b.dispatchEvent(new Event(\"change\",{bubbles:!0})),b.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),b.blur(),await L(250),`${b.value}`.trim()!==`${g}`);C++);}async function T(){if(console.log(\"Setting common order fields\"),t.action){console.log(`Setting action to: ${t.action}`);let n=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${n.length} action labels`),n.forEach(g=>{g.textContent.trim()===t.action&&(console.log(`Clicking ${t.action} label`),g.click())})}t.qty&&(console.log(`Setting quantity to: ${t.qty}`),await u(\".select-input.combobox input\",t.qty))}function y(n=document){let g=n.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(g,$=>{let b=$.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),S=b[0]?.textContent.trim()||\"\",E=b[1]?.textContent.trim()||\"\",C=b[2]?.textContent.trim()||\"\",R=b[3]?.textContent.trim()||\"\",P=null,A=C.match(/@([\\d.]+)/);return A&&(P=Number(A[1])),{timestamp:S,id:E,event:C,comment:R,fillPrice:P}})}function s(n=\"up\"){let g=document.querySelector(\".numeric-input-value-controls\");if(!g)return;g.querySelector(n===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function f(n,g){console.log(`\\u{1F527} Starting submitOrder for ${n} order`),console.log(`\\u{1F50D} DEBUG: submitOrder called with orderType=${n}, priceValue=${g}`),await T();let $=document.querySelector(\".group.order-type .select-input div[tabindex]\");if(!$)return console.error(\"\\u274C Order type dropdown not found!\"),{success:!1,error:\"Order type dropdown not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(`\\u{1F4CB} Setting order type to: ${n}`),$.click(),await L(200);let b=[...document.querySelectorAll(\"ul.dropdown-menu li\")],S=b.map(o=>o.textContent.trim());console.log(\"[submitOrder] Available order type options:\",S),window.lastOrderTypeOptions=S,window.lastOrderTypeDebug={orderType:n,availableTypes:S,dropdownHTML:document.querySelector(\".group.order-type\")?.outerHTML,timestamp:new Date().toISOString()};let E=n.toUpperCase(),R={MARKET:[\"MARKET\",\"MARKET ORDER\"],LIMIT:[\"LIMIT\",\"LIMIT ORDER\"],STOP:[\"STOP\",\"STOP MARKET\",\"STOP ORDER\"],\"STOP LIMIT\":[\"STOP LIMIT\",\"STOP-LIMIT\"],\"TRL STOP\":[\"TRAILING STOP\",\"TRAIL STOP\"],\"TRL STP LMT\":[\"TRAILING STOP LIMIT\",\"TRL STP LMT\"]}[E]||[n],P=b.find(o=>R.includes(o.textContent.trim()))||b.find(o=>o.textContent.trim().toUpperCase()===E);if(!P)return console.error(`\\u274C Order type option '${n}' not found!`),{success:!1,error:`Order type option '${n}' not found`,orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};P.click(),await L(500),g&&(console.log(`\\u{1F4B0} Setting price to: ${g}`),console.log(`\\u{1F50D} DEBUG: About to set price input to: ${g} (type: ${typeof g})`),await u(\".numeric-input.feedback-wrapper input\",g)),s();let A=document.querySelector(\".btn-group .btn-primary\");if(!A)return console.error(\"\\u274C Submit button not found!\"),{success:!1,error:\"Submit button not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(\"\\u{1F680} Clicking submit button...\"),A.click(),await L(500),console.log(y()),console.log(\"\\u23F3 Waiting for order to appear in history...\"),await L(1e3),console.log(\"\\u{1F4CA} Capturing order feedback from submitOrder...\");let m=await j();return m?.rejectionReason?console.log(`\\u2705 submitOrder captured REJECTION: ${m.rejectionReason}`):m?.success&&m?.orders?.length>0?console.log(`\\u2705 submitOrder captured SUCCESS: ${m.orders.length} orders`):m?.error?console.log(`\\u26A0\\uFE0F submitOrder captured ERROR: ${m.error}`):console.log(\"\\u26A0\\uFE0F submitOrder captured UNKNOWN result:\",m),document.querySelector(\".icon.icon-back\")?.click(),await L(200),m}console.log(`\\u{1F4CD} BRACKET STEP 3: Submitting initial ${t.orderType||\"MARKET\"} order...`),console.log(`  Order type: ${t.orderType||\"MARKET\"}`),console.log(`  Entry price: ${t.entryPrice||\"Market price\"}`),console.log(`  Action: ${t.action}`),console.log(`  Quantity: ${t.qty}`);let a=await f(t.orderType||\"MARKET\",t.entryPrice);console.log(\"\\u{1F4CA} Main order result:\",a);let c={success:a?.success||!1,orders:a?.orders||[],symbol:a?.symbol||null,summary:a?.summary||null,rejectionReason:a?.rejectionReason||null,filledCount:a?.filledCount||0,rejectedCount:a?.rejectedCount||0,error:a?.error||null,mainOrder:a,tpOrder:null,slOrder:null};if(a?.rejectionReason||a?.error||!a?.success)return console.log(\"\\u274C Main order rejected/failed - skipping TP/SL orders\"),console.log(`   Rejection reason: ${a?.rejectionReason||a?.error||\"Unknown\"}`),console.log(\"Bracket order creation complete (main order rejected)\"),c;if(console.log(\"\\u2705 Main order successful - proceeding with TP/SL orders\"),t.action===\"Buy\"){if(console.log(\"Flipping action to Sell for TP/SL orders\"),t.action=\"Sell\",l){console.log(`Creating take profit order at ${t.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${t.takeProfit}`);let n=await f(\"LIMIT\",t.takeProfit);c.tpOrder=n,n?.orders?.length&&(c.orders=[...c.orders,...n.orders]),n?.filledCount&&(c.filledCount+=n.filledCount),n?.rejectedCount&&(c.rejectedCount+=n.rejectedCount)}if(p){console.log(`Creating stop loss order at ${t.stopLoss}`);let n=await f(\"STOP\",t.stopLoss);c.slOrder=n,n?.orders?.length&&(c.orders=[...c.orders,...n.orders]),n?.filledCount&&(c.filledCount+=n.filledCount),n?.rejectedCount&&(c.rejectedCount+=n.rejectedCount)}}else{if(console.log(\"Flipping action to Buy for TP/SL orders\"),t.action=\"Buy\",l){console.log(`Creating take profit order at ${t.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${t.takeProfit}`);let n=await f(\"LIMIT\",t.takeProfit);c.tpOrder=n,n?.orders?.length&&(c.orders=[...c.orders,...n.orders]),n?.filledCount&&(c.filledCount+=n.filledCount),n?.rejectedCount&&(c.rejectedCount+=n.rejectedCount)}if(p){console.log(`Creating stop loss order at ${t.stopLoss}`);let n=await f(\"STOP\",t.stopLoss);c.slOrder=n,n?.orders?.length&&(c.orders=[...c.orders,...n.orders]),n?.filledCount&&(c.filledCount+=n.filledCount),n?.rejectedCount&&(c.rejectedCount+=n.rejectedCount)}}return console.log(\"\\u{1F4CA} Final bracket feedback aggregation:\"),console.log(`   Overall success: ${c.success}`),console.log(`   Total orders: ${c.orders.length}`),console.log(`   Filled count: ${c.filledCount}`),console.log(`   Rejected count: ${c.rejectedCount}`),console.log(`   Main order: ${c.mainOrder?.success?\"Success\":\"Failed\"}`),console.log(`   TP order: ${c.tpOrder?.success?\"Success\":c.tpOrder?\"Failed\":\"N/A\"}`),console.log(`   SL order: ${c.slOrder?.success?\"Success\":c.slOrder?\"Failed\":\"N/A\"}`),console.log(\"Bracket order creation complete\"),c}function Z(t=document){let i=t.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(i,r=>{let l=r.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),p=l[0]?.textContent.trim()||\"\",u=l[1]?.textContent.trim()||\"\",T=l[2]?.textContent.trim()||\"\",y=l[3]?.textContent.trim()||\"\",s=null,f=T.match(/@([\\d.]+)/);return f&&(s=Number(f[1])),{timestamp:p,id:u,event:T,comment:y,fillPrice:s}})}async function j(){console.log(\"\\u{1F504} CAPTURING TRADOVATE ORDER FEEDBACK...\"),await L(500);let t=document.querySelector(\".order-history\");if(!t)return console.log(\"\\u274C Order history div not found - no feedback to capture\"),{success:!1,orders:[],rejectionReason:null,error:\"Order history not found\"};console.log(\"\\u2705 Found order history div - capturing feedback...\");let i=t.querySelector(\".trading-ticket-header\"),r=\"UNKNOWN\",l=null,p=null,u=null,T=null,y=null;if(i){let e=i.querySelector('div[style*=\"font-size: 160%\"]'),d=e?e.textContent.trim():\"UNKNOWN\",I=i.querySelector(\"div:last-child\"),h=I?I.textContent.trim():\"No summary\";h.includes(\" MKT \")?r=\"MARKET\":h.includes(\" LMT \")?r=\"LIMIT\":h.includes(\" STP LMT \")?r=\"STOP_LIMIT\":h.includes(\" STP \")&&(r=\"STOP\");let M=h.match(/#(\\d+)/);T=M?M[1]:null,u=h.includes(\"Buy\")?\"Buy\":h.includes(\"Sell\")?\"Sell\":null;let F=h.match(/(\\d+)\\s+[A-Z]+\\d*\\s+(?:MKT|LMT|STP)/);p=F?parseInt(F[1]):null;let O=h.match(/LMT at ([\\d.]+)/);l=O?parseFloat(O[1]):null;let D=h.match(/(\\d+)\\/(\\d+)/);y=D?{filled:parseInt(D[1]),total:parseInt(D[2]),isPartial:parseInt(D[1])<parseInt(D[2]),percentFilled:(parseInt(D[1])/parseInt(D[2])*100).toFixed(2)}:null,console.log(`\\u{1F4CA} ORDER FEEDBACK - Symbol: ${d}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Summary: ${h}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order Type: ${r}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order ID: ${T}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Action: ${u}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Quantity: ${p}`),l&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Requested Price: ${l}`),y&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Fill Status: ${y.filled}/${y.total} (${y.percentFilled}%${y.isPartial?\" - PARTIAL FILL\":\" - COMPLETE\"})`)}let s=Z(t);if(console.log(`\\u{1F4CA} ORDER FEEDBACK - Events (${s.length} found):`),s.forEach((e,d)=>{console.log(`\\u{1F4CA} EVENT ${d+1}:`,{timestamp:e.timestamp,id:e.id,event:e.event,comment:e.comment,fillPrice:e.fillPrice})}),r===\"UNKNOWN\"&&s.length>0){let e=s.map(d=>d.event.toUpperCase());e.some(d=>d.includes(\" STP LMT \"))?r=\"STOP_LIMIT\":e.some(d=>d.includes(\" STP \"))?r=\"STOP\":e.some(d=>d.includes(\" LMT \"))?r=\"LIMIT\":e.some(d=>d.includes(\" MKT \"))&&(r=\"MARKET\")}if(!u&&s.length>0){let e=s[0].event.match(/^(BUY|SELL)/i);if(e){let d=e[1].toLowerCase();u=d.charAt(0).toUpperCase()+d.slice(1)}}if(!p&&s.length>0){let e=s[0].event.match(/^(?:BUY|SELL)\\s+(\\d+)/i);e&&(p=parseInt(e[1],10))}console.log(\"\\u{1F4CA} ORDER FEEDBACK - Full HTML Structure:\"),console.log(t.outerHTML);let f=s.filter(e=>e.fillPrice!==null).map(e=>{let d=e.event.match(/(\\d+)@([\\d.]+)/);return{timestamp:e.timestamp,id:e.id,price:e.fillPrice,quantity:d?parseInt(d[1]):null,eventText:e.event}}),a=null,c=null,n=[];s.forEach(e=>{if(e.event.includes(\"STP\")||e.comment.includes(\"Stop\")){let d=e.event.match(/#?(\\d+)/);d&&(a=d[1],n.push({type:\"STOP_LOSS\",orderId:a,event:e}))}if(e.event.includes(\"LMT\")&&(e.comment.includes(\"Profit\")||e.comment.includes(\"Target\"))){let d=e.event.match(/#?(\\d+)/);d&&d[1]!==T&&(c=d[1],n.push({type:\"TAKE_PROFIT\",orderId:c,event:e}))}(e.comment.includes(\"bracket\")||e.comment.includes(\"OCO\"))&&console.log(`\\u{1F4CA} BRACKET ORDER DETECTED - Event: ${e.event}, Comment: ${e.comment}`)}),n.length>0&&(console.log(`\\u{1F4CA} BRACKET ORDERS FOUND: ${n.length} orders`),n.forEach(e=>{console.log(`\\u{1F4CA} ${e.type} Order ID: ${e.orderId}`)}));let g=null,$=[],b=0;s.forEach(e=>{let d=e.comment.match(/commission[:\\s]+\\$?([\\d.]+)/i)||e.event.match(/commission[:\\s]+\\$?([\\d.]+)/i);d&&(g=parseFloat(d[1]),b+=g,console.log(`\\u{1F4CA} COMMISSION FOUND: ${g}`));let I=e.comment.match(/fee[:\\s]+\\$?([\\d.]+)/i)||e.event.match(/fee[:\\s]+\\$?([\\d.]+)/i);if(I){let h=parseFloat(I[1]);$.push({amount:h,description:e.comment||e.event,timestamp:e.timestamp}),b+=h,console.log(`\\u{1F4CA} FEE FOUND: ${h}`)}if(e.comment.includes(\"Exchange\")||e.event.includes(\"Exchange\")){let h=e.comment.match(/\\$?([\\d.]+)/)||e.event.match(/\\$?([\\d.]+)/);if(h){let M=parseFloat(h[1]);$.push({amount:M,description:\"Exchange Fee\",timestamp:e.timestamp})}}});let S={submittedAt:null,firstFillAt:null,completedAt:null,timeToFill:null,riskCheckTime:null};if(s.length>0){S.submittedAt=s[0].timestamp;let e=s.find(F=>F.event.includes(\"Risk Passed\"));if(e){let F=new Date(S.submittedAt),O=new Date(e.timestamp);S.riskCheckTime=O-F,console.log(`\\u{1F4CA} TIMING - Risk check completed in ${S.riskCheckTime}ms`)}let d=f[0];if(d){S.firstFillAt=d.timestamp;let F=new Date(S.submittedAt),O=new Date(S.firstFillAt);S.timeToFill=O-F,console.log(`\\u{1F4CA} TIMING - First fill in ${S.timeToFill}ms`)}S.completedAt=s[s.length-1].timestamp;let I=new Date(S.submittedAt),M=new Date(S.completedAt)-I;S.totalDuration=M,console.log(`\\u{1F4CA} TIMING - Order completed in ${M}ms total`),console.log(`\\u{1F4CA} TIMING - Submitted: ${S.submittedAt}`),console.log(`\\u{1F4CA} TIMING - Completed: ${S.completedAt}`)}let E=s.filter(e=>e.fillPrice!==null).map(e=>e.fillPrice),C=E.length>0?E.reduce((e,d)=>e+d,0)/E.length:null,R=null;r===\"LIMIT\"&&l&&C&&(u===\"Buy\"?R=l-C:u===\"Sell\"&&(R=C-l));let P=null,A=null;if(r===\"MARKET\"&&C){let e=i?.querySelector('div[style*=\"font-size: 160%\"]'),I=(e?e.textContent.trim():\"\").replace(/[A-Z]\\d+$/,\"\"),M=N[I]?.tickSize||.25;if(E.length>1){let F=Math.min(...E),O=Math.max(...E),D=O-F,U=Math.round(D/M);P={priceRange:D,priceRangeTicks:U,minFillPrice:F,maxFillPrice:O,fillCount:E.length,tickSize:M,note:\"Slippage calculated from fill price range. Mid-price at submission not available.\"},console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Price range: ${D} (${U} ticks)`),console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Fills ranged from ${F} to ${O}`)}else E.length===1&&(P={fillPrice:E[0],tickSize:M,note:\"Single fill. Slippage cannot be calculated without mid-price at submission.\"},console.log(`\\u{1F4CA} MARKET ORDER - Single fill at ${E[0]}`))}let m=t.textContent,o={success:!1,orders:s||[],rejectionReason:null,error:null,orderId:T,orderType:r,orderAction:u,orderQuantity:p,requestedPrice:l,averageFillPrice:C,priceImprovement:R,fillPrices:E,fillRatio:y,fillEvents:f,slippage:P,stopLossOrderId:a,takeProfitOrderId:c,bracketOrders:n,commission:g,fees:$,totalCost:b>0?b:null,timingMetrics:S,priceComparison:null};l&&C&&(o.priceComparison={requested:l,filled:C,difference:C-l,percentDifference:((C-l)/l*100).toFixed(3),improvement:R,analysis:R>0?\"BETTER_THAN_REQUESTED\":R<0?\"WORSE_THAN_REQUESTED\":\"FILLED_AT_REQUESTED\"},console.log(`\\u{1F4CA} PRICE COMPARISON - Requested: ${l}, Filled: ${C}`),console.log(`\\u{1F4CA} PRICE COMPARISON - Difference: ${o.priceComparison.difference} (${o.priceComparison.percentDifference}%)`),console.log(`\\u{1F4CA} PRICE COMPARISON - Analysis: ${o.priceComparison.analysis}`)),m.includes(\"Rejected\")?(console.log(\"\\u274C ORDER REJECTED - checking rejection reason...\"),m.includes(\"outside of market hours\")?(console.log(\"\\u274C REJECTION REASON: Order placed outside market hours\"),o.rejectionReason=\"Order placed outside market hours\"):m.includes(\"Risk\")?(console.log(\"\\u274C REJECTION REASON: Risk management violation\"),o.rejectionReason=\"Risk management violation\"):(console.log(\"\\u274C REJECTION REASON: Other - check full feedback above\"),o.rejectionReason=\"Order rejected\")):m.includes(\"Risk Passed\")?(console.log(\"\\u2705 RISK MANAGEMENT: Order passed risk checks\"),o.success=!0):s.length>0&&(o.success=!0);let w=(()=>{let e=`\n\\u{1F4CA} \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550 ORDER VERIFICATION REPORT \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`;return e+=`\n\\u{1F538} ORDER DETAILS:\n`,e+=`   Order ID: ${o.orderId||\"N/A\"}\n`,e+=`   Type: ${o.orderType}\n`,e+=`   Action: ${o.orderAction} ${o.orderQuantity||\"N/A\"} units\n`,e+=`   Status: ${o.success?\"\\u2705 SUCCESS\":\"\\u274C FAILED\"}\n`,o.orderType===\"LIMIT\"&&o.priceComparison&&(e+=`\n\\u{1F538} PRICE VERIFICATION:\n`,e+=`   Requested: ${o.requestedPrice}\n`,e+=`   Filled: ${o.averageFillPrice}\n`,e+=`   Difference: ${o.priceComparison.difference} (${o.priceComparison.percentDifference}%)\n`,e+=`   Result: ${o.priceComparison.analysis}\n`),o.orderType===\"MARKET\"&&o.slippage&&(e+=`\n\\u{1F538} MARKET ORDER SLIPPAGE:\n`,o.slippage.priceRange!==void 0&&(e+=`   Fill Range: ${o.slippage.priceRange} (${o.slippage.priceRangeTicks} ticks)\n`,e+=`   Min Fill: ${o.slippage.minFillPrice}\n`,e+=`   Max Fill: ${o.slippage.maxFillPrice}\n`)),o.fillRatio&&(e+=`\n\\u{1F538} FILL INFORMATION:\n`,e+=`   Fill Ratio: ${o.fillRatio.filled}/${o.fillRatio.total} (${o.fillRatio.percentFilled}%)\n`,e+=`   Status: ${o.fillRatio.isPartial?\"\\u26A0\\uFE0F PARTIAL FILL\":\"\\u2705 COMPLETE FILL\"}\n`,o.fillEvents.length>0&&(e+=`   Individual Fills:\n`,o.fillEvents.forEach((d,I)=>{e+=`     ${I+1}. ${d.quantity||\"N/A\"} @ ${d.price} (${d.timestamp})\n`}))),o.bracketOrders.length>0&&(e+=`\n\\u{1F538} BRACKET ORDERS:\n`,o.stopLossOrderId&&(e+=`   Stop Loss: #${o.stopLossOrderId}\n`),o.takeProfitOrderId&&(e+=`   Take Profit: #${o.takeProfitOrderId}\n`)),o.timingMetrics.timeToFill&&(e+=`\n\\u{1F538} EXECUTION TIMING:\n`,e+=`   Time to Fill: ${o.timingMetrics.timeToFill}ms\n`,o.timingMetrics.riskCheckTime&&(e+=`   Risk Check: ${o.timingMetrics.riskCheckTime}ms\n`),e+=`   Total Duration: ${o.timingMetrics.totalDuration||\"N/A\"}ms\n`),(o.commission||o.totalCost)&&(e+=`\n\\u{1F538} COSTS:\n`,o.commission&&(e+=`   Commission: ${o.commission}\n`),o.fees.length>0&&(e+=`   Fees: ${o.fees.length} fee(s) totaling ${o.fees.reduce((d,I)=>d+I.amount,0)}\n`),o.totalCost&&(e+=`   Total Cost: ${o.totalCost}\n`)),o.rejectionReason&&(e+=`\n\\u{1F538} REJECTION DETAILS:\n`,e+=`   Reason: ${o.rejectionReason}\n`),e+=`\n\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`,e})();return console.log(w),o.verificationReport=w,j.lastResult=o,window.lastOrderFeedback=o,console.log(\"\\u{1F504} ORDER FEEDBACK CAPTURE COMPLETE\"),console.log(\"\\u{1F4A1} TIP: Access last feedback with: window.lastOrderFeedback\"),o}var N={MNQ:{tickSize:.25,tickValue:.5,defaultSL:15,defaultTP:200,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:15,defaultTP:200,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function B(t,i=1,r=\"Buy\",l=null,p=null,u=.25,T=null){console.log(`\\u{1F680} [AUTOTRADE START] autoTrade called with: symbol=${t}, qty=${i}, action=${r}, TP=${l}, SL=${p}, tickSize=${u}, orderType=${T}`),console.log(`\\u{1F680} [AUTOTRADE START] Function entry successful at ${new Date().toISOString()}`);try{console.log(`\\u{1F50D} [DEBUG] TP ticks input parameter = ${l} (type: ${typeof l})`);let y=v.symbol||\"NQ\";console.log(`\\u{1F50D} [SYMBOL] Using symbol: ${y}`),console.log(`\\u{1F50D} [SYMBOL] currentState.symbol = ${v.symbol}`);let s=y.replace(/[A-Z]\\d+$/,\"\");console.log(`\\u{1F50D} [SYMBOL] Root symbol: ${s}`),console.log(`\\u{1F50D} [DATA] Looking up symbolData for ${s}...`);let f=N[s];if(console.log(\"\\u{1F50D} [DATA] symbolData found:\",f),s!==B.lastRootSymbol){v.tickSize=f?.tickSize??\"\";let O=document.getElementById(\"tickInput\");O&&(O.value=v.tickSize)}B.lastRootSymbol=s;let a=f&&typeof f.tickSize==\"number\"?f.tickSize:parseFloat(v.tickSize)||u;v.tickSize=a;let c=document.getElementById(\"tickInput\");c&&(c.value=a);let n=p||f?.defaultSL||parseInt(v.sl)||40,g=l||f?.defaultTP||parseInt(v.tp)||100,$=n>0,b=g>0;console.log(`\\u{1F50D} DEBUG: actualTakeProfitTicks = ${g} (from takeProfitTicks: ${l}, defaultTP: ${f?.defaultTP}, tpInput: ${v.tp})`);let S=f?.tickSize?\"dictionary\":v.tickSize?\"input field\":\"default parameter\";console.log(`Using tick size ${a} (from ${S})`),console.log(`Using SL: ${n} ticks, TP: ${g} ticks`),console.log(`\\u{1F50D} [DEBUG] tickSize = ${a} (symbolData.tickSize: ${f?.tickSize}, tickInput: ${v.tickSize}, _tickSize param: ${u})`),console.log(`\\u{1F4E1} [MARKET DATA] Getting market data for ${y}...`),console.log(`\\u{1F4E1} [MARKET DATA] About to call getMarketData(${y})`);let E=X(y);if(console.log(\"\\u{1F4E1} [MARKET DATA] getMarketData returned:\",E),!E){console.error(`\\u274C [MARKET DATA] No market data for ${y} - EARLY RETURN!`);return}console.log(\"\\u{1F4E1} [MARKET DATA] Market data received:\",E),console.log(\"\\u{1F4B0} [ORDER PREP] Starting order preparation...\");let C=document.getElementById(\"entryPriceInput\"),R=C&&C.value?parseFloat(C.value):null;console.log(`\\u{1F4B0} [ORDER PREP] Custom entry price: ${R}`);let P=parseFloat(r===\"Buy\"?E.offerPrice:E.bidPrice);console.log(`\\u{1F4B0} [ORDER PREP] Market price: ${P} (${r===\"Buy\"?\"offer\":\"bid\"} price)`);let A=\"MARKET\",m=P;if(console.log(`\\u{1F4B0} [ORDER PREP] Initial order type: ${A}, entry price: ${m}`),T){let O=[\"MARKET\",\"LIMIT\",\"STOP\",\"STOP LIMIT\",\"TRL STOP\",\"TRL STP LMT\"];if(!O.includes(T)){console.error(`Invalid order type: ${T}. Valid types: ${O.join(\", \")}`);return}A=T,console.log(`Using explicit order type: ${A}`),A!==\"MARKET\"&&R!==null?(m=R,console.log(`Using custom entry price: ${m} for ${A} order`)):A!==\"MARKET\"?(m=P,console.log(`Using market price: ${m} for ${A} order`)):A===\"MARKET\"&&(m=P,console.log(`Using market price: ${m} for MARKET order`))}else R!==null?(console.log(`Custom entry price provided: ${R}`),m=R,r===\"Buy\"?A=R<P?\"LIMIT\":\"STOP\":A=R>P?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${A}`)):console.log(`No custom entry price provided, using market order at ${P}`);let o=f?.precision??2;console.log(`Using price precision: ${o} decimal places`);let k=document.getElementById(\"slPriceInput\"),w=document.getElementById(\"tpPriceInput\"),e=k&&k.value?parseFloat(k.value):null,d=w&&w.value?parseFloat(w.value):null,I;e!==null?(I=e.toFixed(o),console.log(`Using hardcoded SL price: ${I}`)):(I=(r===\"Buy\"?m-n*a:m+n*a).toFixed(o),console.log(`Calculated SL price: ${I} (${r===\"Buy\"?\"entry - \":\"entry + \"}${n} ticks)`));let h;if(d!==null)h=d.toFixed(o),console.log(`Using hardcoded TP price: ${h}`);else{let O=g*a;console.log(`\\u{1F50D} DEBUG: TP calculation - entryPrice: ${m}, actualTakeProfitTicks: ${g}, tickSize: ${a}, offset: ${O}`),h=(r===\"Buy\"?m+g*a:m-g*a).toFixed(o),console.log(`Calculated TP price: ${h} (${r===\"Buy\"?\"entry + \":\"entry - \"}${g} ticks)`)}let M={symbol:E.symbol,action:r,qty:i.toString(),takeProfit:h,stopLoss:I,orderType:A,entryPrice:A!==\"MARKET\"?m.toFixed(o):null,enableTP:b,enableSL:$};console.log(\"Trade data prepared:\",M);let F=(r===\"Buy\"?m+g*a:m-g*a).toFixed(o);return console.log(`\\u{1F50D} DEBUG: tradeData.takeProfit = ${M.takeProfit} (should be TP price for ${g} ticks)`),console.log(`\\u2705 TP VALIDATION: Expected=${F}, Actual=${M.takeProfit}, Match=${F===M.takeProfit?\"\\u2705\":\"\\u274C\"}`),F!==M.takeProfit&&console.error(`\\u{1F6A8} TP MISMATCH: Expected ${F} but got ${M.takeProfit} - this indicates a calculation error!`),console.log(\"\\u{1F680} [ORDER EXECUTION] About to submit bracket orders with tradeData:\",M),console.log(\"\\u{1F680} [ORDER EXECUTION] Calling createBracketOrdersManual...\"),H(M).then(O=>(console.log(\"\\u2705 [ORDER EXECUTION] createBracketOrdersManual SUCCESS:\",O),O)).catch(O=>{throw console.error(\"\\u274C [ORDER EXECUTION] createBracketOrdersManual ERROR:\",O),O}).finally(()=>{let O=N[s],D=document.getElementById(\"slInput\"),U=document.getElementById(\"tpInput\")})}catch(y){throw console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Critical error in autoTrade function:\",y),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Stack trace:\",y.stack),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Function parameters:\",{inputSymbol:t,quantity:i,action:r,takeProfitTicks:l,stopLossTicks:p,_tickSize:u,explicitOrderType:T}),y}}function z(t){console.log(`getFrontQuarter called for root: \"${t}\"`);let{letter:i,yearDigit:r}=G();console.log(`Got quarterly code: letter=${i}, yearDigit=${r}`);let l=`${t.toUpperCase()}${i}${r}`;return console.log(`Returning front quarter symbol: \"${l}\"`),l}function X(t){console.log(`getMarketData called for: \"${t}\"`);let i=/^[A-Z]{1,3}$/.test(t)?z(t):t.toUpperCase();console.log(`Using symbol: \"${i}\" for market data lookup`);let l=(document.querySelector(\".quoteboard.module.data-table\")||document).querySelectorAll(\".public_fixedDataTable_bodyRow\"),p=null;for(let s of l){let f=s.querySelectorAll(\".public_fixedDataTableCell_cellContent\");if(!f.length)continue;if((f[0].textContent||\"\").trim().toUpperCase()===i){p=s;break}}if(!p)return console.error(`Row for symbol \"${i}\" not found in data table`),alert(`Cannot Find ${t}`),null;let u=p.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),T=u[4]?.textContent.trim(),y=u[5]?.textContent.trim();return console.log(`Extracted prices for ${i}: bid=${T}, offer=${y}`),{symbol:i,bidPrice:T,offerPrice:y}}var de=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function pe(t=new Date){console.log(`getMonthlyCode called with date: ${t.toISOString()}`);let i=de[t.getUTCMonth()],r=t.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${i}, yearDigit=${r}`),{letter:i,yearDigit:r}}function G(t=new Date){console.log(`getQuarterlyCode called with date: ${t.toISOString()}`);let i=[2,5,8,11],r={2:\"H\",5:\"M\",8:\"U\",11:\"Z\"};function l(f,a){let $=1+(5-new Date(Date.UTC(f,a,1)).getUTCDay()+7)%7+14;return new Date(Date.UTC(f,a,$,0,0,0))}let p=t.getUTCFullYear(),u=t.getUTCMonth();console.log(`Current month index: ${u}`),console.log(`Starting calculation with year=${p}, month=${u}`);let T=0;for(;!i.includes(u)&&(u++,u>11&&(u=0,p++),!(++T>12)););let y=l(p,u);t.getTime()>=y.getTime()&&(u+=3,u>11&&(u-=12,p++));let s={letter:r[u],yearDigit:p%10+\"\"};return console.log(`Calculated quarterly code: letter=${s.letter}, yearDigit=${s.yearDigit}`),s}console.log(\"Creating example front-quarter symbol\");var{letter:fe,yearDigit:me}=G(),ge=`NQ${fe}${me}`;console.log(`Example front-quarter symbol created: ${ge}`);var K={initialized:!1,options:{}},x=null;function _(t={}){K.initialized=!0,K.options={...t},t.panel&&Q(t.panel)}function Q(t){x=t}function J(){return x?.mount?x.mount({visible:!1}):x?.createUI?x.createUI(!1):(console.warn(\"[TradoAuto] No UI adapter registered; skipping invisible UI creation\"),null)}var ye={state:v,futuresTickData:N,delay:L,normalizeSymbol:ue,updateSymbol:se,updatePrice:ae,clickExitForSymbol:ie,moveStopLossToBreakeven:ce,getCurrentPosition:V,captureOrderFeedback:j,getOrderEvents:Z,createBracketOrdersManual:H,autoTrade:B,getFrontQuarter:z,getMarketData:X,getMonthlyCode:pe,getQuarterlyCode:G,init:_,registerUIPanel:Q,createInvisibleUI:J,getInitStatus:()=>({...K})};function W(t={}){return _(t),ye}var Y=W();typeof window<\"u\"&&(window.TradoAuto=Y);var Te=Y;return re(Ee);})();\n//# sourceMappingURL=tradovate_auto_driver.js.map\n";
    const panelSource = "var TradovateUIPanelBundle=(()=>{var U=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var re=(e,c)=>{for(var l in c)U(e,l,{get:c[l],enumerable:!0})},ie=(e,c,l,i)=>{if(c&&typeof c==\"object\"||typeof c==\"function\")for(let p of ne(c))!le.call(e,p)&&p!==l&&U(e,p,{get:()=>c[p],enumerable:!(i=oe(c,p))||i.enumerable});return e};var ce=e=>ie(U({},\"__esModule\",{value:!0}),e);var $e={};re($e,{createUIPanel:()=>te,default:()=>ke});console.log(\"Auto Order script initialized - AUTOMATIC HOT RELOAD SUCCESS!\");function M(e){return console.log(`Delaying for ${e}ms`),new Promise(c=>setTimeout(c,e))}var F={symbol:\"NQ\",tickSize:.25,tp:null,sl:null,qty:10,entryPrice:null,tpPrice:null,slPrice:null,tpEnabled:!0,slEnabled:!0};async function se(e,c=\"cancel-option-Exit-at-Mkt-Cxl\"){let l={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},i={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},p=S=>(S||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),u=S=>new Promise(v=>setTimeout(v,S));async function T(S,{timeout:v=1200,interval:t=50}={}){let y=performance.now();for(;performance.now()-y<v;){let A=S();if(A)return A;await u(t)}return null}let g=c.toLowerCase(),d=l[g]||c,m=i[d]||null,s=p(e),a=/^[A-Z]{1,3}$/.test(s),n=[...document.querySelectorAll(\".header .contract-symbol span\")].find(S=>{let v=p(S.textContent);if(v===s)return!0;if(a&&v.startsWith(s)){let t=v.substring(s.length);return/^[FGHJKMNQUVXZ]\\d+$/.test(t)}return!1});if(!n)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let C=n.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),E=C?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),$=C?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!C||!E||!$)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(m?m.test(p(E.textContent)):!1)return E.click(),!0;$.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let h=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(S=>S.offsetParent!==null||/display\\s*:\\s*block/i.test(S.getAttribute(\"style\")||\"\")||!!S.closest(\".open\")),f=await T(h,{timeout:900,interval:40});if(!f||!f.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let I=$.getBoundingClientRect();f.sort((S,v)=>{let t=S.getBoundingClientRect(),y=v.getBoundingClientRect(),A=Math.hypot(t.left-I.left,t.top-I.bottom),P=Math.hypot(y.left-I.left,y.top-I.bottom);return A-P});let R=f[0],r=document.getElementById(d);if(!r&&m){for(let S of f)if(r=[...S.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(v=>m.test(p(v.textContent))),r){R=S;break}}if(!r)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let o=r.tagName?r.matches(\"a,button\")?r:r.querySelector(\"a,button\")||r:r;return[\"mousedown\",\"mouseup\",\"click\"].forEach(S=>o.dispatchEvent(new MouseEvent(S,{bubbles:!0}))),$.click(),await u(120),f=h(),r=document.getElementById(d)||(m?f?.flatMap(S=>[...S.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(S=>m.test(p(S.textContent))):null),r?([\"mousedown\",\"mouseup\",\"click\"].forEach(S=>(r.querySelector(\"a,button\")||r).dispatchEvent(new MouseEvent(S,{bubbles:!0}))),await u(80),E.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function ae(e){console.log(`moveStopLossToBreakeven called for symbol: ${e}`);let c=V(e);if(!c){console.log(`No open position found for ${e}`);return}console.log(`Found position for ${e}:`,c);let l=c.entryPrice,i=c.quantity>0,p=e.replace(/[A-Z]\\d+$/,\"\"),u=D[p],g=(u?.tickSize||.25)*2,d=i?(l+g).toFixed(u?.precision||2):(l-g).toFixed(u?.precision||2);console.log(`Calculated breakeven price: ${d} (entry: ${l}, isLong: ${i}, buffer: ${g})`);let m=document.querySelectorAll(\".module.module-dom\"),s=0;for(let a of m){let n=a.querySelector(\".contract-symbol span\"),b=n?n.textContent.trim().toUpperCase():\"\",C=e.toUpperCase(),E=/^[A-Z]{1,3}$/.test(C);if(b===C||E&&b.startsWith(C)&&/^[FGHJKMNQUVXZ]\\d+$/.test(b.substring(C.length))){let $=a.querySelector(\".order-type\");if(__UI_PANEL_BUNDLE__&$.textContent.includes(\"STOP\")){console.log(`Found stop order for ${e}, updating to breakeven`);let k=a.querySelector('input[type=\"number\"], .numeric-input input');k?(console.log(`Updating stop price from ${k.value} to ${d}`),k.focus(),k.value=d,k.dispatchEvent(new Event(\"input\",{bubbles:!0})),k.dispatchEvent(new Event(\"change\",{bubbles:!0})),k.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),s++,console.log(`Stop order ${s} updated to breakeven`)):console.log(\"Price input not found for stop order\")}}}s>0?console.log(`\\u2705 Successfully moved ${s} stop order(s) to breakeven for ${e}`):console.log(`\\u26A0\\uFE0F No stop orders found to update for ${e}`)}function V(e){console.log(`getCurrentPosition called for symbol: ${e}`);let c=document.querySelectorAll(\".module.module-dom\");for(let i of c){let p=i.querySelector(\".contract-symbol span\"),u=p?p.textContent.trim().toUpperCase():\"\",T=e.toUpperCase(),g=/^[A-Z]{1,3}$/.test(T);if(u===T||g&&u.startsWith(T)&&/^[FGHJKMNQUVXZ]\\d+$/.test(u.substring(T.length))){let d=i.querySelector(\".position-quantity, .quantity\"),m=i.querySelector(\".avg-price, .entry-price, .price\");if(d&&m){let s=parseFloat(d.textContent.replace(/[^\\d.-]/g,\"\")),a=parseFloat(m.textContent.replace(/[^\\d.-]/g,\"\"));if(!isNaN(s)&&!isNaN(a)&&s!==0)return console.log(`Found position: qty=${s}, entry=${a}`),{quantity:s,entryPrice:a}}}}let l=document.querySelectorAll(\".portfolio-row, .position-row\");for(let i of l){let p=i.querySelector(\".symbol, .contract-symbol\"),u=p?p.textContent.trim().toUpperCase():\"\",T=e.toUpperCase(),g=/^[A-Z]{1,3}$/.test(T);if(u===T||g&&u.startsWith(T)&&/^[FGHJKMNQUVXZ]\\d+$/.test(u.substring(T.length))){let d=i.querySelectorAll(\"td, .cell\");for(let m=0;m<d.length;m++){let s=d[m].textContent.trim(),a=parseFloat(s.replace(/[^\\d.-]/g,\"\"));if(!isNaN(a)&&a!==0)for(let n=m+1;n<Math.min(m+4,d.length);n++){let b=d[n].textContent.trim(),C=parseFloat(b.replace(/[^\\d.-]/g,\"\"));if(!isNaN(C)&&C>0)return console.log(`Found position from portfolio: qty=${a}, entry=${C}`),{quantity:a,entryPrice:C}}}}}return console.log(`No position data found for ${e}`),null}async function ue(e,c){console.log(`updateSymbol called with selector: \"${e}\", value: \"${c}\"`);let l=document.querySelectorAll(e);if(console.log(`Found ${l.length} matching inputs with selector: ${e}`),l.length===0){let T=['.trading-ticket input[type=\"text\"]',\".order-entry .search-box--input\",\".order-ticket .search-box--input\",\".search-box--input\"];for(let g of T)if(l=document.querySelectorAll(g),l.length>0){console.log(`Using fallback selector: ${g}, found ${l.length} inputs`);break}}let i=l[0]||l[1];if(!i){console.error(\"No matching input elements found with any selector!\"),console.error(\"Tried selectors:\",e,\"and fallbacks\");return}console.log(\"Selected input:\",i),console.log(\"Input location:\",{inTradingTicket:!!i.closest(\".trading-ticket\"),inMarketAnalyzer:!!i.closest(\".market-analyzer, .market-watchlist\"),parentClasses:i.parentElement?.className,placeholder:i.placeholder});let p=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,u=T=>i.dispatchEvent(new KeyboardEvent(T,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),p.call(i,\"\"),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await M(400),console.log(`Setting input value to: \"${c}\"`),p.call(i,c),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await M(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(u),i.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function de(e){let c=\"input.form-control\";for(let l=0;l<20;l++){let i=document.querySelector(c);if(i&&i.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,e),[\"input\",\"change\",\"blur\"].forEach(u=>i.dispatchEvent(new Event(u,{bubbles:!0}))),await M(300);return}await M(100)}console.error(\"Price input not found\")}function pe(e){console.log(`normalizeSymbol called with: \"${e}\"`);let c=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${c}`);let l=c?j(e):e.toUpperCase();return console.log(`Normalized symbol: \"${l}\"`),l}async function H(e){console.log(\"Creating bracket orders with data:\",e);let c=document.getElementById(\"tpCheckbox\"),l=document.getElementById(\"slCheckbox\");c&&typeof e.enableTP==\"boolean\"&&(c.checked=e.enableTP),l&&typeof e.enableSL==\"boolean\"&&(l.checked=e.enableSL);let i=typeof e.enableTP==\"boolean\"?e.enableTP:c?c.checked:!0,p=typeof e.enableSL==\"boolean\"?e.enableSL:l?l.checked:!0;console.log(`TP enabled: ${i}, SL enabled: ${p}`);async function u(n,b){let C=[...document.querySelectorAll(\".trading-ticket\")].find(h=>h.offsetParent);if(!C)return console.error(\"No visible trading ticket\");let E;for(let h=0;h<25&&(E=[...C.querySelectorAll(n)].find(f=>f.offsetParent&&!f.disabled),!E);h++)await M(100);if(!E)return console.error(`No live input for ${n}`);let $=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,k=E.closest(\".select-input.combobox\");k&&!E.value&&(k.querySelector(\".btn\")?.click(),await M(150),k.querySelector(\".dropdown-menu li\")?.click(),await M(150));for(let h=0;h<3&&(E.focus(),$.call(E,b),E.dispatchEvent(new Event(\"input\",{bubbles:!0})),E.dispatchEvent(new Event(\"change\",{bubbles:!0})),E.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),E.blur(),await M(250),`${E.value}`.trim()!==`${b}`);h++);}async function T(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let n=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${n.length} action labels`),n.forEach(b=>{b.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),b.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await u(\".select-input.combobox input\",e.qty))}function g(n=document){let b=n.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(b,C=>{let E=C.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),$=E[0]?.textContent.trim()||\"\",k=E[1]?.textContent.trim()||\"\",h=E[2]?.textContent.trim()||\"\",f=E[3]?.textContent.trim()||\"\",I=null,R=h.match(/@([\\d.]+)/);return R&&(I=Number(R[1])),{timestamp:$,id:k,event:h,comment:f,fillPrice:I}})}function d(n=\"up\"){let b=document.querySelector(\".numeric-input-value-controls\");if(!b)return;b.querySelector(n===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function m(n,b){console.log(`\\u{1F527} Starting submitOrder for ${n} order`),console.log(`\\u{1F50D} DEBUG: submitOrder called with orderType=${n}, priceValue=${b}`),await T();let C=document.querySelector(\".group.order-type .select-input div[tabindex]\");if(!C)return console.error(\"\\u274C Order type dropdown not found!\"),{success:!1,error:\"Order type dropdown not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(`\\u{1F4CB} Setting order type to: ${n}`),C.click(),await M(200);let E=[...document.querySelectorAll(\"ul.dropdown-menu li\")],$=E.map(o=>o.textContent.trim());console.log(\"[submitOrder] Available order type options:\",$),window.lastOrderTypeOptions=$,window.lastOrderTypeDebug={orderType:n,availableTypes:$,dropdownHTML:document.querySelector(\".group.order-type\")?.outerHTML,timestamp:new Date().toISOString()};let k=n.toUpperCase(),f={MARKET:[\"MARKET\",\"MARKET ORDER\"],LIMIT:[\"LIMIT\",\"LIMIT ORDER\"],STOP:[\"STOP\",\"STOP MARKET\",\"STOP ORDER\"],\"STOP LIMIT\":[\"STOP LIMIT\",\"STOP-LIMIT\"],\"TRL STOP\":[\"TRAILING STOP\",\"TRAIL STOP\"],\"TRL STP LMT\":[\"TRAILING STOP LIMIT\",\"TRL STP LMT\"]}[k]||[n],I=E.find(o=>f.includes(o.textContent.trim()))||E.find(o=>o.textContent.trim().toUpperCase()===k);if(!I)return console.error(`\\u274C Order type option '${n}' not found!`),{success:!1,error:`Order type option '${n}' not found`,orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};I.click(),await M(500),b&&(console.log(`\\u{1F4B0} Setting price to: ${b}`),console.log(`\\u{1F50D} DEBUG: About to set price input to: ${b} (type: ${typeof b})`),await u(\".numeric-input.feedback-wrapper input\",b)),d();let R=document.querySelector(\".btn-group .btn-primary\");if(!R)return console.error(\"\\u274C Submit button not found!\"),{success:!1,error:\"Submit button not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(\"\\u{1F680} Clicking submit button...\"),R.click(),await M(500),console.log(g()),console.log(\"\\u23F3 Waiting for order to appear in history...\"),await M(1e3),console.log(\"\\u{1F4CA} Capturing order feedback from submitOrder...\");let r=await K();return r?.rejectionReason?console.log(`\\u2705 submitOrder captured REJECTION: ${r.rejectionReason}`):r?.success&&r?.orders?.length>0?console.log(`\\u2705 submitOrder captured SUCCESS: ${r.orders.length} orders`):r?.error?console.log(`\\u26A0\\uFE0F submitOrder captured ERROR: ${r.error}`):console.log(\"\\u26A0\\uFE0F submitOrder captured UNKNOWN result:\",r),document.querySelector(\".icon.icon-back\")?.click(),await M(200),r}console.log(`\\u{1F4CD} BRACKET STEP 3: Submitting initial ${e.orderType||\"MARKET\"} order...`),console.log(`  Order type: ${e.orderType||\"MARKET\"}`),console.log(`  Entry price: ${e.entryPrice||\"Market price\"}`),console.log(`  Action: ${e.action}`),console.log(`  Quantity: ${e.qty}`);let s=await m(e.orderType||\"MARKET\",e.entryPrice);console.log(\"\\u{1F4CA} Main order result:\",s);let a={success:s?.success||!1,orders:s?.orders||[],symbol:s?.symbol||null,summary:s?.summary||null,rejectionReason:s?.rejectionReason||null,filledCount:s?.filledCount||0,rejectedCount:s?.rejectedCount||0,error:s?.error||null,mainOrder:s,tpOrder:null,slOrder:null};if(s?.rejectionReason||s?.error||!s?.success)return console.log(\"\\u274C Main order rejected/failed - skipping TP/SL orders\"),console.log(`   Rejection reason: ${s?.rejectionReason||s?.error||\"Unknown\"}`),console.log(\"Bracket order creation complete (main order rejected)\"),a;if(console.log(\"\\u2705 Main order successful - proceeding with TP/SL orders\"),e.action===\"Buy\"){if(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",i){console.log(`Creating take profit order at ${e.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${e.takeProfit}`);let n=await m(\"LIMIT\",e.takeProfit);a.tpOrder=n,n?.orders?.length&&(a.orders=[...a.orders,...n.orders]),n?.filledCount&&(a.filledCount+=n.filledCount),n?.rejectedCount&&(a.rejectedCount+=n.rejectedCount)}if(p){console.log(`Creating stop loss order at ${e.stopLoss}`);let n=await m(\"STOP\",e.stopLoss);a.slOrder=n,n?.orders?.length&&(a.orders=[...a.orders,...n.orders]),n?.filledCount&&(a.filledCount+=n.filledCount),n?.rejectedCount&&(a.rejectedCount+=n.rejectedCount)}}else{if(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",i){console.log(`Creating take profit order at ${e.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${e.takeProfit}`);let n=await m(\"LIMIT\",e.takeProfit);a.tpOrder=n,n?.orders?.length&&(a.orders=[...a.orders,...n.orders]),n?.filledCount&&(a.filledCount+=n.filledCount),n?.rejectedCount&&(a.rejectedCount+=n.rejectedCount)}if(p){console.log(`Creating stop loss order at ${e.stopLoss}`);let n=await m(\"STOP\",e.stopLoss);a.slOrder=n,n?.orders?.length&&(a.orders=[...a.orders,...n.orders]),n?.filledCount&&(a.filledCount+=n.filledCount),n?.rejectedCount&&(a.rejectedCount+=n.rejectedCount)}}return console.log(\"\\u{1F4CA} Final bracket feedback aggregation:\"),console.log(`   Overall success: ${a.success}`),console.log(`   Total orders: ${a.orders.length}`),console.log(`   Filled count: ${a.filledCount}`),console.log(`   Rejected count: ${a.rejectedCount}`),console.log(`   Main order: ${a.mainOrder?.success?\"Success\":\"Failed\"}`),console.log(`   TP order: ${a.tpOrder?.success?\"Success\":a.tpOrder?\"Failed\":\"N/A\"}`),console.log(`   SL order: ${a.slOrder?.success?\"Success\":a.slOrder?\"Failed\":\"N/A\"}`),console.log(\"Bracket order creation complete\"),a}function X(e=document){let c=e.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(c,l=>{let i=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),p=i[0]?.textContent.trim()||\"\",u=i[1]?.textContent.trim()||\"\",T=i[2]?.textContent.trim()||\"\",g=i[3]?.textContent.trim()||\"\",d=null,m=T.match(/@([\\d.]+)/);return m&&(d=Number(m[1])),{timestamp:p,id:u,event:T,comment:g,fillPrice:d}})}async function K(){console.log(\"\\u{1F504} CAPTURING TRADOVATE ORDER FEEDBACK...\"),await M(500);let e=document.querySelector(\".order-history\");if(!e)return console.log(\"\\u274C Order history div not found - no feedback to capture\"),{success:!1,orders:[],rejectionReason:null,error:\"Order history not found\"};console.log(\"\\u2705 Found order history div - capturing feedback...\");let c=e.querySelector(\".trading-ticket-header\"),l=\"UNKNOWN\",i=null,p=null,u=null,T=null,g=null;if(c){let t=c.querySelector('div[style*=\"font-size: 160%\"]'),y=t?t.textContent.trim():\"UNKNOWN\",A=c.querySelector(\"div:last-child\"),P=A?A.textContent.trim():\"No summary\";P.includes(\" MKT \")?l=\"MARKET\":P.includes(\" LMT \")?l=\"LIMIT\":P.includes(\" STP LMT \")?l=\"STOP_LIMIT\":P.includes(\" STP \")&&(l=\"STOP\");let O=P.match(/#(\\d+)/);T=O?O[1]:null,u=P.includes(\"Buy\")?\"Buy\":P.includes(\"Sell\")?\"Sell\":null;let L=P.match(/(\\d+)\\s+[A-Z]+\\d*\\s+(?:MKT|LMT|STP)/);p=L?parseInt(L[1]):null;let x=P.match(/LMT at ([\\d.]+)/);i=x?parseFloat(x[1]):null;let w=P.match(/(\\d+)\\/(\\d+)/);g=w?{filled:parseInt(w[1]),total:parseInt(w[2]),isPartial:parseInt(w[1])<parseInt(w[2]),percentFilled:(parseInt(w[1])/parseInt(w[2])*100).toFixed(2)}:null,console.log(`\\u{1F4CA} ORDER FEEDBACK - Symbol: ${y}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Summary: ${P}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order Type: ${l}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order ID: ${T}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Action: ${u}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Quantity: ${p}`),i&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Requested Price: ${i}`),g&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Fill Status: ${g.filled}/${g.total} (${g.percentFilled}%${g.isPartial?\" - PARTIAL FILL\":\" - COMPLETE\"})`)}let d=X(e);if(console.log(`\\u{1F4CA} ORDER FEEDBACK - Events (${d.length} found):`),d.forEach((t,y)=>{console.log(`\\u{1F4CA} EVENT ${y+1}:`,{timestamp:t.timestamp,id:t.id,event:t.event,comment:t.comment,fillPrice:t.fillPrice})}),l===\"UNKNOWN\"&&d.length>0){let t=d.map(y=>y.event.toUpperCase());t.some(y=>y.includes(\" STP LMT \"))?l=\"STOP_LIMIT\":t.some(y=>y.includes(\" STP \"))?l=\"STOP\":t.some(y=>y.includes(\" LMT \"))?l=\"LIMIT\":t.some(y=>y.includes(\" MKT \"))&&(l=\"MARKET\")}if(!u&&d.length>0){let t=d[0].event.match(/^(BUY|SELL)/i);if(t){let y=t[1].toLowerCase();u=y.charAt(0).toUpperCase()+y.slice(1)}}if(!p&&d.length>0){let t=d[0].event.match(/^(?:BUY|SELL)\\s+(\\d+)/i);t&&(p=parseInt(t[1],10))}console.log(\"\\u{1F4CA} ORDER FEEDBACK - Full HTML Structure:\"),console.log(e.outerHTML);let m=d.filter(t=>t.fillPrice!==null).map(t=>{let y=t.event.match(/(\\d+)@([\\d.]+)/);return{timestamp:t.timestamp,id:t.id,price:t.fillPrice,quantity:y?parseInt(y[1]):null,eventText:t.event}}),s=null,a=null,n=[];d.forEach(t=>{if(t.event.includes(\"STP\")||t.comment.includes(\"Stop\")){let y=t.event.match(/#?(\\d+)/);y&&(s=y[1],n.push({type:\"STOP_LOSS\",orderId:s,event:t}))}if(t.event.includes(\"LMT\")&&(t.comment.includes(\"Profit\")||t.comment.includes(\"Target\"))){let y=t.event.match(/#?(\\d+)/);y&&y[1]!==T&&(a=y[1],n.push({type:\"TAKE_PROFIT\",orderId:a,event:t}))}(t.comment.includes(\"bracket\")||t.comment.includes(\"OCO\"))&&console.log(`\\u{1F4CA} BRACKET ORDER DETECTED - Event: ${t.event}, Comment: ${t.comment}`)}),n.length>0&&(console.log(`\\u{1F4CA} BRACKET ORDERS FOUND: ${n.length} orders`),n.forEach(t=>{console.log(`\\u{1F4CA} ${t.type} Order ID: ${t.orderId}`)}));let b=null,C=[],E=0;d.forEach(t=>{let y=t.comment.match(/commission[:\\s]+\\$?([\\d.]+)/i)||t.event.match(/commission[:\\s]+\\$?([\\d.]+)/i);y&&(b=parseFloat(y[1]),E+=b,console.log(`\\u{1F4CA} COMMISSION FOUND: ${b}`));let A=t.comment.match(/fee[:\\s]+\\$?([\\d.]+)/i)||t.event.match(/fee[:\\s]+\\$?([\\d.]+)/i);if(A){let P=parseFloat(A[1]);C.push({amount:P,description:t.comment||t.event,timestamp:t.timestamp}),E+=P,console.log(`\\u{1F4CA} FEE FOUND: ${P}`)}if(t.comment.includes(\"Exchange\")||t.event.includes(\"Exchange\")){let P=t.comment.match(/\\$?([\\d.]+)/)||t.event.match(/\\$?([\\d.]+)/);if(P){let O=parseFloat(P[1]);C.push({amount:O,description:\"Exchange Fee\",timestamp:t.timestamp})}}});let $={submittedAt:null,firstFillAt:null,completedAt:null,timeToFill:null,riskCheckTime:null};if(d.length>0){$.submittedAt=d[0].timestamp;let t=d.find(L=>L.event.includes(\"Risk Passed\"));if(t){let L=new Date($.submittedAt),x=new Date(t.timestamp);$.riskCheckTime=x-L,console.log(`\\u{1F4CA} TIMING - Risk check completed in ${$.riskCheckTime}ms`)}let y=m[0];if(y){$.firstFillAt=y.timestamp;let L=new Date($.submittedAt),x=new Date($.firstFillAt);$.timeToFill=x-L,console.log(`\\u{1F4CA} TIMING - First fill in ${$.timeToFill}ms`)}$.completedAt=d[d.length-1].timestamp;let A=new Date($.submittedAt),O=new Date($.completedAt)-A;$.totalDuration=O,console.log(`\\u{1F4CA} TIMING - Order completed in ${O}ms total`),console.log(`\\u{1F4CA} TIMING - Submitted: ${$.submittedAt}`),console.log(`\\u{1F4CA} TIMING - Completed: ${$.completedAt}`)}let k=d.filter(t=>t.fillPrice!==null).map(t=>t.fillPrice),h=k.length>0?k.reduce((t,y)=>t+y,0)/k.length:null,f=null;l===\"LIMIT\"&&i&&h&&(u===\"Buy\"?f=i-h:u===\"Sell\"&&(f=h-i));let I=null,R=null;if(l===\"MARKET\"&&h){let t=c?.querySelector('div[style*=\"font-size: 160%\"]'),A=(t?t.textContent.trim():\"\").replace(/[A-Z]\\d+$/,\"\"),O=D[A]?.tickSize||.25;if(k.length>1){let L=Math.min(...k),x=Math.max(...k),w=x-L,N=Math.round(w/O);I={priceRange:w,priceRangeTicks:N,minFillPrice:L,maxFillPrice:x,fillCount:k.length,tickSize:O,note:\"Slippage calculated from fill price range. Mid-price at submission not available.\"},console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Price range: ${w} (${N} ticks)`),console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Fills ranged from ${L} to ${x}`)}else k.length===1&&(I={fillPrice:k[0],tickSize:O,note:\"Single fill. Slippage cannot be calculated without mid-price at submission.\"},console.log(`\\u{1F4CA} MARKET ORDER - Single fill at ${k[0]}`))}let r=e.textContent,o={success:!1,orders:d||[],rejectionReason:null,error:null,orderId:T,orderType:l,orderAction:u,orderQuantity:p,requestedPrice:i,averageFillPrice:h,priceImprovement:f,fillPrices:k,fillRatio:g,fillEvents:m,slippage:I,stopLossOrderId:s,takeProfitOrderId:a,bracketOrders:n,commission:b,fees:C,totalCost:E>0?E:null,timingMetrics:$,priceComparison:null};i&&h&&(o.priceComparison={requested:i,filled:h,difference:h-i,percentDifference:((h-i)/i*100).toFixed(3),improvement:f,analysis:f>0?\"BETTER_THAN_REQUESTED\":f<0?\"WORSE_THAN_REQUESTED\":\"FILLED_AT_REQUESTED\"},console.log(`\\u{1F4CA} PRICE COMPARISON - Requested: ${i}, Filled: ${h}`),console.log(`\\u{1F4CA} PRICE COMPARISON - Difference: ${o.priceComparison.difference} (${o.priceComparison.percentDifference}%)`),console.log(`\\u{1F4CA} PRICE COMPARISON - Analysis: ${o.priceComparison.analysis}`)),r.includes(\"Rejected\")?(console.log(\"\\u274C ORDER REJECTED - checking rejection reason...\"),r.includes(\"outside of market hours\")?(console.log(\"\\u274C REJECTION REASON: Order placed outside market hours\"),o.rejectionReason=\"Order placed outside market hours\"):r.includes(\"Risk\")?(console.log(\"\\u274C REJECTION REASON: Risk management violation\"),o.rejectionReason=\"Risk management violation\"):(console.log(\"\\u274C REJECTION REASON: Other - check full feedback above\"),o.rejectionReason=\"Order rejected\")):r.includes(\"Risk Passed\")?(console.log(\"\\u2705 RISK MANAGEMENT: Order passed risk checks\"),o.success=!0):d.length>0&&(o.success=!0);let v=(()=>{let t=`\n\\u{1F4CA} \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550 ORDER VERIFICATION REPORT \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`;return t+=`\n\\u{1F538} ORDER DETAILS:\n`,t+=`   Order ID: ${o.orderId||\"N/A\"}\n`,t+=`   Type: ${o.orderType}\n`,t+=`   Action: ${o.orderAction} ${o.orderQuantity||\"N/A\"} units\n`,t+=`   Status: ${o.success?\"\\u2705 SUCCESS\":\"\\u274C FAILED\"}\n`,o.orderType===\"LIMIT\"&&o.priceComparison&&(t+=`\n\\u{1F538} PRICE VERIFICATION:\n`,t+=`   Requested: ${o.requestedPrice}\n`,t+=`   Filled: ${o.averageFillPrice}\n`,t+=`   Difference: ${o.priceComparison.difference} (${o.priceComparison.percentDifference}%)\n`,t+=`   Result: ${o.priceComparison.analysis}\n`),o.orderType===\"MARKET\"&&o.slippage&&(t+=`\n\\u{1F538} MARKET ORDER SLIPPAGE:\n`,o.slippage.priceRange!==void 0&&(t+=`   Fill Range: ${o.slippage.priceRange} (${o.slippage.priceRangeTicks} ticks)\n`,t+=`   Min Fill: ${o.slippage.minFillPrice}\n`,t+=`   Max Fill: ${o.slippage.maxFillPrice}\n`)),o.fillRatio&&(t+=`\n\\u{1F538} FILL INFORMATION:\n`,t+=`   Fill Ratio: ${o.fillRatio.filled}/${o.fillRatio.total} (${o.fillRatio.percentFilled}%)\n`,t+=`   Status: ${o.fillRatio.isPartial?\"\\u26A0\\uFE0F PARTIAL FILL\":\"\\u2705 COMPLETE FILL\"}\n`,o.fillEvents.length>0&&(t+=`   Individual Fills:\n`,o.fillEvents.forEach((y,A)=>{t+=`     ${A+1}. ${y.quantity||\"N/A\"} @ ${y.price} (${y.timestamp})\n`}))),o.bracketOrders.length>0&&(t+=`\n\\u{1F538} BRACKET ORDERS:\n`,o.stopLossOrderId&&(t+=`   Stop Loss: #${o.stopLossOrderId}\n`),o.takeProfitOrderId&&(t+=`   Take Profit: #${o.takeProfitOrderId}\n`)),o.timingMetrics.timeToFill&&(t+=`\n\\u{1F538} EXECUTION TIMING:\n`,t+=`   Time to Fill: ${o.timingMetrics.timeToFill}ms\n`,o.timingMetrics.riskCheckTime&&(t+=`   Risk Check: ${o.timingMetrics.riskCheckTime}ms\n`),t+=`   Total Duration: ${o.timingMetrics.totalDuration||\"N/A\"}ms\n`),(o.commission||o.totalCost)&&(t+=`\n\\u{1F538} COSTS:\n`,o.commission&&(t+=`   Commission: ${o.commission}\n`),o.fees.length>0&&(t+=`   Fees: ${o.fees.length} fee(s) totaling ${o.fees.reduce((y,A)=>y+A.amount,0)}\n`),o.totalCost&&(t+=`   Total Cost: ${o.totalCost}\n`)),o.rejectionReason&&(t+=`\n\\u{1F538} REJECTION DETAILS:\n`,t+=`   Reason: ${o.rejectionReason}\n`),t+=`\n\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`,t})();return console.log(v),o.verificationReport=v,K.lastResult=o,window.lastOrderFeedback=o,console.log(\"\\u{1F504} ORDER FEEDBACK CAPTURE COMPLETE\"),console.log(\"\\u{1F4A1} TIP: Access last feedback with: window.lastOrderFeedback\"),o}var D={MNQ:{tickSize:.25,tickValue:.5,defaultSL:15,defaultTP:200,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:15,defaultTP:200,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function q(e,c=1,l=\"Buy\",i=null,p=null,u=.25,T=null){console.log(`\\u{1F680} [AUTOTRADE START] autoTrade called with: symbol=${e}, qty=${c}, action=${l}, TP=${i}, SL=${p}, tickSize=${u}, orderType=${T}`),console.log(`\\u{1F680} [AUTOTRADE START] Function entry successful at ${new Date().toISOString()}`);try{console.log(`\\u{1F50D} [DEBUG] TP ticks input parameter = ${i} (type: ${typeof i})`);let g=F.symbol||\"NQ\";console.log(`\\u{1F50D} [SYMBOL] Using symbol: ${g}`),console.log(`\\u{1F50D} [SYMBOL] currentState.symbol = ${F.symbol}`);let d=g.replace(/[A-Z]\\d+$/,\"\");console.log(`\\u{1F50D} [SYMBOL] Root symbol: ${d}`),console.log(`\\u{1F50D} [DATA] Looking up symbolData for ${d}...`);let m=D[d];if(console.log(\"\\u{1F50D} [DATA] symbolData found:\",m),d!==q.lastRootSymbol){F.tickSize=m?.tickSize??\"\";let x=document.getElementById(\"tickInput\");x&&(x.value=F.tickSize)}q.lastRootSymbol=d;let s=m&&typeof m.tickSize==\"number\"?m.tickSize:parseFloat(F.tickSize)||u;F.tickSize=s;let a=document.getElementById(\"tickInput\");a&&(a.value=s);let n=p||m?.defaultSL||parseInt(F.sl)||40,b=i||m?.defaultTP||parseInt(F.tp)||100,C=n>0,E=b>0;console.log(`\\u{1F50D} DEBUG: actualTakeProfitTicks = ${b} (from takeProfitTicks: ${i}, defaultTP: ${m?.defaultTP}, tpInput: ${F.tp})`);let $=m?.tickSize?\"dictionary\":F.tickSize?\"input field\":\"default parameter\";console.log(`Using tick size ${s} (from ${$})`),console.log(`Using SL: ${n} ticks, TP: ${b} ticks`),console.log(`\\u{1F50D} [DEBUG] tickSize = ${s} (symbolData.tickSize: ${m?.tickSize}, tickInput: ${F.tickSize}, _tickSize param: ${u})`),console.log(`\\u{1F4E1} [MARKET DATA] Getting market data for ${g}...`),console.log(`\\u{1F4E1} [MARKET DATA] About to call getMarketData(${g})`);let k=Y(g);if(console.log(\"\\u{1F4E1} [MARKET DATA] getMarketData returned:\",k),!k){console.error(`\\u274C [MARKET DATA] No market data for ${g} - EARLY RETURN!`);return}console.log(\"\\u{1F4E1} [MARKET DATA] Market data received:\",k),console.log(\"\\u{1F4B0} [ORDER PREP] Starting order preparation...\");let h=document.getElementById(\"entryPriceInput\"),f=h&&h.value?parseFloat(h.value):null;console.log(`\\u{1F4B0} [ORDER PREP] Custom entry price: ${f}`);let I=parseFloat(l===\"Buy\"?k.offerPrice:k.bidPrice);console.log(`\\u{1F4B0} [ORDER PREP] Market price: ${I} (${l===\"Buy\"?\"offer\":\"bid\"} price)`);let R=\"MARKET\",r=I;if(console.log(`\\u{1F4B0} [ORDER PREP] Initial order type: ${R}, entry price: ${r}`),T){let x=[\"MARKET\",\"LIMIT\",\"STOP\",\"STOP LIMIT\",\"TRL STOP\",\"TRL STP LMT\"];if(!x.includes(T)){console.error(`Invalid order type: ${T}. Valid types: ${x.join(\", \")}`);return}R=T,console.log(`Using explicit order type: ${R}`),R!==\"MARKET\"&&f!==null?(r=f,console.log(`Using custom entry price: ${r} for ${R} order`)):R!==\"MARKET\"?(r=I,console.log(`Using market price: ${r} for ${R} order`)):R===\"MARKET\"&&(r=I,console.log(`Using market price: ${r} for MARKET order`))}else f!==null?(console.log(`Custom entry price provided: ${f}`),r=f,l===\"Buy\"?R=f<I?\"LIMIT\":\"STOP\":R=f>I?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${R}`)):console.log(`No custom entry price provided, using market order at ${I}`);let o=m?.precision??2;console.log(`Using price precision: ${o} decimal places`);let S=document.getElementById(\"slPriceInput\"),v=document.getElementById(\"tpPriceInput\"),t=S&&S.value?parseFloat(S.value):null,y=v&&v.value?parseFloat(v.value):null,A;t!==null?(A=t.toFixed(o),console.log(`Using hardcoded SL price: ${A}`)):(A=(l===\"Buy\"?r-n*s:r+n*s).toFixed(o),console.log(`Calculated SL price: ${A} (${l===\"Buy\"?\"entry - \":\"entry + \"}${n} ticks)`));let P;if(y!==null)P=y.toFixed(o),console.log(`Using hardcoded TP price: ${P}`);else{let x=b*s;console.log(`\\u{1F50D} DEBUG: TP calculation - entryPrice: ${r}, actualTakeProfitTicks: ${b}, tickSize: ${s}, offset: ${x}`),P=(l===\"Buy\"?r+b*s:r-b*s).toFixed(o),console.log(`Calculated TP price: ${P} (${l===\"Buy\"?\"entry + \":\"entry - \"}${b} ticks)`)}let O={symbol:k.symbol,action:l,qty:c.toString(),takeProfit:P,stopLoss:A,orderType:R,entryPrice:R!==\"MARKET\"?r.toFixed(o):null,enableTP:E,enableSL:C};console.log(\"Trade data prepared:\",O);let L=(l===\"Buy\"?r+b*s:r-b*s).toFixed(o);return console.log(`\\u{1F50D} DEBUG: tradeData.takeProfit = ${O.takeProfit} (should be TP price for ${b} ticks)`),console.log(`\\u2705 TP VALIDATION: Expected=${L}, Actual=${O.takeProfit}, Match=${L===O.takeProfit?\"\\u2705\":\"\\u274C\"}`),L!==O.takeProfit&&console.error(`\\u{1F6A8} TP MISMATCH: Expected ${L} but got ${O.takeProfit} - this indicates a calculation error!`),console.log(\"\\u{1F680} [ORDER EXECUTION] About to submit bracket orders with tradeData:\",O),console.log(\"\\u{1F680} [ORDER EXECUTION] Calling createBracketOrdersManual...\"),H(O).then(x=>(console.log(\"\\u2705 [ORDER EXECUTION] createBracketOrdersManual SUCCESS:\",x),x)).catch(x=>{throw console.error(\"\\u274C [ORDER EXECUTION] createBracketOrdersManual ERROR:\",x),x}).finally(()=>{let x=D[d],w=document.getElementById(\"slInput\"),N=document.getElementById(\"tpInput\")})}catch(g){throw console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Critical error in autoTrade function:\",g),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Stack trace:\",g.stack),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Function parameters:\",{inputSymbol:e,quantity:c,action:l,takeProfitTicks:i,stopLossTicks:p,_tickSize:u,explicitOrderType:T}),g}}function j(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:c,yearDigit:l}=Q();console.log(`Got quarterly code: letter=${c}, yearDigit=${l}`);let i=`${e.toUpperCase()}${c}${l}`;return console.log(`Returning front quarter symbol: \"${i}\"`),i}function Y(e){console.log(`getMarketData called for: \"${e}\"`);let c=/^[A-Z]{1,3}$/.test(e)?j(e):e.toUpperCase();console.log(`Using symbol: \"${c}\" for market data lookup`);let i=(document.querySelector(\".quoteboard.module.data-table\")||document).querySelectorAll(\".public_fixedDataTable_bodyRow\"),p=null;for(let d of i){let m=d.querySelectorAll(\".public_fixedDataTableCell_cellContent\");if(!m.length)continue;if((m[0].textContent||\"\").trim().toUpperCase()===c){p=d;break}}if(!p)return console.error(`Row for symbol \"${c}\" not found in data table`),alert(`Cannot Find ${e}`),null;let u=p.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),T=u[4]?.textContent.trim(),g=u[5]?.textContent.trim();return console.log(`Extracted prices for ${c}: bid=${T}, offer=${g}`),{symbol:c,bidPrice:T,offerPrice:g}}var fe=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function me(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let c=fe[e.getUTCMonth()],l=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${c}, yearDigit=${l}`),{letter:c,yearDigit:l}}function Q(e=new Date){console.log(`getQuarterlyCode called with date: ${e.toISOString()}`);let c=[2,5,8,11],l={2:\"H\",5:\"M\",8:\"U\",11:\"Z\"};function i(m,s){let C=1+(5-new Date(Date.UTC(m,s,1)).getUTCDay()+7)%7+14;return new Date(Date.UTC(m,s,C,0,0,0))}let p=e.getUTCFullYear(),u=e.getUTCMonth();console.log(`Current month index: ${u}`),console.log(`Starting calculation with year=${p}, month=${u}`);let T=0;for(;!c.includes(u)&&(u++,u>11&&(u=0,p++),!(++T>12)););let g=i(p,u);e.getTime()>=g.getTime()&&(u+=3,u>11&&(u-=12,p++));let d={letter:l[u],yearDigit:p%10+\"\"};return console.log(`Calculated quarterly code: letter=${d.letter}, yearDigit=${d.yearDigit}`),d}console.log(\"Creating example front-quarter symbol\");var{letter:ge,yearDigit:ye}=Q(),be=`NQ${ge}${ye}`;console.log(`Example front-quarter symbol created: ${be}`);var z={initialized:!1,options:{}},B=null;function Z(e={}){z.initialized=!0,z.options={...e},e.panel&&J(e.panel)}function J(e){B=e}function Ee(){return B?.mount?B.mount({visible:!1}):B?.createUI?B.createUI(!1):(console.warn(\"[TradoAuto] No UI adapter registered; skipping invisible UI creation\"),null)}var Te={state:F,futuresTickData:D,delay:M,normalizeSymbol:pe,updateSymbol:ue,updatePrice:de,clickExitForSymbol:se,moveStopLossToBreakeven:ae,getCurrentPosition:V,captureOrderFeedback:K,getOrderEvents:X,createBracketOrdersManual:H,autoTrade:q,getFrontQuarter:j,getMarketData:Y,getMonthlyCode:me,getQuarterlyCode:Q,init:Z,registerUIPanel:J,createInvisibleUI:Ee,getInitStatus:()=>({...z})};function Se(e={}){return Z(e),Te}var W=Se();typeof window<\"u\"&&(window.TradoAuto=W);var G=W;function ee(e,{visible:c=!1}={}){if(console.log(`Creating UI (visible=${c})`),!e)return console.warn(\"[TradoUIPanel] renderPanel called without driver instance\"),null;let l=e.state,i=e.futuresTickData,p=e.normalizeSymbol,u=\"NQ\",T=u.replace(/[A-Z]\\d+$/,\"\"),g=i[T]||i.NQ;l.symbol=u,l.tp=g.defaultTP,l.sl=g.defaultSL,l.tickSize=g.tickSize;let d=g.defaultTP.toString(),m=g.defaultSL.toString(),s=\"10\",a=g.tickSize.toString();console.log(`Using defaults: TP=${d}, SL=${m}, Qty=${s}, Tick=${a}, Symbol=${u}`),console.log(`Symbol data for ${T}: defaultTP=${g.defaultTP}, defaultSL=${g.defaultSL}`);let n=document.createElement(\"div\");n.id=c?\"bracket-trade-box\":\"invisible-trade-inputs\",c?(Object.assign(n.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"}),n.style.top=\"20px\",n.style.right=\"20px\"):Object.assign(n.style,{position:\"fixed\",top:\"-9999px\",left:\"-9999px\",visibility:\"hidden\",opacity:\"0\",pointerEvents:\"none\"}),c?n.innerHTML=`\n        <!-- Header with Symbol -->\n        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n            <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n            <input type=\"text\" id=\"symbolInput\" value=\"${u}\"\n                style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                placeholder=\"Symbol\" />\n        </div>\n        \n        <!-- Hidden Tick Size Input -->\n        <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n            <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n            <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${a}\"\n                style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n        </div>\n\n        <!-- Main Controls -->\n        <div id=\"mainControls\">\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"tpInput\" value=\"${d}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Ticks\" />\n                    <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n                <input type=\"checkbox\" id=\"slCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"slInput\" value=\"${m}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"SL Ticks\" />\n                    <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                        placeholder=\"SL Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n                <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n                <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                    <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"0.01\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                    <input type=\"number\" id=\"qtyInput\" value=\"${s}\" min=\"1\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                </div>\n                <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n                <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n                <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n            </div>\n            <!-- NEW: Breakeven button above Reverse -->\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n            </div>\n        </div>`:n.innerHTML=`\n            <input type=\"text\" id=\"symbolInput\" value=\"${u}\" />\n            <input type=\"number\" id=\"tickInput\" value=\"${a}\" />\n            <input type=\"number\" id=\"tpInput\" value=\"${d}\" />\n            <input type=\"number\" id=\"slInput\" value=\"${m}\" />\n            <input type=\"number\" id=\"qtyInput\" value=\"${s}\" />\n            <input type=\"number\" id=\"entryPriceInput\" />\n            <input type=\"number\" id=\"tpPriceInput\" />\n            <input type=\"number\" id=\"slPriceInput\" />\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n        `;let b=c?\"bracket-trade-box\":\"invisible-trade-inputs\";if(document.getElementById(b))return console.log(`${b} already exists, skipping creation`),document.getElementById(b);document.body.appendChild(n),console.log(\"UI container added to DOM\"),console.log(\"Setting up universal event handlers\");let C=document.getElementById(\"slInput\"),E=document.getElementById(\"tpInput\"),$=document.getElementById(\"qtyInput\");C&&C.addEventListener(\"input\",()=>{console.log(`SL input changed to: ${C.value}`);let f=parseFloat(C.value);isNaN(f)||(l.sl=f,E&&(E.value=Math.round(f*3.5)),l.tp=Math.round(f*3.5),console.log(`Calculated TP: ${l.tp} (SL \\xD7 3.5)`))}),E&&E.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${E.value}`);let f=parseFloat(E.value);isNaN(f)||(l.tp=f)}),__UI_PANEL_BUNDLE__&$.addEventListener(\"input\",f=>{console.log(`Quantity input changed to: ${f.target.value}`);let I=parseInt(f.target.value);!isNaN(I)&&I>0&&(l.qty=I)});let k=document.getElementById(\"symbolInput\");k&&(k.addEventListener(\"input\",f=>{console.log(`Symbol input changed to: ${f.target.value}`),l.symbol=f.target.value}),k.addEventListener(\"change\",f=>{let I=f.target.value,R=p(I);console.log(`Symbol changed to: ${I}, normalized: ${R}`);let r=I.replace(/[A-Z]\\d+$/,\"\"),o=i[r];if(o){console.log(`Found default values for ${r}: SL=${o.defaultSL}, TP=${o.defaultTP}`);let S=document.getElementById(\"slInput\"),v=document.getElementById(\"tpInput\"),t=document.getElementById(\"tickInput\");S.value=o.defaultSL,v.value=o.defaultTP,l.sl=o.defaultSL,l.tp=o.defaultTP,typeof o.tickSize==\"number\"&&(t.value=o.tickSize,l.tickSize=o.tickSize,console.log(`Updated tick size to ${o.tickSize} for ${r}`)),console.log(`\\u2705 Updated SL/TP to default values for ${r}: SL=${S.value}, TP=${v.value}`)}e.updateSymbol(\".trading-ticket .search-box--input\",R)}));let h=document.getElementById(\"tickInput\");if(h&&h.addEventListener(\"input\",f=>{console.log(`Tick size input changed to: ${f.target.value}`);let I=parseFloat(f.target.value);!isNaN(I)&&I>0&&(l.tickSize=I)}),c){console.log(\"Setting up UI event handlers\"),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let r=document.getElementById(\"symbolInput\").value||\"NQ\",o=p(r);console.log(`Calling clickExitForSymbol for: ${o} with Exit at Mkt & Cxl option`),e.clickExitForSymbol(o,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",o)}catch(r){console.error(\"Close All operation failed:\",r);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(o){console.error(\"Fallback close method also failed:\",o)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let r=document.getElementById(\"symbolInput\").value||\"NQ\",o=p(r);console.log(`Calling clickExitForSymbol for: ${o} with Cancel All option`),e.clickExitForSymbol(o,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",o)}catch(r){console.error(\"Cancel All operation failed:\",r)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let r=document.getElementById(\"symbolInput\").value||\"NQ\",o=p(r);console.log(`Calling clickExitForSymbol for: ${o} with Reverse & Cxl option`),e.clickExitForSymbol(o,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",o)}catch(r){console.error(\"Reverse Position operation failed:\",r)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",()=>{console.log(\"Breakeven button clicked\");try{let r=document.getElementById(\"symbolInput\").value||\"NQ\",o=p(r);console.log(`Processing breakeven for symbol: ${o}`),e.moveStopLossToBreakeven(o),console.log(\"Breakeven action triggered for symbol:\",o)}catch(r){console.error(\"Breakeven operation failed:\",r)}}),console.log(\"Setting up default values\"),document.getElementById(\"symbolInput\").value=\"NQ\",document.getElementById(\"tickInput\").value=l.tickSize,console.log(\"Setting up drag functionality\");let f=!1,I,R;n.addEventListener(\"mousedown\",r=>{console.log(\"Container mousedown event detected\"),f=!0,I=r.clientX-n.getBoundingClientRect().left,R=r.clientY-n.getBoundingClientRect().top,console.log(`Drag started at offset X:${I}, Y:${R}`),n.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",r=>{if(f){let o=`${r.clientX-I}px`,S=`${r.clientY-R}px`;r.clientX%20===0&&console.log(`Dragging panel to X:${o}, Y:${S}`),n.style.left=o,n.style.top=S,n.style.right=\"unset\"}}),document.addEventListener(\"mouseup\",()=>{f&&console.log(`Container drop position: Left:${n.style.left}, Top:${n.style.top}`),f=!1,n.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let r=document.getElementById(\"symbolInput\").value||\"NQ\",o=+$.value,S=+E.value,v=+C.value,t=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${r}, Qty=${o}, TP=${S}, SL=${v}, TickSize=${t}`),e.autoTrade(r,o,\"Buy\",S,v,t).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let r=document.getElementById(\"symbolInput\").value||\"NQ\",o=+$.value,S=+E.value,v=+C.value,t=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${r}, Qty=${o}, TP=${S}, SL=${v}, TickSize=${t}`),e.autoTrade(r,o,\"Sell\",S,v,t).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}return console.log(\"State management: Using in-memory state only, no persistence\"),n}function te({driverInstance:e=G}={},c={}){let l=!1,i=!1,p=null;function u(s={}){let{visible:a=!0}={...c,...s},n=ee(e,{visible:a});return n&&(l=!0,i=a,p=n),n}function T(){return u({visible:!1})}function g(){return u({visible:!0})}function d(){let s=!1,a=document.getElementById(\"bracket-trade-box\"),n=document.getElementById(\"invisible-trade-inputs\");return a&&(a.remove(),s=!0),n&&(n.remove(),s=!0),s&&(l=!1,i=!1,p=null),s}function m(){return{mounted:l,visible:i,hasPanel:!!document.getElementById(\"bracket-trade-box\"),hasInvisiblePanel:!!document.getElementById(\"invisible-trade-inputs\"),lastContainer:p}}return{mount:u,createUI:u,createInvisibleUI:T,show:g,hide:d,getStatus:m,render:s=>ee(e,s)}}var _=te();G.registerUIPanel(_);typeof window<\"u\"&&(window.TradoUIPanel=_);var ke=_;return ce($e);})();\n//# sourceMappingURL=tradovate_ui_panel.js.map\n";

    function inject(code, id) {
        if (!code) {
            console.warn(`[AutoOrder] No code supplied for ${id}, skipping injection.`);
            return;
        }

        const scriptId = `trado-${id}`;
        if (document.getElementById(scriptId)) {
            console.debug(`[AutoOrder] Script ${scriptId} already present, skipping duplicate injection.`);
            return;
        }

        const script = document.createElement('script');
        script.id = scriptId;
        script.type = 'text/javascript';
        script.textContent = code;
        document.head.appendChild(script);
        console.debug(`[AutoOrder] Injected ${id} bundle.`);
    }

    function waitForGlobal(name, timeout = 8000) {
        return new Promise((resolve, reject) => {
            const start = Date.now();
            (function check() {
                if (window[name]) {
                    resolve(window[name]);
                    return;
                }
                if (Date.now() - start > timeout) {
                    reject(new Error(`${name} not available within ${timeout}ms`));
                    return;
                }
                requestAnimationFrame(check);
            })();
        });
    }

    inject(driverSource, 'auto-driver');
    inject(panelSource, 'ui-panel');

    Promise.all([
        waitForGlobal('TradoAuto'),
        waitForGlobal('TradoUIPanel')
    ]).then(([autoDriver, uiPanel]) => {
        try {
            autoDriver.init?.({ source: 'tampermonkey' });
        } catch (err) {
            console.error('[AutoOrder] Failed to init driver', err);
        }

        try {
            uiPanel.mount?.({ visible: true });
        } catch (err) {
            console.error('[AutoOrder] Failed to mount UI panel', err);
        }

        console.info('[AutoOrder] Driver and panel ready.');
    }).catch(err => {
        console.error('[AutoOrder] Initialization failed', err);
    });
})();
