// ==UserScript==
// @name         Auto Order (Modular)
// @namespace    http://tampermonkey.net/
// @version      6.0
// @description  Thin wrapper that loads the modular Tradovate automation driver and UI panel.
// @author       You
// @match        https://trader.tradovate.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tradovate.com
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    const driverSource = "var TradovateAutoDriverBundle=(()=>{var ae=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var qe=Object.prototype.hasOwnProperty;var Me=(q,C)=>{for(var s in C)ae(q,s,{get:C[s],enumerable:!0})},Fe=(q,C,s,F)=>{if(C&&typeof C==\"object\"||typeof C==\"function\")for(let p of Ae(C))!qe.call(q,p)&&p!==s&&ae(q,p,{get:()=>C[p],enumerable:!(F=Le(C,p))||F.enumerable});return q};var Ne=q=>Fe(ae({},\"__esModule\",{value:!0}),q);var Re={};Me(Re,{createAutoDriver:()=>De,default:()=>Oe});function ze(q={}){let s={...{symbol:\"NQ\",quantity:1,tpTicks:120,slTicks:40,tpEnabled:!0,slEnabled:!0,tickSize:.25,entryPrice:null,lastSource:\"init\",lastUpdated:Date.now()},...q},F=new Set;function p(){for(let R of F)try{R({...s})}catch(Z){console.warn(\"[DriverStore] listener error\",Z)}}function oe(){return{...s}}function ne(R={},Z=\"unknown\"){let B={...s,...R,lastSource:Z,lastUpdated:Date.now()};return Object.keys(B).some(Q=>B[Q]!==s[Q])&&(s=B,p()),s}function le(R){return F.add(R),R({...s}),()=>F.delete(R)}return{getState:oe,applyUpdate:ne,subscribe:le}}typeof window<\"u\"&&(window.TradoAutoState||(window.TradoAutoState=ze()));(function(){let q=window.TradoAutoState&&typeof window.TradoAutoState.getState==\"function\"?window.TradoAutoState:R();window.TradoAutoState=q;let{getState:C,applyUpdate:s,subscribe:F}=q;function p(e,n=null){let l=typeof e==\"string\"?parseFloat(e):e;return Number.isFinite(l)?l:n}function oe(){let e=l=>{let r=document.getElementById(l);return r?r.value:void 0},n=l=>{let r=document.getElementById(l);return r?!!r.checked:void 0};return{symbol:e(\"symbolInput\"),quantity:p(e(\"qtyInput\")),tpTicks:p(e(\"tpInput\")),slTicks:p(e(\"slInput\")),tickSize:p(e(\"tickInput\")),entryPrice:p(e(\"entryPriceInput\")),tpPrice:p(e(\"tpPriceInput\")),slPrice:p(e(\"slPriceInput\")),tpEnabled:n(\"tpCheckbox\"),slEnabled:n(\"slCheckbox\")}}function ne(e={},n=\"autoTrade-call\"){let l=typeof C==\"function\"?C():{},t={...{...oe(),...l}};return e.symbol&&(t.symbol=e.symbol),typeof e.quantity==\"number\"&&(t.quantity=e.quantity),typeof e.tpTicks==\"number\"&&(t.tpTicks=e.tpTicks),typeof e.slTicks==\"number\"&&(t.slTicks=e.slTicks),typeof e.tickSize==\"number\"&&(t.tickSize=e.tickSize),e.entryPrice!=null&&(t.entryPrice=e.entryPrice),e.tpEnabled!=null&&(t.tpEnabled=e.tpEnabled),e.slEnabled!=null&&(t.slEnabled=e.slEnabled),e.tpPrice!=null&&(t.tpPrice=e.tpPrice),e.slPrice!=null&&(t.slPrice=e.slPrice),t.symbol=(t.symbol||\"NQ\").toUpperCase(),t.quantity=p(t.quantity,1),t.tpTicks=p(t.tpTicks,120),t.slTicks=p(t.slTicks,40),t.tickSize=p(t.tickSize,.25),t.entryPrice=t.entryPrice!=null?p(t.entryPrice):null,t.tpPrice=t.tpPrice!=null?p(t.tpPrice):null,t.slPrice=t.slPrice!=null?p(t.slPrice):null,t.tpEnabled=typeof t.tpEnabled==\"boolean\"?t.tpEnabled:!0,t.slEnabled=typeof t.slEnabled==\"boolean\"?t.slEnabled:!0,t.lastSource=n,typeof s==\"function\"&&s(t,n),t}function le(e){if(!e)return;let n=(r,a)=>{let t=document.getElementById(r);if(!t)return;let d=a??\"\";t.value!==String(d)&&(t.value=d)},l=(r,a)=>{let t=document.getElementById(r);!t||typeof a!=\"boolean\"||t.checked!==a&&(t.checked=a)};n(\"symbolInput\",e.symbol),n(\"qtyInput\",e.quantity),n(\"tpInput\",e.tpTicks),n(\"slInput\",e.slTicks),n(\"tickInput\",e.tickSize),n(\"entryPriceInput\",e.entryPrice),n(\"tpPriceInput\",e.tpPrice),n(\"slPriceInput\",e.slPrice),l(\"tpCheckbox\",e.tpEnabled),l(\"slCheckbox\",e.slEnabled)}typeof F==\"function\"&&F(le);let{createDriverStore:R}=window.TradoAutoState||{};console.log(\"Auto Order script initialized\");var Z=!1;function B(e){return console.log(`Delaying for ${e}ms`),new Promise(n=>setTimeout(n,e))}function J(){console.log(\"Creating UI\");let e=localStorage.getItem(\"bracketTrade_tp\")||\"120\",n=localStorage.getItem(\"bracketTrade_sl\")||\"40\",l=localStorage.getItem(\"bracketTrade_qty\")||\"9\",r=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",a=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\";console.log(`Stored values: TP=${e}, SL=${n}, Qty=${l}, Tick=${r}, Symbol=${a}`);let t=document.createElement(\"div\");t.id=\"bracket-trade-box\",Object.assign(t.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"});let d=0,f=0;d&&f?(t.style.left=d,t.style.top=f):(t.style.top=\"20px\",t.style.right=\"20px\"),t.innerHTML=`\n    <!-- Header with Symbol -->\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n        <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n        <input type=\"text\" id=\"symbolInput\" value=\"${a}\"\n            style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n            placeholder=\"Symbol\" />\n    </div>\n\n    <!-- Hidden Tick Size Input -->\n    <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n        <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n        <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${r}\"\n            style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n    </div>\n\n    <!-- Main Controls -->\n    <div id=\"mainControls\">\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"tpInput\" value=\"${e}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Ticks\" />\n                <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"slInput\" value=\"${n}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Ticks\" />\n                <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n            <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n            <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                <input type=\"number\" id=\"qtyInput\" value=\"${l}\" min=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n            </div>\n            <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n        </div>\n        <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n            <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n            <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n        </div>\n\n        <!-- NEW: Breakeven button above Reverse -->\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n        </div>\n\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n        </div>\n    </div>`,document.body.appendChild(t),console.log(\"UI container added to DOM\");let c=document.createElement(\"div\");c.id=\"bracket-trade-tray\",Object.assign(c.style,{position:\"fixed\",top:t.style.top||\"20px\",left:\"0px\",background:\"#24262b\",border:\"1px solid #444\",padding:\"10px\",borderRadius:\"8px\",boxShadow:\"0 2px 10px rgba(0,0,0,0.4)\",color:\"#fff\",width:\"140px\",zIndex:\"99999\",display:\"none\"}),c.innerHTML=`\n      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\n        <div style=\"font-weight:600;\">Price Tray</div>\n        <button id=\"trayCloseBtn\" title=\"Hide\"\n          style=\"background:#333;border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;\">\\xD7</button>\n      </div>\n      <div style=\"display:flex;flex-direction:column;gap:6px\">\n        <button id=\"tray-btn-high\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">High</button>\n        <button id=\"tray-btn-low\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Low</button>\n        <button id=\"tray-btn-open\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Open</button>\n        <button id=\"tray-btn-close\" style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Close</button>\n        <button id=\"tray-btn-mid\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Middle</button>\n      </div>\n    `,document.body.appendChild(c);let g=document.createElement(\"button\");g.id=\"trayToggle\",g.textContent=\"\\u25C2 O/L/H/C/M\",Object.assign(g.style,{position:\"absolute\",right:\"-92px\",top:\"0\",height:\"32px\",background:\"#30343b\",color:\"#fff\",border:\"1px solid #444\",borderRadius:\"0 8px 8px 0\",padding:\"4px 8px\",cursor:\"pointer\"}),t.appendChild(g);function u(){let o=t.getBoundingClientRect();c.style.top=`${o.top}px`,c.style.left=`${o.right+8}px`}u(),window.addEventListener(\"resize\",u),g.addEventListener(\"click\",()=>{u(),c.style.display=c.style.display===\"none\"?\"block\":\"none\"}),c.querySelector(\"#trayCloseBtn\")?.addEventListener(\"click\",()=>{c.style.display=\"none\"});let b=null;function E(){let o=(document.getElementById(\"tickInput\")?.value||\"\").toString(),i=o.indexOf(\".\");return i===-1?0:o.length-i-1}setInterval(()=>{try{if(typeof se==\"function\"){if(b=se(),b){let o={open:[\"tray-btn-open\",\"Open\"],low:[\"tray-btn-low\",\"Low\"],high:[\"tray-btn-high\",\"High\"],close:[\"tray-btn-close\",\"Close\"]};for(let[m,[x,k]]of Object.entries(o)){let P=document.getElementById(x);if(!P)continue;let O=b[m];P.title=O!=null?`${k}: ${O}`:`${k}: \\u2014`}let i=document.getElementById(\"tray-btn-mid\");if(i){let m=b.open,x=b.close;if(typeof m==\"number\"&&typeof x==\"number\"){let k=E(),P=((m+x)/2).toFixed(k);i.title=`Mid (O+C)/2: ${P}`}else i.title=\"Mid (O+C)/2: \\u2014\"}}u()}}catch(o){console.warn(\"extractTradovateDataBox polling error:\",o)}},500);function v(o){let i=document.getElementById(\"entryPriceInput\");if(!i||o==null)return;Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,o),[\"input\",\"change\",\"blur\"].forEach(x=>i.dispatchEvent(new Event(x,{bubbles:!0})))}function S(o){if(!b||b[o]==null){console.warn(`No ${o} available from databox`);return}v(b[o])}function N(){if(!b||typeof b.open!=\"number\"||typeof b.close!=\"number\"){console.warn(\"Mid price unavailable (need open & close)\");return}let o=E(),i=((b.high+b.low)/2).toFixed(o);v(i)}document.getElementById(\"tray-btn-open\")?.addEventListener(\"click\",()=>S(\"open\")),document.getElementById(\"tray-btn-low\")?.addEventListener(\"click\",()=>S(\"low\")),document.getElementById(\"tray-btn-high\")?.addEventListener(\"click\",()=>S(\"high\")),document.getElementById(\"tray-btn-close\")?.addEventListener(\"click\",()=>S(\"close\")),document.getElementById(\"tray-btn-mid\")?.addEventListener(\"click\",N),console.log(\"Setting up UI event handlers\");let I=document.getElementById(\"slInput\"),T=document.getElementById(\"tpInput\"),A=document.getElementById(\"qtyInput\");document.getElementById(\"slInput\").addEventListener(\"input\",()=>{console.log(`SL input changed to: ${I.value}`);let o=parseFloat(I.value);isNaN(o)||(T.value=o*3,console.log(`Calculated TP: ${T.value} (SL \\xD7 3)`)),localStorage.setItem(\"bracketTrade_sl\",I.value),localStorage.setItem(\"bracketTrade_tp\",T.value),typeof s==\"function\"&&s({slTicks:p(I.value),tpTicks:p(T.value)},\"floating-ui\")}),T.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${T.value}`),localStorage.setItem(\"bracketTrade_tp\",T.value),typeof s==\"function\"&&s({tpTicks:p(T.value)},\"floating-ui\")}),document.getElementById(\"qtyInput\").addEventListener(\"input\",o=>{console.log(`Quantity input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_qty\",o.target.value),typeof s==\"function\"&&s({quantity:p(o.target.value,1)},\"floating-ui\")}),document.getElementById(\"tpCheckbox\")?.addEventListener(\"change\",o=>{typeof s==\"function\"&&s({tpEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"slCheckbox\")?.addEventListener(\"change\",o=>{typeof s==\"function\"&&s({slEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"entryPriceInput\")?.addEventListener(\"input\",o=>{typeof s==\"function\"&&s({entryPrice:p(o.target.value)},\"floating-ui\")}),document.getElementById(\"tpPriceInput\")?.addEventListener(\"input\",o=>{typeof s==\"function\"&&s({tpPrice:p(o.target.value)},\"floating-ui\")}),document.getElementById(\"slPriceInput\")?.addEventListener(\"input\",o=>{typeof s==\"function\"&&s({slPrice:p(o.target.value)},\"floating-ui\")}),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Calling clickExitForSymbol for: ${i} with Exit at Mkt & Cxl option`),Q(i,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",i)}catch(o){console.error(\"Close All operation failed:\",o);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(i){console.error(\"Fallback close method also failed:\",i)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Calling clickExitForSymbol for: ${i} with Cancel All option`),Q(i,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",i)}catch(o){console.error(\"Cancel All operation failed:\",o)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Calling clickExitForSymbol for: ${i} with Reverse & Cxl option`),Q(i,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",i)}catch(o){console.error(\"Reverse Position operation failed:\",o)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",async()=>{console.log(\"Breakeven button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Breakeven for symbol: ${i}`);let m=$=>($||\"\").replace(/\\s+/g,\" \").trim().toUpperCase(),x=[...document.querySelectorAll(\".contract-symbol span\")].find($=>{let j=m($.textContent),Be=m(i);return j===Be||j.startsWith(m(o))});if(!x)return console.error(\"Breakeven: contract header not found\");let P=[...(x.closest(\".gm-scroll-view\")||x.closest(\".header\")||document).querySelectorAll(\".info-column\")].find($=>/position/i.test($.querySelector(\"small\")?.textContent||\"\"));if(!P){console.error(\"Breakeven: Position column not found\");return}let O=P.querySelector(\".number\"),V=O?.querySelector(\"span\"),ge=(O?.textContent||\"\").trim().match(/@([\\d.,]+)/);if(!ge){console.error(\"Breakeven: could not parse entry price from Position\");return}let ye=parseFloat(ge[1].replace(/,/g,\"\")),ee=1;if(V){let $=parseFloat(V.textContent.replace(/[^\\d.-]/g,\"\"));!isNaN($)&&$!==0&&(ee=Math.abs($))}let te=\"LONG\",be=V?.classList||O?.classList||{contains:()=>!1};be.contains(\"text-danger\")&&(te=\"SHORT\"),be.contains(\"text-success\")&&(te=\"LONG\");let me=te===\"LONG\"?\"Sell\":\"Buy\";console.log(`Breakeven detected: side=${te}, qty=${ee}, entry=${ye}. Placing ${me} LIMIT at entry.`);let ie=document.getElementById(\"tpCheckbox\"),ce=document.getElementById(\"slCheckbox\"),Ce=ie.checked,Pe=ce.checked;ie.checked=!1,ce.checked=!1;let $e=(()=>{let j=(parseFloat(document.getElementById(\"tickInput\").value)||.25).toString();return j.includes(\".\")?j.length-j.indexOf(\".\")-1:0})();document.getElementById(\"entryPriceInput\").value=ye.toFixed($e),document.getElementById(\"qtyInput\").value=ee.toString(),[\"input\",\"change\",\"blur\"].forEach($=>{document.getElementById(\"entryPriceInput\").dispatchEvent(new Event($,{bubbles:!0})),document.getElementById(\"qtyInput\").dispatchEvent(new Event($,{bubbles:!0}))}),await K(o,ee,me,null,null,parseFloat(document.getElementById(\"tickInput\").value)||.25),ie.checked=Ce,ce.checked=Pe,document.getElementById(\"entryPriceInput\").value=\"\",[\"input\",\"change\",\"blur\"].forEach($=>document.getElementById(\"entryPriceInput\").dispatchEvent(new Event($,{bubbles:!0})))}catch(o){console.error(\"Breakeven action failed:\",o)}}),console.log(\"Setting up persistent settings\"),document.getElementById(\"symbolInput\").value=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\",document.getElementById(\"symbolInput\").addEventListener(\"input\",o=>{let i=o.target.value;console.log(`Symbol input changed to: ${i}`),localStorage.setItem(\"bracketTrade_symbol\",i),typeof s==\"function\"&&s({symbol:i},\"floating-ui\")}),document.getElementById(\"symbolInput\").addEventListener(\"change\",o=>{let i=o.target.value,m=H(i);console.log(`Symbol changed to: ${i}, normalized: ${m}`);let x=i.replace(/[A-Z]\\d+$/,\"\"),k=de[x];if(k){console.log(`Found default values for ${x}: SL=${k.defaultSL}, TP=${k.defaultTP}`);let P=document.getElementById(\"slInput\"),O=document.getElementById(\"tpInput\"),V=document.getElementById(\"tickInput\");P.value=k.defaultSL,O.value=k.defaultTP,typeof k.tickSize==\"number\"&&(V.value=k.tickSize,localStorage.setItem(\"bracketTrade_tick\",k.tickSize),console.log(`Updated tick size to ${k.tickSize} for ${x}`)),localStorage.setItem(\"bracketTrade_sl\",k.defaultSL),localStorage.setItem(\"bracketTrade_tp\",k.defaultTP),console.log(`Updated SL/TP to default values for ${x}: SL=${P.value}, TP=${O.value}`)}ke(\".search-box--input\",m),typeof s==\"function\"&&s({symbol:m,slTicks:k?.defaultSL,tpTicks:k?.defaultTP,tickSize:k?.tickSize},\"floating-ui\")}),document.getElementById(\"tickInput\").value=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",document.getElementById(\"tickInput\").addEventListener(\"input\",o=>{console.log(`Tick size input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_tick\",o.target.value),typeof s==\"function\"&&s({tickSize:p(o.target.value,.25)},\"floating-ui\")}),console.log(\"Setting up drag functionality\");let y=!1,h,L;t.addEventListener(\"mousedown\",o=>{console.log(\"Container mousedown event detected\"),y=!0,h=o.clientX-t.getBoundingClientRect().left,L=o.clientY-t.getBoundingClientRect().top,console.log(`Drag started at offset X:${h}, Y:${L}`),t.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",o=>{if(y){let i=`${o.clientX-h}px`,m=`${o.clientY-L}px`;o.clientX%20===0&&console.log(`Dragging panel to X:${i}, Y:${m}`),t.style.left=i,t.style.top=m,t.style.right=\"unset\",u()}}),document.addEventListener(\"mouseup\",()=>{y&&(console.log(`Container drop position: Left:${t.style.left}, Top:${t.style.top}`),localStorage.setItem(\"bracketTradeBoxLeft\",t.style.left),localStorage.setItem(\"bracketTradeBoxTop\",t.style.top)),y=!1,t.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=+A.value,m=+T.value,x=+I.value,k=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${o}, Qty=${i}, TP=${m}, SL=${x}, TickSize=${k}`),K(o,i,\"Buy\",m,x,k).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=+A.value,m=+T.value,x=+I.value,k=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${o}, Qty=${i}, TP=${m}, SL=${x}, TickSize=${k}`),K(o,i,\"Sell\",m,x,k).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}async function Q(e,n=\"cancel-option-Exit-at-Mkt-Cxl\"){let l={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},r={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},a=y=>(y||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),t=y=>new Promise(h=>setTimeout(h,y));async function d(y,{timeout:h=1200,interval:L=50}={}){let o=performance.now();for(;performance.now()-o<h;){let i=y();if(i)return i;await t(L)}return null}let f=n.toLowerCase(),c=l[f]||n,g=r[c]||null,u=a(e),b=/^[A-Z]{1,3}$/.test(u),E=[...document.querySelectorAll(\".header .contract-symbol span\")].find(y=>{let h=a(y.textContent);return h===u||b&&h.startsWith(u)});if(!E)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let S=E.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),N=S?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),I=S?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!S||!N||!I)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(g?g.test(a(N.textContent)):!1)return N.click(),!0;I.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let A=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(y=>y.offsetParent!==null||/display\\s*:\\s*block/i.test(y.getAttribute(\"style\")||\"\")||!!y.closest(\".open\")),z=await d(A,{timeout:900,interval:40});if(!z||!z.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let M=I.getBoundingClientRect();z.sort((y,h)=>{let L=y.getBoundingClientRect(),o=h.getBoundingClientRect(),i=Math.hypot(L.left-M.left,L.top-M.bottom),m=Math.hypot(o.left-M.left,o.top-M.bottom);return i-m});let D=z[0],w=document.getElementById(c);if(!w&&g){for(let y of z)if(w=[...y.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(h=>g.test(a(h.textContent))),w){D=y;break}}if(!w)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let U=w.tagName?w.matches(\"a,button\")?w:w.querySelector(\"a,button\")||w:w;return[\"mousedown\",\"mouseup\",\"click\"].forEach(y=>U.dispatchEvent(new MouseEvent(y,{bubbles:!0}))),I.click(),await t(120),z=A(),w=document.getElementById(c)||(g?z?.flatMap(y=>[...y.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(y=>g.test(a(y.textContent))):null),w?([\"mousedown\",\"mouseup\",\"click\"].forEach(y=>(w.querySelector(\"a,button\")||w).dispatchEvent(new MouseEvent(y,{bubbles:!0}))),await t(80),N.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function se(e=document){let n=[...e.querySelectorAll(\".databox.react-draggable.react-resizable\")].find(d=>d.offsetParent!==null);if(!n)return null;let a={timestamp:((d,f=n)=>{let c=f.querySelector(d);return c?c.textContent.trim():null})(\".header .title\")||null};return n.querySelectorAll(\".gm-scroll-view .entries li\").forEach(d=>{let f=d.querySelector(\".label\"),c=d.querySelector(\".desc\");if(!f||!c)return;let g=f.cloneNode(!0);g.querySelectorAll(\"span\").forEach(N=>N.remove());let u=(g.textContent||\"\").trim().toLowerCase().replace(/[^a-z0-9]/g,\"\"),b=(c.textContent||\"\").trim(),v={open:\"open\",high:\"high\",low:\"low\",close:\"close\",volume:\"volume\",atr:\"atr\",vwap:\"vwap\",upperband1:\"upperBand1\",lowerband1:\"lowerBand1\",upperband2:\"upperBand2\",lowerband2:\"lowerBand2\"}[u]||u,S=b.replace(/,/g,\"\");v===\"volume\"?S=Number.parseInt(S,10):S=Number.parseFloat(S),a[v]=Number.isNaN(S)?b:S}),a}document.querySelectorAll(\"#bracket-trade-box, #bracket-trade-tray\").forEach(e=>e.remove()),J(),console.log(\"UI creation complete\");async function ke(e,n){console.log(`updateSymbol called with selector: \"${e}\", value: \"${n}\"`);let l=document.querySelectorAll(e);console.log(`Found ${l.length} matching inputs`);let r=l[1]||l[0];if(!r){console.error(\"No matching input elements found!\");return}console.log(\"Selected input:\",r);let a=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,t=d=>r.dispatchEvent(new KeyboardEvent(d,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),a.call(r,\"\"),r.focus(),r.dispatchEvent(new Event(\"input\",{bubbles:!0})),await B(400),console.log(`Setting input value to: \"${n}\"`),a.call(r,n),r.focus(),r.dispatchEvent(new Event(\"input\",{bubbles:!0})),await B(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(t),r.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function Qe(e){let n=\"input.form-control\";for(let l=0;l<20;l++){let r=document.querySelector(n);if(r&&r.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(r,e),[\"input\",\"change\",\"blur\"].forEach(t=>r.dispatchEvent(new Event(t,{bubbles:!0}))),await B(300);return}await B(100)}console.error(\"Price input not found\")}function H(e){console.log(`normalizeSymbol called with: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${n}`);let l=n?Se(e):e.toUpperCase();return console.log(`Normalized symbol: \"${l}\"`),l}async function xe(e){console.log(\"Creating bracket orders with data:\",e);let n=typeof e.tpEnabled==\"boolean\"?e.tpEnabled:document.getElementById(\"tpCheckbox\")?.checked??!0,l=typeof e.slEnabled==\"boolean\"?e.slEnabled:document.getElementById(\"slCheckbox\")?.checked??!0;console.log(`TP enabled: ${n}, SL enabled: ${l}`);async function r(f,c){let g=[...document.querySelectorAll(\".trading-ticket\")].find(v=>v.offsetParent);if(!g)return console.error(\"No visible trading ticket\");let u;for(let v=0;v<25&&(u=[...g.querySelectorAll(f)].find(S=>S.offsetParent&&!S.disabled),!u);v++)await B(100);if(!u)return console.error(`No live input for ${f}`);let b=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,E=u.closest(\".select-input.combobox\");E&&!u.value&&(E.querySelector(\".btn\")?.click(),await B(150),E.querySelector(\".dropdown-menu li\")?.click(),await B(150));for(let v=0;v<3&&(u.focus(),b.call(u,c),u.dispatchEvent(new Event(\"input\",{bubbles:!0})),u.dispatchEvent(new Event(\"change\",{bubbles:!0})),u.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),u.blur(),await B(250),`${u.value}`.trim()!==`${c}`);v++);}async function a(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let f=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${f.length} action labels`),f.forEach(c=>{c.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),c.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await r(\".select-input.combobox input\",e.qty))}function t(f=\"up\"){let c=document.querySelector(\".numeric-input-value-controls\");if(!c)return;c.querySelector(f===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function d(f,c){await a(),document.querySelector(\".group.order-type .select-input div[tabindex]\")?.click(),[...document.querySelectorAll(\"ul.dropdown-menu li\")].find(u=>u.textContent.trim()===f)?.click(),c&&await r(\".numeric-input.feedback-wrapper input\",c),document.querySelector(\".btn-group .btn-primary\")?.click(),await B(200),console.log(ue()),document.querySelector(\".icon.icon-back\")?.click(),await B(200)}return console.log(`Submitting initial ${e.orderType||\"MARKET\"} order`),await d(e.orderType||\"MARKET\",e.entryPrice),e.action===\"Buy\"?(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await d(\"LIMIT\",e.takeProfit)),l&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await d(\"STOP\",e.stopLoss))):(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await d(\"LIMIT\",e.takeProfit)),l&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await d(\"STOP\",e.stopLoss))),console.log(\"Bracket order creation complete\"),Promise.resolve()}function ue(e=document){let n=e.querySelector(\".order-history-content\")||e.querySelector(\".module.orders\");if(!n)return[];let l=n.querySelectorAll(\".public_fixedDataTable_bodyRow\");return Array.from(l,r=>{let a=r.querySelectorAll(\".public_fixedDataTableCell_cellContent\");if(!a.length)return null;let t=a[0]?.textContent.trim()||\"\",d=a[1]?.textContent.trim()||\"\",f=a[2]?.textContent.trim()||\"\",c=a[3]?.textContent.trim()||\"\",g=null,u=f.match(/@([\\d.]+)/);return u&&(g=Number(u[1])),f?{timestamp:t,id:d,event:f,comment:c,fillPrice:g}:null}).filter(Boolean)}let de={MNQ:{tickSize:.25,tickValue:.5,defaultSL:40,defaultTP:100,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:40,defaultTP:100,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function K(e,n=1,l=\"Buy\",r=null,a=null,t=.25){console.log(`autoTrade called with: symbol=${e}, qty=${n}, action=${l}, TP=${r}, SL=${a}, tickSize=${t}`);let d={};e&&(d.symbol=e),typeof n==\"number\"&&!Number.isNaN(n)&&(d.quantity=n),r!=null&&(d.tpTicks=r),a!=null&&(d.slTicks=a),t!=null&&(d.tickSize=t);let f=ne(d,\"autoTrade\"),{symbol:c,quantity:g,tpTicks:u,slTicks:b,tickSize:E,entryPrice:v,tpPrice:S,slPrice:N,tpEnabled:I,slEnabled:T}=f,A=c||\"NQ\";console.log(`Using symbol: ${A}`);let z=A.replace(/[A-Z]\\d+$/,\"\")||A;console.log(`Root symbol: ${z}`);let M=de[z]||{},D=Number.isFinite(E)?E:typeof M.tickSize==\"number\"?M.tickSize:p(t,.25);Number.isFinite(D)||(D=.25);let w=T?p(b,M.defaultSL??40):0,U=I?p(u,M.defaultTP??100):0,y=p(g,1);console.log(`Using tick size ${D}`),console.log(`Effective SL: ${w} ticks, TP: ${U} ticks`),console.log(`Getting market data for ${A}`);let h=ve(A);if(!h){console.error(`No market data for ${A}`);return}console.log(\"Market data:\",h);let L=parseFloat(l===\"Buy\"?h.offerPrice:h.bidPrice);console.log(`Market price: ${L} (${l===\"Buy\"?\"offer\":\"bid\"} price)`);let o=Number.isFinite(v)?v:null,i=L,m=\"MARKET\";o!==null?(console.log(`Custom entry price provided: ${o}`),i=o,l===\"Buy\"?m=o<L?\"LIMIT\":\"STOP\":m=o>L?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${m}`)):console.log(`No custom entry price provided, using market order at ${L}`);let x=Number.isFinite(M.precision)?M.precision:2;console.log(`Using price precision: ${x} decimal places`);let k=T?Number.isFinite(N)?N:l===\"Buy\"?i-w*D:i+w*D:null,P=I?Number.isFinite(S)?S:l===\"Buy\"?i+U*D:i-U*D:null,O=k!=null?k.toFixed(x):null,V=P!=null?P.toFixed(x):null;typeof s==\"function\"&&s({symbol:A,quantity:y,tpTicks:U,slTicks:w,tickSize:D,entryPrice:o,tpPrice:P??null,slPrice:k,tpEnabled:I,slEnabled:T},\"autoTrade-final\");let re={symbol:h.symbol,action:l,qty:String(y),takeProfit:V,stopLoss:O,orderType:m,entryPrice:m!==\"MARKET\"&&i!=null?i.toFixed(x):null,tpEnabled:I,slEnabled:T};return console.log(\"Trade data prepared:\",re),console.log(\"Submitting bracket orders\"),xe(re).finally(()=>{})}function Se(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:n,yearDigit:l}=pe();console.log(`Got quarterly code: letter=${n}, yearDigit=${l}`);let r=`${e.toUpperCase()}${n}${l}`;return console.log(`Returning front quarter symbol: \"${r}\"`),r}function ve(e){console.log(`getMarketData called for: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e)?H(e):e.toUpperCase(),l=Ee(n);if(!l)return console.log(`Cannot Find ${e}`),null;let r=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),a=r[4]?.textContent.trim(),t=r[5]?.textContent.trim();return{symbol:n,bidPrice:a,offerPrice:t}}function Ee(e){let n=/^[A-Z]{1,3}$/.test((e||\"\").trim()),l=n?null:d(e),r=n?d(e):null,a=document.querySelectorAll(\".quoteboard.module.data-table, .data-table, .quoteboard\"),t=a.length?a:[document];for(let f of t){let c=f.querySelectorAll(\".public_fixedDataTable_bodyRow\");for(let g of c){if(g.offsetParent===null)continue;let u=g.querySelector(\".public_fixedDataTableCell_cellContent\");if(!u)continue;let b=d(u.textContent);if(l&&b===l||r&&b.startsWith(r))return g}}return console.error(`findQuoteRow: row for \"${e}\" not found (visible area).`),null;function d(f){return String(f||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase()}}let we=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function _e(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let n=we[e.getUTCMonth()],l=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${n}, yearDigit=${l}`),{letter:n,yearDigit:l}}function W(e=new Date){console.log(`getNQFrontMonth called with date: ${e.toISOString()}`);let n=[3,6,9,12],l=[\"H\",\"M\",\"U\",\"Z\"],r=e.getFullYear(),a=e.getMonth()+1,t=e.getDate();console.log(`Current date: ${r}-${a}-${t}`);for(let c=0;c<n.length;c++){let g=n[c],u=Y(r,g),b=new Date(u);if(b.setDate(u.getDate()-4),console.log(`Checking ${l[c]} contract: expiry=${u.toISOString()}, roll=${b.toISOString()}`),e<b){let E=`NQ${l[c]}${String(r).slice(-2)}`;return console.log(`Current front month: ${E} (before roll date)`),{symbol:E,letter:l[c],yearDigit:String(r).slice(-2),expiry:u,rollDate:b,isRollPeriod:!1}}else if(e<u){let E=(c+1)%4,v=E>c?r:r+1,S=`NQ${l[E]}${String(v).slice(-2)}`;return console.log(`Front month during roll period: ${S}`),{symbol:S,letter:l[E],yearDigit:String(v).slice(-2),expiry:Y(v,n[E]),rollDate:b,isRollPeriod:!0}}}let d=r+1,f=`NQ${l[0]}${String(d).slice(-2)}`;return console.log(`Moving to next year: ${f}`),{symbol:f,letter:l[0],yearDigit:String(d).slice(-2),expiry:Y(d,n[0]),rollDate:null,isRollPeriod:!1}}function Y(e,n){let r=(5-new Date(e,n-1,1).getDay()+7)%7,a=new Date(e,n-1,1+r),t=new Date(a);return t.setDate(a.getDate()+14),t}function pe(e=new Date){console.log(`getQuarterlyCode called (legacy) with date: ${e.toISOString()}`);let n=W(e);return console.log(`Legacy getQuarterlyCode returning: letter=${n.letter}, yearDigit=${n.yearDigit}`),{letter:n.letter,yearDigit:String(n.yearDigit).slice(-1)}}console.log(\"Calculating current NQ front month using CME rules...\");let X=W();console.log(`Current NQ front month: ${X.symbol}`),console.log(`Expiry date: ${X.expiry.toISOString()}`),console.log(`Roll date: ${X.rollDate?X.rollDate.toISOString():\"N/A\"}`),console.log(`Is in roll period: ${X.isRollPeriod}`);let{letter:he,yearDigit:Ie}=pe(),Te=`NQ${he}${Ie}`;console.log(`Legacy front-quarter symbol: ${Te}`),window.getNQFrontMonth=W,window.getThirdFriday=Y;function fe(){console.warn(\"[TradoAuto] moveStopLossToBreakeven is not implemented in this build\")}let G={init:()=>{console.log(\"[TradoAuto] legacy driver init\")},autoTrade:K,clickExitForSymbol:Q,moveStopLossToBreakeven:fe,createUI:J,getNQFrontMonth:W,getThirdFriday:Y,getState:()=>typeof C==\"function\"?C():{},applyConfig:(e={},n=\"external\")=>typeof s==\"function\"?s(e,n):{},subscribeState:e=>typeof F==\"function\"?F(e):()=>{},getOrderEvents:ue},_=typeof unsafeWindow<\"u\"?unsafeWindow:window;console.log(\"[TradoAuto] installing legacy driver onto window/unsafeWindow\"),window.TradoAuto=G,_.TradoAuto=G,_.TradovateAutoDriverBundle={default:G,autoTrade:K,clickExitForSymbol:Q,moveStopLossToBreakeven:fe,createUI:J,getNQFrontMonth:W,getThirdFriday:Y},_.__tradoAutoInterval||(_.__tradoAutoInterval=setInterval(()=>{(!_.TradoAuto||typeof _.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on targetWindow\"),_.TradoAuto=G),(!window.TradoAuto||typeof window.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on window\"),window.TradoAuto=G)},250),console.log(\"[TradoAuto] watchdog interval started\"))})();function De(){return typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto}var Oe=typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto;return Ne(Re);})();\n//# sourceMappingURL=tradovate_auto_driver.js.map\n";
    const panelSource = "var TradovateUIPanelBundle=(()=>{var ke=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var De=Object.prototype.hasOwnProperty;var Oe=(E,$)=>{for(var l in $)ke(E,l,{get:$[l],enumerable:!0})},Qe=(E,$,l,q)=>{if(__UI_PANEL_BUNDLE__&typeof $==\"object\"||typeof $==\"function\")for(let d of Re($))!De.call(E,d)&&d!==l&&ke(E,d,{get:()=>$[d],enumerable:!(q=Me($,d))||q.enumerable});return E};var Ue=E=>Qe(ke({},\"__esModule\",{value:!0}),E);var Ye={};Oe(Ye,{createUIPanel:()=>Be,default:()=>Ve});function _e(E={}){let l={...{symbol:\"NQ\",quantity:1,tpTicks:120,slTicks:40,tpEnabled:!0,slEnabled:!0,tickSize:.25,entryPrice:null,lastSource:\"init\",lastUpdated:Date.now()},...E},q=new Set;function d(){for(let F of q)try{F({...l})}catch(G){console.warn(\"[DriverStore] listener error\",G)}}function D(){return{...l}}function te(F={},G=\"unknown\"){let I={...l,...F,lastSource:G,lastUpdated:Date.now()};return Object.keys(I).some(y=>I[y]!==l[y])&&(l=I,d()),l}function O(F){return q.add(F),F({...l}),()=>q.delete(F)}return{getState:D,applyUpdate:te,subscribe:O}}typeof window<\"u\"&&(window.TradoAutoState||(window.TradoAutoState=_e()));(function(){let E=window.TradoAutoState&&typeof window.TradoAutoState.getState==\"function\"?window.TradoAutoState:F();window.TradoAutoState=E;let{getState:$,applyUpdate:l,subscribe:q}=E;function d(e,n=null){let r=typeof e==\"string\"?parseFloat(e):e;return Number.isFinite(r)?r:n}function D(){let e=r=>{let i=document.getElementById(r);return i?i.value:void 0},n=r=>{let i=document.getElementById(r);return i?!!i.checked:void 0};return{symbol:e(\"symbolInput\"),quantity:d(e(\"qtyInput\")),tpTicks:d(e(\"tpInput\")),slTicks:d(e(\"slInput\")),tickSize:d(e(\"tickInput\")),entryPrice:d(e(\"entryPriceInput\")),tpPrice:d(e(\"tpPriceInput\")),slPrice:d(e(\"slPriceInput\")),tpEnabled:n(\"tpCheckbox\"),slEnabled:n(\"slCheckbox\")}}function te(e={},n=\"autoTrade-call\"){let r=typeof $==\"function\"?$():{},t={...{...D(),...r}};return e.symbol&&(t.symbol=e.symbol),typeof e.quantity==\"number\"&&(t.quantity=e.quantity),typeof e.tpTicks==\"number\"&&(t.tpTicks=e.tpTicks),typeof e.slTicks==\"number\"&&(t.slTicks=e.slTicks),typeof e.tickSize==\"number\"&&(t.tickSize=e.tickSize),e.entryPrice!=null&&(t.entryPrice=e.entryPrice),e.tpEnabled!=null&&(t.tpEnabled=e.tpEnabled),e.slEnabled!=null&&(t.slEnabled=e.slEnabled),e.tpPrice!=null&&(t.tpPrice=e.tpPrice),e.slPrice!=null&&(t.slPrice=e.slPrice),t.symbol=(t.symbol||\"NQ\").toUpperCase(),t.quantity=d(t.quantity,1),t.tpTicks=d(t.tpTicks,120),t.slTicks=d(t.slTicks,40),t.tickSize=d(t.tickSize,.25),t.entryPrice=t.entryPrice!=null?d(t.entryPrice):null,t.tpPrice=t.tpPrice!=null?d(t.tpPrice):null,t.slPrice=t.slPrice!=null?d(t.slPrice):null,t.tpEnabled=typeof t.tpEnabled==\"boolean\"?t.tpEnabled:!0,t.slEnabled=typeof t.slEnabled==\"boolean\"?t.slEnabled:!0,t.lastSource=n,typeof l==\"function\"&&l(t,n),t}function O(e){if(!e)return;let n=(i,s)=>{let t=document.getElementById(i);if(!t)return;let g=s??\"\";t.value!==String(g)&&(t.value=g)},r=(i,s)=>{let t=document.getElementById(i);!t||typeof s!=\"boolean\"||t.checked!==s&&(t.checked=s)};n(\"symbolInput\",e.symbol),n(\"qtyInput\",e.quantity),n(\"tpInput\",e.tpTicks),n(\"slInput\",e.slTicks),n(\"tickInput\",e.tickSize),n(\"entryPriceInput\",e.entryPrice),n(\"tpPriceInput\",e.tpPrice),n(\"slPriceInput\",e.slPrice),r(\"tpCheckbox\",e.tpEnabled),r(\"slCheckbox\",e.slEnabled)}typeof q==\"function\"&&q(O);let{createDriverStore:F}=window.TradoAutoState||{};console.log(\"Auto Order script initialized\");var G=!1;function I(e){return console.log(`Delaying for ${e}ms`),new Promise(n=>setTimeout(n,e))}function Q(){console.log(\"Creating UI\");let e=localStorage.getItem(\"bracketTrade_tp\")||\"120\",n=localStorage.getItem(\"bracketTrade_sl\")||\"40\",r=localStorage.getItem(\"bracketTrade_qty\")||\"9\",i=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",s=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\";console.log(`Stored values: TP=${e}, SL=${n}, Qty=${r}, Tick=${i}, Symbol=${s}`);let t=document.createElement(\"div\");t.id=\"bracket-trade-box\",Object.assign(t.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"});let g=0,b=0;g&&b?(t.style.left=g,t.style.top=b):(t.style.top=\"20px\",t.style.right=\"20px\"),t.innerHTML=`\n    <!-- Header with Symbol -->\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n        <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n        <input type=\"text\" id=\"symbolInput\" value=\"${s}\"\n            style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n            placeholder=\"Symbol\" />\n    </div>\n\n    <!-- Hidden Tick Size Input -->\n    <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n        <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n        <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${i}\"\n            style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n    </div>\n\n    <!-- Main Controls -->\n    <div id=\"mainControls\">\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"tpInput\" value=\"${e}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Ticks\" />\n                <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"slInput\" value=\"${n}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Ticks\" />\n                <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n            <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n            <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                <input type=\"number\" id=\"qtyInput\" value=\"${r}\" min=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n            </div>\n            <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n        </div>\n        <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n            <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n            <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n        </div>\n\n        <!-- NEW: Breakeven button above Reverse -->\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n        </div>\n\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n        </div>\n    </div>`,document.body.appendChild(t),console.log(\"UI container added to DOM\");let a=document.createElement(\"div\");a.id=\"bracket-trade-tray\",Object.assign(a.style,{position:\"fixed\",top:t.style.top||\"20px\",left:\"0px\",background:\"#24262b\",border:\"1px solid #444\",padding:\"10px\",borderRadius:\"8px\",boxShadow:\"0 2px 10px rgba(0,0,0,0.4)\",color:\"#fff\",width:\"140px\",zIndex:\"99999\",display:\"none\"}),a.innerHTML=`\n      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\n        <div style=\"font-weight:600;\">Price Tray</div>\n        <button id=\"trayCloseBtn\" title=\"Hide\"\n          style=\"background:#333;border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;\">\\xD7</button>\n      </div>\n      <div style=\"display:flex;flex-direction:column;gap:6px\">\n        <button id=\"tray-btn-high\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">High</button>\n        <button id=\"tray-btn-low\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Low</button>\n        <button id=\"tray-btn-open\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Open</button>\n        <button id=\"tray-btn-close\" style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Close</button>\n        <button id=\"tray-btn-mid\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Middle</button>\n      </div>\n    `,document.body.appendChild(a);let m=document.createElement(\"button\");m.id=\"trayToggle\",m.textContent=\"\\u25C2 O/L/H/C/M\",Object.assign(m.style,{position:\"absolute\",right:\"-92px\",top:\"0\",height:\"32px\",background:\"#30343b\",color:\"#fff\",border:\"1px solid #444\",borderRadius:\"0 8px 8px 0\",padding:\"4px 8px\",cursor:\"pointer\"}),t.appendChild(m);function u(){let o=t.getBoundingClientRect();a.style.top=`${o.top}px`,a.style.left=`${o.right+8}px`}u(),window.addEventListener(\"resize\",u),m.addEventListener(\"click\",()=>{u(),a.style.display=a.style.display===\"none\"?\"block\":\"none\"}),a.querySelector(\"#trayCloseBtn\")?.addEventListener(\"click\",()=>{a.style.display=\"none\"});let k=null;function C(){let o=(document.getElementById(\"tickInput\")?.value||\"\").toString(),c=o.indexOf(\".\");return c===-1?0:o.length-c-1}setInterval(()=>{try{if(typeof ce==\"function\"){if(k=ce(),k){let o={open:[\"tray-btn-open\",\"Open\"],low:[\"tray-btn-low\",\"Low\"],high:[\"tray-btn-high\",\"High\"],close:[\"tray-btn-close\",\"Close\"]};for(let[v,[w,S]]of Object.entries(o)){let M=document.getElementById(w);if(!M)continue;let Z=k[v];M.title=Z!=null?`${S}: ${Z}`:`${S}: \\u2014`}let c=document.getElementById(\"tray-btn-mid\");if(c){let v=k.open,w=k.close;if(typeof v==\"number\"&&typeof w==\"number\"){let S=C(),M=((v+w)/2).toFixed(S);c.title=`Mid (O+C)/2: ${M}`}else c.title=\"Mid (O+C)/2: \\u2014\"}}u()}}catch(o){console.warn(\"extractTradovateDataBox polling error:\",o)}},500);function P(o){let c=document.getElementById(\"entryPriceInput\");if(!c||o==null)return;Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(c,o),[\"input\",\"change\",\"blur\"].forEach(w=>c.dispatchEvent(new Event(w,{bubbles:!0})))}function T(o){if(!k||k[o]==null){console.warn(`No ${o} available from databox`);return}P(k[o])}function X(){if(!k||typeof k.open!=\"number\"||typeof k.close!=\"number\"){console.warn(\"Mid price unavailable (need open & close)\");return}let o=C(),c=((k.high+k.low)/2).toFixed(o);P(c)}document.getElementById(\"tray-btn-open\")?.addEventListener(\"click\",()=>T(\"open\")),document.getElementById(\"tray-btn-low\")?.addEventListener(\"click\",()=>T(\"low\")),document.getElementById(\"tray-btn-high\")?.addEventListener(\"click\",()=>T(\"high\")),document.getElementById(\"tray-btn-close\")?.addEventListener(\"click\",()=>T(\"close\")),document.getElementById(\"tray-btn-mid\")?.addEventListener(\"click\",X),console.log(\"Setting up UI event handlers\");let N=document.getElementById(\"slInput\"),z=document.getElementById(\"tpInput\"),Y=document.getElementById(\"qtyInput\");document.getElementById(\"slInput\").addEventListener(\"input\",()=>{console.log(`SL input changed to: ${N.value}`);let o=parseFloat(N.value);isNaN(o)||(z.value=o*3,console.log(`Calculated TP: ${z.value} (SL \\xD7 3)`)),localStorage.setItem(\"bracketTrade_sl\",N.value),localStorage.setItem(\"bracketTrade_tp\",z.value),typeof l==\"function\"&&l({slTicks:d(N.value),tpTicks:d(z.value)},\"floating-ui\")}),z.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${z.value}`),localStorage.setItem(\"bracketTrade_tp\",z.value),typeof l==\"function\"&&l({tpTicks:d(z.value)},\"floating-ui\")}),document.getElementById(\"qtyInput\").addEventListener(\"input\",o=>{console.log(`Quantity input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_qty\",o.target.value),typeof l==\"function\"&&l({quantity:d(o.target.value,1)},\"floating-ui\")}),document.getElementById(\"tpCheckbox\")?.addEventListener(\"change\",o=>{typeof l==\"function\"&&l({tpEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"slCheckbox\")?.addEventListener(\"change\",o=>{typeof l==\"function\"&&l({slEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"entryPriceInput\")?.addEventListener(\"input\",o=>{typeof l==\"function\"&&l({entryPrice:d(o.target.value)},\"floating-ui\")}),document.getElementById(\"tpPriceInput\")?.addEventListener(\"input\",o=>{typeof l==\"function\"&&l({tpPrice:d(o.target.value)},\"floating-ui\")}),document.getElementById(\"slPriceInput\")?.addEventListener(\"input\",o=>{typeof l==\"function\"&&l({slPrice:d(o.target.value)},\"floating-ui\")}),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=j(o);console.log(`Calling clickExitForSymbol for: ${c} with Exit at Mkt & Cxl option`),y(c,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",c)}catch(o){console.error(\"Close All operation failed:\",o);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(c){console.error(\"Fallback close method also failed:\",c)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=j(o);console.log(`Calling clickExitForSymbol for: ${c} with Cancel All option`),y(c,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",c)}catch(o){console.error(\"Cancel All operation failed:\",o)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=j(o);console.log(`Calling clickExitForSymbol for: ${c} with Reverse & Cxl option`),y(c,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",c)}catch(o){console.error(\"Reverse Position operation failed:\",o)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",async()=>{console.log(\"Breakeven button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=j(o);console.log(`Breakeven for symbol: ${c}`);let v=R=>(R||\"\").replace(/\\s+/g,\" \").trim().toUpperCase(),w=[...document.querySelectorAll(\".contract-symbol span\")].find(R=>{let se=v(R.textContent),Fe=v(c);return se===Fe||se.startsWith(v(o))});if(!w)return console.error(\"Breakeven: contract header not found\");let M=[...(w.closest(\".gm-scroll-view\")||w.closest(\".header\")||document).querySelectorAll(\".info-column\")].find(R=>/position/i.test(R.querySelector(\"small\")?.textContent||\"\"));if(!M){console.error(\"Breakeven: Position column not found\");return}let Z=M.querySelector(\".number\"),ie=Z?.querySelector(\"span\"),he=(Z?.textContent||\"\").trim().match(/@([\\d.,]+)/);if(!he){console.error(\"Breakeven: could not parse entry price from Position\");return}let we=parseFloat(he[1].replace(/,/g,\"\")),ye=1;if(ie){let R=parseFloat(ie.textContent.replace(/[^\\d.-]/g,\"\"));!isNaN(R)&&R!==0&&(ye=Math.abs(R))}let fe=\"LONG\",Te=ie?.classList||Z?.classList||{contains:()=>!1};Te.contains(\"text-danger\")&&(fe=\"SHORT\"),Te.contains(\"text-success\")&&(fe=\"LONG\");let $e=fe===\"LONG\"?\"Sell\":\"Buy\";console.log(`Breakeven detected: side=${fe}, qty=${ye}, entry=${we}. Placing ${$e} LIMIT at entry.`);let me=document.getElementById(\"tpCheckbox\"),xe=document.getElementById(\"slCheckbox\"),qe=me.checked,Ne=xe.checked;me.checked=!1,xe.checked=!1;let ze=(()=>{let se=(parseFloat(document.getElementById(\"tickInput\").value)||.25).toString();return se.includes(\".\")?se.length-se.indexOf(\".\")-1:0})();document.getElementById(\"entryPriceInput\").value=we.toFixed(ze),document.getElementById(\"qtyInput\").value=ye.toString(),[\"input\",\"change\",\"blur\"].forEach(R=>{document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(R,{bubbles:!0})),document.getElementById(\"qtyInput\").dispatchEvent(new Event(R,{bubbles:!0}))}),await B(o,ye,$e,null,null,parseFloat(document.getElementById(\"tickInput\").value)||.25),me.checked=qe,xe.checked=Ne,document.getElementById(\"entryPriceInput\").value=\"\",[\"input\",\"change\",\"blur\"].forEach(R=>document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(R,{bubbles:!0})))}catch(o){console.error(\"Breakeven action failed:\",o)}}),console.log(\"Setting up persistent settings\"),document.getElementById(\"symbolInput\").value=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\",document.getElementById(\"symbolInput\").addEventListener(\"input\",o=>{let c=o.target.value;console.log(`Symbol input changed to: ${c}`),localStorage.setItem(\"bracketTrade_symbol\",c),typeof l==\"function\"&&l({symbol:c},\"floating-ui\")}),document.getElementById(\"symbolInput\").addEventListener(\"change\",o=>{let c=o.target.value,v=j(c);console.log(`Symbol changed to: ${c}, normalized: ${v}`);let w=c.replace(/[A-Z]\\d+$/,\"\"),S=h[w];if(S){console.log(`Found default values for ${w}: SL=${S.defaultSL}, TP=${S.defaultTP}`);let M=document.getElementById(\"slInput\"),Z=document.getElementById(\"tpInput\"),ie=document.getElementById(\"tickInput\");M.value=S.defaultSL,Z.value=S.defaultTP,typeof S.tickSize==\"number\"&&(ie.value=S.tickSize,localStorage.setItem(\"bracketTrade_tick\",S.tickSize),console.log(`Updated tick size to ${S.tickSize} for ${w}`)),localStorage.setItem(\"bracketTrade_sl\",S.defaultSL),localStorage.setItem(\"bracketTrade_tp\",S.defaultTP),console.log(`Updated SL/TP to default values for ${w}: SL=${M.value}, TP=${Z.value}`)}oe(\".search-box--input\",v),typeof l==\"function\"&&l({symbol:v,slTicks:S?.defaultSL,tpTicks:S?.defaultTP,tickSize:S?.tickSize},\"floating-ui\")}),document.getElementById(\"tickInput\").value=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",document.getElementById(\"tickInput\").addEventListener(\"input\",o=>{console.log(`Tick size input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_tick\",o.target.value),typeof l==\"function\"&&l({tickSize:d(o.target.value,.25)},\"floating-ui\")}),console.log(\"Setting up drag functionality\");let x=!1,A,U;t.addEventListener(\"mousedown\",o=>{console.log(\"Container mousedown event detected\"),x=!0,A=o.clientX-t.getBoundingClientRect().left,U=o.clientY-t.getBoundingClientRect().top,console.log(`Drag started at offset X:${A}, Y:${U}`),t.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",o=>{if(x){let c=`${o.clientX-A}px`,v=`${o.clientY-U}px`;o.clientX%20===0&&console.log(`Dragging panel to X:${c}, Y:${v}`),t.style.left=c,t.style.top=v,t.style.right=\"unset\",u()}}),document.addEventListener(\"mouseup\",()=>{x&&(console.log(`Container drop position: Left:${t.style.left}, Top:${t.style.top}`),localStorage.setItem(\"bracketTradeBoxLeft\",t.style.left),localStorage.setItem(\"bracketTradeBoxTop\",t.style.top)),x=!1,t.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=+Y.value,v=+z.value,w=+N.value,S=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${o}, Qty=${c}, TP=${v}, SL=${w}, TickSize=${S}`),B(o,c,\"Buy\",v,w,S).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=+Y.value,v=+z.value,w=+N.value,S=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${o}, Qty=${c}, TP=${v}, SL=${w}, TickSize=${S}`),B(o,c,\"Sell\",v,w,S).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}async function y(e,n=\"cancel-option-Exit-at-Mkt-Cxl\"){let r={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},i={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},s=x=>(x||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),t=x=>new Promise(A=>setTimeout(A,x));async function g(x,{timeout:A=1200,interval:U=50}={}){let o=performance.now();for(;performance.now()-o<A;){let c=x();if(c)return c;await t(U)}return null}let b=n.toLowerCase(),a=r[b]||n,m=i[a]||null,u=s(e),k=/^[A-Z]{1,3}$/.test(u),C=[...document.querySelectorAll(\".header .contract-symbol span\")].find(x=>{let A=s(x.textContent);return A===u||k&&A.startsWith(u)});if(!C)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let T=C.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),X=T?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),N=T?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!T||!X||!N)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(m?m.test(s(X.textContent)):!1)return X.click(),!0;N.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let Y=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(x=>x.offsetParent!==null||/display\\s*:\\s*block/i.test(x.getAttribute(\"style\")||\"\")||!!x.closest(\".open\")),K=await g(Y,{timeout:900,interval:40});if(!K||!K.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let H=N.getBoundingClientRect();K.sort((x,A)=>{let U=x.getBoundingClientRect(),o=A.getBoundingClientRect(),c=Math.hypot(U.left-H.left,U.top-H.bottom),v=Math.hypot(o.left-H.left,o.top-H.bottom);return c-v});let W=K[0],L=document.getElementById(a);if(!L&&m){for(let x of K)if(L=[...x.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(A=>m.test(s(A.textContent))),L){W=x;break}}if(!L)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let re=L.tagName?L.matches(\"a,button\")?L:L.querySelector(\"a,button\")||L:L;return[\"mousedown\",\"mouseup\",\"click\"].forEach(x=>re.dispatchEvent(new MouseEvent(x,{bubbles:!0}))),N.click(),await t(120),K=Y(),L=document.getElementById(a)||(m?K?.flatMap(x=>[...x.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(x=>m.test(s(x.textContent))):null),L?([\"mousedown\",\"mouseup\",\"click\"].forEach(x=>(L.querySelector(\"a,button\")||L).dispatchEvent(new MouseEvent(x,{bubbles:!0}))),await t(80),X.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function ce(e=document){let n=[...e.querySelectorAll(\".databox.react-draggable.react-resizable\")].find(g=>g.offsetParent!==null);if(!n)return null;let s={timestamp:((g,b=n)=>{let a=b.querySelector(g);return a?a.textContent.trim():null})(\".header .title\")||null};return n.querySelectorAll(\".gm-scroll-view .entries li\").forEach(g=>{let b=g.querySelector(\".label\"),a=g.querySelector(\".desc\");if(!b||!a)return;let m=b.cloneNode(!0);m.querySelectorAll(\"span\").forEach(X=>X.remove());let u=(m.textContent||\"\").trim().toLowerCase().replace(/[^a-z0-9]/g,\"\"),k=(a.textContent||\"\").trim(),P={open:\"open\",high:\"high\",low:\"low\",close:\"close\",volume:\"volume\",atr:\"atr\",vwap:\"vwap\",upperband1:\"upperBand1\",lowerband1:\"lowerBand1\",upperband2:\"upperBand2\",lowerband2:\"lowerBand2\"}[u]||u,T=k.replace(/,/g,\"\");P===\"volume\"?T=Number.parseInt(T,10):T=Number.parseFloat(T),s[P]=Number.isNaN(T)?k:T}),s}document.querySelectorAll(\"#bracket-trade-box, #bracket-trade-tray\").forEach(e=>e.remove()),Q(),console.log(\"UI creation complete\");async function oe(e,n){console.log(`updateSymbol called with selector: \"${e}\", value: \"${n}\"`);let r=document.querySelectorAll(e);console.log(`Found ${r.length} matching inputs`);let i=r[1]||r[0];if(!i){console.error(\"No matching input elements found!\");return}console.log(\"Selected input:\",i);let s=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,t=g=>i.dispatchEvent(new KeyboardEvent(g,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),s.call(i,\"\"),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await I(400),console.log(`Setting input value to: \"${n}\"`),s.call(i,n),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await I(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(t),i.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function J(e){let n=\"input.form-control\";for(let r=0;r<20;r++){let i=document.querySelector(n);if(i&&i.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,e),[\"input\",\"change\",\"blur\"].forEach(t=>i.dispatchEvent(new Event(t,{bubbles:!0}))),await I(300);return}await I(100)}console.error(\"Price input not found\")}function j(e){console.log(`normalizeSymbol called with: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${n}`);let r=n?ne(e):e.toUpperCase();return console.log(`Normalized symbol: \"${r}\"`),r}async function de(e){console.log(\"Creating bracket orders with data:\",e);let n=typeof e.tpEnabled==\"boolean\"?e.tpEnabled:document.getElementById(\"tpCheckbox\")?.checked??!0,r=typeof e.slEnabled==\"boolean\"?e.slEnabled:document.getElementById(\"slCheckbox\")?.checked??!0;console.log(`TP enabled: ${n}, SL enabled: ${r}`);async function i(b,a){let m=[...document.querySelectorAll(\".trading-ticket\")].find(P=>P.offsetParent);if(!m)return console.error(\"No visible trading ticket\");let u;for(let P=0;P<25&&(u=[...m.querySelectorAll(b)].find(T=>T.offsetParent&&!T.disabled),!u);P++)await I(100);if(!u)return console.error(`No live input for ${b}`);let k=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,C=u.closest(\".select-input.combobox\");C&&!u.value&&(C.querySelector(\".btn\")?.click(),await I(150),C.querySelector(\".dropdown-menu li\")?.click(),await I(150));for(let P=0;P<3&&(u.focus(),k.call(u,a),u.dispatchEvent(new Event(\"input\",{bubbles:!0})),u.dispatchEvent(new Event(\"change\",{bubbles:!0})),u.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),u.blur(),await I(250),`${u.value}`.trim()!==`${a}`);P++);}async function s(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let b=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${b.length} action labels`),b.forEach(a=>{a.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),a.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await i(\".select-input.combobox input\",e.qty))}function t(b=\"up\"){let a=document.querySelector(\".numeric-input-value-controls\");if(!a)return;a.querySelector(b===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function g(b,a){await s(),document.querySelector(\".group.order-type .select-input div[tabindex]\")?.click(),[...document.querySelectorAll(\"ul.dropdown-menu li\")].find(u=>u.textContent.trim()===b)?.click(),a&&await i(\".numeric-input.feedback-wrapper input\",a),document.querySelector(\".btn-group .btn-primary\")?.click(),await I(200),console.log(ue()),document.querySelector(\".icon.icon-back\")?.click(),await I(200)}return console.log(`Submitting initial ${e.orderType||\"MARKET\"} order`),await g(e.orderType||\"MARKET\",e.entryPrice),e.action===\"Buy\"?(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await g(\"LIMIT\",e.takeProfit)),r&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await g(\"STOP\",e.stopLoss))):(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await g(\"LIMIT\",e.takeProfit)),r&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await g(\"STOP\",e.stopLoss))),console.log(\"Bracket order creation complete\"),Promise.resolve()}function ue(e=document){let n=e.querySelector(\".order-history-content\")||e.querySelector(\".module.orders\");if(!n)return[];let r=n.querySelectorAll(\".public_fixedDataTable_bodyRow\");return Array.from(r,i=>{let s=i.querySelectorAll(\".public_fixedDataTableCell_cellContent\");if(!s.length)return null;let t=s[0]?.textContent.trim()||\"\",g=s[1]?.textContent.trim()||\"\",b=s[2]?.textContent.trim()||\"\",a=s[3]?.textContent.trim()||\"\",m=null,u=b.match(/@([\\d.]+)/);return u&&(m=Number(u[1])),b?{timestamp:t,id:g,event:b,comment:a,fillPrice:m}:null}).filter(Boolean)}let h={MNQ:{tickSize:.25,tickValue:.5,defaultSL:40,defaultTP:100,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:40,defaultTP:100,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function B(e,n=1,r=\"Buy\",i=null,s=null,t=.25){console.log(`autoTrade called with: symbol=${e}, qty=${n}, action=${r}, TP=${i}, SL=${s}, tickSize=${t}`);let g={};e&&(g.symbol=e),typeof n==\"number\"&&!Number.isNaN(n)&&(g.quantity=n),i!=null&&(g.tpTicks=i),s!=null&&(g.slTicks=s),t!=null&&(g.tickSize=t);let b=te(g,\"autoTrade\"),{symbol:a,quantity:m,tpTicks:u,slTicks:k,tickSize:C,entryPrice:P,tpPrice:T,slPrice:X,tpEnabled:N,slEnabled:z}=b,Y=a||\"NQ\";console.log(`Using symbol: ${Y}`);let K=Y.replace(/[A-Z]\\d+$/,\"\")||Y;console.log(`Root symbol: ${K}`);let H=h[K]||{},W=Number.isFinite(C)?C:typeof H.tickSize==\"number\"?H.tickSize:d(t,.25);Number.isFinite(W)||(W=.25);let L=z?d(k,H.defaultSL??40):0,re=N?d(u,H.defaultTP??100):0,x=d(m,1);console.log(`Using tick size ${W}`),console.log(`Effective SL: ${L} ticks, TP: ${re} ticks`),console.log(`Getting market data for ${Y}`);let A=f(Y);if(!A){console.error(`No market data for ${Y}`);return}console.log(\"Market data:\",A);let U=parseFloat(r===\"Buy\"?A.offerPrice:A.bidPrice);console.log(`Market price: ${U} (${r===\"Buy\"?\"offer\":\"bid\"} price)`);let o=Number.isFinite(P)?P:null,c=U,v=\"MARKET\";o!==null?(console.log(`Custom entry price provided: ${o}`),c=o,r===\"Buy\"?v=o<U?\"LIMIT\":\"STOP\":v=o>U?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${v}`)):console.log(`No custom entry price provided, using market order at ${U}`);let w=Number.isFinite(H.precision)?H.precision:2;console.log(`Using price precision: ${w} decimal places`);let S=z?Number.isFinite(X)?X:r===\"Buy\"?c-L*W:c+L*W:null,M=N?Number.isFinite(T)?T:r===\"Buy\"?c+re*W:c-re*W:null,Z=S!=null?S.toFixed(w):null,ie=M!=null?M.toFixed(w):null;typeof l==\"function\"&&l({symbol:Y,quantity:x,tpTicks:re,slTicks:L,tickSize:W,entryPrice:o,tpPrice:M??null,slPrice:S,tpEnabled:N,slEnabled:z},\"autoTrade-final\");let be={symbol:A.symbol,action:r,qty:String(x),takeProfit:ie,stopLoss:Z,orderType:v,entryPrice:v!==\"MARKET\"&&c!=null?c.toFixed(w):null,tpEnabled:N,slEnabled:z};return console.log(\"Trade data prepared:\",be),console.log(\"Submitting bracket orders\"),de(be).finally(()=>{})}function ne(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:n,yearDigit:r}=Ee();console.log(`Got quarterly code: letter=${n}, yearDigit=${r}`);let i=`${e.toUpperCase()}${n}${r}`;return console.log(`Returning front quarter symbol: \"${i}\"`),i}function f(e){console.log(`getMarketData called for: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e)?j(e):e.toUpperCase(),r=p(n);if(!r)return console.log(`Cannot Find ${e}`),null;let i=r.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),s=i[4]?.textContent.trim(),t=i[5]?.textContent.trim();return{symbol:n,bidPrice:s,offerPrice:t}}function p(e){let n=/^[A-Z]{1,3}$/.test((e||\"\").trim()),r=n?null:g(e),i=n?g(e):null,s=document.querySelectorAll(\".quoteboard.module.data-table, .data-table, .quoteboard\"),t=s.length?s:[document];for(let b of t){let a=b.querySelectorAll(\".public_fixedDataTable_bodyRow\");for(let m of a){if(m.offsetParent===null)continue;let u=m.querySelector(\".public_fixedDataTableCell_cellContent\");if(!u)continue;let k=g(u.textContent);if(r&&k===r||i&&k.startsWith(i))return m}}return console.error(`findQuoteRow: row for \"${e}\" not found (visible area).`),null;function g(b){return String(b||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase()}}let _=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function ee(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let n=_[e.getUTCMonth()],r=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${n}, yearDigit=${r}`),{letter:n,yearDigit:r}}function V(e=new Date){console.log(`getNQFrontMonth called with date: ${e.toISOString()}`);let n=[3,6,9,12],r=[\"H\",\"M\",\"U\",\"Z\"],i=e.getFullYear(),s=e.getMonth()+1,t=e.getDate();console.log(`Current date: ${i}-${s}-${t}`);for(let a=0;a<n.length;a++){let m=n[a],u=ae(i,m),k=new Date(u);if(k.setDate(u.getDate()-4),console.log(`Checking ${r[a]} contract: expiry=${u.toISOString()}, roll=${k.toISOString()}`),e<k){let C=`NQ${r[a]}${String(i).slice(-2)}`;return console.log(`Current front month: ${C} (before roll date)`),{symbol:C,letter:r[a],yearDigit:String(i).slice(-2),expiry:u,rollDate:k,isRollPeriod:!1}}else if(e<u){let C=(a+1)%4,P=C>a?i:i+1,T=`NQ${r[C]}${String(P).slice(-2)}`;return console.log(`Front month during roll period: ${T}`),{symbol:T,letter:r[C],yearDigit:String(P).slice(-2),expiry:ae(P,n[C]),rollDate:k,isRollPeriod:!0}}}let g=i+1,b=`NQ${r[0]}${String(g).slice(-2)}`;return console.log(`Moving to next year: ${b}`),{symbol:b,letter:r[0],yearDigit:String(g).slice(-2),expiry:ae(g,n[0]),rollDate:null,isRollPeriod:!1}}function ae(e,n){let i=(5-new Date(e,n-1,1).getDay()+7)%7,s=new Date(e,n-1,1+i),t=new Date(s);return t.setDate(s.getDate()+14),t}function Ee(e=new Date){console.log(`getQuarterlyCode called (legacy) with date: ${e.toISOString()}`);let n=V(e);return console.log(`Legacy getQuarterlyCode returning: letter=${n.letter}, yearDigit=${n.yearDigit}`),{letter:n.letter,yearDigit:String(n.yearDigit).slice(-1)}}console.log(\"Calculating current NQ front month using CME rules...\");let pe=V();console.log(`Current NQ front month: ${pe.symbol}`),console.log(`Expiry date: ${pe.expiry.toISOString()}`),console.log(`Roll date: ${pe.rollDate?pe.rollDate.toISOString():\"N/A\"}`),console.log(`Is in roll period: ${pe.isRollPeriod}`);let{letter:Ce,yearDigit:Le}=Ee(),Ae=`NQ${Ce}${Le}`;console.log(`Legacy front-quarter symbol: ${Ae}`),window.getNQFrontMonth=V,window.getThirdFriday=ae;function Ie(){console.warn(\"[TradoAuto] moveStopLossToBreakeven is not implemented in this build\")}let ge={init:()=>{console.log(\"[TradoAuto] legacy driver init\")},autoTrade:B,clickExitForSymbol:y,moveStopLossToBreakeven:Ie,createUI:Q,getNQFrontMonth:V,getThirdFriday:ae,getState:()=>typeof $==\"function\"?$():{},applyConfig:(e={},n=\"external\")=>typeof l==\"function\"?l(e,n):{},subscribeState:e=>typeof q==\"function\"?q(e):()=>{},getOrderEvents:ue},le=typeof unsafeWindow<\"u\"?unsafeWindow:window;console.log(\"[TradoAuto] installing legacy driver onto window/unsafeWindow\"),window.TradoAuto=ge,le.TradoAuto=ge,le.TradovateAutoDriverBundle={default:ge,autoTrade:B,clickExitForSymbol:y,moveStopLossToBreakeven:Ie,createUI:Q,getNQFrontMonth:V,getThirdFriday:ae},le.__tradoAutoInterval||(le.__tradoAutoInterval=setInterval(()=>{(!le.TradoAuto||typeof le.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on targetWindow\"),le.TradoAuto=ge),(!window.TradoAuto||typeof window.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on window\"),window.TradoAuto=ge)},250),console.log(\"[TradoAuto] watchdog interval started\"))})();var ve=typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto;function Pe(E,{visible:$=!1}={}){if(console.log(`Creating UI (visible=${$})`),!E)return console.warn(\"[TradoUIPanel] renderPanel called without driver instance\"),null;let l=E.state,q=E.futuresTickData,d=E.normalizeSymbol,D=\"NQ\",te=D.replace(/[A-Z]\\d+$/,\"\"),O=q[te]||q.NQ;l.symbol=D,l.tp=O.defaultTP,l.sl=O.defaultSL,l.tickSize=O.tickSize;let F=O.defaultTP.toString(),G=O.defaultSL.toString(),I=\"10\",Q=O.tickSize.toString();console.log(`Using defaults: TP=${F}, SL=${G}, Qty=${I}, Tick=${Q}, Symbol=${D}`),console.log(`Symbol data for ${te}: defaultTP=${O.defaultTP}, defaultSL=${O.defaultSL}`);let y=document.createElement(\"div\");y.id=$?\"bracket-trade-box\":\"invisible-trade-inputs\",$?(Object.assign(y.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"}),y.style.top=\"20px\",y.style.right=\"20px\"):Object.assign(y.style,{position:\"fixed\",top:\"-9999px\",left:\"-9999px\",visibility:\"hidden\",opacity:\"0\",pointerEvents:\"none\"}),$?y.innerHTML=`\n        <!-- Header with Symbol -->\n        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n            <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n            <input type=\"text\" id=\"symbolInput\" value=\"${D}\"\n                style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                placeholder=\"Symbol\" />\n        </div>\n        \n        <!-- Hidden Tick Size Input -->\n        <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n            <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n            <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${Q}\"\n                style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n        </div>\n\n        <!-- Main Controls -->\n        <div id=\"mainControls\">\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"tpInput\" value=\"${F}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Ticks\" />\n                    <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n                <input type=\"checkbox\" id=\"slCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"slInput\" value=\"${G}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"SL Ticks\" />\n                    <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                        placeholder=\"SL Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n                <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n                <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                    <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"0.01\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                    <input type=\"number\" id=\"qtyInput\" value=\"${I}\" min=\"1\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                </div>\n                <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n                <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n                <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n            </div>\n            <!-- NEW: Breakeven button above Reverse -->\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n            </div>\n        </div>`:y.innerHTML=`\n            <input type=\"text\" id=\"symbolInput\" value=\"${D}\" />\n            <input type=\"number\" id=\"tickInput\" value=\"${Q}\" />\n            <input type=\"number\" id=\"tpInput\" value=\"${F}\" />\n            <input type=\"number\" id=\"slInput\" value=\"${G}\" />\n            <input type=\"number\" id=\"qtyInput\" value=\"${I}\" />\n            <input type=\"number\" id=\"entryPriceInput\" />\n            <input type=\"number\" id=\"tpPriceInput\" />\n            <input type=\"number\" id=\"slPriceInput\" />\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n        `;let ce=$?\"bracket-trade-box\":\"invisible-trade-inputs\";if(document.getElementById(ce))return console.log(`${ce} already exists, skipping creation`),document.getElementById(ce);document.body.appendChild(y),console.log(\"UI container added to DOM\"),console.log(\"Setting up universal event handlers\");let oe=document.getElementById(\"slInput\"),J=document.getElementById(\"tpInput\"),j=document.getElementById(\"qtyInput\");oe&&oe.addEventListener(\"input\",()=>{console.log(`SL input changed to: ${oe.value}`);let h=parseFloat(oe.value);isNaN(h)||(l.sl=h,J&&(J.value=Math.round(h*3.5)),l.tp=Math.round(h*3.5),console.log(`Calculated TP: ${l.tp} (SL \\xD7 3.5)`))}),J&&J.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${J.value}`);let h=parseFloat(J.value);isNaN(h)||(l.tp=h)}),j&&j.addEventListener(\"input\",h=>{console.log(`Quantity input changed to: ${h.target.value}`);let B=parseInt(h.target.value);!isNaN(B)&&B>0&&(l.qty=B)});let de=document.getElementById(\"symbolInput\");de&&(de.addEventListener(\"input\",h=>{console.log(`Symbol input changed to: ${h.target.value}`),l.symbol=h.target.value}),de.addEventListener(\"change\",h=>{let B=h.target.value,ne=d(B);console.log(`Symbol changed to: ${B}, normalized: ${ne}`);let f=B.replace(/[A-Z]\\d+$/,\"\"),p=q[f];if(p){console.log(`Found default values for ${f}: SL=${p.defaultSL}, TP=${p.defaultTP}`);let _=document.getElementById(\"slInput\"),ee=document.getElementById(\"tpInput\"),V=document.getElementById(\"tickInput\");_.value=p.defaultSL,ee.value=p.defaultTP,l.sl=p.defaultSL,l.tp=p.defaultTP,typeof p.tickSize==\"number\"&&(V.value=p.tickSize,l.tickSize=p.tickSize,console.log(`Updated tick size to ${p.tickSize} for ${f}`)),console.log(`\\u2705 Updated SL/TP to default values for ${f}: SL=${_.value}, TP=${ee.value}`)}E.updateSymbol(\".trading-ticket .search-box--input\",ne)}));let ue=document.getElementById(\"tickInput\");if(ue&&ue.addEventListener(\"input\",h=>{console.log(`Tick size input changed to: ${h.target.value}`);let B=parseFloat(h.target.value);!isNaN(B)&&B>0&&(l.tickSize=B)}),$){console.log(\"Setting up UI event handlers\"),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let f=document.getElementById(\"symbolInput\").value||\"NQ\",p=d(f);console.log(`Calling clickExitForSymbol for: ${p} with Exit at Mkt & Cxl option`),E.clickExitForSymbol(p,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",p)}catch(f){console.error(\"Close All operation failed:\",f);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(p){console.error(\"Fallback close method also failed:\",p)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let f=document.getElementById(\"symbolInput\").value||\"NQ\",p=d(f);console.log(`Calling clickExitForSymbol for: ${p} with Cancel All option`),E.clickExitForSymbol(p,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",p)}catch(f){console.error(\"Cancel All operation failed:\",f)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let f=document.getElementById(\"symbolInput\").value||\"NQ\",p=d(f);console.log(`Calling clickExitForSymbol for: ${p} with Reverse & Cxl option`),E.clickExitForSymbol(p,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",p)}catch(f){console.error(\"Reverse Position operation failed:\",f)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",()=>{console.log(\"Breakeven button clicked\");try{let f=document.getElementById(\"symbolInput\").value||\"NQ\",p=d(f);console.log(`Processing breakeven for symbol: ${p}`),E.moveStopLossToBreakeven(p),console.log(\"Breakeven action triggered for symbol:\",p)}catch(f){console.error(\"Breakeven operation failed:\",f)}}),console.log(\"Setting up default values\"),document.getElementById(\"symbolInput\").value=\"NQ\",document.getElementById(\"tickInput\").value=l.tickSize,console.log(\"Setting up drag functionality\");let h=!1,B,ne;y.addEventListener(\"mousedown\",f=>{console.log(\"Container mousedown event detected\"),h=!0,B=f.clientX-y.getBoundingClientRect().left,ne=f.clientY-y.getBoundingClientRect().top,console.log(`Drag started at offset X:${B}, Y:${ne}`),y.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",f=>{if(h){let p=`${f.clientX-B}px`,_=`${f.clientY-ne}px`;f.clientX%20===0&&console.log(`Dragging panel to X:${p}, Y:${_}`),y.style.left=p,y.style.top=_,y.style.right=\"unset\"}}),document.addEventListener(\"mouseup\",()=>{h&&console.log(`Container drop position: Left:${y.style.left}, Top:${y.style.top}`),h=!1,y.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let f=document.getElementById(\"symbolInput\").value||\"NQ\",p=+j.value,_=+J.value,ee=+oe.value,V=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${f}, Qty=${p}, TP=${_}, SL=${ee}, TickSize=${V}`),E.autoTrade(f,p,\"Buy\",_,ee,V).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let f=document.getElementById(\"symbolInput\").value||\"NQ\",p=+j.value,_=+J.value,ee=+oe.value,V=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${f}, Qty=${p}, TP=${_}, SL=${ee}, TickSize=${V}`),E.autoTrade(f,p,\"Sell\",_,ee,V).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}return console.log(\"State management: Using in-memory state only, no persistence\"),y}function Be({driverInstance:E=ve}={},$={}){let l=!1,q=!1,d=null;function D(I={}){let{visible:Q=!0}={...$,...I},y=Pe(E,{visible:Q});return y&&(l=!0,q=Q,d=y),y}function te(){return D({visible:!1})}function O(){return D({visible:!0})}function F(){let I=!1,Q=document.getElementById(\"bracket-trade-box\"),y=document.getElementById(\"invisible-trade-inputs\");return Q&&(Q.remove(),I=!0),y&&(y.remove(),I=!0),I&&(l=!1,q=!1,d=null),I}function G(){return{mounted:l,visible:q,hasPanel:!!document.getElementById(\"bracket-trade-box\"),hasInvisiblePanel:!!document.getElementById(\"invisible-trade-inputs\"),lastContainer:d}}return{mount:D,createUI:D,createInvisibleUI:te,show:O,hide:F,getStatus:G,render:I=>Pe(E,I)}}var Se=Be();ve.registerUIPanel(Se);typeof window<\"u\"&&(window.TradoUIPanel=Se);var Ve=Se;return Ue(Ye);})();\n//# sourceMappingURL=tradovate_ui_panel.js.map\n";

    function inject(code, id) {
        if (!code) {
            console.warn(`[AutoOrder] No code supplied for ${id}, skipping injection.`);
            return;
        }

        const scriptId = `trado-${id}`;
        if (document.getElementById(scriptId)) {
            console.debug(`[AutoOrder] Script ${scriptId} already present, skipping duplicate injection.`);
            return;
        }

        const script = document.createElement('script');
        script.id = scriptId;
        script.type = 'text/javascript';
        script.textContent = code;
        document.head.appendChild(script);
        console.debug(`[AutoOrder] Injected ${id} bundle.`);
    }

    function waitForGlobal(name, timeout = 8000) {
        return new Promise((resolve, reject) => {
            const start = Date.now();
            (function check() {
                if (window[name]) {
                    resolve(window[name]);
                    return;
                }
                if (Date.now() - start > timeout) {
                    reject(new Error(`${name} not available within ${timeout}ms`));
                    return;
                }
                requestAnimationFrame(check);
            })();
        });
    }

    inject(driverSource, 'auto-driver');
    inject(panelSource, 'ui-panel');

    Promise.all([
        waitForGlobal('TradoAuto'),
        waitForGlobal('TradoUIPanel')
    ]).then(([autoDriver, uiPanel]) => {
        try {
            autoDriver.init?.({ source: 'tampermonkey' });
        } catch (err) {
            console.error('[AutoOrder] Failed to init driver', err);
        }

        try {
            uiPanel.mount?.({ visible: true });
        } catch (err) {
            console.error('[AutoOrder] Failed to mount UI panel', err);
        }

        console.info('[AutoOrder] Driver and panel ready.');
    }).catch(err => {
        console.error('[AutoOrder] Initialization failed', err);
    });
})();
