// ==UserScript==
// @name         Auto Order (Modular)
// @namespace    http://tampermonkey.net/
// @version      6.0
// @description  Thin wrapper that loads the modular Tradovate automation driver and UI panel.
// @author       You
// @match        https://trader.tradovate.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tradovate.com
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    const driverSource = "var TradovateAutoDriverBundle=(()=>{var ae=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var Le=Object.getOwnPropertyNames;var Ae=Object.prototype.hasOwnProperty;var qe=(M,P)=>{for(var s in P)ae(M,s,{get:P[s],enumerable:!0})},Me=(M,P,s,F)=>{if(P&&typeof P==\"object\"||typeof P==\"function\")for(let f of Le(P))!Ae.call(M,f)&&f!==s&&ae(M,f,{get:()=>P[f],enumerable:!(F=Be(P,f))||F.enumerable});return M};var Ne=M=>Me(ae({},\"__esModule\",{value:!0}),M);var Oe={};qe(Oe,{createAutoDriver:()=>ze,default:()=>De});function Fe(M={}){let s={...{symbol:\"NQ\",quantity:1,tpTicks:120,slTicks:40,tpEnabled:!0,slEnabled:!0,tickSize:.25,entryPrice:null,lastSource:\"init\",lastUpdated:Date.now()},...M},F=new Set;function f(){for(let R of F)try{R({...s})}catch(Z){console.warn(\"[DriverStore] listener error\",Z)}}function oe(){return{...s}}function ne(R={},Z=\"unknown\"){let L={...s,...R,lastSource:Z,lastUpdated:Date.now()};return Object.keys(L).some(Q=>L[Q]!==s[Q])&&(s=L,f()),s}function le(R){return F.add(R),R({...s}),()=>F.delete(R)}return{getState:oe,applyUpdate:ne,subscribe:le}}typeof window<\"u\"&&(window.TradoAutoState||(window.TradoAutoState=Fe()));(function(){let M=window.TradoAutoState&&typeof window.TradoAutoState.getState==\"function\"?window.TradoAutoState:R();window.TradoAutoState=M;let{getState:P,applyUpdate:s,subscribe:F}=M;function f(e,n=null){let r=typeof e==\"string\"?parseFloat(e):e;return Number.isFinite(r)?r:n}function oe(){let e=r=>{let l=document.getElementById(r);return l?l.value:void 0},n=r=>{let l=document.getElementById(r);return l?!!l.checked:void 0};return{symbol:e(\"symbolInput\"),quantity:f(e(\"qtyInput\")),tpTicks:f(e(\"tpInput\")),slTicks:f(e(\"slInput\")),tickSize:f(e(\"tickInput\")),entryPrice:f(e(\"entryPriceInput\")),tpPrice:f(e(\"tpPriceInput\")),slPrice:f(e(\"slPriceInput\")),tpEnabled:n(\"tpCheckbox\"),slEnabled:n(\"slCheckbox\")}}function ne(e={},n=\"autoTrade-call\"){let r=typeof P==\"function\"?P():{},t={...{...oe(),...r}};return e.symbol&&(t.symbol=e.symbol),typeof e.quantity==\"number\"&&(t.quantity=e.quantity),typeof e.tpTicks==\"number\"&&(t.tpTicks=e.tpTicks),typeof e.slTicks==\"number\"&&(t.slTicks=e.slTicks),typeof e.tickSize==\"number\"&&(t.tickSize=e.tickSize),e.entryPrice!=null&&(t.entryPrice=e.entryPrice),e.tpEnabled!=null&&(t.tpEnabled=e.tpEnabled),e.slEnabled!=null&&(t.slEnabled=e.slEnabled),e.tpPrice!=null&&(t.tpPrice=e.tpPrice),e.slPrice!=null&&(t.slPrice=e.slPrice),t.symbol=(t.symbol||\"NQ\").toUpperCase(),t.quantity=f(t.quantity,1),t.tpTicks=f(t.tpTicks,120),t.slTicks=f(t.slTicks,40),t.tickSize=f(t.tickSize,.25),t.entryPrice=t.entryPrice!=null?f(t.entryPrice):null,t.tpPrice=t.tpPrice!=null?f(t.tpPrice):null,t.slPrice=t.slPrice!=null?f(t.slPrice):null,t.tpEnabled=typeof t.tpEnabled==\"boolean\"?t.tpEnabled:!0,t.slEnabled=typeof t.slEnabled==\"boolean\"?t.slEnabled:!0,t.lastSource=n,typeof s==\"function\"&&s(t,n),t}function le(e){if(!e)return;let n=(l,u)=>{let t=document.getElementById(l);if(!t)return;let p=u??\"\";t.value!==String(p)&&(t.value=p)},r=(l,u)=>{let t=document.getElementById(l);!t||typeof u!=\"boolean\"||t.checked!==u&&(t.checked=u)};n(\"symbolInput\",e.symbol),n(\"qtyInput\",e.quantity),n(\"tpInput\",e.tpTicks),n(\"slInput\",e.slTicks),n(\"tickInput\",e.tickSize),n(\"entryPriceInput\",e.entryPrice),n(\"tpPriceInput\",e.tpPrice),n(\"slPriceInput\",e.slPrice),r(\"tpCheckbox\",e.tpEnabled),r(\"slCheckbox\",e.slEnabled)}typeof F==\"function\"&&F(le);let{createDriverStore:R}=window.TradoAutoState||{};console.log(\"Auto Order script initialized\");var Z=!1;function L(e){return console.log(`Delaying for ${e}ms`),new Promise(n=>setTimeout(n,e))}function J(){console.log(\"Creating UI\");let e=localStorage.getItem(\"bracketTrade_tp\")||\"120\",n=localStorage.getItem(\"bracketTrade_sl\")||\"40\",r=localStorage.getItem(\"bracketTrade_qty\")||\"9\",l=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",u=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\";console.log(`Stored values: TP=${e}, SL=${n}, Qty=${r}, Tick=${l}, Symbol=${u}`);let t=document.createElement(\"div\");t.id=\"bracket-trade-box\",Object.assign(t.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"});let p=0,x=0;p&&x?(t.style.left=p,t.style.top=x):(t.style.top=\"20px\",t.style.right=\"20px\"),t.innerHTML=`\n    <!-- Header with Symbol -->\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n        <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n        <input type=\"text\" id=\"symbolInput\" value=\"${u}\"\n            style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n            placeholder=\"Symbol\" />\n    </div>\n\n    <!-- Hidden Tick Size Input -->\n    <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n        <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n        <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${l}\"\n            style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n    </div>\n\n    <!-- Main Controls -->\n    <div id=\"mainControls\">\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"tpInput\" value=\"${e}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Ticks\" />\n                <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"slInput\" value=\"${n}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Ticks\" />\n                <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n            <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n            <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                <input type=\"number\" id=\"qtyInput\" value=\"${r}\" min=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n            </div>\n            <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n        </div>\n        <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n            <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n            <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n        </div>\n\n        <!-- NEW: Breakeven button above Reverse -->\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n        </div>\n\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n        </div>\n    </div>`,document.body.appendChild(t),console.log(\"UI container added to DOM\");let a=document.createElement(\"div\");a.id=\"bracket-trade-tray\",Object.assign(a.style,{position:\"fixed\",top:t.style.top||\"20px\",left:\"0px\",background:\"#24262b\",border:\"1px solid #444\",padding:\"10px\",borderRadius:\"8px\",boxShadow:\"0 2px 10px rgba(0,0,0,0.4)\",color:\"#fff\",width:\"140px\",zIndex:\"99999\",display:\"none\"}),a.innerHTML=`\n      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\n        <div style=\"font-weight:600;\">Price Tray</div>\n        <button id=\"trayCloseBtn\" title=\"Hide\"\n          style=\"background:#333;border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;\">\\xD7</button>\n      </div>\n      <div style=\"display:flex;flex-direction:column;gap:6px\">\n        <button id=\"tray-btn-high\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">High</button>\n        <button id=\"tray-btn-low\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Low</button>\n        <button id=\"tray-btn-open\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Open</button>\n        <button id=\"tray-btn-close\" style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Close</button>\n        <button id=\"tray-btn-mid\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Middle</button>\n      </div>\n    `,document.body.appendChild(a);let d=document.createElement(\"button\");d.id=\"trayToggle\",d.textContent=\"\\u25C2 O/L/H/C/M\",Object.assign(d.style,{position:\"absolute\",right:\"-92px\",top:\"0\",height:\"32px\",background:\"#30343b\",color:\"#fff\",border:\"1px solid #444\",borderRadius:\"0 8px 8px 0\",padding:\"4px 8px\",cursor:\"pointer\"}),t.appendChild(d);function b(){let o=t.getBoundingClientRect();a.style.top=`${o.top}px`,a.style.left=`${o.right+8}px`}b(),window.addEventListener(\"resize\",b),d.addEventListener(\"click\",()=>{b(),a.style.display=a.style.display===\"none\"?\"block\":\"none\"}),a.querySelector(\"#trayCloseBtn\")?.addEventListener(\"click\",()=>{a.style.display=\"none\"});let c=null;function v(){let o=(document.getElementById(\"tickInput\")?.value||\"\").toString(),i=o.indexOf(\".\");return i===-1?0:o.length-i-1}setInterval(()=>{try{if(typeof se==\"function\"){if(c=se(),c){let o={open:[\"tray-btn-open\",\"Open\"],low:[\"tray-btn-low\",\"Low\"],high:[\"tray-btn-high\",\"High\"],close:[\"tray-btn-close\",\"Close\"]};for(let[m,[S,k]]of Object.entries(o)){let $=document.getElementById(S);if(!$)continue;let O=c[m];$.title=O!=null?`${k}: ${O}`:`${k}: \\u2014`}let i=document.getElementById(\"tray-btn-mid\");if(i){let m=c.open,S=c.close;if(typeof m==\"number\"&&typeof S==\"number\"){let k=v(),$=((m+S)/2).toFixed(k);i.title=`Mid (O+C)/2: ${$}`}else i.title=\"Mid (O+C)/2: \\u2014\"}}b()}}catch(o){console.warn(\"extractTradovateDataBox polling error:\",o)}},500);function h(o){let i=document.getElementById(\"entryPriceInput\");if(!i||o==null)return;Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,o),[\"input\",\"change\",\"blur\"].forEach(S=>i.dispatchEvent(new Event(S,{bubbles:!0})))}function g(o){if(!c||c[o]==null){console.warn(`No ${o} available from databox`);return}h(c[o])}function C(){if(!c||typeof c.open!=\"number\"||typeof c.close!=\"number\"){console.warn(\"Mid price unavailable (need open & close)\");return}let o=v(),i=((c.high+c.low)/2).toFixed(o);h(i)}document.getElementById(\"tray-btn-open\")?.addEventListener(\"click\",()=>g(\"open\")),document.getElementById(\"tray-btn-low\")?.addEventListener(\"click\",()=>g(\"low\")),document.getElementById(\"tray-btn-high\")?.addEventListener(\"click\",()=>g(\"high\")),document.getElementById(\"tray-btn-close\")?.addEventListener(\"click\",()=>g(\"close\")),document.getElementById(\"tray-btn-mid\")?.addEventListener(\"click\",C),console.log(\"Setting up UI event handlers\");let I=document.getElementById(\"slInput\"),T=document.getElementById(\"tpInput\"),q=document.getElementById(\"qtyInput\");document.getElementById(\"slInput\").addEventListener(\"input\",()=>{console.log(`SL input changed to: ${I.value}`);let o=parseFloat(I.value);isNaN(o)||(T.value=o*3,console.log(`Calculated TP: ${T.value} (SL \\xD7 3)`)),localStorage.setItem(\"bracketTrade_sl\",I.value),localStorage.setItem(\"bracketTrade_tp\",T.value),typeof s==\"function\"&&s({slTicks:f(I.value),tpTicks:f(T.value)},\"floating-ui\")}),T.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${T.value}`),localStorage.setItem(\"bracketTrade_tp\",T.value),typeof s==\"function\"&&s({tpTicks:f(T.value)},\"floating-ui\")}),document.getElementById(\"qtyInput\").addEventListener(\"input\",o=>{console.log(`Quantity input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_qty\",o.target.value),typeof s==\"function\"&&s({quantity:f(o.target.value,1)},\"floating-ui\")}),document.getElementById(\"tpCheckbox\")?.addEventListener(\"change\",o=>{typeof s==\"function\"&&s({tpEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"slCheckbox\")?.addEventListener(\"change\",o=>{typeof s==\"function\"&&s({slEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"entryPriceInput\")?.addEventListener(\"input\",o=>{typeof s==\"function\"&&s({entryPrice:f(o.target.value)},\"floating-ui\")}),document.getElementById(\"tpPriceInput\")?.addEventListener(\"input\",o=>{typeof s==\"function\"&&s({tpPrice:f(o.target.value)},\"floating-ui\")}),document.getElementById(\"slPriceInput\")?.addEventListener(\"input\",o=>{typeof s==\"function\"&&s({slPrice:f(o.target.value)},\"floating-ui\")}),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Calling clickExitForSymbol for: ${i} with Exit at Mkt & Cxl option`),Q(i,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",i)}catch(o){console.error(\"Close All operation failed:\",o);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(i){console.error(\"Fallback close method also failed:\",i)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Calling clickExitForSymbol for: ${i} with Cancel All option`),Q(i,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",i)}catch(o){console.error(\"Cancel All operation failed:\",o)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Calling clickExitForSymbol for: ${i} with Reverse & Cxl option`),Q(i,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",i)}catch(o){console.error(\"Reverse Position operation failed:\",o)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",async()=>{console.log(\"Breakeven button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=H(o);console.log(`Breakeven for symbol: ${i}`);let m=B=>(B||\"\").replace(/\\s+/g,\" \").trim().toUpperCase(),S=[...document.querySelectorAll(\".contract-symbol span\")].find(B=>{let j=m(B.textContent),$e=m(i);return j===$e||j.startsWith(m(o))});if(!S)return console.error(\"Breakeven: contract header not found\");let $=[...(S.closest(\".gm-scroll-view\")||S.closest(\".header\")||document).querySelectorAll(\".info-column\")].find(B=>/position/i.test(B.querySelector(\"small\")?.textContent||\"\"));if(!$){console.error(\"Breakeven: Position column not found\");return}let O=$.querySelector(\".number\"),V=O?.querySelector(\"span\"),fe=(O?.textContent||\"\").trim().match(/@([\\d.,]+)/);if(!fe){console.error(\"Breakeven: could not parse entry price from Position\");return}let ge=parseFloat(fe[1].replace(/,/g,\"\")),ee=1;if(V){let B=parseFloat(V.textContent.replace(/[^\\d.-]/g,\"\"));!isNaN(B)&&B!==0&&(ee=Math.abs(B))}let te=\"LONG\",ye=V?.classList||O?.classList||{contains:()=>!1};ye.contains(\"text-danger\")&&(te=\"SHORT\"),ye.contains(\"text-success\")&&(te=\"LONG\");let be=te===\"LONG\"?\"Sell\":\"Buy\";console.log(`Breakeven detected: side=${te}, qty=${ee}, entry=${ge}. Placing ${be} LIMIT at entry.`);let ie=document.getElementById(\"tpCheckbox\"),ce=document.getElementById(\"slCheckbox\"),Te=ie.checked,Ce=ce.checked;ie.checked=!1,ce.checked=!1;let Pe=(()=>{let j=(parseFloat(document.getElementById(\"tickInput\").value)||.25).toString();return j.includes(\".\")?j.length-j.indexOf(\".\")-1:0})();document.getElementById(\"entryPriceInput\").value=ge.toFixed(Pe),document.getElementById(\"qtyInput\").value=ee.toString(),[\"input\",\"change\",\"blur\"].forEach(B=>{document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(B,{bubbles:!0})),document.getElementById(\"qtyInput\").dispatchEvent(new Event(B,{bubbles:!0}))}),await K(o,ee,be,null,null,parseFloat(document.getElementById(\"tickInput\").value)||.25),ie.checked=Te,ce.checked=Ce,document.getElementById(\"entryPriceInput\").value=\"\",[\"input\",\"change\",\"blur\"].forEach(B=>document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(B,{bubbles:!0})))}catch(o){console.error(\"Breakeven action failed:\",o)}}),console.log(\"Setting up persistent settings\"),document.getElementById(\"symbolInput\").value=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\",document.getElementById(\"symbolInput\").addEventListener(\"input\",o=>{let i=o.target.value;console.log(`Symbol input changed to: ${i}`),localStorage.setItem(\"bracketTrade_symbol\",i),typeof s==\"function\"&&s({symbol:i},\"floating-ui\")}),document.getElementById(\"symbolInput\").addEventListener(\"change\",o=>{let i=o.target.value,m=H(i);console.log(`Symbol changed to: ${i}, normalized: ${m}`);let S=i.replace(/[A-Z]\\d+$/,\"\"),k=ue[S];if(k){console.log(`Found default values for ${S}: SL=${k.defaultSL}, TP=${k.defaultTP}`);let $=document.getElementById(\"slInput\"),O=document.getElementById(\"tpInput\"),V=document.getElementById(\"tickInput\");$.value=k.defaultSL,O.value=k.defaultTP,typeof k.tickSize==\"number\"&&(V.value=k.tickSize,localStorage.setItem(\"bracketTrade_tick\",k.tickSize),console.log(`Updated tick size to ${k.tickSize} for ${S}`)),localStorage.setItem(\"bracketTrade_sl\",k.defaultSL),localStorage.setItem(\"bracketTrade_tp\",k.defaultTP),console.log(`Updated SL/TP to default values for ${S}: SL=${$.value}, TP=${O.value}`)}me(\".search-box--input\",m),typeof s==\"function\"&&s({symbol:m,slTicks:k?.defaultSL,tpTicks:k?.defaultTP,tickSize:k?.tickSize},\"floating-ui\")}),document.getElementById(\"tickInput\").value=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",document.getElementById(\"tickInput\").addEventListener(\"input\",o=>{console.log(`Tick size input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_tick\",o.target.value),typeof s==\"function\"&&s({tickSize:f(o.target.value,.25)},\"floating-ui\")}),console.log(\"Setting up drag functionality\");let y=!1,w,A;t.addEventListener(\"mousedown\",o=>{console.log(\"Container mousedown event detected\"),y=!0,w=o.clientX-t.getBoundingClientRect().left,A=o.clientY-t.getBoundingClientRect().top,console.log(`Drag started at offset X:${w}, Y:${A}`),t.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",o=>{if(y){let i=`${o.clientX-w}px`,m=`${o.clientY-A}px`;o.clientX%20===0&&console.log(`Dragging panel to X:${i}, Y:${m}`),t.style.left=i,t.style.top=m,t.style.right=\"unset\",b()}}),document.addEventListener(\"mouseup\",()=>{y&&(console.log(`Container drop position: Left:${t.style.left}, Top:${t.style.top}`),localStorage.setItem(\"bracketTradeBoxLeft\",t.style.left),localStorage.setItem(\"bracketTradeBoxTop\",t.style.top)),y=!1,t.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=+q.value,m=+T.value,S=+I.value,k=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${o}, Qty=${i}, TP=${m}, SL=${S}, TickSize=${k}`),K(o,i,\"Buy\",m,S,k).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",i=+q.value,m=+T.value,S=+I.value,k=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${o}, Qty=${i}, TP=${m}, SL=${S}, TickSize=${k}`),K(o,i,\"Sell\",m,S,k).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}async function Q(e,n=\"cancel-option-Exit-at-Mkt-Cxl\"){let r={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},l={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},u=y=>(y||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),t=y=>new Promise(w=>setTimeout(w,y));async function p(y,{timeout:w=1200,interval:A=50}={}){let o=performance.now();for(;performance.now()-o<w;){let i=y();if(i)return i;await t(A)}return null}let x=n.toLowerCase(),a=r[x]||n,d=l[a]||null,b=u(e),c=/^[A-Z]{1,3}$/.test(b),v=[...document.querySelectorAll(\".header .contract-symbol span\")].find(y=>{let w=u(y.textContent);return w===b||c&&w.startsWith(b)});if(!v)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let g=v.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),C=g?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),I=g?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!g||!C||!I)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(d?d.test(u(C.textContent)):!1)return C.click(),!0;I.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let q=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(y=>y.offsetParent!==null||/display\\s*:\\s*block/i.test(y.getAttribute(\"style\")||\"\")||!!y.closest(\".open\")),z=await p(q,{timeout:900,interval:40});if(!z||!z.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let N=I.getBoundingClientRect();z.sort((y,w)=>{let A=y.getBoundingClientRect(),o=w.getBoundingClientRect(),i=Math.hypot(A.left-N.left,A.top-N.bottom),m=Math.hypot(o.left-N.left,o.top-N.bottom);return i-m});let D=z[0],E=document.getElementById(a);if(!E&&d){for(let y of z)if(E=[...y.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(w=>d.test(u(w.textContent))),E){D=y;break}}if(!E)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let U=E.tagName?E.matches(\"a,button\")?E:E.querySelector(\"a,button\")||E:E;return[\"mousedown\",\"mouseup\",\"click\"].forEach(y=>U.dispatchEvent(new MouseEvent(y,{bubbles:!0}))),I.click(),await t(120),z=q(),E=document.getElementById(a)||(d?z?.flatMap(y=>[...y.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(y=>d.test(u(y.textContent))):null),E?([\"mousedown\",\"mouseup\",\"click\"].forEach(y=>(E.querySelector(\"a,button\")||E).dispatchEvent(new MouseEvent(y,{bubbles:!0}))),await t(80),C.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function se(e=document){let n=[...e.querySelectorAll(\".databox.react-draggable.react-resizable\")].find(p=>p.offsetParent!==null);if(!n)return null;let u={timestamp:((p,x=n)=>{let a=x.querySelector(p);return a?a.textContent.trim():null})(\".header .title\")||null};return n.querySelectorAll(\".gm-scroll-view .entries li\").forEach(p=>{let x=p.querySelector(\".label\"),a=p.querySelector(\".desc\");if(!x||!a)return;let d=x.cloneNode(!0);d.querySelectorAll(\"span\").forEach(C=>C.remove());let b=(d.textContent||\"\").trim().toLowerCase().replace(/[^a-z0-9]/g,\"\"),c=(a.textContent||\"\").trim(),h={open:\"open\",high:\"high\",low:\"low\",close:\"close\",volume:\"volume\",atr:\"atr\",vwap:\"vwap\",upperband1:\"upperBand1\",lowerband1:\"lowerBand1\",upperband2:\"upperBand2\",lowerband2:\"lowerBand2\"}[b]||b,g=c.replace(/,/g,\"\");h===\"volume\"?g=Number.parseInt(g,10):g=Number.parseFloat(g),u[h]=Number.isNaN(g)?c:g}),u}document.querySelectorAll(\"#bracket-trade-box, #bracket-trade-tray\").forEach(e=>e.remove()),J(),console.log(\"UI creation complete\");async function me(e,n){console.log(`updateSymbol called with selector: \"${e}\", value: \"${n}\"`);let r=document.querySelectorAll(e);console.log(`Found ${r.length} matching inputs`);let l=r[1]||r[0];if(!l){console.error(\"No matching input elements found!\");return}console.log(\"Selected input:\",l);let u=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,t=p=>l.dispatchEvent(new KeyboardEvent(p,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),u.call(l,\"\"),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await L(400),console.log(`Setting input value to: \"${n}\"`),u.call(l,n),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await L(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(t),l.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function Re(e){let n=\"input.form-control\";for(let r=0;r<20;r++){let l=document.querySelector(n);if(l&&l.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(l,e),[\"input\",\"change\",\"blur\"].forEach(t=>l.dispatchEvent(new Event(t,{bubbles:!0}))),await L(300);return}await L(100)}console.error(\"Price input not found\")}function H(e){console.log(`normalizeSymbol called with: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${n}`);let r=n?xe(e):e.toUpperCase();return console.log(`Normalized symbol: \"${r}\"`),r}async function ke(e){console.log(\"Creating bracket orders with data:\",e);let n=typeof e.tpEnabled==\"boolean\"?e.tpEnabled:document.getElementById(\"tpCheckbox\")?.checked??!0,r=typeof e.slEnabled==\"boolean\"?e.slEnabled:document.getElementById(\"slCheckbox\")?.checked??!0;console.log(`TP enabled: ${n}, SL enabled: ${r}`);async function l(a,d){let b=[...document.querySelectorAll(\".trading-ticket\")].find(g=>g.offsetParent);if(!b)return console.error(\"No visible trading ticket\");let c;for(let g=0;g<25&&(c=[...b.querySelectorAll(a)].find(C=>C.offsetParent&&!C.disabled),!c);g++)await L(100);if(!c)return console.error(`No live input for ${a}`);let v=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,h=c.closest(\".select-input.combobox\");h&&!c.value&&(h.querySelector(\".btn\")?.click(),await L(150),h.querySelector(\".dropdown-menu li\")?.click(),await L(150));for(let g=0;g<3&&(c.focus(),v.call(c,d),c.dispatchEvent(new Event(\"input\",{bubbles:!0})),c.dispatchEvent(new Event(\"change\",{bubbles:!0})),c.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),c.blur(),await L(250),`${c.value}`.trim()!==`${d}`);g++);}async function u(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let a=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${a.length} action labels`),a.forEach(d=>{d.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),d.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await l(\".select-input.combobox input\",e.qty))}function t(a=document){let d=a.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(d,b=>{let c=b.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),v=c[0]?.textContent.trim()||\"\",h=c[1]?.textContent.trim()||\"\",g=c[2]?.textContent.trim()||\"\",C=c[3]?.textContent.trim()||\"\",I=null,T=g.match(/@([\\d.]+)/);return T&&(I=Number(T[1])),{timestamp:v,id:h,event:g,comment:C,fillPrice:I}})}function p(a=\"up\"){let d=document.querySelector(\".numeric-input-value-controls\");if(!d)return;d.querySelector(a===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function x(a,d){await u(),document.querySelector(\".group.order-type .select-input div[tabindex]\")?.click(),[...document.querySelectorAll(\"ul.dropdown-menu li\")].find(c=>c.textContent.trim()===a)?.click(),d&&await l(\".numeric-input.feedback-wrapper input\",d),p(),document.querySelector(\".btn-group .btn-primary\")?.click(),await L(200),console.log(t()),document.querySelector(\".icon.icon-back\")?.click(),await L(200)}return console.log(`Submitting initial ${e.orderType||\"MARKET\"} order`),await x(e.orderType||\"MARKET\",e.entryPrice),e.action===\"Buy\"?(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await x(\"LIMIT\",e.takeProfit)),r&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await x(\"STOP\",e.stopLoss))):(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await x(\"LIMIT\",e.takeProfit)),r&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await x(\"STOP\",e.stopLoss))),console.log(\"Bracket order creation complete\"),Promise.resolve()}function Qe(e=document){let n=e.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(n,r=>{let l=r.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),u=l[0]?.textContent.trim()||\"\",t=l[1]?.textContent.trim()||\"\",p=l[2]?.textContent.trim()||\"\",x=l[3]?.textContent.trim()||\"\",a=null,d=p.match(/@([\\d.]+)/);return d&&(a=Number(d[1])),{timestamp:u,id:t,event:p,comment:x,fillPrice:a}})}let ue={MNQ:{tickSize:.25,tickValue:.5,defaultSL:40,defaultTP:100,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:40,defaultTP:100,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function K(e,n=1,r=\"Buy\",l=null,u=null,t=.25){console.log(`autoTrade called with: symbol=${e}, qty=${n}, action=${r}, TP=${l}, SL=${u}, tickSize=${t}`);let p={};e&&(p.symbol=e),typeof n==\"number\"&&!Number.isNaN(n)&&(p.quantity=n),l!=null&&(p.tpTicks=l),u!=null&&(p.slTicks=u),t!=null&&(p.tickSize=t);let x=ne(p,\"autoTrade\"),{symbol:a,quantity:d,tpTicks:b,slTicks:c,tickSize:v,entryPrice:h,tpPrice:g,slPrice:C,tpEnabled:I,slEnabled:T}=x,q=a||\"NQ\";console.log(`Using symbol: ${q}`);let z=q.replace(/[A-Z]\\d+$/,\"\")||q;console.log(`Root symbol: ${z}`);let N=ue[z]||{},D=Number.isFinite(v)?v:typeof N.tickSize==\"number\"?N.tickSize:f(t,.25);Number.isFinite(D)||(D=.25);let E=T?f(c,N.defaultSL??40):0,U=I?f(b,N.defaultTP??100):0,y=f(d,1);console.log(`Using tick size ${D}`),console.log(`Effective SL: ${E} ticks, TP: ${U} ticks`),console.log(`Getting market data for ${q}`);let w=Se(q);if(!w){console.error(`No market data for ${q}`);return}console.log(\"Market data:\",w);let A=parseFloat(r===\"Buy\"?w.offerPrice:w.bidPrice);console.log(`Market price: ${A} (${r===\"Buy\"?\"offer\":\"bid\"} price)`);let o=Number.isFinite(h)?h:null,i=A,m=\"MARKET\";o!==null?(console.log(`Custom entry price provided: ${o}`),i=o,r===\"Buy\"?m=o<A?\"LIMIT\":\"STOP\":m=o>A?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${m}`)):console.log(`No custom entry price provided, using market order at ${A}`);let S=Number.isFinite(N.precision)?N.precision:2;console.log(`Using price precision: ${S} decimal places`);let k=T?Number.isFinite(C)?C:r===\"Buy\"?i-E*D:i+E*D:null,$=I?Number.isFinite(g)?g:r===\"Buy\"?i+U*D:i-U*D:null,O=k!=null?k.toFixed(S):null,V=$!=null?$.toFixed(S):null;typeof s==\"function\"&&s({symbol:q,quantity:y,tpTicks:U,slTicks:E,tickSize:D,entryPrice:o,tpPrice:$??null,slPrice:k,tpEnabled:I,slEnabled:T},\"autoTrade-final\");let re={symbol:w.symbol,action:r,qty:String(y),takeProfit:V,stopLoss:O,orderType:m,entryPrice:m!==\"MARKET\"&&i!=null?i.toFixed(S):null,tpEnabled:I,slEnabled:T};return console.log(\"Trade data prepared:\",re),console.log(\"Submitting bracket orders\"),ke(re).finally(()=>{})}function xe(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:n,yearDigit:r}=de();console.log(`Got quarterly code: letter=${n}, yearDigit=${r}`);let l=`${e.toUpperCase()}${n}${r}`;return console.log(`Returning front quarter symbol: \"${l}\"`),l}function Se(e){console.log(`getMarketData called for: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e)?H(e):e.toUpperCase(),r=ve(n);if(!r)return console.log(`Cannot Find ${e}`),null;let l=r.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),u=l[4]?.textContent.trim(),t=l[5]?.textContent.trim();return{symbol:n,bidPrice:u,offerPrice:t}}function ve(e){let n=/^[A-Z]{1,3}$/.test((e||\"\").trim()),r=n?null:p(e),l=n?p(e):null,u=document.querySelectorAll(\".quoteboard.module.data-table, .data-table, .quoteboard\"),t=u.length?u:[document];for(let x of t){let a=x.querySelectorAll(\".public_fixedDataTable_bodyRow\");for(let d of a){if(d.offsetParent===null)continue;let b=d.querySelector(\".public_fixedDataTableCell_cellContent\");if(!b)continue;let c=p(b.textContent);if(r&&c===r||l&&c.startsWith(l))return d}}return console.error(`findQuoteRow: row for \"${e}\" not found (visible area).`),null;function p(x){return String(x||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase()}}let Ee=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function _e(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let n=Ee[e.getUTCMonth()],r=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${n}, yearDigit=${r}`),{letter:n,yearDigit:r}}function W(e=new Date){console.log(`getNQFrontMonth called with date: ${e.toISOString()}`);let n=[3,6,9,12],r=[\"H\",\"M\",\"U\",\"Z\"],l=e.getFullYear(),u=e.getMonth()+1,t=e.getDate();console.log(`Current date: ${l}-${u}-${t}`);for(let a=0;a<n.length;a++){let d=n[a],b=Y(l,d),c=new Date(b);if(c.setDate(b.getDate()-4),console.log(`Checking ${r[a]} contract: expiry=${b.toISOString()}, roll=${c.toISOString()}`),e<c){let v=`NQ${r[a]}${String(l).slice(-2)}`;return console.log(`Current front month: ${v} (before roll date)`),{symbol:v,letter:r[a],yearDigit:String(l).slice(-2),expiry:b,rollDate:c,isRollPeriod:!1}}else if(e<b){let v=(a+1)%4,h=v>a?l:l+1,g=`NQ${r[v]}${String(h).slice(-2)}`;return console.log(`Front month during roll period: ${g}`),{symbol:g,letter:r[v],yearDigit:String(h).slice(-2),expiry:Y(h,n[v]),rollDate:c,isRollPeriod:!0}}}let p=l+1,x=`NQ${r[0]}${String(p).slice(-2)}`;return console.log(`Moving to next year: ${x}`),{symbol:x,letter:r[0],yearDigit:String(p).slice(-2),expiry:Y(p,n[0]),rollDate:null,isRollPeriod:!1}}function Y(e,n){let l=(5-new Date(e,n-1,1).getDay()+7)%7,u=new Date(e,n-1,1+l),t=new Date(u);return t.setDate(u.getDate()+14),t}function de(e=new Date){console.log(`getQuarterlyCode called (legacy) with date: ${e.toISOString()}`);let n=W(e);return console.log(`Legacy getQuarterlyCode returning: letter=${n.letter}, yearDigit=${n.yearDigit}`),{letter:n.letter,yearDigit:String(n.yearDigit).slice(-1)}}console.log(\"Calculating current NQ front month using CME rules...\");let X=W();console.log(`Current NQ front month: ${X.symbol}`),console.log(`Expiry date: ${X.expiry.toISOString()}`),console.log(`Roll date: ${X.rollDate?X.rollDate.toISOString():\"N/A\"}`),console.log(`Is in roll period: ${X.isRollPeriod}`);let{letter:we,yearDigit:he}=de(),Ie=`NQ${we}${he}`;console.log(`Legacy front-quarter symbol: ${Ie}`),window.getNQFrontMonth=W,window.getThirdFriday=Y;function pe(){console.warn(\"[TradoAuto] moveStopLossToBreakeven is not implemented in this build\")}let G={init:()=>{console.log(\"[TradoAuto] legacy driver init\")},autoTrade:K,clickExitForSymbol:Q,moveStopLossToBreakeven:pe,createUI:J,getNQFrontMonth:W,getThirdFriday:Y,getState:()=>typeof P==\"function\"?P():{},applyConfig:(e={},n=\"external\")=>typeof s==\"function\"?s(e,n):{},subscribeState:e=>typeof F==\"function\"?F(e):()=>{}},_=typeof unsafeWindow<\"u\"?unsafeWindow:window;console.log(\"[TradoAuto] installing legacy driver onto window/unsafeWindow\"),window.TradoAuto=G,_.TradoAuto=G,_.TradovateAutoDriverBundle={default:G,autoTrade:K,clickExitForSymbol:Q,moveStopLossToBreakeven:pe,createUI:J,getNQFrontMonth:W,getThirdFriday:Y},_.__tradoAutoInterval||(_.__tradoAutoInterval=setInterval(()=>{(!_.TradoAuto||typeof _.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on targetWindow\"),_.TradoAuto=G),(!window.TradoAuto||typeof window.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on window\"),window.TradoAuto=G)},250),console.log(\"[TradoAuto] watchdog interval started\"))})();function ze(){return typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto}var De=typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto;return Ne(Oe);})();\n//# sourceMappingURL=tradovate_auto_driver.js.map\n";
    const panelSource = "var TradovateUIPanelBundle=(()=>{var ke=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Re=Object.getOwnPropertyNames;var De=Object.prototype.hasOwnProperty;var Oe=(E,$)=>{for(var r in $)ke(E,r,{get:$[r],enumerable:!0})},Qe=(E,$,r,A)=>{if(__UI_PANEL_BUNDLE__&typeof $==\"object\"||typeof $==\"function\")for(let d of Re($))!De.call(E,d)&&d!==r&&ke(E,d,{get:()=>$[d],enumerable:!(A=Me($,d))||A.enumerable});return E};var Ue=E=>Qe(ke({},\"__esModule\",{value:!0}),E);var Ye={};Oe(Ye,{createUIPanel:()=>Ce,default:()=>Ve});function _e(E={}){let r={...{symbol:\"NQ\",quantity:1,tpTicks:120,slTicks:40,tpEnabled:!0,slEnabled:!0,tickSize:.25,entryPrice:null,lastSource:\"init\",lastUpdated:Date.now()},...E},A=new Set;function d(){for(let M of A)try{M({...r})}catch(G){console.warn(\"[DriverStore] listener error\",G)}}function O(){return{...r}}function te(M={},G=\"unknown\"){let I={...r,...M,lastSource:G,lastUpdated:Date.now()};return Object.keys(I).some(f=>I[f]!==r[f])&&(r=I,d()),r}function Q(M){return A.add(M),M({...r}),()=>A.delete(M)}return{getState:O,applyUpdate:te,subscribe:Q}}typeof window<\"u\"&&(window.TradoAutoState||(window.TradoAutoState=_e()));(function(){let E=window.TradoAutoState&&typeof window.TradoAutoState.getState==\"function\"?window.TradoAutoState:M();window.TradoAutoState=E;let{getState:$,applyUpdate:r,subscribe:A}=E;function d(e,n=null){let i=typeof e==\"string\"?parseFloat(e):e;return Number.isFinite(i)?i:n}function O(){let e=i=>{let l=document.getElementById(i);return l?l.value:void 0},n=i=>{let l=document.getElementById(i);return l?!!l.checked:void 0};return{symbol:e(\"symbolInput\"),quantity:d(e(\"qtyInput\")),tpTicks:d(e(\"tpInput\")),slTicks:d(e(\"slInput\")),tickSize:d(e(\"tickInput\")),entryPrice:d(e(\"entryPriceInput\")),tpPrice:d(e(\"tpPriceInput\")),slPrice:d(e(\"slPriceInput\")),tpEnabled:n(\"tpCheckbox\"),slEnabled:n(\"slCheckbox\")}}function te(e={},n=\"autoTrade-call\"){let i=typeof $==\"function\"?$():{},t={...{...O(),...i}};return e.symbol&&(t.symbol=e.symbol),typeof e.quantity==\"number\"&&(t.quantity=e.quantity),typeof e.tpTicks==\"number\"&&(t.tpTicks=e.tpTicks),typeof e.slTicks==\"number\"&&(t.slTicks=e.slTicks),typeof e.tickSize==\"number\"&&(t.tickSize=e.tickSize),e.entryPrice!=null&&(t.entryPrice=e.entryPrice),e.tpEnabled!=null&&(t.tpEnabled=e.tpEnabled),e.slEnabled!=null&&(t.slEnabled=e.slEnabled),e.tpPrice!=null&&(t.tpPrice=e.tpPrice),e.slPrice!=null&&(t.slPrice=e.slPrice),t.symbol=(t.symbol||\"NQ\").toUpperCase(),t.quantity=d(t.quantity,1),t.tpTicks=d(t.tpTicks,120),t.slTicks=d(t.slTicks,40),t.tickSize=d(t.tickSize,.25),t.entryPrice=t.entryPrice!=null?d(t.entryPrice):null,t.tpPrice=t.tpPrice!=null?d(t.tpPrice):null,t.slPrice=t.slPrice!=null?d(t.slPrice):null,t.tpEnabled=typeof t.tpEnabled==\"boolean\"?t.tpEnabled:!0,t.slEnabled=typeof t.slEnabled==\"boolean\"?t.slEnabled:!0,t.lastSource=n,typeof r==\"function\"&&r(t,n),t}function Q(e){if(!e)return;let n=(l,u)=>{let t=document.getElementById(l);if(!t)return;let y=u??\"\";t.value!==String(y)&&(t.value=y)},i=(l,u)=>{let t=document.getElementById(l);!t||typeof u!=\"boolean\"||t.checked!==u&&(t.checked=u)};n(\"symbolInput\",e.symbol),n(\"qtyInput\",e.quantity),n(\"tpInput\",e.tpTicks),n(\"slInput\",e.slTicks),n(\"tickInput\",e.tickSize),n(\"entryPriceInput\",e.entryPrice),n(\"tpPriceInput\",e.tpPrice),n(\"slPriceInput\",e.slPrice),i(\"tpCheckbox\",e.tpEnabled),i(\"slCheckbox\",e.slEnabled)}typeof A==\"function\"&&A(Q);let{createDriverStore:M}=window.TradoAutoState||{};console.log(\"Auto Order script initialized\");var G=!1;function I(e){return console.log(`Delaying for ${e}ms`),new Promise(n=>setTimeout(n,e))}function U(){console.log(\"Creating UI\");let e=localStorage.getItem(\"bracketTrade_tp\")||\"120\",n=localStorage.getItem(\"bracketTrade_sl\")||\"40\",i=localStorage.getItem(\"bracketTrade_qty\")||\"9\",l=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",u=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\";console.log(`Stored values: TP=${e}, SL=${n}, Qty=${i}, Tick=${l}, Symbol=${u}`);let t=document.createElement(\"div\");t.id=\"bracket-trade-box\",Object.assign(t.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"});let y=0,w=0;y&&w?(t.style.left=y,t.style.top=w):(t.style.top=\"20px\",t.style.right=\"20px\"),t.innerHTML=`\n    <!-- Header with Symbol -->\n    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n        <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n        <input type=\"text\" id=\"symbolInput\" value=\"${u}\"\n            style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n            placeholder=\"Symbol\" />\n    </div>\n\n    <!-- Hidden Tick Size Input -->\n    <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n        <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n        <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${l}\"\n            style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n    </div>\n\n    <!-- Main Controls -->\n    <div id=\"mainControls\">\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"tpInput\" value=\"${e}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Ticks\" />\n                <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"TP Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n            <div style=\"display:flex;gap:4px;flex:1;\">\n                <input type=\"number\" id=\"slInput\" value=\"${n}\" step=\"1\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Ticks\" />\n                <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                    style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                    placeholder=\"SL Price\" />\n            </div>\n        </div>\n        <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n            <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n            <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                <input type=\"number\" id=\"qtyInput\" value=\"${i}\" min=\"1\"\n                    style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n            </div>\n            <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n        </div>\n        <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n            <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n            <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n        </div>\n\n        <!-- NEW: Breakeven button above Reverse -->\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n        </div>\n\n        <div style=\"display:flex;gap:10px;margin-top:6px;\">\n            <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n        </div>\n    </div>`,document.body.appendChild(t),console.log(\"UI container added to DOM\");let s=document.createElement(\"div\");s.id=\"bracket-trade-tray\",Object.assign(s.style,{position:\"fixed\",top:t.style.top||\"20px\",left:\"0px\",background:\"#24262b\",border:\"1px solid #444\",padding:\"10px\",borderRadius:\"8px\",boxShadow:\"0 2px 10px rgba(0,0,0,0.4)\",color:\"#fff\",width:\"140px\",zIndex:\"99999\",display:\"none\"}),s.innerHTML=`\n      <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\n        <div style=\"font-weight:600;\">Price Tray</div>\n        <button id=\"trayCloseBtn\" title=\"Hide\"\n          style=\"background:#333;border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;\">\\xD7</button>\n      </div>\n      <div style=\"display:flex;flex-direction:column;gap:6px\">\n        <button id=\"tray-btn-high\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">High</button>\n        <button id=\"tray-btn-low\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Low</button>\n        <button id=\"tray-btn-open\"  style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Open</button>\n        <button id=\"tray-btn-close\" style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Close</button>\n        <button id=\"tray-btn-mid\"   style=\"padding:6px;border:1px solid #555;background:#2a2d34;color:#fff;border-radius:6px;text-align:left;\">Middle</button>\n      </div>\n    `,document.body.appendChild(s);let p=document.createElement(\"button\");p.id=\"trayToggle\",p.textContent=\"\\u25C2 O/L/H/C/M\",Object.assign(p.style,{position:\"absolute\",right:\"-92px\",top:\"0\",height:\"32px\",background:\"#30343b\",color:\"#fff\",border:\"1px solid #444\",borderRadius:\"0 8px 8px 0\",padding:\"4px 8px\",cursor:\"pointer\"}),t.appendChild(p);function k(){let o=t.getBoundingClientRect();s.style.top=`${o.top}px`,s.style.left=`${o.right+8}px`}k(),window.addEventListener(\"resize\",k),p.addEventListener(\"click\",()=>{k(),s.style.display=s.style.display===\"none\"?\"block\":\"none\"}),s.querySelector(\"#trayCloseBtn\")?.addEventListener(\"click\",()=>{s.style.display=\"none\"});let a=null;function C(){let o=(document.getElementById(\"tickInput\")?.value||\"\").toString(),c=o.indexOf(\".\");return c===-1?0:o.length-c-1}setInterval(()=>{try{if(typeof ce==\"function\"){if(a=ce(),a){let o={open:[\"tray-btn-open\",\"Open\"],low:[\"tray-btn-low\",\"Low\"],high:[\"tray-btn-high\",\"High\"],close:[\"tray-btn-close\",\"Close\"]};for(let[v,[T,S]]of Object.entries(o)){let R=document.getElementById(T);if(!R)continue;let Z=a[v];R.title=Z!=null?`${S}: ${Z}`:`${S}: \\u2014`}let c=document.getElementById(\"tray-btn-mid\");if(c){let v=a.open,T=a.close;if(typeof v==\"number\"&&typeof T==\"number\"){let S=C(),R=((v+T)/2).toFixed(S);c.title=`Mid (O+C)/2: ${R}`}else c.title=\"Mid (O+C)/2: \\u2014\"}}k()}}catch(o){console.warn(\"extractTradovateDataBox polling error:\",o)}},500);function q(o){let c=document.getElementById(\"entryPriceInput\");if(!c||o==null)return;Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(c,o),[\"input\",\"change\",\"blur\"].forEach(T=>c.dispatchEvent(new Event(T,{bubbles:!0})))}function m(o){if(!a||a[o]==null){console.warn(`No ${o} available from databox`);return}q(a[o])}function F(){if(!a||typeof a.open!=\"number\"||typeof a.close!=\"number\"){console.warn(\"Mid price unavailable (need open & close)\");return}let o=C(),c=((a.high+a.low)/2).toFixed(o);q(c)}document.getElementById(\"tray-btn-open\")?.addEventListener(\"click\",()=>m(\"open\")),document.getElementById(\"tray-btn-low\")?.addEventListener(\"click\",()=>m(\"low\")),document.getElementById(\"tray-btn-high\")?.addEventListener(\"click\",()=>m(\"high\")),document.getElementById(\"tray-btn-close\")?.addEventListener(\"click\",()=>m(\"close\")),document.getElementById(\"tray-btn-mid\")?.addEventListener(\"click\",F),console.log(\"Setting up UI event handlers\");let N=document.getElementById(\"slInput\"),z=document.getElementById(\"tpInput\"),H=document.getElementById(\"qtyInput\");document.getElementById(\"slInput\").addEventListener(\"input\",()=>{console.log(`SL input changed to: ${N.value}`);let o=parseFloat(N.value);isNaN(o)||(z.value=o*3,console.log(`Calculated TP: ${z.value} (SL \\xD7 3)`)),localStorage.setItem(\"bracketTrade_sl\",N.value),localStorage.setItem(\"bracketTrade_tp\",z.value),typeof r==\"function\"&&r({slTicks:d(N.value),tpTicks:d(z.value)},\"floating-ui\")}),z.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${z.value}`),localStorage.setItem(\"bracketTrade_tp\",z.value),typeof r==\"function\"&&r({tpTicks:d(z.value)},\"floating-ui\")}),document.getElementById(\"qtyInput\").addEventListener(\"input\",o=>{console.log(`Quantity input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_qty\",o.target.value),typeof r==\"function\"&&r({quantity:d(o.target.value,1)},\"floating-ui\")}),document.getElementById(\"tpCheckbox\")?.addEventListener(\"change\",o=>{typeof r==\"function\"&&r({tpEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"slCheckbox\")?.addEventListener(\"change\",o=>{typeof r==\"function\"&&r({slEnabled:!!o.target.checked},\"floating-ui\")}),document.getElementById(\"entryPriceInput\")?.addEventListener(\"input\",o=>{typeof r==\"function\"&&r({entryPrice:d(o.target.value)},\"floating-ui\")}),document.getElementById(\"tpPriceInput\")?.addEventListener(\"input\",o=>{typeof r==\"function\"&&r({tpPrice:d(o.target.value)},\"floating-ui\")}),document.getElementById(\"slPriceInput\")?.addEventListener(\"input\",o=>{typeof r==\"function\"&&r({slPrice:d(o.target.value)},\"floating-ui\")}),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=X(o);console.log(`Calling clickExitForSymbol for: ${c} with Exit at Mkt & Cxl option`),f(c,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",c)}catch(o){console.error(\"Close All operation failed:\",o);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(c){console.error(\"Fallback close method also failed:\",c)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=X(o);console.log(`Calling clickExitForSymbol for: ${c} with Cancel All option`),f(c,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",c)}catch(o){console.error(\"Cancel All operation failed:\",o)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=X(o);console.log(`Calling clickExitForSymbol for: ${c} with Reverse & Cxl option`),f(c,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",c)}catch(o){console.error(\"Reverse Position operation failed:\",o)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",async()=>{console.log(\"Breakeven button clicked\");try{let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=X(o);console.log(`Breakeven for symbol: ${c}`);let v=D=>(D||\"\").replace(/\\s+/g,\" \").trim().toUpperCase(),T=[...document.querySelectorAll(\".contract-symbol span\")].find(D=>{let se=v(D.textContent),Fe=v(c);return se===Fe||se.startsWith(v(o))});if(!T)return console.error(\"Breakeven: contract header not found\");let R=[...(T.closest(\".gm-scroll-view\")||T.closest(\".header\")||document).querySelectorAll(\".info-column\")].find(D=>/position/i.test(D.querySelector(\"small\")?.textContent||\"\"));if(!R){console.error(\"Breakeven: Position column not found\");return}let Z=R.querySelector(\".number\"),ie=Z?.querySelector(\"span\"),he=(Z?.textContent||\"\").trim().match(/@([\\d.,]+)/);if(!he){console.error(\"Breakeven: could not parse entry price from Position\");return}let we=parseFloat(he[1].replace(/,/g,\"\")),ge=1;if(ie){let D=parseFloat(ie.textContent.replace(/[^\\d.-]/g,\"\"));!isNaN(D)&&D!==0&&(ge=Math.abs(D))}let ye=\"LONG\",Te=ie?.classList||Z?.classList||{contains:()=>!1};Te.contains(\"text-danger\")&&(ye=\"SHORT\"),Te.contains(\"text-success\")&&(ye=\"LONG\");let $e=ye===\"LONG\"?\"Sell\":\"Buy\";console.log(`Breakeven detected: side=${ye}, qty=${ge}, entry=${we}. Placing ${$e} LIMIT at entry.`);let me=document.getElementById(\"tpCheckbox\"),xe=document.getElementById(\"slCheckbox\"),qe=me.checked,Ne=xe.checked;me.checked=!1,xe.checked=!1;let ze=(()=>{let se=(parseFloat(document.getElementById(\"tickInput\").value)||.25).toString();return se.includes(\".\")?se.length-se.indexOf(\".\")-1:0})();document.getElementById(\"entryPriceInput\").value=we.toFixed(ze),document.getElementById(\"qtyInput\").value=ge.toString(),[\"input\",\"change\",\"blur\"].forEach(D=>{document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(D,{bubbles:!0})),document.getElementById(\"qtyInput\").dispatchEvent(new Event(D,{bubbles:!0}))}),await P(o,ge,$e,null,null,parseFloat(document.getElementById(\"tickInput\").value)||.25),me.checked=qe,xe.checked=Ne,document.getElementById(\"entryPriceInput\").value=\"\",[\"input\",\"change\",\"blur\"].forEach(D=>document.getElementById(\"entryPriceInput\").dispatchEvent(new Event(D,{bubbles:!0})))}catch(o){console.error(\"Breakeven action failed:\",o)}}),console.log(\"Setting up persistent settings\"),document.getElementById(\"symbolInput\").value=localStorage.getItem(\"bracketTrade_symbol\")||\"NQ\",document.getElementById(\"symbolInput\").addEventListener(\"input\",o=>{let c=o.target.value;console.log(`Symbol input changed to: ${c}`),localStorage.setItem(\"bracketTrade_symbol\",c),typeof r==\"function\"&&r({symbol:c},\"floating-ui\")}),document.getElementById(\"symbolInput\").addEventListener(\"change\",o=>{let c=o.target.value,v=X(c);console.log(`Symbol changed to: ${c}, normalized: ${v}`);let T=c.replace(/[A-Z]\\d+$/,\"\"),S=h[T];if(S){console.log(`Found default values for ${T}: SL=${S.defaultSL}, TP=${S.defaultTP}`);let R=document.getElementById(\"slInput\"),Z=document.getElementById(\"tpInput\"),ie=document.getElementById(\"tickInput\");R.value=S.defaultSL,Z.value=S.defaultTP,typeof S.tickSize==\"number\"&&(ie.value=S.tickSize,localStorage.setItem(\"bracketTrade_tick\",S.tickSize),console.log(`Updated tick size to ${S.tickSize} for ${T}`)),localStorage.setItem(\"bracketTrade_sl\",S.defaultSL),localStorage.setItem(\"bracketTrade_tp\",S.defaultTP),console.log(`Updated SL/TP to default values for ${T}: SL=${R.value}, TP=${Z.value}`)}oe(\".search-box--input\",v),typeof r==\"function\"&&r({symbol:v,slTicks:S?.defaultSL,tpTicks:S?.defaultTP,tickSize:S?.tickSize},\"floating-ui\")}),document.getElementById(\"tickInput\").value=localStorage.getItem(\"bracketTrade_tick\")||\"0.25\",document.getElementById(\"tickInput\").addEventListener(\"input\",o=>{console.log(`Tick size input changed to: ${o.target.value}`),localStorage.setItem(\"bracketTrade_tick\",o.target.value),typeof r==\"function\"&&r({tickSize:d(o.target.value,.25)},\"floating-ui\")}),console.log(\"Setting up drag functionality\");let x=!1,L,_;t.addEventListener(\"mousedown\",o=>{console.log(\"Container mousedown event detected\"),x=!0,L=o.clientX-t.getBoundingClientRect().left,_=o.clientY-t.getBoundingClientRect().top,console.log(`Drag started at offset X:${L}, Y:${_}`),t.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",o=>{if(x){let c=`${o.clientX-L}px`,v=`${o.clientY-_}px`;o.clientX%20===0&&console.log(`Dragging panel to X:${c}, Y:${v}`),t.style.left=c,t.style.top=v,t.style.right=\"unset\",k()}}),document.addEventListener(\"mouseup\",()=>{x&&(console.log(`Container drop position: Left:${t.style.left}, Top:${t.style.top}`),localStorage.setItem(\"bracketTradeBoxLeft\",t.style.left),localStorage.setItem(\"bracketTradeBoxTop\",t.style.top)),x=!1,t.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=+H.value,v=+z.value,T=+N.value,S=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${o}, Qty=${c}, TP=${v}, SL=${T}, TickSize=${S}`),P(o,c,\"Buy\",v,T,S).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let o=document.getElementById(\"symbolInput\").value||\"NQ\",c=+H.value,v=+z.value,T=+N.value,S=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${o}, Qty=${c}, TP=${v}, SL=${T}, TickSize=${S}`),P(o,c,\"Sell\",v,T,S).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}async function f(e,n=\"cancel-option-Exit-at-Mkt-Cxl\"){let i={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},l={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},u=x=>(x||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),t=x=>new Promise(L=>setTimeout(L,x));async function y(x,{timeout:L=1200,interval:_=50}={}){let o=performance.now();for(;performance.now()-o<L;){let c=x();if(c)return c;await t(_)}return null}let w=n.toLowerCase(),s=i[w]||n,p=l[s]||null,k=u(e),a=/^[A-Z]{1,3}$/.test(k),C=[...document.querySelectorAll(\".header .contract-symbol span\")].find(x=>{let L=u(x.textContent);return L===k||a&&L.startsWith(k)});if(!C)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let m=C.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),F=m?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),N=m?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!m||!F||!N)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(p?p.test(u(F.textContent)):!1)return F.click(),!0;N.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let H=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(x=>x.offsetParent!==null||/display\\s*:\\s*block/i.test(x.getAttribute(\"style\")||\"\")||!!x.closest(\".open\")),K=await y(H,{timeout:900,interval:40});if(!K||!K.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let j=N.getBoundingClientRect();K.sort((x,L)=>{let _=x.getBoundingClientRect(),o=L.getBoundingClientRect(),c=Math.hypot(_.left-j.left,_.top-j.bottom),v=Math.hypot(o.left-j.left,o.top-j.bottom);return c-v});let W=K[0],B=document.getElementById(s);if(!B&&p){for(let x of K)if(B=[...x.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(L=>p.test(u(L.textContent))),B){W=x;break}}if(!B)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let re=B.tagName?B.matches(\"a,button\")?B:B.querySelector(\"a,button\")||B:B;return[\"mousedown\",\"mouseup\",\"click\"].forEach(x=>re.dispatchEvent(new MouseEvent(x,{bubbles:!0}))),N.click(),await t(120),K=H(),B=document.getElementById(s)||(p?K?.flatMap(x=>[...x.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(x=>p.test(u(x.textContent))):null),B?([\"mousedown\",\"mouseup\",\"click\"].forEach(x=>(B.querySelector(\"a,button\")||B).dispatchEvent(new MouseEvent(x,{bubbles:!0}))),await t(80),F.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function ce(e=document){let n=[...e.querySelectorAll(\".databox.react-draggable.react-resizable\")].find(y=>y.offsetParent!==null);if(!n)return null;let u={timestamp:((y,w=n)=>{let s=w.querySelector(y);return s?s.textContent.trim():null})(\".header .title\")||null};return n.querySelectorAll(\".gm-scroll-view .entries li\").forEach(y=>{let w=y.querySelector(\".label\"),s=y.querySelector(\".desc\");if(!w||!s)return;let p=w.cloneNode(!0);p.querySelectorAll(\"span\").forEach(F=>F.remove());let k=(p.textContent||\"\").trim().toLowerCase().replace(/[^a-z0-9]/g,\"\"),a=(s.textContent||\"\").trim(),q={open:\"open\",high:\"high\",low:\"low\",close:\"close\",volume:\"volume\",atr:\"atr\",vwap:\"vwap\",upperband1:\"upperBand1\",lowerband1:\"lowerBand1\",upperband2:\"upperBand2\",lowerband2:\"lowerBand2\"}[k]||k,m=a.replace(/,/g,\"\");q===\"volume\"?m=Number.parseInt(m,10):m=Number.parseFloat(m),u[q]=Number.isNaN(m)?a:m}),u}document.querySelectorAll(\"#bracket-trade-box, #bracket-trade-tray\").forEach(e=>e.remove()),U(),console.log(\"UI creation complete\");async function oe(e,n){console.log(`updateSymbol called with selector: \"${e}\", value: \"${n}\"`);let i=document.querySelectorAll(e);console.log(`Found ${i.length} matching inputs`);let l=i[1]||i[0];if(!l){console.error(\"No matching input elements found!\");return}console.log(\"Selected input:\",l);let u=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,t=y=>l.dispatchEvent(new KeyboardEvent(y,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),u.call(l,\"\"),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await I(400),console.log(`Setting input value to: \"${n}\"`),u.call(l,n),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await I(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(t),l.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function J(e){let n=\"input.form-control\";for(let i=0;i<20;i++){let l=document.querySelector(n);if(l&&l.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(l,e),[\"input\",\"change\",\"blur\"].forEach(t=>l.dispatchEvent(new Event(t,{bubbles:!0}))),await I(300);return}await I(100)}console.error(\"Price input not found\")}function X(e){console.log(`normalizeSymbol called with: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${n}`);let i=n?ne(e):e.toUpperCase();return console.log(`Normalized symbol: \"${i}\"`),i}async function de(e){console.log(\"Creating bracket orders with data:\",e);let n=typeof e.tpEnabled==\"boolean\"?e.tpEnabled:document.getElementById(\"tpCheckbox\")?.checked??!0,i=typeof e.slEnabled==\"boolean\"?e.slEnabled:document.getElementById(\"slCheckbox\")?.checked??!0;console.log(`TP enabled: ${n}, SL enabled: ${i}`);async function l(s,p){let k=[...document.querySelectorAll(\".trading-ticket\")].find(m=>m.offsetParent);if(!k)return console.error(\"No visible trading ticket\");let a;for(let m=0;m<25&&(a=[...k.querySelectorAll(s)].find(F=>F.offsetParent&&!F.disabled),!a);m++)await I(100);if(!a)return console.error(`No live input for ${s}`);let C=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,q=a.closest(\".select-input.combobox\");q&&!a.value&&(q.querySelector(\".btn\")?.click(),await I(150),q.querySelector(\".dropdown-menu li\")?.click(),await I(150));for(let m=0;m<3&&(a.focus(),C.call(a,p),a.dispatchEvent(new Event(\"input\",{bubbles:!0})),a.dispatchEvent(new Event(\"change\",{bubbles:!0})),a.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),a.blur(),await I(250),`${a.value}`.trim()!==`${p}`);m++);}async function u(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let s=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${s.length} action labels`),s.forEach(p=>{p.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),p.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await l(\".select-input.combobox input\",e.qty))}function t(s=document){let p=s.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(p,k=>{let a=k.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),C=a[0]?.textContent.trim()||\"\",q=a[1]?.textContent.trim()||\"\",m=a[2]?.textContent.trim()||\"\",F=a[3]?.textContent.trim()||\"\",N=null,z=m.match(/@([\\d.]+)/);return z&&(N=Number(z[1])),{timestamp:C,id:q,event:m,comment:F,fillPrice:N}})}function y(s=\"up\"){let p=document.querySelector(\".numeric-input-value-controls\");if(!p)return;p.querySelector(s===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function w(s,p){await u(),document.querySelector(\".group.order-type .select-input div[tabindex]\")?.click(),[...document.querySelectorAll(\"ul.dropdown-menu li\")].find(a=>a.textContent.trim()===s)?.click(),p&&await l(\".numeric-input.feedback-wrapper input\",p),y(),document.querySelector(\".btn-group .btn-primary\")?.click(),await I(200),console.log(t()),document.querySelector(\".icon.icon-back\")?.click(),await I(200)}return console.log(`Submitting initial ${e.orderType||\"MARKET\"} order`),await w(e.orderType||\"MARKET\",e.entryPrice),e.action===\"Buy\"?(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await w(\"LIMIT\",e.takeProfit)),i&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await w(\"STOP\",e.stopLoss))):(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",n&&(console.log(`Creating take profit order at ${e.takeProfit}`),await w(\"LIMIT\",e.takeProfit)),i&&(console.log(`Creating stop loss order at ${e.stopLoss}`),await w(\"STOP\",e.stopLoss))),console.log(\"Bracket order creation complete\"),Promise.resolve()}function fe(e=document){let n=e.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(n,i=>{let l=i.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),u=l[0]?.textContent.trim()||\"\",t=l[1]?.textContent.trim()||\"\",y=l[2]?.textContent.trim()||\"\",w=l[3]?.textContent.trim()||\"\",s=null,p=y.match(/@([\\d.]+)/);return p&&(s=Number(p[1])),{timestamp:u,id:t,event:y,comment:w,fillPrice:s}})}let h={MNQ:{tickSize:.25,tickValue:.5,defaultSL:40,defaultTP:100,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:40,defaultTP:100,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function P(e,n=1,i=\"Buy\",l=null,u=null,t=.25){console.log(`autoTrade called with: symbol=${e}, qty=${n}, action=${i}, TP=${l}, SL=${u}, tickSize=${t}`);let y={};e&&(y.symbol=e),typeof n==\"number\"&&!Number.isNaN(n)&&(y.quantity=n),l!=null&&(y.tpTicks=l),u!=null&&(y.slTicks=u),t!=null&&(y.tickSize=t);let w=te(y,\"autoTrade\"),{symbol:s,quantity:p,tpTicks:k,slTicks:a,tickSize:C,entryPrice:q,tpPrice:m,slPrice:F,tpEnabled:N,slEnabled:z}=w,H=s||\"NQ\";console.log(`Using symbol: ${H}`);let K=H.replace(/[A-Z]\\d+$/,\"\")||H;console.log(`Root symbol: ${K}`);let j=h[K]||{},W=Number.isFinite(C)?C:typeof j.tickSize==\"number\"?j.tickSize:d(t,.25);Number.isFinite(W)||(W=.25);let B=z?d(a,j.defaultSL??40):0,re=N?d(k,j.defaultTP??100):0,x=d(p,1);console.log(`Using tick size ${W}`),console.log(`Effective SL: ${B} ticks, TP: ${re} ticks`),console.log(`Getting market data for ${H}`);let L=b(H);if(!L){console.error(`No market data for ${H}`);return}console.log(\"Market data:\",L);let _=parseFloat(i===\"Buy\"?L.offerPrice:L.bidPrice);console.log(`Market price: ${_} (${i===\"Buy\"?\"offer\":\"bid\"} price)`);let o=Number.isFinite(q)?q:null,c=_,v=\"MARKET\";o!==null?(console.log(`Custom entry price provided: ${o}`),c=o,i===\"Buy\"?v=o<_?\"LIMIT\":\"STOP\":v=o>_?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${v}`)):console.log(`No custom entry price provided, using market order at ${_}`);let T=Number.isFinite(j.precision)?j.precision:2;console.log(`Using price precision: ${T} decimal places`);let S=z?Number.isFinite(F)?F:i===\"Buy\"?c-B*W:c+B*W:null,R=N?Number.isFinite(m)?m:i===\"Buy\"?c+re*W:c-re*W:null,Z=S!=null?S.toFixed(T):null,ie=R!=null?R.toFixed(T):null;typeof r==\"function\"&&r({symbol:H,quantity:x,tpTicks:re,slTicks:B,tickSize:W,entryPrice:o,tpPrice:R??null,slPrice:S,tpEnabled:N,slEnabled:z},\"autoTrade-final\");let be={symbol:L.symbol,action:i,qty:String(x),takeProfit:ie,stopLoss:Z,orderType:v,entryPrice:v!==\"MARKET\"&&c!=null?c.toFixed(T):null,tpEnabled:N,slEnabled:z};return console.log(\"Trade data prepared:\",be),console.log(\"Submitting bracket orders\"),de(be).finally(()=>{})}function ne(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:n,yearDigit:i}=Ee();console.log(`Got quarterly code: letter=${n}, yearDigit=${i}`);let l=`${e.toUpperCase()}${n}${i}`;return console.log(`Returning front quarter symbol: \"${l}\"`),l}function b(e){console.log(`getMarketData called for: \"${e}\"`);let n=/^[A-Z]{1,3}$/.test(e)?X(e):e.toUpperCase(),i=g(n);if(!i)return console.log(`Cannot Find ${e}`),null;let l=i.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),u=l[4]?.textContent.trim(),t=l[5]?.textContent.trim();return{symbol:n,bidPrice:u,offerPrice:t}}function g(e){let n=/^[A-Z]{1,3}$/.test((e||\"\").trim()),i=n?null:y(e),l=n?y(e):null,u=document.querySelectorAll(\".quoteboard.module.data-table, .data-table, .quoteboard\"),t=u.length?u:[document];for(let w of t){let s=w.querySelectorAll(\".public_fixedDataTable_bodyRow\");for(let p of s){if(p.offsetParent===null)continue;let k=p.querySelector(\".public_fixedDataTableCell_cellContent\");if(!k)continue;let a=y(k.textContent);if(i&&a===i||l&&a.startsWith(l))return p}}return console.error(`findQuoteRow: row for \"${e}\" not found (visible area).`),null;function y(w){return String(w||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase()}}let V=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function ee(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let n=V[e.getUTCMonth()],i=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${n}, yearDigit=${i}`),{letter:n,yearDigit:i}}function Y(e=new Date){console.log(`getNQFrontMonth called with date: ${e.toISOString()}`);let n=[3,6,9,12],i=[\"H\",\"M\",\"U\",\"Z\"],l=e.getFullYear(),u=e.getMonth()+1,t=e.getDate();console.log(`Current date: ${l}-${u}-${t}`);for(let s=0;s<n.length;s++){let p=n[s],k=ae(l,p),a=new Date(k);if(a.setDate(k.getDate()-4),console.log(`Checking ${i[s]} contract: expiry=${k.toISOString()}, roll=${a.toISOString()}`),e<a){let C=`NQ${i[s]}${String(l).slice(-2)}`;return console.log(`Current front month: ${C} (before roll date)`),{symbol:C,letter:i[s],yearDigit:String(l).slice(-2),expiry:k,rollDate:a,isRollPeriod:!1}}else if(e<k){let C=(s+1)%4,q=C>s?l:l+1,m=`NQ${i[C]}${String(q).slice(-2)}`;return console.log(`Front month during roll period: ${m}`),{symbol:m,letter:i[C],yearDigit:String(q).slice(-2),expiry:ae(q,n[C]),rollDate:a,isRollPeriod:!0}}}let y=l+1,w=`NQ${i[0]}${String(y).slice(-2)}`;return console.log(`Moving to next year: ${w}`),{symbol:w,letter:i[0],yearDigit:String(y).slice(-2),expiry:ae(y,n[0]),rollDate:null,isRollPeriod:!1}}function ae(e,n){let l=(5-new Date(e,n-1,1).getDay()+7)%7,u=new Date(e,n-1,1+l),t=new Date(u);return t.setDate(u.getDate()+14),t}function Ee(e=new Date){console.log(`getQuarterlyCode called (legacy) with date: ${e.toISOString()}`);let n=Y(e);return console.log(`Legacy getQuarterlyCode returning: letter=${n.letter}, yearDigit=${n.yearDigit}`),{letter:n.letter,yearDigit:String(n.yearDigit).slice(-1)}}console.log(\"Calculating current NQ front month using CME rules...\");let ue=Y();console.log(`Current NQ front month: ${ue.symbol}`),console.log(`Expiry date: ${ue.expiry.toISOString()}`),console.log(`Roll date: ${ue.rollDate?ue.rollDate.toISOString():\"N/A\"}`),console.log(`Is in roll period: ${ue.isRollPeriod}`);let{letter:Be,yearDigit:Le}=Ee(),Ae=`NQ${Be}${Le}`;console.log(`Legacy front-quarter symbol: ${Ae}`),window.getNQFrontMonth=Y,window.getThirdFriday=ae;function Ie(){console.warn(\"[TradoAuto] moveStopLossToBreakeven is not implemented in this build\")}let pe={init:()=>{console.log(\"[TradoAuto] legacy driver init\")},autoTrade:P,clickExitForSymbol:f,moveStopLossToBreakeven:Ie,createUI:U,getNQFrontMonth:Y,getThirdFriday:ae,getState:()=>typeof $==\"function\"?$():{},applyConfig:(e={},n=\"external\")=>typeof r==\"function\"?r(e,n):{},subscribeState:e=>typeof A==\"function\"?A(e):()=>{}},le=typeof unsafeWindow<\"u\"?unsafeWindow:window;console.log(\"[TradoAuto] installing legacy driver onto window/unsafeWindow\"),window.TradoAuto=pe,le.TradoAuto=pe,le.TradovateAutoDriverBundle={default:pe,autoTrade:P,clickExitForSymbol:f,moveStopLossToBreakeven:Ie,createUI:U,getNQFrontMonth:Y,getThirdFriday:ae},le.__tradoAutoInterval||(le.__tradoAutoInterval=setInterval(()=>{(!le.TradoAuto||typeof le.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on targetWindow\"),le.TradoAuto=pe),(!window.TradoAuto||typeof window.TradoAuto.autoTrade!=\"function\")&&(console.warn(\"[TradoAuto] Reasserting driver on window\"),window.TradoAuto=pe)},250),console.log(\"[TradoAuto] watchdog interval started\"))})();var ve=typeof window<\"u\"&&window.TradoAuto?window.TradoAuto:TradoAuto;function Pe(E,{visible:$=!1}={}){if(console.log(`Creating UI (visible=${$})`),!E)return console.warn(\"[TradoUIPanel] renderPanel called without driver instance\"),null;let r=E.state,A=E.futuresTickData,d=E.normalizeSymbol,O=\"NQ\",te=O.replace(/[A-Z]\\d+$/,\"\"),Q=A[te]||A.NQ;r.symbol=O,r.tp=Q.defaultTP,r.sl=Q.defaultSL,r.tickSize=Q.tickSize;let M=Q.defaultTP.toString(),G=Q.defaultSL.toString(),I=\"10\",U=Q.tickSize.toString();console.log(`Using defaults: TP=${M}, SL=${G}, Qty=${I}, Tick=${U}, Symbol=${O}`),console.log(`Symbol data for ${te}: defaultTP=${Q.defaultTP}, defaultSL=${Q.defaultSL}`);let f=document.createElement(\"div\");f.id=$?\"bracket-trade-box\":\"invisible-trade-inputs\",$?(Object.assign(f.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"}),f.style.top=\"20px\",f.style.right=\"20px\"):Object.assign(f.style,{position:\"fixed\",top:\"-9999px\",left:\"-9999px\",visibility:\"hidden\",opacity:\"0\",pointerEvents:\"none\"}),$?f.innerHTML=`\n        <!-- Header with Symbol -->\n        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n            <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n            <input type=\"text\" id=\"symbolInput\" value=\"${O}\"\n                style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                placeholder=\"Symbol\" />\n        </div>\n        \n        <!-- Hidden Tick Size Input -->\n        <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n            <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n            <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${U}\"\n                style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n        </div>\n\n        <!-- Main Controls -->\n        <div id=\"mainControls\">\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"tpInput\" value=\"${M}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Ticks\" />\n                    <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n                <input type=\"checkbox\" id=\"slCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"slInput\" value=\"${G}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"SL Ticks\" />\n                    <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                        placeholder=\"SL Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n                <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n                <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                    <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"0.01\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                    <input type=\"number\" id=\"qtyInput\" value=\"${I}\" min=\"1\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                </div>\n                <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n                <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n                <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n            </div>\n            <!-- NEW: Breakeven button above Reverse -->\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n            </div>\n        </div>`:f.innerHTML=`\n            <input type=\"text\" id=\"symbolInput\" value=\"${O}\" />\n            <input type=\"number\" id=\"tickInput\" value=\"${U}\" />\n            <input type=\"number\" id=\"tpInput\" value=\"${M}\" />\n            <input type=\"number\" id=\"slInput\" value=\"${G}\" />\n            <input type=\"number\" id=\"qtyInput\" value=\"${I}\" />\n            <input type=\"number\" id=\"entryPriceInput\" />\n            <input type=\"number\" id=\"tpPriceInput\" />\n            <input type=\"number\" id=\"slPriceInput\" />\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n        `;let ce=$?\"bracket-trade-box\":\"invisible-trade-inputs\";if(document.getElementById(ce))return console.log(`${ce} already exists, skipping creation`),document.getElementById(ce);document.body.appendChild(f),console.log(\"UI container added to DOM\"),console.log(\"Setting up universal event handlers\");let oe=document.getElementById(\"slInput\"),J=document.getElementById(\"tpInput\"),X=document.getElementById(\"qtyInput\");oe&&oe.addEventListener(\"input\",()=>{console.log(`SL input changed to: ${oe.value}`);let h=parseFloat(oe.value);isNaN(h)||(r.sl=h,J&&(J.value=Math.round(h*3.5)),r.tp=Math.round(h*3.5),console.log(`Calculated TP: ${r.tp} (SL \\xD7 3.5)`))}),J&&J.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${J.value}`);let h=parseFloat(J.value);isNaN(h)||(r.tp=h)}),X&&X.addEventListener(\"input\",h=>{console.log(`Quantity input changed to: ${h.target.value}`);let P=parseInt(h.target.value);!isNaN(P)&&P>0&&(r.qty=P)});let de=document.getElementById(\"symbolInput\");de&&(de.addEventListener(\"input\",h=>{console.log(`Symbol input changed to: ${h.target.value}`),r.symbol=h.target.value}),de.addEventListener(\"change\",h=>{let P=h.target.value,ne=d(P);console.log(`Symbol changed to: ${P}, normalized: ${ne}`);let b=P.replace(/[A-Z]\\d+$/,\"\"),g=A[b];if(g){console.log(`Found default values for ${b}: SL=${g.defaultSL}, TP=${g.defaultTP}`);let V=document.getElementById(\"slInput\"),ee=document.getElementById(\"tpInput\"),Y=document.getElementById(\"tickInput\");V.value=g.defaultSL,ee.value=g.defaultTP,r.sl=g.defaultSL,r.tp=g.defaultTP,typeof g.tickSize==\"number\"&&(Y.value=g.tickSize,r.tickSize=g.tickSize,console.log(`Updated tick size to ${g.tickSize} for ${b}`)),console.log(`\\u2705 Updated SL/TP to default values for ${b}: SL=${V.value}, TP=${ee.value}`)}E.updateSymbol(\".trading-ticket .search-box--input\",ne)}));let fe=document.getElementById(\"tickInput\");if(fe&&fe.addEventListener(\"input\",h=>{console.log(`Tick size input changed to: ${h.target.value}`);let P=parseFloat(h.target.value);!isNaN(P)&&P>0&&(r.tickSize=P)}),$){console.log(\"Setting up UI event handlers\"),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let b=document.getElementById(\"symbolInput\").value||\"NQ\",g=d(b);console.log(`Calling clickExitForSymbol for: ${g} with Exit at Mkt & Cxl option`),E.clickExitForSymbol(g,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",g)}catch(b){console.error(\"Close All operation failed:\",b);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(g){console.error(\"Fallback close method also failed:\",g)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let b=document.getElementById(\"symbolInput\").value||\"NQ\",g=d(b);console.log(`Calling clickExitForSymbol for: ${g} with Cancel All option`),E.clickExitForSymbol(g,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",g)}catch(b){console.error(\"Cancel All operation failed:\",b)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let b=document.getElementById(\"symbolInput\").value||\"NQ\",g=d(b);console.log(`Calling clickExitForSymbol for: ${g} with Reverse & Cxl option`),E.clickExitForSymbol(g,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",g)}catch(b){console.error(\"Reverse Position operation failed:\",b)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",()=>{console.log(\"Breakeven button clicked\");try{let b=document.getElementById(\"symbolInput\").value||\"NQ\",g=d(b);console.log(`Processing breakeven for symbol: ${g}`),E.moveStopLossToBreakeven(g),console.log(\"Breakeven action triggered for symbol:\",g)}catch(b){console.error(\"Breakeven operation failed:\",b)}}),console.log(\"Setting up default values\"),document.getElementById(\"symbolInput\").value=\"NQ\",document.getElementById(\"tickInput\").value=r.tickSize,console.log(\"Setting up drag functionality\");let h=!1,P,ne;f.addEventListener(\"mousedown\",b=>{console.log(\"Container mousedown event detected\"),h=!0,P=b.clientX-f.getBoundingClientRect().left,ne=b.clientY-f.getBoundingClientRect().top,console.log(`Drag started at offset X:${P}, Y:${ne}`),f.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",b=>{if(h){let g=`${b.clientX-P}px`,V=`${b.clientY-ne}px`;b.clientX%20===0&&console.log(`Dragging panel to X:${g}, Y:${V}`),f.style.left=g,f.style.top=V,f.style.right=\"unset\"}}),document.addEventListener(\"mouseup\",()=>{h&&console.log(`Container drop position: Left:${f.style.left}, Top:${f.style.top}`),h=!1,f.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let b=document.getElementById(\"symbolInput\").value||\"NQ\",g=+X.value,V=+J.value,ee=+oe.value,Y=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${b}, Qty=${g}, TP=${V}, SL=${ee}, TickSize=${Y}`),E.autoTrade(b,g,\"Buy\",V,ee,Y).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let b=document.getElementById(\"symbolInput\").value||\"NQ\",g=+X.value,V=+J.value,ee=+oe.value,Y=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${b}, Qty=${g}, TP=${V}, SL=${ee}, TickSize=${Y}`),E.autoTrade(b,g,\"Sell\",V,ee,Y).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}return console.log(\"State management: Using in-memory state only, no persistence\"),f}function Ce({driverInstance:E=ve}={},$={}){let r=!1,A=!1,d=null;function O(I={}){let{visible:U=!0}={...$,...I},f=Pe(E,{visible:U});return f&&(r=!0,A=U,d=f),f}function te(){return O({visible:!1})}function Q(){return O({visible:!0})}function M(){let I=!1,U=document.getElementById(\"bracket-trade-box\"),f=document.getElementById(\"invisible-trade-inputs\");return U&&(U.remove(),I=!0),f&&(f.remove(),I=!0),I&&(r=!1,A=!1,d=null),I}function G(){return{mounted:r,visible:A,hasPanel:!!document.getElementById(\"bracket-trade-box\"),hasInvisiblePanel:!!document.getElementById(\"invisible-trade-inputs\"),lastContainer:d}}return{mount:O,createUI:O,createInvisibleUI:te,show:Q,hide:M,getStatus:G,render:I=>Pe(E,I)}}var Se=Ce();ve.registerUIPanel(Se);typeof window<\"u\"&&(window.TradoUIPanel=Se);var Ve=Se;return Ue(Ye);})();\n//# sourceMappingURL=tradovate_ui_panel.js.map\n";

    function inject(code, id) {
        if (!code) {
            console.warn(`[AutoOrder] No code supplied for ${id}, skipping injection.`);
            return;
        }

        const scriptId = `trado-${id}`;
        if (document.getElementById(scriptId)) {
            console.debug(`[AutoOrder] Script ${scriptId} already present, skipping duplicate injection.`);
            return;
        }

        const script = document.createElement('script');
        script.id = scriptId;
        script.type = 'text/javascript';
        script.textContent = code;
        document.head.appendChild(script);
        console.debug(`[AutoOrder] Injected ${id} bundle.`);
    }

    function waitForGlobal(name, timeout = 8000) {
        return new Promise((resolve, reject) => {
            const start = Date.now();
            (function check() {
                if (window[name]) {
                    resolve(window[name]);
                    return;
                }
                if (Date.now() - start > timeout) {
                    reject(new Error(`${name} not available within ${timeout}ms`));
                    return;
                }
                requestAnimationFrame(check);
            })();
        });
    }

    inject(driverSource, 'auto-driver');
    inject(panelSource, 'ui-panel');

    Promise.all([
        waitForGlobal('TradoAuto'),
        waitForGlobal('TradoUIPanel')
    ]).then(([autoDriver, uiPanel]) => {
        try {
            autoDriver.init?.({ source: 'tampermonkey' });
        } catch (err) {
            console.error('[AutoOrder] Failed to init driver', err);
        }

        try {
            uiPanel.mount?.({ visible: true });
        } catch (err) {
            console.error('[AutoOrder] Failed to mount UI panel', err);
        }

        console.info('[AutoOrder] Driver and panel ready.');
    }).catch(err => {
        console.error('[AutoOrder] Initialization failed', err);
    });
})();
