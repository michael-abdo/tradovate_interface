// ==UserScript==
// @name         Auto Order (Modular)
// @namespace    http://tampermonkey.net/
// @version      6.0
// @description  Thin wrapper that loads the modular Tradovate automation driver and UI panel.
// @author       You
// @match        https://trader.tradovate.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tradovate.com
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    const driverSource = "\"use strict\";var TradovateAutoDriverBundle=(()=>{var U=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var oe=Object.prototype.hasOwnProperty;var ne=(t,s)=>{for(var i in s)U(t,i,{get:s[i],enumerable:!0})},le=(t,s,i,l)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let u of te(s))!oe.call(t,u)&&u!==i&&U(t,u,{get:()=>s[u],enumerable:!(l=ee(s,u))||l.enumerable});return t};var re=t=>le(U({},\"__esModule\",{value:!0}),t);var Ee={};ne(Ee,{createAutoDriver:()=>W,createInvisibleUI:()=>J,default:()=>Te,initDriver:()=>G,registerUIPanel:()=>_});console.log(\"Auto Order script initialized - AUTOMATIC HOT RELOAD SUCCESS!\");function w(t){return console.log(`Delaying for ${t}ms`),new Promise(s=>setTimeout(s,t))}var D={symbol:\"NQ\",tickSize:.25,tp:null,sl:null,qty:10,entryPrice:null,tpPrice:null,slPrice:null,tpEnabled:!0,slEnabled:!0};async function ie(t,s=\"cancel-option-Exit-at-Mkt-Cxl\"){let i={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},l={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},u=$=>($||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),a=$=>new Promise(P=>setTimeout(P,$));async function y($,{timeout:P=1200,interval:e=50}={}){let g=performance.now();for(;performance.now()-g<P;){let O=$();if(O)return O;await a(e)}return null}let p=s.toLowerCase(),c=i[p]||s,n=l[c]||null,o=u(t),f=/^[A-Z]{1,3}$/.test(o),R=[...document.querySelectorAll(\".header .contract-symbol span\")].find($=>{let P=u($.textContent);if(P===o)return!0;if(f&&P.startsWith(o)){let e=P.substring(o.length);return/^[FGHJKMNQUVXZ]\\d+$/.test(e)}return!1});if(!R)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let S=R.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),C=S?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),m=S?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!S||!C||!m)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(n?n.test(u(C.textContent)):!1)return C.click(),!0;m.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let k=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter($=>$.offsetParent!==null||/display\\s*:\\s*block/i.test($.getAttribute(\"style\")||\"\")||!!$.closest(\".open\")),b=await y(k,{timeout:900,interval:40});if(!b||!b.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let E=m.getBoundingClientRect();b.sort(($,P)=>{let e=$.getBoundingClientRect(),g=P.getBoundingClientRect(),O=Math.hypot(e.left-E.left,e.top-E.bottom),h=Math.hypot(g.left-E.left,g.top-E.bottom);return O-h});let M=b[0],A=document.getElementById(c);if(!A&&n){for(let $ of b)if(A=[...$.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(P=>n.test(u(P.textContent))),A){M=$;break}}if(!A)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let r=A.tagName?A.matches(\"a,button\")?A:A.querySelector(\"a,button\")||A:A;return[\"mousedown\",\"mouseup\",\"click\"].forEach($=>r.dispatchEvent(new MouseEvent($,{bubbles:!0}))),m.click(),await a(120),b=k(),A=document.getElementById(c)||(n?b?.flatMap($=>[...$.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find($=>n.test(u($.textContent))):null),A?([\"mousedown\",\"mouseup\",\"click\"].forEach($=>(A.querySelector(\"a,button\")||A).dispatchEvent(new MouseEvent($,{bubbles:!0}))),await a(80),C.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function ce(t){console.log(`moveStopLossToBreakeven called for symbol: ${t}`);let s=V(t);if(!s){console.log(`No open position found for ${t}`);return}console.log(`Found position for ${t}:`,s);let i=s.entryPrice,l=s.quantity>0,u=t.replace(/[A-Z]\\d+$/,\"\"),a=N[u],p=(a?.tickSize||.25)*2,c=l?(i+p).toFixed(a?.precision||2):(i-p).toFixed(a?.precision||2);console.log(`Calculated breakeven price: ${c} (entry: ${i}, isLong: ${l}, buffer: ${p})`);let n=document.querySelectorAll(\".module.module-dom\"),o=0;for(let f of n){let R=f.querySelector(\".contract-symbol span\"),d=R?R.textContent.trim().toUpperCase():\"\",S=t.toUpperCase(),C=/^[A-Z]{1,3}$/.test(S);if(d===S||C&&d.startsWith(S)&&/^[FGHJKMNQUVXZ]\\d+$/.test(d.substring(S.length))){let m=f.querySelector(\".order-type\");if(m&&m.textContent.includes(\"STOP\")){console.log(`Found stop order for ${t}, updating to breakeven`);let T=f.querySelector('input[type=\"number\"], .numeric-input input');T?(console.log(`Updating stop price from ${T.value} to ${c}`),T.focus(),T.value=c,T.dispatchEvent(new Event(\"input\",{bubbles:!0})),T.dispatchEvent(new Event(\"change\",{bubbles:!0})),T.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),o++,console.log(`Stop order ${o} updated to breakeven`)):console.log(\"Price input not found for stop order\")}}}o>0?console.log(`\\u2705 Successfully moved ${o} stop order(s) to breakeven for ${t}`):console.log(`\\u26A0\\uFE0F No stop orders found to update for ${t}`)}function V(t){console.log(`getCurrentPosition called for symbol: ${t}`);let s=document.querySelectorAll(\".module.module-dom\");for(let l of s){let u=l.querySelector(\".contract-symbol span\"),a=u?u.textContent.trim().toUpperCase():\"\",y=t.toUpperCase(),p=/^[A-Z]{1,3}$/.test(y);if(a===y||p&&a.startsWith(y)&&/^[FGHJKMNQUVXZ]\\d+$/.test(a.substring(y.length))){let c=l.querySelector(\".position-quantity, .quantity\"),n=l.querySelector(\".avg-price, .entry-price, .price\");if(c&&n){let o=parseFloat(c.textContent.replace(/[^\\d.-]/g,\"\")),f=parseFloat(n.textContent.replace(/[^\\d.-]/g,\"\"));if(!isNaN(o)&&!isNaN(f)&&o!==0)return console.log(`Found position: qty=${o}, entry=${f}`),{quantity:o,entryPrice:f}}}}let i=document.querySelectorAll(\".portfolio-row, .position-row\");for(let l of i){let u=l.querySelector(\".symbol, .contract-symbol\"),a=u?u.textContent.trim().toUpperCase():\"\",y=t.toUpperCase(),p=/^[A-Z]{1,3}$/.test(y);if(a===y||p&&a.startsWith(y)&&/^[FGHJKMNQUVXZ]\\d+$/.test(a.substring(y.length))){let c=l.querySelectorAll(\"td, .cell\");for(let n=0;n<c.length;n++){let o=c[n].textContent.trim(),f=parseFloat(o.replace(/[^\\d.-]/g,\"\"));if(!isNaN(f)&&f!==0)for(let R=n+1;R<Math.min(n+4,c.length);R++){let d=c[R].textContent.trim(),S=parseFloat(d.replace(/[^\\d.-]/g,\"\"));if(!isNaN(S)&&S>0)return console.log(`Found position from portfolio: qty=${f}, entry=${S}`),{quantity:f,entryPrice:S}}}}}return console.log(`No position data found for ${t}`),null}async function se(t,s){console.log(`updateSymbol called with selector: \"${t}\", value: \"${s}\"`);let i=document.querySelectorAll(t);if(console.log(`Found ${i.length} matching inputs with selector: ${t}`),i.length===0){let y=['.trading-ticket input[type=\"text\"]',\".order-entry .search-box--input\",\".order-ticket .search-box--input\",\".search-box--input\"];for(let p of y)if(i=document.querySelectorAll(p),i.length>0){console.log(`Using fallback selector: ${p}, found ${i.length} inputs`);break}}let l=i[0]||i[1];if(!l){console.error(\"No matching input elements found with any selector!\"),console.error(\"Tried selectors:\",t,\"and fallbacks\");return}console.log(\"Selected input:\",l),console.log(\"Input location:\",{inTradingTicket:!!l.closest(\".trading-ticket\"),inMarketAnalyzer:!!l.closest(\".market-analyzer, .market-watchlist\"),parentClasses:l.parentElement?.className,placeholder:l.placeholder});let u=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,a=y=>l.dispatchEvent(new KeyboardEvent(y,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),u.call(l,\"\"),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await w(400),console.log(`Setting input value to: \"${s}\"`),u.call(l,s),l.focus(),l.dispatchEvent(new Event(\"input\",{bubbles:!0})),await w(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(a),l.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function ae(t){let s=\"input.form-control\";for(let i=0;i<20;i++){let l=document.querySelector(s);if(l&&l.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(l,t),[\"input\",\"change\",\"blur\"].forEach(a=>l.dispatchEvent(new Event(a,{bubbles:!0}))),await w(300);return}await w(100)}console.error(\"Price input not found\")}function ue(t){console.log(`normalizeSymbol called with: \"${t}\"`);let s=/^[A-Z]{1,3}$/.test(t);console.log(`Is root symbol: ${s}`);let i=s?j(t):t.toUpperCase();return console.log(`Normalized symbol: \"${i}\"`),i}async function H(t){console.log(\"Creating bracket orders with data:\",t);let s=document.getElementById(\"tpCheckbox\").checked,i=document.getElementById(\"slCheckbox\").checked;console.log(`TP enabled: ${s}, SL enabled: ${i}`);async function l(o,f){let R=[...document.querySelectorAll(\".trading-ticket\")].find(m=>m.offsetParent);if(!R)return console.error(\"No visible trading ticket\");let d;for(let m=0;m<25&&(d=[...R.querySelectorAll(o)].find(T=>T.offsetParent&&!T.disabled),!d);m++)await w(100);if(!d)return console.error(`No live input for ${o}`);let S=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,C=d.closest(\".select-input.combobox\");C&&!d.value&&(C.querySelector(\".btn\")?.click(),await w(150),C.querySelector(\".dropdown-menu li\")?.click(),await w(150));for(let m=0;m<3&&(d.focus(),S.call(d,f),d.dispatchEvent(new Event(\"input\",{bubbles:!0})),d.dispatchEvent(new Event(\"change\",{bubbles:!0})),d.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),d.blur(),await w(250),`${d.value}`.trim()!==`${f}`);m++);}async function u(){if(console.log(\"Setting common order fields\"),t.action){console.log(`Setting action to: ${t.action}`);let o=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${o.length} action labels`),o.forEach(f=>{f.textContent.trim()===t.action&&(console.log(`Clicking ${t.action} label`),f.click())})}t.qty&&(console.log(`Setting quantity to: ${t.qty}`),await l(\".select-input.combobox input\",t.qty))}function a(o=document){let f=o.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(f,R=>{let d=R.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),S=d[0]?.textContent.trim()||\"\",C=d[1]?.textContent.trim()||\"\",m=d[2]?.textContent.trim()||\"\",T=d[3]?.textContent.trim()||\"\",k=null,b=m.match(/@([\\d.]+)/);return b&&(k=Number(b[1])),{timestamp:S,id:C,event:m,comment:T,fillPrice:k}})}function y(o=\"up\"){let f=document.querySelector(\".numeric-input-value-controls\");if(!f)return;f.querySelector(o===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function p(o,f){console.log(`\\u{1F527} Starting submitOrder for ${o} order`),console.log(`\\u{1F50D} DEBUG: submitOrder called with orderType=${o}, priceValue=${f}`),await u();let R=document.querySelector(\".group.order-type .select-input div[tabindex]\");if(!R)return console.error(\"\\u274C Order type dropdown not found!\"),{success:!1,error:\"Order type dropdown not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(`\\u{1F4CB} Setting order type to: ${o}`),R.click(),await w(200);let d=[...document.querySelectorAll(\"ul.dropdown-menu li\")],S=d.map(M=>M.textContent.trim());console.log(\"[submitOrder] Available order type options:\",S),window.lastOrderTypeOptions=S,window.lastOrderTypeDebug={orderType:o,availableTypes:S,dropdownHTML:document.querySelector(\".group.order-type\")?.outerHTML,timestamp:new Date().toISOString()};let C=o.toUpperCase(),T={MARKET:[\"MARKET\",\"MARKET ORDER\"],LIMIT:[\"LIMIT\",\"LIMIT ORDER\"],STOP:[\"STOP\",\"STOP MARKET\",\"STOP ORDER\"],\"STOP LIMIT\":[\"STOP LIMIT\",\"STOP-LIMIT\"],\"TRL STOP\":[\"TRAILING STOP\",\"TRAIL STOP\"],\"TRL STP LMT\":[\"TRAILING STOP LIMIT\",\"TRL STP LMT\"]}[C]||[o],k=d.find(M=>T.includes(M.textContent.trim()))||d.find(M=>M.textContent.trim().toUpperCase()===C);if(!k)return console.error(`\\u274C Order type option '${o}' not found!`),{success:!1,error:`Order type option '${o}' not found`,orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};k.click(),await w(500),f&&(console.log(`\\u{1F4B0} Setting price to: ${f}`),console.log(`\\u{1F50D} DEBUG: About to set price input to: ${f} (type: ${typeof f})`),await l(\".numeric-input.feedback-wrapper input\",f)),y();let b=document.querySelector(\".btn-group .btn-primary\");if(!b)return console.error(\"\\u274C Submit button not found!\"),{success:!1,error:\"Submit button not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(\"\\u{1F680} Clicking submit button...\"),b.click(),await w(500),console.log(a()),console.log(\"\\u23F3 Waiting for order to appear in history...\"),await w(1e3),console.log(\"\\u{1F4CA} Capturing order feedback from submitOrder...\");let E=await K();return E?.rejectionReason?console.log(`\\u2705 submitOrder captured REJECTION: ${E.rejectionReason}`):E?.success&&E?.orders?.length>0?console.log(`\\u2705 submitOrder captured SUCCESS: ${E.orders.length} orders`):E?.error?console.log(`\\u26A0\\uFE0F submitOrder captured ERROR: ${E.error}`):console.log(\"\\u26A0\\uFE0F submitOrder captured UNKNOWN result:\",E),document.querySelector(\".icon.icon-back\")?.click(),await w(200),E}console.log(`\\u{1F4CD} BRACKET STEP 3: Submitting initial ${t.orderType||\"MARKET\"} order...`),console.log(`  Order type: ${t.orderType||\"MARKET\"}`),console.log(`  Entry price: ${t.entryPrice||\"Market price\"}`),console.log(`  Action: ${t.action}`),console.log(`  Quantity: ${t.qty}`);let c=await p(t.orderType||\"MARKET\",t.entryPrice);console.log(\"\\u{1F4CA} Main order result:\",c);let n={success:c?.success||!1,orders:c?.orders||[],symbol:c?.symbol||null,summary:c?.summary||null,rejectionReason:c?.rejectionReason||null,filledCount:c?.filledCount||0,rejectedCount:c?.rejectedCount||0,error:c?.error||null,mainOrder:c,tpOrder:null,slOrder:null};if(c?.rejectionReason||c?.error||!c?.success)return console.log(\"\\u274C Main order rejected/failed - skipping TP/SL orders\"),console.log(`   Rejection reason: ${c?.rejectionReason||c?.error||\"Unknown\"}`),console.log(\"Bracket order creation complete (main order rejected)\"),n;if(console.log(\"\\u2705 Main order successful - proceeding with TP/SL orders\"),t.action===\"Buy\"){if(console.log(\"Flipping action to Sell for TP/SL orders\"),t.action=\"Sell\",s){console.log(`Creating take profit order at ${t.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${t.takeProfit}`);let o=await p(\"LIMIT\",t.takeProfit);n.tpOrder=o,o?.orders?.length&&(n.orders=[...n.orders,...o.orders]),o?.filledCount&&(n.filledCount+=o.filledCount),o?.rejectedCount&&(n.rejectedCount+=o.rejectedCount)}if(i){console.log(`Creating stop loss order at ${t.stopLoss}`);let o=await p(\"STOP\",t.stopLoss);n.slOrder=o,o?.orders?.length&&(n.orders=[...n.orders,...o.orders]),o?.filledCount&&(n.filledCount+=o.filledCount),o?.rejectedCount&&(n.rejectedCount+=o.rejectedCount)}}else{if(console.log(\"Flipping action to Buy for TP/SL orders\"),t.action=\"Buy\",s){console.log(`Creating take profit order at ${t.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${t.takeProfit}`);let o=await p(\"LIMIT\",t.takeProfit);n.tpOrder=o,o?.orders?.length&&(n.orders=[...n.orders,...o.orders]),o?.filledCount&&(n.filledCount+=o.filledCount),o?.rejectedCount&&(n.rejectedCount+=o.rejectedCount)}if(i){console.log(`Creating stop loss order at ${t.stopLoss}`);let o=await p(\"STOP\",t.stopLoss);n.slOrder=o,o?.orders?.length&&(n.orders=[...n.orders,...o.orders]),o?.filledCount&&(n.filledCount+=o.filledCount),o?.rejectedCount&&(n.rejectedCount+=o.rejectedCount)}}return console.log(\"\\u{1F4CA} Final bracket feedback aggregation:\"),console.log(`   Overall success: ${n.success}`),console.log(`   Total orders: ${n.orders.length}`),console.log(`   Filled count: ${n.filledCount}`),console.log(`   Rejected count: ${n.rejectedCount}`),console.log(`   Main order: ${n.mainOrder?.success?\"Success\":\"Failed\"}`),console.log(`   TP order: ${n.tpOrder?.success?\"Success\":n.tpOrder?\"Failed\":\"N/A\"}`),console.log(`   SL order: ${n.slOrder?.success?\"Success\":n.slOrder?\"Failed\":\"N/A\"}`),console.log(\"Bracket order creation complete\"),n}function Z(t=document){let s=t.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(s,i=>{let l=i.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),u=l[0]?.textContent.trim()||\"\",a=l[1]?.textContent.trim()||\"\",y=l[2]?.textContent.trim()||\"\",p=l[3]?.textContent.trim()||\"\",c=null,n=y.match(/@([\\d.]+)/);return n&&(c=Number(n[1])),{timestamp:u,id:a,event:y,comment:p,fillPrice:c}})}async function K(){console.log(\"\\u{1F504} CAPTURING TRADOVATE ORDER FEEDBACK...\"),await w(500);let t=document.querySelector(\".order-history\");if(!t)return console.log(\"\\u274C Order history div not found - no feedback to capture\"),{success:!1,orders:[],rejectionReason:null,error:\"Order history not found\"};console.log(\"\\u2705 Found order history div - capturing feedback...\");let s=t.querySelector(\".trading-ticket-header\"),i=\"UNKNOWN\",l=null,u=null,a=null,y=null,p=null;if(s){let e=s.querySelector('div[style*=\"font-size: 160%\"]'),g=e?e.textContent.trim():\"UNKNOWN\",O=s.querySelector(\"div:last-child\"),h=O?O.textContent.trim():\"No summary\";h.includes(\" MKT \")?i=\"MARKET\":h.includes(\" LMT \")?i=\"LIMIT\":h.includes(\" STP LMT \")?i=\"STOP_LIMIT\":h.includes(\" STP \")&&(i=\"STOP\");let I=h.match(/#(\\d+)/);y=I?I[1]:null,a=h.includes(\"Buy\")?\"Buy\":h.includes(\"Sell\")?\"Sell\":null;let F=h.match(/(\\d+)\\s+[A-Z]+\\d*\\s+(?:MKT|LMT|STP)/);u=F?parseInt(F[1]):null;let L=h.match(/LMT at ([\\d.]+)/);l=L?parseFloat(L[1]):null;let v=h.match(/(\\d+)\\/(\\d+)/);p=v?{filled:parseInt(v[1]),total:parseInt(v[2]),isPartial:parseInt(v[1])<parseInt(v[2]),percentFilled:(parseInt(v[1])/parseInt(v[2])*100).toFixed(2)}:null,console.log(`\\u{1F4CA} ORDER FEEDBACK - Symbol: ${g}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Summary: ${h}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order Type: ${i}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order ID: ${y}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Action: ${a}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Quantity: ${u}`),l&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Requested Price: ${l}`),p&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Fill Status: ${p.filled}/${p.total} (${p.percentFilled}%${p.isPartial?\" - PARTIAL FILL\":\" - COMPLETE\"})`)}let c=Z(t);console.log(`\\u{1F4CA} ORDER FEEDBACK - Events (${c.length} found):`),c.forEach((e,g)=>{console.log(`\\u{1F4CA} EVENT ${g+1}:`,{timestamp:e.timestamp,id:e.id,event:e.event,comment:e.comment,fillPrice:e.fillPrice})}),console.log(\"\\u{1F4CA} ORDER FEEDBACK - Full HTML Structure:\"),console.log(t.outerHTML);let n=c.filter(e=>e.fillPrice!==null).map(e=>{let g=e.event.match(/(\\d+)@([\\d.]+)/);return{timestamp:e.timestamp,id:e.id,price:e.fillPrice,quantity:g?parseInt(g[1]):null,eventText:e.event}}),o=null,f=null,R=[];c.forEach(e=>{if(e.event.includes(\"STP\")||e.comment.includes(\"Stop\")){let g=e.event.match(/#?(\\d+)/);g&&(o=g[1],R.push({type:\"STOP_LOSS\",orderId:o,event:e}))}if(e.event.includes(\"LMT\")&&(e.comment.includes(\"Profit\")||e.comment.includes(\"Target\"))){let g=e.event.match(/#?(\\d+)/);g&&g[1]!==y&&(f=g[1],R.push({type:\"TAKE_PROFIT\",orderId:f,event:e}))}(e.comment.includes(\"bracket\")||e.comment.includes(\"OCO\"))&&console.log(`\\u{1F4CA} BRACKET ORDER DETECTED - Event: ${e.event}, Comment: ${e.comment}`)}),R.length>0&&(console.log(`\\u{1F4CA} BRACKET ORDERS FOUND: ${R.length} orders`),R.forEach(e=>{console.log(`\\u{1F4CA} ${e.type} Order ID: ${e.orderId}`)}));let d=null,S=[],C=0;c.forEach(e=>{let g=e.comment.match(/commission[:\\s]+\\$?([\\d.]+)/i)||e.event.match(/commission[:\\s]+\\$?([\\d.]+)/i);g&&(d=parseFloat(g[1]),C+=d,console.log(`\\u{1F4CA} COMMISSION FOUND: ${d}`));let O=e.comment.match(/fee[:\\s]+\\$?([\\d.]+)/i)||e.event.match(/fee[:\\s]+\\$?([\\d.]+)/i);if(O){let h=parseFloat(O[1]);S.push({amount:h,description:e.comment||e.event,timestamp:e.timestamp}),C+=h,console.log(`\\u{1F4CA} FEE FOUND: ${h}`)}if(e.comment.includes(\"Exchange\")||e.event.includes(\"Exchange\")){let h=e.comment.match(/\\$?([\\d.]+)/)||e.event.match(/\\$?([\\d.]+)/);if(h){let I=parseFloat(h[1]);S.push({amount:I,description:\"Exchange Fee\",timestamp:e.timestamp})}}});let m={submittedAt:null,firstFillAt:null,completedAt:null,timeToFill:null,riskCheckTime:null};if(c.length>0){m.submittedAt=c[0].timestamp;let e=c.find(F=>F.event.includes(\"Risk Passed\"));if(e){let F=new Date(m.submittedAt),L=new Date(e.timestamp);m.riskCheckTime=L-F,console.log(`\\u{1F4CA} TIMING - Risk check completed in ${m.riskCheckTime}ms`)}let g=n[0];if(g){m.firstFillAt=g.timestamp;let F=new Date(m.submittedAt),L=new Date(m.firstFillAt);m.timeToFill=L-F,console.log(`\\u{1F4CA} TIMING - First fill in ${m.timeToFill}ms`)}m.completedAt=c[c.length-1].timestamp;let O=new Date(m.submittedAt),I=new Date(m.completedAt)-O;m.totalDuration=I,console.log(`\\u{1F4CA} TIMING - Order completed in ${I}ms total`),console.log(`\\u{1F4CA} TIMING - Submitted: ${m.submittedAt}`),console.log(`\\u{1F4CA} TIMING - Completed: ${m.completedAt}`)}let T=c.filter(e=>e.fillPrice!==null).map(e=>e.fillPrice),k=T.length>0?T.reduce((e,g)=>e+g,0)/T.length:null,b=null;i===\"LIMIT\"&&l&&k&&(a===\"Buy\"?b=l-k:a===\"Sell\"&&(b=k-l));let E=null,M=null;if(i===\"MARKET\"&&k){let e=s?.querySelector('div[style*=\"font-size: 160%\"]'),O=(e?e.textContent.trim():\"\").replace(/[A-Z]\\d+$/,\"\"),I=N[O]?.tickSize||.25;if(T.length>1){let F=Math.min(...T),L=Math.max(...T),v=L-F,Q=Math.round(v/I);E={priceRange:v,priceRangeTicks:Q,minFillPrice:F,maxFillPrice:L,fillCount:T.length,tickSize:I,note:\"Slippage calculated from fill price range. Mid-price at submission not available.\"},console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Price range: ${v} (${Q} ticks)`),console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Fills ranged from ${F} to ${L}`)}else T.length===1&&(E={fillPrice:T[0],tickSize:I,note:\"Single fill. Slippage cannot be calculated without mid-price at submission.\"},console.log(`\\u{1F4CA} MARKET ORDER - Single fill at ${T[0]}`))}let A=t.textContent,r={success:!1,orders:c||[],rejectionReason:null,error:null,orderId:y,orderType:i,orderAction:a,orderQuantity:u,requestedPrice:l,averageFillPrice:k,priceImprovement:b,fillPrices:T,fillRatio:p,fillEvents:n,slippage:E,stopLossOrderId:o,takeProfitOrderId:f,bracketOrders:R,commission:d,fees:S,totalCost:C>0?C:null,timingMetrics:m,priceComparison:null};l&&k&&(r.priceComparison={requested:l,filled:k,difference:k-l,percentDifference:((k-l)/l*100).toFixed(3),improvement:b,analysis:b>0?\"BETTER_THAN_REQUESTED\":b<0?\"WORSE_THAN_REQUESTED\":\"FILLED_AT_REQUESTED\"},console.log(`\\u{1F4CA} PRICE COMPARISON - Requested: ${l}, Filled: ${k}`),console.log(`\\u{1F4CA} PRICE COMPARISON - Difference: ${r.priceComparison.difference} (${r.priceComparison.percentDifference}%)`),console.log(`\\u{1F4CA} PRICE COMPARISON - Analysis: ${r.priceComparison.analysis}`)),A.includes(\"Rejected\")?(console.log(\"\\u274C ORDER REJECTED - checking rejection reason...\"),A.includes(\"outside of market hours\")?(console.log(\"\\u274C REJECTION REASON: Order placed outside market hours\"),r.rejectionReason=\"Order placed outside market hours\"):A.includes(\"Risk\")?(console.log(\"\\u274C REJECTION REASON: Risk management violation\"),r.rejectionReason=\"Risk management violation\"):(console.log(\"\\u274C REJECTION REASON: Other - check full feedback above\"),r.rejectionReason=\"Order rejected\")):A.includes(\"Risk Passed\")?(console.log(\"\\u2705 RISK MANAGEMENT: Order passed risk checks\"),r.success=!0):c.length>0&&(r.success=!0);let P=(()=>{let e=`\n\\u{1F4CA} \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550 ORDER VERIFICATION REPORT \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`;return e+=`\n\\u{1F538} ORDER DETAILS:\n`,e+=`   Order ID: ${r.orderId||\"N/A\"}\n`,e+=`   Type: ${r.orderType}\n`,e+=`   Action: ${r.orderAction} ${r.orderQuantity||\"N/A\"} units\n`,e+=`   Status: ${r.success?\"\\u2705 SUCCESS\":\"\\u274C FAILED\"}\n`,r.orderType===\"LIMIT\"&&r.priceComparison&&(e+=`\n\\u{1F538} PRICE VERIFICATION:\n`,e+=`   Requested: ${r.requestedPrice}\n`,e+=`   Filled: ${r.averageFillPrice}\n`,e+=`   Difference: ${r.priceComparison.difference} (${r.priceComparison.percentDifference}%)\n`,e+=`   Result: ${r.priceComparison.analysis}\n`),r.orderType===\"MARKET\"&&r.slippage&&(e+=`\n\\u{1F538} MARKET ORDER SLIPPAGE:\n`,r.slippage.priceRange!==void 0&&(e+=`   Fill Range: ${r.slippage.priceRange} (${r.slippage.priceRangeTicks} ticks)\n`,e+=`   Min Fill: ${r.slippage.minFillPrice}\n`,e+=`   Max Fill: ${r.slippage.maxFillPrice}\n`)),r.fillRatio&&(e+=`\n\\u{1F538} FILL INFORMATION:\n`,e+=`   Fill Ratio: ${r.fillRatio.filled}/${r.fillRatio.total} (${r.fillRatio.percentFilled}%)\n`,e+=`   Status: ${r.fillRatio.isPartial?\"\\u26A0\\uFE0F PARTIAL FILL\":\"\\u2705 COMPLETE FILL\"}\n`,r.fillEvents.length>0&&(e+=`   Individual Fills:\n`,r.fillEvents.forEach((g,O)=>{e+=`     ${O+1}. ${g.quantity||\"N/A\"} @ ${g.price} (${g.timestamp})\n`}))),r.bracketOrders.length>0&&(e+=`\n\\u{1F538} BRACKET ORDERS:\n`,r.stopLossOrderId&&(e+=`   Stop Loss: #${r.stopLossOrderId}\n`),r.takeProfitOrderId&&(e+=`   Take Profit: #${r.takeProfitOrderId}\n`)),r.timingMetrics.timeToFill&&(e+=`\n\\u{1F538} EXECUTION TIMING:\n`,e+=`   Time to Fill: ${r.timingMetrics.timeToFill}ms\n`,r.timingMetrics.riskCheckTime&&(e+=`   Risk Check: ${r.timingMetrics.riskCheckTime}ms\n`),e+=`   Total Duration: ${r.timingMetrics.totalDuration||\"N/A\"}ms\n`),(r.commission||r.totalCost)&&(e+=`\n\\u{1F538} COSTS:\n`,r.commission&&(e+=`   Commission: ${r.commission}\n`),r.fees.length>0&&(e+=`   Fees: ${r.fees.length} fee(s) totaling ${r.fees.reduce((g,O)=>g+O.amount,0)}\n`),r.totalCost&&(e+=`   Total Cost: ${r.totalCost}\n`)),r.rejectionReason&&(e+=`\n\\u{1F538} REJECTION DETAILS:\n`,e+=`   Reason: ${r.rejectionReason}\n`),e+=`\n\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`,e})();return console.log(P),r.verificationReport=P,K.lastResult=r,window.lastOrderFeedback=r,console.log(\"\\u{1F504} ORDER FEEDBACK CAPTURE COMPLETE\"),console.log(\"\\u{1F4A1} TIP: Access last feedback with: window.lastOrderFeedback\"),r}var N={MNQ:{tickSize:.25,tickValue:.5,defaultSL:15,defaultTP:200,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:15,defaultTP:200,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function q(t,s=1,i=\"Buy\",l=null,u=null,a=.25,y=null){console.log(`\\u{1F680} [AUTOTRADE START] autoTrade called with: symbol=${t}, qty=${s}, action=${i}, TP=${l}, SL=${u}, tickSize=${a}, orderType=${y}`),console.log(`\\u{1F680} [AUTOTRADE START] Function entry successful at ${new Date().toISOString()}`);try{console.log(`\\u{1F50D} [DEBUG] TP ticks input parameter = ${l} (type: ${typeof l})`);let p=D.symbol||\"NQ\";console.log(`\\u{1F50D} [SYMBOL] Using symbol: ${p}`),console.log(`\\u{1F50D} [SYMBOL] currentState.symbol = ${D.symbol}`);let c=p.replace(/[A-Z]\\d+$/,\"\");console.log(`\\u{1F50D} [SYMBOL] Root symbol: ${c}`),console.log(`\\u{1F50D} [DATA] Looking up symbolData for ${c}...`);let n=N[c];if(console.log(\"\\u{1F50D} [DATA] symbolData found:\",n),c!==q.lastRootSymbol){D.tickSize=n?.tickSize??\"\";let I=document.getElementById(\"tickInput\");I&&(I.value=D.tickSize)}q.lastRootSymbol=c;let o=n&&typeof n.tickSize==\"number\"?n.tickSize:parseFloat(D.tickSize)||a;D.tickSize=o;let f=document.getElementById(\"tickInput\");f&&(f.value=o);let R=u||n?.defaultSL||parseInt(D.sl)||40,d=l||n?.defaultTP||parseInt(D.tp)||100;console.log(`\\u{1F50D} DEBUG: actualTakeProfitTicks = ${d} (from takeProfitTicks: ${l}, defaultTP: ${n?.defaultTP}, tpInput: ${D.tp})`);let S=n?.tickSize?\"dictionary\":D.tickSize?\"input field\":\"default parameter\";console.log(`Using tick size ${o} (from ${S})`),console.log(`Using SL: ${R} ticks, TP: ${d} ticks`),console.log(`\\u{1F50D} [DEBUG] tickSize = ${o} (symbolData.tickSize: ${n?.tickSize}, tickInput: ${D.tickSize}, _tickSize param: ${a})`),console.log(`\\u{1F4E1} [MARKET DATA] Getting market data for ${p}...`),console.log(`\\u{1F4E1} [MARKET DATA] About to call getMarketData(${p})`);let C=X(p);if(console.log(\"\\u{1F4E1} [MARKET DATA] getMarketData returned:\",C),!C){console.error(`\\u274C [MARKET DATA] No market data for ${p} - EARLY RETURN!`);return}console.log(\"\\u{1F4E1} [MARKET DATA] Market data received:\",C),console.log(\"\\u{1F4B0} [ORDER PREP] Starting order preparation...\");let m=document.getElementById(\"entryPriceInput\"),T=m&&m.value?parseFloat(m.value):null;console.log(`\\u{1F4B0} [ORDER PREP] Custom entry price: ${T}`);let k=parseFloat(i===\"Buy\"?C.offerPrice:C.bidPrice);console.log(`\\u{1F4B0} [ORDER PREP] Market price: ${k} (${i===\"Buy\"?\"offer\":\"bid\"} price)`);let b=\"MARKET\",E=k;if(console.log(`\\u{1F4B0} [ORDER PREP] Initial order type: ${b}, entry price: ${E}`),y){let I=[\"MARKET\",\"LIMIT\",\"STOP\",\"STOP LIMIT\",\"TRL STOP\",\"TRL STP LMT\"];if(!I.includes(y)){console.error(`Invalid order type: ${y}. Valid types: ${I.join(\", \")}`);return}b=y,console.log(`Using explicit order type: ${b}`),b!==\"MARKET\"&&T!==null?(E=T,console.log(`Using custom entry price: ${E} for ${b} order`)):b!==\"MARKET\"?(E=k,console.log(`Using market price: ${E} for ${b} order`)):b===\"MARKET\"&&(E=k,console.log(`Using market price: ${E} for MARKET order`))}else T!==null?(console.log(`Custom entry price provided: ${T}`),E=T,i===\"Buy\"?b=T<k?\"LIMIT\":\"STOP\":b=T>k?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${b}`)):console.log(`No custom entry price provided, using market order at ${k}`);let M=n?.precision??2;console.log(`Using price precision: ${M} decimal places`);let A=document.getElementById(\"slPriceInput\"),r=document.getElementById(\"tpPriceInput\"),$=A&&A.value?parseFloat(A.value):null,P=r&&r.value?parseFloat(r.value):null,e;$!==null?(e=$.toFixed(M),console.log(`Using hardcoded SL price: ${e}`)):(e=(i===\"Buy\"?E-R*o:E+R*o).toFixed(M),console.log(`Calculated SL price: ${e} (${i===\"Buy\"?\"entry - \":\"entry + \"}${R} ticks)`));let g;if(P!==null)g=P.toFixed(M),console.log(`Using hardcoded TP price: ${g}`);else{let I=d*o;console.log(`\\u{1F50D} DEBUG: TP calculation - entryPrice: ${E}, actualTakeProfitTicks: ${d}, tickSize: ${o}, offset: ${I}`),g=(i===\"Buy\"?E+d*o:E-d*o).toFixed(M),console.log(`Calculated TP price: ${g} (${i===\"Buy\"?\"entry + \":\"entry - \"}${d} ticks)`)}let O={symbol:C.symbol,action:i,qty:s.toString(),takeProfit:g,stopLoss:e,orderType:b,entryPrice:b!==\"MARKET\"?E.toFixed(M):null};console.log(\"Trade data prepared:\",O);let h=(i===\"Buy\"?E+d*o:E-d*o).toFixed(M);return console.log(`\\u{1F50D} DEBUG: tradeData.takeProfit = ${O.takeProfit} (should be TP price for ${d} ticks)`),console.log(`\\u2705 TP VALIDATION: Expected=${h}, Actual=${O.takeProfit}, Match=${h===O.takeProfit?\"\\u2705\":\"\\u274C\"}`),h!==O.takeProfit&&console.error(`\\u{1F6A8} TP MISMATCH: Expected ${h} but got ${O.takeProfit} - this indicates a calculation error!`),console.log(\"\\u{1F680} [ORDER EXECUTION] About to submit bracket orders with tradeData:\",O),console.log(\"\\u{1F680} [ORDER EXECUTION] Calling createBracketOrdersManual...\"),H(O).then(I=>(console.log(\"\\u2705 [ORDER EXECUTION] createBracketOrdersManual SUCCESS:\",I),I)).catch(I=>{throw console.error(\"\\u274C [ORDER EXECUTION] createBracketOrdersManual ERROR:\",I),I}).finally(()=>{let I=N[c],F=document.getElementById(\"slInput\"),L=document.getElementById(\"tpInput\")})}catch(p){throw console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Critical error in autoTrade function:\",p),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Stack trace:\",p.stack),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Function parameters:\",{inputSymbol:t,quantity:s,action:i,takeProfitTicks:l,stopLossTicks:u,_tickSize:a,explicitOrderType:y}),p}}function j(t){console.log(`getFrontQuarter called for root: \"${t}\"`);let{letter:s,yearDigit:i}=z();console.log(`Got quarterly code: letter=${s}, yearDigit=${i}`);let l=`${t.toUpperCase()}${s}${i}`;return console.log(`Returning front quarter symbol: \"${l}\"`),l}function X(t){console.log(`getMarketData called for: \"${t}\"`);let s=/^[A-Z]{1,3}$/.test(t)?j(t):t.toUpperCase();console.log(`Using symbol: \"${s}\" for market data lookup`);let l=(document.querySelector(\".quoteboard.module.data-table\")||document).querySelectorAll(\".public_fixedDataTable_bodyRow\"),u=null;for(let c of l){let n=c.querySelectorAll(\".public_fixedDataTableCell_cellContent\");if(!n.length)continue;if((n[0].textContent||\"\").trim().toUpperCase()===s){u=c;break}}if(!u)return console.error(`Row for symbol \"${s}\" not found in data table`),alert(`Cannot Find ${t}`),null;let a=u.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),y=a[4]?.textContent.trim(),p=a[5]?.textContent.trim();return console.log(`Extracted prices for ${s}: bid=${y}, offer=${p}`),{symbol:s,bidPrice:y,offerPrice:p}}var de=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function pe(t=new Date){console.log(`getMonthlyCode called with date: ${t.toISOString()}`);let s=de[t.getUTCMonth()],i=t.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${s}, yearDigit=${i}`),{letter:s,yearDigit:i}}function z(t=new Date){console.log(`getQuarterlyCode called with date: ${t.toISOString()}`);let s=[2,5,8,11],i={2:\"H\",5:\"M\",8:\"U\",11:\"Z\"};function l(n,o){let S=1+(5-new Date(Date.UTC(n,o,1)).getUTCDay()+7)%7+14;return new Date(Date.UTC(n,o,S,0,0,0))}let u=t.getUTCFullYear(),a=t.getUTCMonth();console.log(`Current month index: ${a}`),console.log(`Starting calculation with year=${u}, month=${a}`);let y=0;for(;!s.includes(a)&&(a++,a>11&&(a=0,u++),!(++y>12)););let p=l(u,a);t.getTime()>=p.getTime()&&(a+=3,a>11&&(a-=12,u++));let c={letter:i[a],yearDigit:u%10+\"\"};return console.log(`Calculated quarterly code: letter=${c.letter}, yearDigit=${c.yearDigit}`),c}console.log(\"Creating example front-quarter symbol\");var{letter:fe,yearDigit:me}=z(),ge=`NQ${fe}${me}`;console.log(`Example front-quarter symbol created: ${ge}`);var B={initialized:!1,options:{}},x=null;function G(t={}){B.initialized=!0,B.options={...t},t.panel&&_(t.panel)}function _(t){x=t}function J(){return x?.mount?x.mount({visible:!1}):x?.createUI?x.createUI(!1):(console.warn(\"[TradoAuto] No UI adapter registered; skipping invisible UI creation\"),null)}var ye={state:D,futuresTickData:N,delay:w,normalizeSymbol:ue,updateSymbol:se,updatePrice:ae,clickExitForSymbol:ie,moveStopLossToBreakeven:ce,getCurrentPosition:V,captureOrderFeedback:K,getOrderEvents:Z,createBracketOrdersManual:H,autoTrade:q,getFrontQuarter:j,getMarketData:X,getMonthlyCode:pe,getQuarterlyCode:z,init:G,registerUIPanel:_,createInvisibleUI:J,getInitStatus:()=>({...B})};function W(t={}){return G(t),ye}var Y=W();typeof window<\"u\"&&(window.TradoAuto=Y);var Te=Y;return re(Ee);})();\n//# sourceMappingURL=tradovate_auto_driver.js.map\n";
    const panelSource = "var TradovateUIPanelBundle=(()=>{var N=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var re=(e,c)=>{for(var l in c)N(e,l,{get:c[l],enumerable:!0})},ie=(e,c,l,i)=>{if(c&&typeof c==\"object\"||typeof c==\"function\")for(let m of ne(c))!le.call(e,m)&&m!==l&&N(e,m,{get:()=>c[m],enumerable:!(i=oe(c,m))||i.enumerable});return e};var ce=e=>ie(N({},\"__esModule\",{value:!0}),e);var $e={};re($e,{createUIPanel:()=>te,default:()=>Se});console.log(\"Auto Order script initialized - AUTOMATIC HOT RELOAD SUCCESS!\");function O(e){return console.log(`Delaying for ${e}ms`),new Promise(c=>setTimeout(c,e))}var M={symbol:\"NQ\",tickSize:.25,tp:null,sl:null,qty:10,entryPrice:null,tpPrice:null,slPrice:null,tpEnabled:!0,slEnabled:!0};async function se(e,c=\"cancel-option-Exit-at-Mkt-Cxl\"){let l={exit:\"cancel-option-Exit-at-Mkt-Cxl\",reverse:\"cancel-option-Reverse-Cxl\",\"cancel-all\":\"cancel-option-Cancel-All\",\"cancel-bids\":\"cancel-option-Cancel-Bids\",\"cancel-offers\":\"cancel-option-Cancel-Offers\"},i={\"cancel-option-Exit-at-Mkt-Cxl\":/EXIT\\s*AT\\s*MKT/i,\"cancel-option-Reverse-Cxl\":/REVERSE\\s*&\\s*CXL/i,\"cancel-option-Cancel-All\":/CANCEL\\s*ALL/i,\"cancel-option-Cancel-Bids\":/CANCEL\\s*BIDS/i,\"cancel-option-Cancel-Offers\":/CANCEL\\s*OFFERS/i},m=S=>(S||\"\").replace(/[\\u2000-\\u200F\\u2028\\u2029\\u202F\\u00A0]/g,\" \").replace(/\\s+/g,\" \").trim().toUpperCase(),a=S=>new Promise(v=>setTimeout(v,S));async function T(S,{timeout:v=1200,interval:t=50}={}){let $=performance.now();for(;performance.now()-$<v;){let h=S();if(h)return h;await a(t)}return null}let f=c.toLowerCase(),s=l[f]||c,r=i[s]||null,n=m(e),g=/^[A-Z]{1,3}$/.test(n),u=[...document.querySelectorAll(\".header .contract-symbol span\")].find(S=>{let v=m(S.textContent);if(v===n)return!0;if(g&&v.startsWith(n)){let t=v.substring(n.length);return/^[FGHJKMNQUVXZ]\\d+$/.test(t)}return!1});if(!u)return console.error(\"clickExitForSymbol: contract header not found\"),!1;let I=u.closest(\".header\")?.querySelector(\".dropdown.btn-group.btn-split.btn-group-default\"),C=I?.querySelector(\".btn.btn-default:not(.dropdown-toggle)\"),E=I?.querySelector(\".dropdown-toggle.btn.btn-default\");if(!I||!C||!E)return console.error(\"clickExitForSymbol: split button not found\"),!1;if(r?r.test(m(C.textContent)):!1)return C.click(),!0;E.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}));let R=()=>[...document.querySelectorAll(\".dropdown-menu\")].filter(S=>S.offsetParent!==null||/display\\s*:\\s*block/i.test(S.getAttribute(\"style\")||\"\")||!!S.closest(\".open\")),d=await T(R,{timeout:900,interval:40});if(!d||!d.length)return console.error(\"clickExitForSymbol: dropdown menu not visible\"),!1;let y=E.getBoundingClientRect();d.sort((S,v)=>{let t=S.getBoundingClientRect(),$=v.getBoundingClientRect(),h=Math.hypot(t.left-y.left,t.top-y.bottom),P=Math.hypot($.left-y.left,$.top-y.bottom);return h-P});let A=d[0],p=document.getElementById(s);if(!p&&r){for(let S of d)if(p=[...S.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')].find(v=>r.test(m(v.textContent))),p){A=S;break}}if(!p)return console.error(\"clickExitForSymbol: desired menu item not found\"),!1;let o=p.tagName?p.matches(\"a,button\")?p:p.querySelector(\"a,button\")||p:p;return[\"mousedown\",\"mouseup\",\"click\"].forEach(S=>o.dispatchEvent(new MouseEvent(S,{bubbles:!0}))),E.click(),await a(120),d=R(),p=document.getElementById(s)||(r?d?.flatMap(S=>[...S.querySelectorAll('a[role=\"menuitem\"], a, button, li, span')]).find(S=>r.test(m(S.textContent))):null),p?([\"mousedown\",\"mouseup\",\"click\"].forEach(S=>(p.querySelector(\"a,button\")||p).dispatchEvent(new MouseEvent(S,{bubbles:!0}))),await a(80),C.click(),!0):(console.error(\"clickExitForSymbol: primary did not update; giving up\"),!1)}function ae(e){console.log(`moveStopLossToBreakeven called for symbol: ${e}`);let c=_(e);if(!c){console.log(`No open position found for ${e}`);return}console.log(`Found position for ${e}:`,c);let l=c.entryPrice,i=c.quantity>0,m=e.replace(/[A-Z]\\d+$/,\"\"),a=B[m],f=(a?.tickSize||.25)*2,s=i?(l+f).toFixed(a?.precision||2):(l-f).toFixed(a?.precision||2);console.log(`Calculated breakeven price: ${s} (entry: ${l}, isLong: ${i}, buffer: ${f})`);let r=document.querySelectorAll(\".module.module-dom\"),n=0;for(let g of r){let u=g.querySelector(\".contract-symbol span\"),b=u?u.textContent.trim().toUpperCase():\"\",I=e.toUpperCase(),C=/^[A-Z]{1,3}$/.test(I);if(b===I||C&&b.startsWith(I)&&/^[FGHJKMNQUVXZ]\\d+$/.test(b.substring(I.length))){let E=g.querySelector(\".order-type\");if(E&&E.textContent.includes(\"STOP\")){console.log(`Found stop order for ${e}, updating to breakeven`);let k=g.querySelector('input[type=\"number\"], .numeric-input input');k?(console.log(`Updating stop price from ${k.value} to ${s}`),k.focus(),k.value=s,k.dispatchEvent(new Event(\"input\",{bubbles:!0})),k.dispatchEvent(new Event(\"change\",{bubbles:!0})),k.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),n++,console.log(`Stop order ${n} updated to breakeven`)):console.log(\"Price input not found for stop order\")}}}n>0?console.log(`\\u2705 Successfully moved ${n} stop order(s) to breakeven for ${e}`):console.log(`\\u26A0\\uFE0F No stop orders found to update for ${e}`)}function _(e){console.log(`getCurrentPosition called for symbol: ${e}`);let c=document.querySelectorAll(\".module.module-dom\");for(let i of c){let m=i.querySelector(\".contract-symbol span\"),a=m?m.textContent.trim().toUpperCase():\"\",T=e.toUpperCase(),f=/^[A-Z]{1,3}$/.test(T);if(a===T||f&&a.startsWith(T)&&/^[FGHJKMNQUVXZ]\\d+$/.test(a.substring(T.length))){let s=i.querySelector(\".position-quantity, .quantity\"),r=i.querySelector(\".avg-price, .entry-price, .price\");if(s&&r){let n=parseFloat(s.textContent.replace(/[^\\d.-]/g,\"\")),g=parseFloat(r.textContent.replace(/[^\\d.-]/g,\"\"));if(!isNaN(n)&&!isNaN(g)&&n!==0)return console.log(`Found position: qty=${n}, entry=${g}`),{quantity:n,entryPrice:g}}}}let l=document.querySelectorAll(\".portfolio-row, .position-row\");for(let i of l){let m=i.querySelector(\".symbol, .contract-symbol\"),a=m?m.textContent.trim().toUpperCase():\"\",T=e.toUpperCase(),f=/^[A-Z]{1,3}$/.test(T);if(a===T||f&&a.startsWith(T)&&/^[FGHJKMNQUVXZ]\\d+$/.test(a.substring(T.length))){let s=i.querySelectorAll(\"td, .cell\");for(let r=0;r<s.length;r++){let n=s[r].textContent.trim(),g=parseFloat(n.replace(/[^\\d.-]/g,\"\"));if(!isNaN(g)&&g!==0)for(let u=r+1;u<Math.min(r+4,s.length);u++){let b=s[u].textContent.trim(),I=parseFloat(b.replace(/[^\\d.-]/g,\"\"));if(!isNaN(I)&&I>0)return console.log(`Found position from portfolio: qty=${g}, entry=${I}`),{quantity:g,entryPrice:I}}}}}return console.log(`No position data found for ${e}`),null}async function ue(e,c){console.log(`updateSymbol called with selector: \"${e}\", value: \"${c}\"`);let l=document.querySelectorAll(e);if(console.log(`Found ${l.length} matching inputs with selector: ${e}`),l.length===0){let T=['.trading-ticket input[type=\"text\"]',\".order-entry .search-box--input\",\".order-ticket .search-box--input\",\".search-box--input\"];for(let f of T)if(l=document.querySelectorAll(f),l.length>0){console.log(`Using fallback selector: ${f}, found ${l.length} inputs`);break}}let i=l[0]||l[1];if(!i){console.error(\"No matching input elements found with any selector!\"),console.error(\"Tried selectors:\",e,\"and fallbacks\");return}console.log(\"Selected input:\",i),console.log(\"Input location:\",{inTradingTicket:!!i.closest(\".trading-ticket\"),inMarketAnalyzer:!!i.closest(\".market-analyzer, .market-watchlist\"),parentClasses:i.parentElement?.className,placeholder:i.placeholder});let m=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,a=T=>i.dispatchEvent(new KeyboardEvent(T,{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0,cancelable:!0}));console.log(\"Clearing input field\"),m.call(i,\"\"),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await O(400),console.log(`Setting input value to: \"${c}\"`),m.call(i,c),i.focus(),i.dispatchEvent(new Event(\"input\",{bubbles:!0})),await O(900),console.log(\"Simulating Enter key press\"),[\"keydown\",\"keypress\",\"keyup\"].forEach(a),i.dispatchEvent(new Event(\"change\",{bubbles:!0})),console.log(\"Symbol update complete\")}async function de(e){let c=\"input.form-control\";for(let l=0;l<20;l++){let i=document.querySelector(c);if(i&&i.offsetParent){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set.call(i,e),[\"input\",\"change\",\"blur\"].forEach(a=>i.dispatchEvent(new Event(a,{bubbles:!0}))),await O(300);return}await O(100)}console.error(\"Price input not found\")}function pe(e){console.log(`normalizeSymbol called with: \"${e}\"`);let c=/^[A-Z]{1,3}$/.test(e);console.log(`Is root symbol: ${c}`);let l=c?K(e):e.toUpperCase();return console.log(`Normalized symbol: \"${l}\"`),l}async function H(e){console.log(\"Creating bracket orders with data:\",e);let c=document.getElementById(\"tpCheckbox\").checked,l=document.getElementById(\"slCheckbox\").checked;console.log(`TP enabled: ${c}, SL enabled: ${l}`);async function i(n,g){let u=[...document.querySelectorAll(\".trading-ticket\")].find(E=>E.offsetParent);if(!u)return console.error(\"No visible trading ticket\");let b;for(let E=0;E<25&&(b=[...u.querySelectorAll(n)].find(k=>k.offsetParent&&!k.disabled),!b);E++)await O(100);if(!b)return console.error(`No live input for ${n}`);let I=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,\"value\").set,C=b.closest(\".select-input.combobox\");C&&!b.value&&(C.querySelector(\".btn\")?.click(),await O(150),C.querySelector(\".dropdown-menu li\")?.click(),await O(150));for(let E=0;E<3&&(b.focus(),I.call(b,g),b.dispatchEvent(new Event(\"input\",{bubbles:!0})),b.dispatchEvent(new Event(\"change\",{bubbles:!0})),b.dispatchEvent(new KeyboardEvent(\"keydown\",{key:\"Enter\",code:\"Enter\",keyCode:13,which:13,bubbles:!0})),b.blur(),await O(250),`${b.value}`.trim()!==`${g}`);E++);}async function m(){if(console.log(\"Setting common order fields\"),e.action){console.log(`Setting action to: ${e.action}`);let n=document.querySelectorAll(\".radio-group.btn-group label\");console.log(`Found ${n.length} action labels`),n.forEach(g=>{g.textContent.trim()===e.action&&(console.log(`Clicking ${e.action} label`),g.click())})}e.qty&&(console.log(`Setting quantity to: ${e.qty}`),await i(\".select-input.combobox input\",e.qty))}function a(n=document){let g=n.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(g,u=>{let b=u.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),I=b[0]?.textContent.trim()||\"\",C=b[1]?.textContent.trim()||\"\",E=b[2]?.textContent.trim()||\"\",k=b[3]?.textContent.trim()||\"\",R=null,d=E.match(/@([\\d.]+)/);return d&&(R=Number(d[1])),{timestamp:I,id:C,event:E,comment:k,fillPrice:R}})}function T(n=\"up\"){let g=document.querySelector(\".numeric-input-value-controls\");if(!g)return;g.querySelector(n===\"up\"?\".numeric-input-increment\":\".numeric-input-decrement\")?.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0}))}async function f(n,g){console.log(`\\u{1F527} Starting submitOrder for ${n} order`),console.log(`\\u{1F50D} DEBUG: submitOrder called with orderType=${n}, priceValue=${g}`),await m();let u=document.querySelector(\".group.order-type .select-input div[tabindex]\");if(!u)return console.error(\"\\u274C Order type dropdown not found!\"),{success:!1,error:\"Order type dropdown not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(`\\u{1F4CB} Setting order type to: ${n}`),u.click(),await O(200);let b=[...document.querySelectorAll(\"ul.dropdown-menu li\")],I=b.map(A=>A.textContent.trim());console.log(\"[submitOrder] Available order type options:\",I),window.lastOrderTypeOptions=I,window.lastOrderTypeDebug={orderType:n,availableTypes:I,dropdownHTML:document.querySelector(\".group.order-type\")?.outerHTML,timestamp:new Date().toISOString()};let C=n.toUpperCase(),k={MARKET:[\"MARKET\",\"MARKET ORDER\"],LIMIT:[\"LIMIT\",\"LIMIT ORDER\"],STOP:[\"STOP\",\"STOP MARKET\",\"STOP ORDER\"],\"STOP LIMIT\":[\"STOP LIMIT\",\"STOP-LIMIT\"],\"TRL STOP\":[\"TRAILING STOP\",\"TRAIL STOP\"],\"TRL STP LMT\":[\"TRAILING STOP LIMIT\",\"TRL STP LMT\"]}[C]||[n],R=b.find(A=>k.includes(A.textContent.trim()))||b.find(A=>A.textContent.trim().toUpperCase()===C);if(!R)return console.error(`\\u274C Order type option '${n}' not found!`),{success:!1,error:`Order type option '${n}' not found`,orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};R.click(),await O(500),g&&(console.log(`\\u{1F4B0} Setting price to: ${g}`),console.log(`\\u{1F50D} DEBUG: About to set price input to: ${g} (type: ${typeof g})`),await i(\".numeric-input.feedback-wrapper input\",g)),T();let d=document.querySelector(\".btn-group .btn-primary\");if(!d)return console.error(\"\\u274C Submit button not found!\"),{success:!1,error:\"Submit button not found\",orders:[],symbol:null,summary:null,rejectionReason:\"UI validation error\",filledCount:0,rejectedCount:1};console.log(\"\\u{1F680} Clicking submit button...\"),d.click(),await O(500),console.log(a()),console.log(\"\\u23F3 Waiting for order to appear in history...\"),await O(1e3),console.log(\"\\u{1F4CA} Capturing order feedback from submitOrder...\");let y=await z();return y?.rejectionReason?console.log(`\\u2705 submitOrder captured REJECTION: ${y.rejectionReason}`):y?.success&&y?.orders?.length>0?console.log(`\\u2705 submitOrder captured SUCCESS: ${y.orders.length} orders`):y?.error?console.log(`\\u26A0\\uFE0F submitOrder captured ERROR: ${y.error}`):console.log(\"\\u26A0\\uFE0F submitOrder captured UNKNOWN result:\",y),document.querySelector(\".icon.icon-back\")?.click(),await O(200),y}console.log(`\\u{1F4CD} BRACKET STEP 3: Submitting initial ${e.orderType||\"MARKET\"} order...`),console.log(`  Order type: ${e.orderType||\"MARKET\"}`),console.log(`  Entry price: ${e.entryPrice||\"Market price\"}`),console.log(`  Action: ${e.action}`),console.log(`  Quantity: ${e.qty}`);let s=await f(e.orderType||\"MARKET\",e.entryPrice);console.log(\"\\u{1F4CA} Main order result:\",s);let r={success:s?.success||!1,orders:s?.orders||[],symbol:s?.symbol||null,summary:s?.summary||null,rejectionReason:s?.rejectionReason||null,filledCount:s?.filledCount||0,rejectedCount:s?.rejectedCount||0,error:s?.error||null,mainOrder:s,tpOrder:null,slOrder:null};if(s?.rejectionReason||s?.error||!s?.success)return console.log(\"\\u274C Main order rejected/failed - skipping TP/SL orders\"),console.log(`   Rejection reason: ${s?.rejectionReason||s?.error||\"Unknown\"}`),console.log(\"Bracket order creation complete (main order rejected)\"),r;if(console.log(\"\\u2705 Main order successful - proceeding with TP/SL orders\"),e.action===\"Buy\"){if(console.log(\"Flipping action to Sell for TP/SL orders\"),e.action=\"Sell\",c){console.log(`Creating take profit order at ${e.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${e.takeProfit}`);let n=await f(\"LIMIT\",e.takeProfit);r.tpOrder=n,n?.orders?.length&&(r.orders=[...r.orders,...n.orders]),n?.filledCount&&(r.filledCount+=n.filledCount),n?.rejectedCount&&(r.rejectedCount+=n.rejectedCount)}if(l){console.log(`Creating stop loss order at ${e.stopLoss}`);let n=await f(\"STOP\",e.stopLoss);r.slOrder=n,n?.orders?.length&&(r.orders=[...r.orders,...n.orders]),n?.filledCount&&(r.filledCount+=n.filledCount),n?.rejectedCount&&(r.rejectedCount+=n.rejectedCount)}}else{if(console.log(\"Flipping action to Buy for TP/SL orders\"),e.action=\"Buy\",c){console.log(`Creating take profit order at ${e.takeProfit}`),console.log(`\\u{1F50D} DEBUG: About to submit TP LIMIT order at price: ${e.takeProfit}`);let n=await f(\"LIMIT\",e.takeProfit);r.tpOrder=n,n?.orders?.length&&(r.orders=[...r.orders,...n.orders]),n?.filledCount&&(r.filledCount+=n.filledCount),n?.rejectedCount&&(r.rejectedCount+=n.rejectedCount)}if(l){console.log(`Creating stop loss order at ${e.stopLoss}`);let n=await f(\"STOP\",e.stopLoss);r.slOrder=n,n?.orders?.length&&(r.orders=[...r.orders,...n.orders]),n?.filledCount&&(r.filledCount+=n.filledCount),n?.rejectedCount&&(r.rejectedCount+=n.rejectedCount)}}return console.log(\"\\u{1F4CA} Final bracket feedback aggregation:\"),console.log(`   Overall success: ${r.success}`),console.log(`   Total orders: ${r.orders.length}`),console.log(`   Filled count: ${r.filledCount}`),console.log(`   Rejected count: ${r.rejectedCount}`),console.log(`   Main order: ${r.mainOrder?.success?\"Success\":\"Failed\"}`),console.log(`   TP order: ${r.tpOrder?.success?\"Success\":r.tpOrder?\"Failed\":\"N/A\"}`),console.log(`   SL order: ${r.slOrder?.success?\"Success\":r.slOrder?\"Failed\":\"N/A\"}`),console.log(\"Bracket order creation complete\"),r}function X(e=document){let c=e.querySelectorAll(\".order-history-content .public_fixedDataTable_bodyRow\");return Array.from(c,l=>{let i=l.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),m=i[0]?.textContent.trim()||\"\",a=i[1]?.textContent.trim()||\"\",T=i[2]?.textContent.trim()||\"\",f=i[3]?.textContent.trim()||\"\",s=null,r=T.match(/@([\\d.]+)/);return r&&(s=Number(r[1])),{timestamp:m,id:a,event:T,comment:f,fillPrice:s}})}async function z(){console.log(\"\\u{1F504} CAPTURING TRADOVATE ORDER FEEDBACK...\"),await O(500);let e=document.querySelector(\".order-history\");if(!e)return console.log(\"\\u274C Order history div not found - no feedback to capture\"),{success:!1,orders:[],rejectionReason:null,error:\"Order history not found\"};console.log(\"\\u2705 Found order history div - capturing feedback...\");let c=e.querySelector(\".trading-ticket-header\"),l=\"UNKNOWN\",i=null,m=null,a=null,T=null,f=null;if(c){let t=c.querySelector('div[style*=\"font-size: 160%\"]'),$=t?t.textContent.trim():\"UNKNOWN\",h=c.querySelector(\"div:last-child\"),P=h?h.textContent.trim():\"No summary\";P.includes(\" MKT \")?l=\"MARKET\":P.includes(\" LMT \")?l=\"LIMIT\":P.includes(\" STP LMT \")?l=\"STOP_LIMIT\":P.includes(\" STP \")&&(l=\"STOP\");let x=P.match(/#(\\d+)/);T=x?x[1]:null,a=P.includes(\"Buy\")?\"Buy\":P.includes(\"Sell\")?\"Sell\":null;let w=P.match(/(\\d+)\\s+[A-Z]+\\d*\\s+(?:MKT|LMT|STP)/);m=w?parseInt(w[1]):null;let L=P.match(/LMT at ([\\d.]+)/);i=L?parseFloat(L[1]):null;let F=P.match(/(\\d+)\\/(\\d+)/);f=F?{filled:parseInt(F[1]),total:parseInt(F[2]),isPartial:parseInt(F[1])<parseInt(F[2]),percentFilled:(parseInt(F[1])/parseInt(F[2])*100).toFixed(2)}:null,console.log(`\\u{1F4CA} ORDER FEEDBACK - Symbol: ${$}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Summary: ${P}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order Type: ${l}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Order ID: ${T}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Action: ${a}`),console.log(`\\u{1F4CA} ORDER FEEDBACK - Quantity: ${m}`),i&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Requested Price: ${i}`),f&&console.log(`\\u{1F4CA} ORDER FEEDBACK - Fill Status: ${f.filled}/${f.total} (${f.percentFilled}%${f.isPartial?\" - PARTIAL FILL\":\" - COMPLETE\"})`)}let s=X(e);console.log(`\\u{1F4CA} ORDER FEEDBACK - Events (${s.length} found):`),s.forEach((t,$)=>{console.log(`\\u{1F4CA} EVENT ${$+1}:`,{timestamp:t.timestamp,id:t.id,event:t.event,comment:t.comment,fillPrice:t.fillPrice})}),console.log(\"\\u{1F4CA} ORDER FEEDBACK - Full HTML Structure:\"),console.log(e.outerHTML);let r=s.filter(t=>t.fillPrice!==null).map(t=>{let $=t.event.match(/(\\d+)@([\\d.]+)/);return{timestamp:t.timestamp,id:t.id,price:t.fillPrice,quantity:$?parseInt($[1]):null,eventText:t.event}}),n=null,g=null,u=[];s.forEach(t=>{if(t.event.includes(\"STP\")||t.comment.includes(\"Stop\")){let $=t.event.match(/#?(\\d+)/);__UI_PANEL_BUNDLE__&(n=$[1],u.push({type:\"STOP_LOSS\",orderId:n,event:t}))}if(t.event.includes(\"LMT\")&&(t.comment.includes(\"Profit\")||t.comment.includes(\"Target\"))){let $=t.event.match(/#?(\\d+)/);__UI_PANEL_BUNDLE__&$[1]!==T&&(g=$[1],u.push({type:\"TAKE_PROFIT\",orderId:g,event:t}))}(t.comment.includes(\"bracket\")||t.comment.includes(\"OCO\"))&&console.log(`\\u{1F4CA} BRACKET ORDER DETECTED - Event: ${t.event}, Comment: ${t.comment}`)}),u.length>0&&(console.log(`\\u{1F4CA} BRACKET ORDERS FOUND: ${u.length} orders`),u.forEach(t=>{console.log(`\\u{1F4CA} ${t.type} Order ID: ${t.orderId}`)}));let b=null,I=[],C=0;s.forEach(t=>{let $=t.comment.match(/commission[:\\s]+\\$?([\\d.]+)/i)||t.event.match(/commission[:\\s]+\\$?([\\d.]+)/i);__UI_PANEL_BUNDLE__&(b=parseFloat($[1]),C+=b,console.log(`\\u{1F4CA} COMMISSION FOUND: ${b}`));let h=t.comment.match(/fee[:\\s]+\\$?([\\d.]+)/i)||t.event.match(/fee[:\\s]+\\$?([\\d.]+)/i);if(h){let P=parseFloat(h[1]);I.push({amount:P,description:t.comment||t.event,timestamp:t.timestamp}),C+=P,console.log(`\\u{1F4CA} FEE FOUND: ${P}`)}if(t.comment.includes(\"Exchange\")||t.event.includes(\"Exchange\")){let P=t.comment.match(/\\$?([\\d.]+)/)||t.event.match(/\\$?([\\d.]+)/);if(P){let x=parseFloat(P[1]);I.push({amount:x,description:\"Exchange Fee\",timestamp:t.timestamp})}}});let E={submittedAt:null,firstFillAt:null,completedAt:null,timeToFill:null,riskCheckTime:null};if(s.length>0){E.submittedAt=s[0].timestamp;let t=s.find(w=>w.event.includes(\"Risk Passed\"));if(t){let w=new Date(E.submittedAt),L=new Date(t.timestamp);E.riskCheckTime=L-w,console.log(`\\u{1F4CA} TIMING - Risk check completed in ${E.riskCheckTime}ms`)}let $=r[0];if($){E.firstFillAt=$.timestamp;let w=new Date(E.submittedAt),L=new Date(E.firstFillAt);E.timeToFill=L-w,console.log(`\\u{1F4CA} TIMING - First fill in ${E.timeToFill}ms`)}E.completedAt=s[s.length-1].timestamp;let h=new Date(E.submittedAt),x=new Date(E.completedAt)-h;E.totalDuration=x,console.log(`\\u{1F4CA} TIMING - Order completed in ${x}ms total`),console.log(`\\u{1F4CA} TIMING - Submitted: ${E.submittedAt}`),console.log(`\\u{1F4CA} TIMING - Completed: ${E.completedAt}`)}let k=s.filter(t=>t.fillPrice!==null).map(t=>t.fillPrice),R=k.length>0?k.reduce((t,$)=>t+$,0)/k.length:null,d=null;l===\"LIMIT\"&&i&&R&&(a===\"Buy\"?d=i-R:a===\"Sell\"&&(d=R-i));let y=null,A=null;if(l===\"MARKET\"&&R){let t=c?.querySelector('div[style*=\"font-size: 160%\"]'),h=(t?t.textContent.trim():\"\").replace(/[A-Z]\\d+$/,\"\"),x=B[h]?.tickSize||.25;if(k.length>1){let w=Math.min(...k),L=Math.max(...k),F=L-w,V=Math.round(F/x);y={priceRange:F,priceRangeTicks:V,minFillPrice:w,maxFillPrice:L,fillCount:k.length,tickSize:x,note:\"Slippage calculated from fill price range. Mid-price at submission not available.\"},console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Price range: ${F} (${V} ticks)`),console.log(`\\u{1F4CA} MARKET ORDER SLIPPAGE - Fills ranged from ${w} to ${L}`)}else k.length===1&&(y={fillPrice:k[0],tickSize:x,note:\"Single fill. Slippage cannot be calculated without mid-price at submission.\"},console.log(`\\u{1F4CA} MARKET ORDER - Single fill at ${k[0]}`))}let p=e.textContent,o={success:!1,orders:s||[],rejectionReason:null,error:null,orderId:T,orderType:l,orderAction:a,orderQuantity:m,requestedPrice:i,averageFillPrice:R,priceImprovement:d,fillPrices:k,fillRatio:f,fillEvents:r,slippage:y,stopLossOrderId:n,takeProfitOrderId:g,bracketOrders:u,commission:b,fees:I,totalCost:C>0?C:null,timingMetrics:E,priceComparison:null};i&&R&&(o.priceComparison={requested:i,filled:R,difference:R-i,percentDifference:((R-i)/i*100).toFixed(3),improvement:d,analysis:d>0?\"BETTER_THAN_REQUESTED\":d<0?\"WORSE_THAN_REQUESTED\":\"FILLED_AT_REQUESTED\"},console.log(`\\u{1F4CA} PRICE COMPARISON - Requested: ${i}, Filled: ${R}`),console.log(`\\u{1F4CA} PRICE COMPARISON - Difference: ${o.priceComparison.difference} (${o.priceComparison.percentDifference}%)`),console.log(`\\u{1F4CA} PRICE COMPARISON - Analysis: ${o.priceComparison.analysis}`)),p.includes(\"Rejected\")?(console.log(\"\\u274C ORDER REJECTED - checking rejection reason...\"),p.includes(\"outside of market hours\")?(console.log(\"\\u274C REJECTION REASON: Order placed outside market hours\"),o.rejectionReason=\"Order placed outside market hours\"):p.includes(\"Risk\")?(console.log(\"\\u274C REJECTION REASON: Risk management violation\"),o.rejectionReason=\"Risk management violation\"):(console.log(\"\\u274C REJECTION REASON: Other - check full feedback above\"),o.rejectionReason=\"Order rejected\")):p.includes(\"Risk Passed\")?(console.log(\"\\u2705 RISK MANAGEMENT: Order passed risk checks\"),o.success=!0):s.length>0&&(o.success=!0);let v=(()=>{let t=`\n\\u{1F4CA} \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550 ORDER VERIFICATION REPORT \\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`;return t+=`\n\\u{1F538} ORDER DETAILS:\n`,t+=`   Order ID: ${o.orderId||\"N/A\"}\n`,t+=`   Type: ${o.orderType}\n`,t+=`   Action: ${o.orderAction} ${o.orderQuantity||\"N/A\"} units\n`,t+=`   Status: ${o.success?\"\\u2705 SUCCESS\":\"\\u274C FAILED\"}\n`,o.orderType===\"LIMIT\"&&o.priceComparison&&(t+=`\n\\u{1F538} PRICE VERIFICATION:\n`,t+=`   Requested: ${o.requestedPrice}\n`,t+=`   Filled: ${o.averageFillPrice}\n`,t+=`   Difference: ${o.priceComparison.difference} (${o.priceComparison.percentDifference}%)\n`,t+=`   Result: ${o.priceComparison.analysis}\n`),o.orderType===\"MARKET\"&&o.slippage&&(t+=`\n\\u{1F538} MARKET ORDER SLIPPAGE:\n`,o.slippage.priceRange!==void 0&&(t+=`   Fill Range: ${o.slippage.priceRange} (${o.slippage.priceRangeTicks} ticks)\n`,t+=`   Min Fill: ${o.slippage.minFillPrice}\n`,t+=`   Max Fill: ${o.slippage.maxFillPrice}\n`)),o.fillRatio&&(t+=`\n\\u{1F538} FILL INFORMATION:\n`,t+=`   Fill Ratio: ${o.fillRatio.filled}/${o.fillRatio.total} (${o.fillRatio.percentFilled}%)\n`,t+=`   Status: ${o.fillRatio.isPartial?\"\\u26A0\\uFE0F PARTIAL FILL\":\"\\u2705 COMPLETE FILL\"}\n`,o.fillEvents.length>0&&(t+=`   Individual Fills:\n`,o.fillEvents.forEach(($,h)=>{t+=`     ${h+1}. ${$.quantity||\"N/A\"} @ ${$.price} (${$.timestamp})\n`}))),o.bracketOrders.length>0&&(t+=`\n\\u{1F538} BRACKET ORDERS:\n`,o.stopLossOrderId&&(t+=`   Stop Loss: #${o.stopLossOrderId}\n`),o.takeProfitOrderId&&(t+=`   Take Profit: #${o.takeProfitOrderId}\n`)),o.timingMetrics.timeToFill&&(t+=`\n\\u{1F538} EXECUTION TIMING:\n`,t+=`   Time to Fill: ${o.timingMetrics.timeToFill}ms\n`,o.timingMetrics.riskCheckTime&&(t+=`   Risk Check: ${o.timingMetrics.riskCheckTime}ms\n`),t+=`   Total Duration: ${o.timingMetrics.totalDuration||\"N/A\"}ms\n`),(o.commission||o.totalCost)&&(t+=`\n\\u{1F538} COSTS:\n`,o.commission&&(t+=`   Commission: ${o.commission}\n`),o.fees.length>0&&(t+=`   Fees: ${o.fees.length} fee(s) totaling ${o.fees.reduce(($,h)=>$+h.amount,0)}\n`),o.totalCost&&(t+=`   Total Cost: ${o.totalCost}\n`)),o.rejectionReason&&(t+=`\n\\u{1F538} REJECTION DETAILS:\n`,t+=`   Reason: ${o.rejectionReason}\n`),t+=`\n\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\\u2550\n`,t})();return console.log(v),o.verificationReport=v,z.lastResult=o,window.lastOrderFeedback=o,console.log(\"\\u{1F504} ORDER FEEDBACK CAPTURE COMPLETE\"),console.log(\"\\u{1F4A1} TIP: Access last feedback with: window.lastOrderFeedback\"),o}var B={MNQ:{tickSize:.25,tickValue:.5,defaultSL:15,defaultTP:200,precision:2},NQ:{tickSize:.25,tickValue:5,defaultSL:15,defaultTP:200,precision:2},ES:{tickSize:.25,tickValue:12.5,defaultSL:40,defaultTP:100,precision:2},RTY:{tickSize:.1,tickValue:5,defaultSL:90,defaultTP:225,precision:1},YM:{tickSize:1,tickValue:5,defaultSL:10,defaultTP:25,precision:0},CL:{tickSize:.01,tickValue:10,defaultSL:50,defaultTP:100,precision:2},GC:{tickSize:.1,tickValue:10,defaultSL:15,defaultTP:30,precision:1},MGC:{tickSize:.1,tickValue:1,defaultSL:15,defaultTP:30,precision:1}};function U(e,c=1,l=\"Buy\",i=null,m=null,a=.25,T=null){console.log(`\\u{1F680} [AUTOTRADE START] autoTrade called with: symbol=${e}, qty=${c}, action=${l}, TP=${i}, SL=${m}, tickSize=${a}, orderType=${T}`),console.log(`\\u{1F680} [AUTOTRADE START] Function entry successful at ${new Date().toISOString()}`);try{console.log(`\\u{1F50D} [DEBUG] TP ticks input parameter = ${i} (type: ${typeof i})`);let f=M.symbol||\"NQ\";console.log(`\\u{1F50D} [SYMBOL] Using symbol: ${f}`),console.log(`\\u{1F50D} [SYMBOL] currentState.symbol = ${M.symbol}`);let s=f.replace(/[A-Z]\\d+$/,\"\");console.log(`\\u{1F50D} [SYMBOL] Root symbol: ${s}`),console.log(`\\u{1F50D} [DATA] Looking up symbolData for ${s}...`);let r=B[s];if(console.log(\"\\u{1F50D} [DATA] symbolData found:\",r),s!==U.lastRootSymbol){M.tickSize=r?.tickSize??\"\";let x=document.getElementById(\"tickInput\");x&&(x.value=M.tickSize)}U.lastRootSymbol=s;let n=r&&typeof r.tickSize==\"number\"?r.tickSize:parseFloat(M.tickSize)||a;M.tickSize=n;let g=document.getElementById(\"tickInput\");g&&(g.value=n);let u=m||r?.defaultSL||parseInt(M.sl)||40,b=i||r?.defaultTP||parseInt(M.tp)||100;console.log(`\\u{1F50D} DEBUG: actualTakeProfitTicks = ${b} (from takeProfitTicks: ${i}, defaultTP: ${r?.defaultTP}, tpInput: ${M.tp})`);let I=r?.tickSize?\"dictionary\":M.tickSize?\"input field\":\"default parameter\";console.log(`Using tick size ${n} (from ${I})`),console.log(`Using SL: ${u} ticks, TP: ${b} ticks`),console.log(`\\u{1F50D} [DEBUG] tickSize = ${n} (symbolData.tickSize: ${r?.tickSize}, tickInput: ${M.tickSize}, _tickSize param: ${a})`),console.log(`\\u{1F4E1} [MARKET DATA] Getting market data for ${f}...`),console.log(`\\u{1F4E1} [MARKET DATA] About to call getMarketData(${f})`);let C=Z(f);if(console.log(\"\\u{1F4E1} [MARKET DATA] getMarketData returned:\",C),!C){console.error(`\\u274C [MARKET DATA] No market data for ${f} - EARLY RETURN!`);return}console.log(\"\\u{1F4E1} [MARKET DATA] Market data received:\",C),console.log(\"\\u{1F4B0} [ORDER PREP] Starting order preparation...\");let E=document.getElementById(\"entryPriceInput\"),k=E&&E.value?parseFloat(E.value):null;console.log(`\\u{1F4B0} [ORDER PREP] Custom entry price: ${k}`);let R=parseFloat(l===\"Buy\"?C.offerPrice:C.bidPrice);console.log(`\\u{1F4B0} [ORDER PREP] Market price: ${R} (${l===\"Buy\"?\"offer\":\"bid\"} price)`);let d=\"MARKET\",y=R;if(console.log(`\\u{1F4B0} [ORDER PREP] Initial order type: ${d}, entry price: ${y}`),T){let x=[\"MARKET\",\"LIMIT\",\"STOP\",\"STOP LIMIT\",\"TRL STOP\",\"TRL STP LMT\"];if(!x.includes(T)){console.error(`Invalid order type: ${T}. Valid types: ${x.join(\", \")}`);return}d=T,console.log(`Using explicit order type: ${d}`),d!==\"MARKET\"&&k!==null?(y=k,console.log(`Using custom entry price: ${y} for ${d} order`)):d!==\"MARKET\"?(y=R,console.log(`Using market price: ${y} for ${d} order`)):d===\"MARKET\"&&(y=R,console.log(`Using market price: ${y} for MARKET order`))}else k!==null?(console.log(`Custom entry price provided: ${k}`),y=k,l===\"Buy\"?d=k<R?\"LIMIT\":\"STOP\":d=k>R?\"LIMIT\":\"STOP\",console.log(`Order type determined to be: ${d}`)):console.log(`No custom entry price provided, using market order at ${R}`);let A=r?.precision??2;console.log(`Using price precision: ${A} decimal places`);let p=document.getElementById(\"slPriceInput\"),o=document.getElementById(\"tpPriceInput\"),S=p&&p.value?parseFloat(p.value):null,v=o&&o.value?parseFloat(o.value):null,t;S!==null?(t=S.toFixed(A),console.log(`Using hardcoded SL price: ${t}`)):(t=(l===\"Buy\"?y-u*n:y+u*n).toFixed(A),console.log(`Calculated SL price: ${t} (${l===\"Buy\"?\"entry - \":\"entry + \"}${u} ticks)`));let $;if(v!==null)$=v.toFixed(A),console.log(`Using hardcoded TP price: ${$}`);else{let x=b*n;console.log(`\\u{1F50D} DEBUG: TP calculation - entryPrice: ${y}, actualTakeProfitTicks: ${b}, tickSize: ${n}, offset: ${x}`),$=(l===\"Buy\"?y+b*n:y-b*n).toFixed(A),console.log(`Calculated TP price: ${$} (${l===\"Buy\"?\"entry + \":\"entry - \"}${b} ticks)`)}let h={symbol:C.symbol,action:l,qty:c.toString(),takeProfit:$,stopLoss:t,orderType:d,entryPrice:d!==\"MARKET\"?y.toFixed(A):null};console.log(\"Trade data prepared:\",h);let P=(l===\"Buy\"?y+b*n:y-b*n).toFixed(A);return console.log(`\\u{1F50D} DEBUG: tradeData.takeProfit = ${h.takeProfit} (should be TP price for ${b} ticks)`),console.log(`\\u2705 TP VALIDATION: Expected=${P}, Actual=${h.takeProfit}, Match=${P===h.takeProfit?\"\\u2705\":\"\\u274C\"}`),P!==h.takeProfit&&console.error(`\\u{1F6A8} TP MISMATCH: Expected ${P} but got ${h.takeProfit} - this indicates a calculation error!`),console.log(\"\\u{1F680} [ORDER EXECUTION] About to submit bracket orders with tradeData:\",h),console.log(\"\\u{1F680} [ORDER EXECUTION] Calling createBracketOrdersManual...\"),H(h).then(x=>(console.log(\"\\u2705 [ORDER EXECUTION] createBracketOrdersManual SUCCESS:\",x),x)).catch(x=>{throw console.error(\"\\u274C [ORDER EXECUTION] createBracketOrdersManual ERROR:\",x),x}).finally(()=>{let x=B[s],w=document.getElementById(\"slInput\"),L=document.getElementById(\"tpInput\")})}catch(f){throw console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Critical error in autoTrade function:\",f),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Stack trace:\",f.stack),console.error(\"\\u{1F4A5} [AUTOTRADE ERROR] Function parameters:\",{inputSymbol:e,quantity:c,action:l,takeProfitTicks:i,stopLossTicks:m,_tickSize:a,explicitOrderType:T}),f}}function K(e){console.log(`getFrontQuarter called for root: \"${e}\"`);let{letter:c,yearDigit:l}=j();console.log(`Got quarterly code: letter=${c}, yearDigit=${l}`);let i=`${e.toUpperCase()}${c}${l}`;return console.log(`Returning front quarter symbol: \"${i}\"`),i}function Z(e){console.log(`getMarketData called for: \"${e}\"`);let c=/^[A-Z]{1,3}$/.test(e)?K(e):e.toUpperCase();console.log(`Using symbol: \"${c}\" for market data lookup`);let i=(document.querySelector(\".quoteboard.module.data-table\")||document).querySelectorAll(\".public_fixedDataTable_bodyRow\"),m=null;for(let s of i){let r=s.querySelectorAll(\".public_fixedDataTableCell_cellContent\");if(!r.length)continue;if((r[0].textContent||\"\").trim().toUpperCase()===c){m=s;break}}if(!m)return console.error(`Row for symbol \"${c}\" not found in data table`),alert(`Cannot Find ${e}`),null;let a=m.querySelectorAll(\".public_fixedDataTableCell_cellContent\"),T=a[4]?.textContent.trim(),f=a[5]?.textContent.trim();return console.log(`Extracted prices for ${c}: bid=${T}, offer=${f}`),{symbol:c,bidPrice:T,offerPrice:f}}var me=[\"F\",\"G\",\"H\",\"J\",\"K\",\"M\",\"N\",\"Q\",\"U\",\"V\",\"X\",\"Z\"];function fe(e=new Date){console.log(`getMonthlyCode called with date: ${e.toISOString()}`);let c=me[e.getUTCMonth()],l=e.getUTCFullYear()%10+\"\";return console.log(`Calculated monthly code: letter=${c}, yearDigit=${l}`),{letter:c,yearDigit:l}}function j(e=new Date){console.log(`getQuarterlyCode called with date: ${e.toISOString()}`);let c=[2,5,8,11],l={2:\"H\",5:\"M\",8:\"U\",11:\"Z\"};function i(r,n){let I=1+(5-new Date(Date.UTC(r,n,1)).getUTCDay()+7)%7+14;return new Date(Date.UTC(r,n,I,0,0,0))}let m=e.getUTCFullYear(),a=e.getUTCMonth();console.log(`Current month index: ${a}`),console.log(`Starting calculation with year=${m}, month=${a}`);let T=0;for(;!c.includes(a)&&(a++,a>11&&(a=0,m++),!(++T>12)););let f=i(m,a);e.getTime()>=f.getTime()&&(a+=3,a>11&&(a-=12,m++));let s={letter:l[a],yearDigit:m%10+\"\"};return console.log(`Calculated quarterly code: letter=${s.letter}, yearDigit=${s.yearDigit}`),s}console.log(\"Creating example front-quarter symbol\");var{letter:ge,yearDigit:ye}=j(),be=`NQ${ge}${ye}`;console.log(`Example front-quarter symbol created: ${be}`);var q={initialized:!1,options:{}},D=null;function Y(e={}){q.initialized=!0,q.options={...e},e.panel&&J(e.panel)}function J(e){D=e}function Ee(){return D?.mount?D.mount({visible:!1}):D?.createUI?D.createUI(!1):(console.warn(\"[TradoAuto] No UI adapter registered; skipping invisible UI creation\"),null)}var Te={state:M,futuresTickData:B,delay:O,normalizeSymbol:pe,updateSymbol:ue,updatePrice:de,clickExitForSymbol:se,moveStopLossToBreakeven:ae,getCurrentPosition:_,captureOrderFeedback:z,getOrderEvents:X,createBracketOrdersManual:H,autoTrade:U,getFrontQuarter:K,getMarketData:Z,getMonthlyCode:fe,getQuarterlyCode:j,init:Y,registerUIPanel:J,createInvisibleUI:Ee,getInitStatus:()=>({...q})};function ke(e={}){return Y(e),Te}var W=ke();typeof window<\"u\"&&(window.TradoAuto=W);var Q=W;function ee(e,{visible:c=!1}={}){if(console.log(`Creating UI (visible=${c})`),!e)return console.warn(\"[TradoUIPanel] renderPanel called without driver instance\"),null;let l=e.state,i=e.futuresTickData,m=e.normalizeSymbol,a=\"NQ\",T=a.replace(/[A-Z]\\d+$/,\"\"),f=i[T]||i.NQ;l.symbol=a,l.tp=f.defaultTP,l.sl=f.defaultSL,l.tickSize=f.tickSize;let s=f.defaultTP.toString(),r=f.defaultSL.toString(),n=\"10\",g=f.tickSize.toString();console.log(`Using defaults: TP=${s}, SL=${r}, Qty=${n}, Tick=${g}, Symbol=${a}`),console.log(`Symbol data for ${T}: defaultTP=${f.defaultTP}, defaultSL=${f.defaultSL}`);let u=document.createElement(\"div\");u.id=c?\"bracket-trade-box\":\"invisible-trade-inputs\",c?(Object.assign(u.style,{position:\"fixed\",background:\"#1e1e1e\",border:\"1px solid #444\",padding:\"12px\",zIndex:\"99999\",boxShadow:\"0 2px 10px rgba(0,0,0,0.5)\",borderRadius:\"8px\",color:\"#fff\",cursor:\"move\",fontFamily:\"sans-serif\",textAlign:\"center\",width:\"200px\"}),u.style.top=\"20px\",u.style.right=\"20px\"):Object.assign(u.style,{position:\"fixed\",top:\"-9999px\",left:\"-9999px\",visibility:\"hidden\",opacity:\"0\",pointerEvents:\"none\"}),c?u.innerHTML=`\n        <!-- Header with Symbol -->\n        <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;\">\n            <span style=\"font-weight:bold;cursor:grab;\">\\u283F Bracket</span>\n            <input type=\"text\" id=\"symbolInput\" value=\"${a}\"\n                style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                placeholder=\"Symbol\" />\n        </div>\n        \n        <!-- Hidden Tick Size Input -->\n        <div id=\"tickContainer\" style=\"display:none;margin-bottom:8px;\">\n            <label style=\"display:block;margin-bottom:4px;font-size:11px;\">Tick Size</label>\n            <input type=\"number\" id=\"tickInput\" step=\"0.01\" value=\"${g}\"\n                style=\"width:100%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n        </div>\n\n        <!-- Main Controls -->\n        <div id=\"mainControls\">\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:8px;\">\n                <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"tpInput\" value=\"${s}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Ticks\" />\n                    <input type=\"number\" id=\"tpPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"TP Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:12px;\">\n                <input type=\"checkbox\" id=\"slCheckbox\" checked />\n                <div style=\"display:flex;gap:4px;flex:1;\">\n                    <input type=\"number\" id=\"slInput\" value=\"${r}\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\"\n                        placeholder=\"SL Ticks\" />\n                    <input type=\"number\" id=\"slPriceInput\" step=\"0.01\"\n                        style=\"width:50%;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" \n                        placeholder=\"SL Price\" />\n                </div>\n            </div>\n            <div style=\"display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;\">\n                <button id=\"buyBtn\"  style=\"padding:6px 10px;background:#2ecc71;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Buy</button>\n                <div style=\"display:flex;flex-direction:column;gap:4px;\">\n                    <input type=\"number\" id=\"entryPriceInput\" placeholder=\"Entry\" step=\"0.01\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                    <input type=\"number\" id=\"qtyInput\" value=\"${n}\" min=\"1\"\n                        style=\"width:80px;text-align:center;border-radius:4px;border:1px solid #666;background:#2a2a2a;color:#fff;\" />\n                </div>\n                <button id=\"sellBtn\" style=\"padding:6px 10px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Sell</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-bottom:2px;\">\n                <button id=\"cancelAllBtn\" style=\"flex:1;padding:12px 8px;background:#e6b800;color:#000;border:none;border-radius:4px;font-weight:bold;\">Cancel</button>\n                <button id=\"closeAllBtn\" style=\"flex:3;padding:12px 8px;background:#e74c3c;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Close All</button>\n            </div>\n            <!-- NEW: Breakeven button above Reverse -->\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"breakevenBtn\" style=\"flex:1;padding:12px 8px;background:#6c5ce7;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Breakeven</button>\n            </div>\n            <div style=\"display:flex;gap:10px;margin-top:6px;\">\n                <button id=\"reverseBtn\" style=\"flex:1;padding:12px 8px;background:#ff6600;color:#fff;border:none;border-radius:4px;font-weight:bold;\">Reverse</button>\n            </div>\n        </div>`:u.innerHTML=`\n            <input type=\"text\" id=\"symbolInput\" value=\"${a}\" />\n            <input type=\"number\" id=\"tickInput\" value=\"${g}\" />\n            <input type=\"number\" id=\"tpInput\" value=\"${s}\" />\n            <input type=\"number\" id=\"slInput\" value=\"${r}\" />\n            <input type=\"number\" id=\"qtyInput\" value=\"${n}\" />\n            <input type=\"number\" id=\"entryPriceInput\" />\n            <input type=\"number\" id=\"tpPriceInput\" />\n            <input type=\"number\" id=\"slPriceInput\" />\n            <input type=\"checkbox\" id=\"tpCheckbox\" checked />\n            <input type=\"checkbox\" id=\"slCheckbox\" checked />\n        `;let b=c?\"bracket-trade-box\":\"invisible-trade-inputs\";if(document.getElementById(b))return console.log(`${b} already exists, skipping creation`),document.getElementById(b);document.body.appendChild(u),console.log(\"UI container added to DOM\"),console.log(\"Setting up universal event handlers\");let I=document.getElementById(\"slInput\"),C=document.getElementById(\"tpInput\"),E=document.getElementById(\"qtyInput\");I&&I.addEventListener(\"input\",()=>{console.log(`SL input changed to: ${I.value}`);let d=parseFloat(I.value);isNaN(d)||(l.sl=d,C&&(C.value=Math.round(d*3.5)),l.tp=Math.round(d*3.5),console.log(`Calculated TP: ${l.tp} (SL \\xD7 3.5)`))}),C&&C.addEventListener(\"input\",()=>{console.log(`TP input changed to: ${C.value}`);let d=parseFloat(C.value);isNaN(d)||(l.tp=d)}),E&&E.addEventListener(\"input\",d=>{console.log(`Quantity input changed to: ${d.target.value}`);let y=parseInt(d.target.value);!isNaN(y)&&y>0&&(l.qty=y)});let k=document.getElementById(\"symbolInput\");k&&(k.addEventListener(\"input\",d=>{console.log(`Symbol input changed to: ${d.target.value}`),l.symbol=d.target.value}),k.addEventListener(\"change\",d=>{let y=d.target.value,A=m(y);console.log(`Symbol changed to: ${y}, normalized: ${A}`);let p=y.replace(/[A-Z]\\d+$/,\"\"),o=i[p];if(o){console.log(`Found default values for ${p}: SL=${o.defaultSL}, TP=${o.defaultTP}`);let S=document.getElementById(\"slInput\"),v=document.getElementById(\"tpInput\"),t=document.getElementById(\"tickInput\");S.value=o.defaultSL,v.value=o.defaultTP,l.sl=o.defaultSL,l.tp=o.defaultTP,typeof o.tickSize==\"number\"&&(t.value=o.tickSize,l.tickSize=o.tickSize,console.log(`Updated tick size to ${o.tickSize} for ${p}`)),console.log(`\\u2705 Updated SL/TP to default values for ${p}: SL=${S.value}, TP=${v.value}`)}e.updateSymbol(\".trading-ticket .search-box--input\",A)}));let R=document.getElementById(\"tickInput\");if(R&&R.addEventListener(\"input\",d=>{console.log(`Tick size input changed to: ${d.target.value}`);let y=parseFloat(d.target.value);!isNaN(y)&&y>0&&(l.tickSize=y)}),c){console.log(\"Setting up UI event handlers\"),document.getElementById(\"closeAllBtn\").addEventListener(\"click\",()=>{console.log(\"Close All button clicked\");try{let p=document.getElementById(\"symbolInput\").value||\"NQ\",o=m(p);console.log(`Calling clickExitForSymbol for: ${o} with Exit at Mkt & Cxl option`),e.clickExitForSymbol(o,\"cancel-option-Exit-at-Mkt-Cxl\"),console.log(\"Exit action triggered for symbol:\",o)}catch(p){console.error(\"Close All operation failed:\",p);try{console.log(\"Attempting fallback close method with danger buttons\"),document.getElementsByClassName(\"btn btn-danger\")[0]?.click(),setTimeout(()=>{document.getElementsByClassName(\"btn btn-danger\")[1]?.click(),document.getElementsByClassName(\"btn btn-danger\")[2]?.click()},200)}catch(o){console.error(\"Fallback close method also failed:\",o)}}}),document.getElementById(\"cancelAllBtn\").addEventListener(\"click\",()=>{console.log(\"Cancel All button clicked\");try{let p=document.getElementById(\"symbolInput\").value||\"NQ\",o=m(p);console.log(`Calling clickExitForSymbol for: ${o} with Cancel All option`),e.clickExitForSymbol(o,\"cancel-option-Cancel-All\"),console.log(\"Cancel All action triggered for symbol:\",o)}catch(p){console.error(\"Cancel All operation failed:\",p)}}),document.getElementById(\"reverseBtn\").addEventListener(\"click\",()=>{console.log(\"Reverse Position button clicked\");try{let p=document.getElementById(\"symbolInput\").value||\"NQ\",o=m(p);console.log(`Calling clickExitForSymbol for: ${o} with Reverse & Cxl option`),e.clickExitForSymbol(o,\"cancel-option-Reverse-Cxl\"),console.log(\"Reverse Position action triggered for symbol:\",o)}catch(p){console.error(\"Reverse Position operation failed:\",p)}}),document.getElementById(\"breakevenBtn\").addEventListener(\"click\",()=>{console.log(\"Breakeven button clicked\");try{let p=document.getElementById(\"symbolInput\").value||\"NQ\",o=m(p);console.log(`Processing breakeven for symbol: ${o}`),e.moveStopLossToBreakeven(o),console.log(\"Breakeven action triggered for symbol:\",o)}catch(p){console.error(\"Breakeven operation failed:\",p)}}),console.log(\"Setting up default values\"),document.getElementById(\"symbolInput\").value=\"NQ\",document.getElementById(\"tickInput\").value=l.tickSize,console.log(\"Setting up drag functionality\");let d=!1,y,A;u.addEventListener(\"mousedown\",p=>{console.log(\"Container mousedown event detected\"),d=!0,y=p.clientX-u.getBoundingClientRect().left,A=p.clientY-u.getBoundingClientRect().top,console.log(`Drag started at offset X:${y}, Y:${A}`),u.style.cursor=\"grabbing\"}),document.addEventListener(\"mousemove\",p=>{if(d){let o=`${p.clientX-y}px`,S=`${p.clientY-A}px`;p.clientX%20===0&&console.log(`Dragging panel to X:${o}, Y:${S}`),u.style.left=o,u.style.top=S,u.style.right=\"unset\"}}),document.addEventListener(\"mouseup\",()=>{d&&console.log(`Container drop position: Left:${u.style.left}, Top:${u.style.top}`),d=!1,u.style.cursor=\"grab\"}),console.log(\"Setting up trade buttons\"),document.getElementById(\"buyBtn\").addEventListener(\"click\",()=>{console.log(\"BUY button clicked\");let p=document.getElementById(\"symbolInput\").value||\"NQ\",o=+E.value,S=+C.value,v=+I.value,t=+document.getElementById(\"tickInput\").value;console.log(`Initiating BUY order: Symbol=${p}, Qty=${o}, TP=${S}, SL=${v}, TickSize=${t}`),e.autoTrade(p,o,\"Buy\",S,v,t).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after BUY order\")})}),document.getElementById(\"sellBtn\").addEventListener(\"click\",()=>{console.log(\"SELL button clicked\");let p=document.getElementById(\"symbolInput\").value||\"NQ\",o=+E.value,S=+C.value,v=+I.value,t=+document.getElementById(\"tickInput\").value;console.log(`Initiating SELL order: Symbol=${p}, Qty=${o}, TP=${S}, SL=${v}, TickSize=${t}`),e.autoTrade(p,o,\"Sell\",S,v,t).finally(()=>{document.getElementById(\"entryPriceInput\").value=\"\",document.getElementById(\"tpPriceInput\").value=\"\",document.getElementById(\"slPriceInput\").value=\"\",console.log(\"Price inputs reset after SELL order\")})})}return console.log(\"State management: Using in-memory state only, no persistence\"),u}function te({driverInstance:e=Q}={},c={}){let l=!1,i=!1,m=null;function a(n={}){let{visible:g=!0}={...c,...n},u=ee(e,{visible:g});return u&&(l=!0,i=g,m=u),u}function T(){return a({visible:!1})}function f(){return a({visible:!0})}function s(){let n=!1,g=document.getElementById(\"bracket-trade-box\"),u=document.getElementById(\"invisible-trade-inputs\");return g&&(g.remove(),n=!0),u&&(u.remove(),n=!0),n&&(l=!1,i=!1,m=null),n}function r(){return{mounted:l,visible:i,hasPanel:!!document.getElementById(\"bracket-trade-box\"),hasInvisiblePanel:!!document.getElementById(\"invisible-trade-inputs\"),lastContainer:m}}return{mount:a,createUI:a,createInvisibleUI:T,show:f,hide:s,getStatus:r,render:n=>ee(e,n)}}var G=te();Q.registerUIPanel(G);typeof window<\"u\"&&(window.TradoUIPanel=G);var Se=G;return ce($e);})();\n//# sourceMappingURL=tradovate_ui_panel.js.map\n";

    function inject(code, id) {
        if (!code) {
            console.warn(`[AutoOrder] No code supplied for ${id}, skipping injection.`);
            return;
        }

        const scriptId = `trado-${id}`;
        if (document.getElementById(scriptId)) {
            console.debug(`[AutoOrder] Script ${scriptId} already present, skipping duplicate injection.`);
            return;
        }

        const script = document.createElement('script');
        script.id = scriptId;
        script.type = 'text/javascript';
        script.textContent = code;
        document.head.appendChild(script);
        console.debug(`[AutoOrder] Injected ${id} bundle.`);
    }

    function waitForGlobal(name, timeout = 8000) {
        return new Promise((resolve, reject) => {
            const start = Date.now();
            (function check() {
                if (window[name]) {
                    resolve(window[name]);
                    return;
                }
                if (Date.now() - start > timeout) {
                    reject(new Error(`${name} not available within ${timeout}ms`));
                    return;
                }
                requestAnimationFrame(check);
            })();
        });
    }

    inject(driverSource, 'auto-driver');
    inject(panelSource, 'ui-panel');

    Promise.all([
        waitForGlobal('TradoAuto'),
        waitForGlobal('TradoUIPanel')
    ]).then(([autoDriver, uiPanel]) => {
        try {
            autoDriver.init?.({ source: 'tampermonkey' });
        } catch (err) {
            console.error('[AutoOrder] Failed to init driver', err);
        }

        try {
            uiPanel.mount?.({ visible: true });
        } catch (err) {
            console.error('[AutoOrder] Failed to mount UI panel', err);
        }

        console.info('[AutoOrder] Driver and panel ready.');
    }).catch(err => {
        console.error('[AutoOrder] Initialization failed', err);
    });
})();
